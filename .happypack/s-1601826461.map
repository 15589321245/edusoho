{"version":3,"sources":["app/Resources/static-src/app/js/task-manage/create/index.js"],"names":["Editor","$modal","$element","$task_manage_content","$","$task_manage_type","$frame","$iframe_body","iframe_jQuery","iframe_name","mode","data","type","step","loaded","contentUrl","_init","_initEvent","click","_onSave","event","_onNext","_onPrev","_onSetType","_onDelete","_inItStep1form","_renderContent","_switchPage","e","_validator","$this","currentTarget","addClass","siblings","removeClass","val","_renderNext","isCreateOperation","isDaysMode","isNormalCourseSet","isLiveType","confirmResult","console","log","confirm","_askSave","attr","postData","serializeArray","concat","find","alert","length","post","done","response","modal","append","undefined","sortable","get","ids","document","location","reload","html","chapterId","input","name","add","$parent","value","nextAll","each","hasClass","before","fail","msg","errorResponse","JSON","parse","responseText","error","message","$btn","url","then","_renderStep","_rendStepIframe","_rendButton","_initIframe","show","iFrameResize","loadiframe","validator","contentWindow","contents","load","$step1_form","validate","rules","mediaType","required","messages","$from","form","_renderPrev","_rendSubmit","prev","next","removeAttr"],"mappings":"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","file":"index.js","sourceRoot":"/Users/kz/projects/edusoho","sourcesContent":["import loadAnimation from 'common/load-animation'\nimport 'jquery-sortable';\nimport notify from \"common/notify\";\n\nclass Editor {\n  constructor($modal) {\n    this.$element = $modal;\n    this.$task_manage_content = $('#task-create-content');\n    this.$task_manage_type = $('#task-create-type');\n    this.$frame = null;\n    this.$iframe_body = null;\n    this.iframe_jQuery = null;\n    this.iframe_name = 'task-create-content-iframe';\n    this.mode = this.$task_manage_type.data('editorMode');\n    this.type = this.$task_manage_type.data('editorType');\n    this.step = 1;\n    this.loaded = false;\n    this.contentUrl = '';\n    this._init();\n    this._initEvent();\n  }\n\n  _initEvent() {\n    $('#course-tasks-submit').click(event => this._onSave(event));\n    $('#course-tasks-next').click(event => this._onNext(event));\n    $('#course-tasks-prev').click(event => this._onPrev(event));\n    if (this.mode != 'edit') {\n      $('.js-course-tasks-item').click(event => this._onSetType(event));\n    } else {\n      $('.delete-task').click(event => this._onDelete(event));\n    }\n  }\n\n  _init() {\n    this._inItStep1form();\n    this._renderContent(this.step);\n    if (this.mode == 'edit') {\n      this.contentUrl = this.$task_manage_type.data('editorStep2Url');\n      this.step = 2;\n      this._switchPage();\n    }\n  }\n\n  _onNext(e) {\n    if (this.step === 3 || !this._validator(this.step)) {\n      return;\n    }\n    this.step += 1;\n    this._switchPage();\n  }\n\n  _onPrev() {\n    // 第二页可以上一步\n    if (this.step === 1 || (this.step == 3 && !this._validator(this.step))) {\n      return;\n    }\n\n    this.step -= 1;\n    this._switchPage();\n  }\n\n  _onSetType(event) {\n    let $this = $(event.currentTarget).addClass('active');\n    $this.siblings().removeClass('active');\n    let type = $this.data('type');\n    $('[name=\"mediaType\"]').val(type);\n    this.contentUrl = $this.data('contentUrl');\n    this.type !== type ? (this.loaded = false) : (this.loaded = true);\n    this.type = type;\n    this._renderNext(true);\n  }\n\n  _askSave(){\n    const isCreateOperation = $('#task-create-type').data('editor-mode') == 'create';\n    const isDaysMode = $('#courseExpiryMode').val() == 'days';\n    const isNormalCourseSet = $('#courseSetType').val() == 'normal';\n    const isLiveType = this.type == 'live';\n    let confirmResult = true;\n    console.log($('#courseExpiryMode').val());\n    if(isCreateOperation && isDaysMode && isNormalCourseSet && isLiveType){\n      confirmResult = confirm('本计划的学习加入方式为“随到随学”，加入直播活动可能会导致后来的学员无法参加，只能观看回放。确定要添加吗？');\n    }\n\n    return confirmResult;\n  }\n\n  _onSave(event) {\n    if (!this._validator(this.step)) {\n      return;\n    }\n\n    if(!this._askSave()){\n      return;\n    }\n\n    $(event.currentTarget).attr('disabled', 'disabled');\n    let postData = $('#step1-form').serializeArray()\n      .concat(this.$iframe_body.find('#step2-form').serializeArray())\n      .concat(this.$iframe_body.find(\"#step2-form\").serializeArray());\n    alert($('#step1-form').serializeArray().length);\n    alert(this.$iframe_body.find('#step2-form').serializeArray().length);\n    alert(this.$iframe_body.find('#step3-form').serializeArray().length);\n    alert(postData.length);\n    $.post(this.$task_manage_type.data('saveUrl'), postData)\n      .done((response) => {\n        this.$element.modal('hide');\n        if (response && response.append !== undefined && response.append === false) {\n          let data = $('#sortable-list').sortable(\"serialize\").get();\n          $.post($('#sortable-list').data('sortUrl'), {ids: data}, (response) => {\n            if (response) {\n              document.location.reload();\n            }\n          });\n        }\n        let html = response;\n        let chapterId = postData.find(function (input) {\n          return input.name == 'chapterId';\n        })\n\n        var add = 0;\n        let $parent = $('#' + chapterId.value);\n\n        if ($parent.length) {\n          $parent.nextAll().each(function () {\n            if ($(this).hasClass('task-manage-chapter')) {\n              $(this).before(html);\n              add = 1;\n              return false;\n            }\n            if ($parent.hasClass('task-manage-unit') && $(this).hasClass('task-manage-unit')) {\n              $(this).before(html);\n              add = 1;\n              return false;\n            }\n          });\n          if (add != 1) {\n            $(\"#sortable-list\").append(html);\n            add = 1;\n          }\n        } else {\n          $(\"#sortable-list\").append(html);\n        }\n\n        let data = $('#sortable-list').sortable(\"serialize\").get();\n        $.post($('#sortable-list').data('sortUrl'), {ids: data});\n      })\n      .fail((response) => {\n        let msg = '';\n        let errorResponse = JSON.parse(response.responseText);\n        if (errorResponse.error && errorResponse.error.message) {\n          msg = errorResponse.error.message;\n        }\n        notify('warning', '保存出错: ' + msg);\n        $(\"#course-tasks-submit\").attr('disabled', null);\n      });\n  }\n\n  _onDelete(event) {\n    let $btn = $(event.currentTarget);\n    let url = $btn.data('url');\n    if (url === undefined) {\n      return;\n    }\n\n    $.post(url)\n      .then((response) => {\n        notify('success', '删除成功');\n        this.$element.modal('hide');\n        document.location.reload();\n      })\n      .fail(error => {\n        notify('warning', '删除失败~~');\n      })\n  }\n\n  _switchPage() {\n    this._renderStep(this.step);\n    this._renderContent(this.step);\n    this._rendStepIframe(this.step);\n    this._rendButton(this.step);\n    if (this.step == 2 && !this.loaded) {\n      this._initIframe();\n    }\n  }\n\n  _initIframe() {\n    let html = '<iframe class=\"' + this.iframe_name + '\" id=\"' + this.iframe_name + '\" name=\"' + this.iframe_name + '\" scrolling=\"no\" src=\"' + this.contentUrl + '\"></iframe>';\n    this.$task_manage_content.html(html).show();\n    this.$frame = $('#' + this.iframe_name).iFrameResize();\n    let loadiframe = () => {\n      this.loaded = true;\n      let validator = {};\n      this.iframe_jQuery = this.$frame[0].contentWindow.$;\n      this.$iframe_body = this.$frame.contents().find('body').addClass('task-iframe-body');\n      this._rendButton(2);\n      this.$iframe_body.find(\"#step2-form\").data('validator', validator);\n      this.$iframe_body.find(\"#step3-form\").data('validator', validator);\n\n    };\n    this.$frame.load(loadAnimation(loadiframe, this.$task_manage_content));\n  }\n\n  _inItStep1form() {\n    let $step1_form = $(\"#step1-form\");\n    let validator = $step1_form.validate({\n      rules: {\n        mediaType: {\n          required: true,\n        },\n      },\n      messages: {\n        mediaType: \"请选择%display%\",\n      }\n    });\n    $step1_form.data('validator', validator);\n  }\n\n  _validator(step) {\n    let validator = null;\n    if (step === 1) {\n      validator = $(\"#step1-form\").data('validator');\n    } else if (this.loaded) {\n      var $from = this.$iframe_body.find(\"#step\" + step + \"-form\");\n      validator = this.iframe_jQuery.data($from[0], 'validator');\n    }\n\n    if (validator && !validator.form()) {\n      return false;\n    }\n    return true;\n  }\n\n  _rendButton(step) {\n    if (step === 1) {\n      this._renderPrev(false);\n      this._rendSubmit(false);\n      this._renderNext(true);\n    } else if (step === 2) {\n      this._renderPrev(true);\n      if (this.mode === 'edit') {\n        this._renderPrev(false);\n      }\n      if (!this.loaded) {\n        this._rendSubmit(false);\n        this._renderNext(false);\n        return;\n      }\n      this._rendSubmit(true);\n      this._renderNext(true);\n    } else if (step === 3) {\n      this._renderNext(false);\n      this._renderPrev(true);\n    }\n  }\n\n  _rendStepIframe(step) {\n    if (!this.loaded || !this.$iframe_body) {\n      return;\n    }\n    (step === 2) ? this.$iframe_body.find(\".js-step2-view\").addClass('active') : this.$iframe_body.find(\".js-step2-view\").removeClass('active');\n    (step === 3) ? this.$iframe_body.find(\".js-step3-view\").addClass('active') : this.$iframe_body.find(\".js-step3-view\").removeClass('active');\n  }\n\n  _renderStep(step) {\n    $('#task-create-step').find('li:eq(' + (step - 1) + ')').addClass('doing').prev().addClass('done').removeClass('doing');\n    $('#task-create-step').find('li:eq(' + (step - 1) + ')').next().removeClass('doing').removeClass('done');\n  }\n\n  _renderContent(step) {\n    (step === 1) ? this.$task_manage_type.removeClass('hidden') : this.$task_manage_type.addClass('hidden');\n    (step !== 1) ? this.$task_manage_content.removeClass('hidden') : this.$task_manage_content.addClass('hidden');\n  }\n\n  _renderNext(show) {\n    show ? $(\"#course-tasks-next\").removeClass('hidden').removeAttr(\"disabled\") : $(\"#course-tasks-next\").addClass('hidden');\n  }\n\n  _renderPrev(show) {\n    show ? $(\"#course-tasks-prev\").removeClass('hidden') : $(\"#course-tasks-prev\").addClass('hidden');\n  }\n\n  _rendSubmit(show) {\n    show ? $(\"#course-tasks-submit\").removeClass('hidden') : $(\"#course-tasks-submit\").addClass('hidden');\n  }\n\n}\n\nnew Editor($('#modal'));\n"]}