{"version":3,"sources":["app/Resources/static-src/app/js/player/balloon-cloud-video-player-new.js"],"names":["BalloonCloudVideoPlayer","options","player","setup","element","hasFlashPlayerVersion","test","navigator","userAgent","$","css","html","self","extConfig","textTrack","length","Object","assign","watermark","file","pos","xrepeat","opacity","fingerprint","duration","fingerprintTime","timelimit","pluck","text","display","enablePlaybackRates","isBrowserSupportPlaybackRates","playbackRates","enable","source","src","url","controlBar","statsInfo","accesskey","globalId","userId","userName","id","attr","disableControlBar","disableProgressBar","playlist","remeberLastPos","videoHeaderLength","VideoPlayerSDK","on","e","emit","data","result","choosed","convertQuestionType","type","play","pause","getCurrentTime","time","setCurrentTime","paused","questions","i","exam","popupExam","config","setExams","nUserAgent","toLowerCase","isIE","indexOf","isIE11","isChrome","isSafari","matched","match","from","map","es","cloud"],"mappings":"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","file":"balloon-cloud-video-player-new.js","sourceRoot":"/Users/kz/projects/edusoho","sourcesContent":["import Emitter from 'component-emitter';\nimport swfobject from 'es-swfobject';\n\nclass BalloonCloudVideoPlayer extends Emitter {\n\n  constructor(options) {\n    super();\n    this.options = options;\n    this.player = {};\n    this.setup();\n  }\n\n  setup() {\n    let element = this.options.element;\n    // todo delete, to move into the cloud player\n    if (!swfobject.hasFlashPlayerVersion('11') && !/(iPhone|iPad|iPod|iOS|Android)/i.test(navigator.userAgent)) {\n      $(element).css({'background-color': '#313131', 'position': 'relative'});\n      $(element).html('<p style=\"color:#fff; position: absolute; top: 49%; left:0; right:0\">您的浏览器未装Flash播放器或版本太低，请先安装或升级Flash播放器。请点击<a target=\"_blank\" href=\"http://www.adobe.com/go/getflashplayer\">这里</a>安装最新版本</p>');\n      return;\n    }\n\n    var self = this;\n\n    let extConfig = {};\n\n    //字幕\n    if (self.options.textTrack.length) {\n      extConfig = Object.assign(extConfig, {\n        textTrack: self.options.textTrack\n      });\n    }\n\n    if (self.options.watermark) {\n      extConfig = Object.assign(extConfig, {\n        watermark: {\n          file: self.options.watermark,\n          pos: 'top.right', //top.right, bottom.right, bottom.left, center\n          xrepeat: 0,\n          opacity: 0.5\n        }\n      });\n    }\n\n    if (self.options.fingerprint) {\n      extConfig = Object.assign(extConfig, {\n        fingerprint: {\n          html: self.options.fingerprint,\n          duration: self.options.fingerprintTime\n        }\n      })\n    }\n\n    if (self.options.timelimit) {\n      extConfig = Object.assign(extConfig, {\n        pluck: {\n          timelimit: self.options.timelimit,\n          text: \"免费试看结束，购买后可完整观看\",\n          display: true\n        }\n      })\n    }\n\n    if (self.options.enablePlaybackRates && self.isBrowserSupportPlaybackRates()) {\n      extConfig = Object.assign(extConfig, {\n        playbackRates: {\n          enable: true,\n          source: 'hls',\n          src: self.options.url\n        }\n      });\n    }\n\n    if (self.options.controlBar) {\n      extConfig = Object.assign(extConfig, {\n        controlBar: self.options.controlBar\n      });\n    }\n\n    if (self.options.statsInfo) {\n      var statsInfo = self.options.statsInfo;\n      extConfig = Object.assign(extConfig, {\n        statsInfo: {\n          accesskey: statsInfo.accesskey,\n          globalId: statsInfo.globalId,\n          userId: statsInfo.userId,\n          userName: statsInfo.userName\n        }\n      });\n    }\n\n    extConfig = Object.assign(extConfig, {\n      id: $(self.options.element).attr('id'),\n      disableControlBar: self.options.disableControlBar,\n      disableProgressBar: self.options.disableProgressBar,\n      playlist: self.options.url,\n      remeberLastPos: self.options.remeberLastPos,\n      videoHeaderLength: self.options.videoHeaderLength\n    })\n    var player = new VideoPlayerSDK(extConfig);\n\n    player.on('ready', function (e) {\n      self.emit(\"ready\", e);\n    });\n\n    player.on(\"timeupdate\", function (e) {\n      //    player.__events get all the event;\n      self.emit(\"timechange\", e);\n    });\n\n    player.on(\"ended\", function (e) {\n      self.emit(\"ended\", e);\n    });\n\n    player.on(\"playing\", function (e) {\n      self.emit(\"playing\", e);\n    });\n\n    player.on(\"paused\", function (e) {\n      self.emit(\"paused\", e);\n    });\n\n    player.on(\"answered\", function (e) {\n      var data = e.data;\n      data['answer'] = data.result.choosed;\n      data['type'] = self.convertQuestionType(data.type, 'cloud');\n      self.emit(\"answered\", data);\n    });\n\n    this.player = player;\n  }\n\n  play() {\n    this.player.play();\n  }\n\n  pause() {\n    this.player.pause();\n  }\n\n  getCurrentTime() {\n    return this.player.getCurrentTime();\n  }\n\n  setCurrentTime(time) {\n    this.player.setCurrentTime(time);\n    return this;\n  }\n\n  replay() {\n    this.setCurrentTime(0).play();\n    return this;\n  }\n\n  isPlaying() {\n    if (this.player && this.player.paused) {\n      return !this.player.paused();\n    }\n    return false;\n  }\n\n  setQuestions(questions) {\n\n    if (questions.length > 0) {\n\n      for (var i in questions) {\n        questions[i]['type'] = this.convertQuestionType(questions[i].type, 'es');\n      }\n\n      var exam = {\n        popupExam: {\n          config: {\n            \"mode\": \"middle\"\n          },\n          questions: questions\n        }\n      }\n\n      this.player.setExams(exam);\n    }\n\n    return this;\n  }\n\n  isBrowserSupportPlaybackRates() {\n    var nUserAgent = navigator.userAgent.toLowerCase();\n    // IE不支持，低版本(47以下)的chrome不支持\n    var isIE = nUserAgent.indexOf('msie') > 0;\n    var isIE11 = nUserAgent.indexOf('trident') > 0 && nUserAgent.indexOf('rv') > 0;\n    var isChrome = nUserAgent.indexOf('chrome') > 0;\n    var isSafari = nUserAgent.indexOf('safari') > 0 && !isChrome;\n\n    if (isIE11 || isIE || isSafari) {\n      return false;\n    }\n    if (isChrome) {\n      var matched = navigator.userAgent.match(/Chrome\\/(\\d{0,3})/i);\n      if (matched && matched[1] < 47) {\n        return false;\n      }\n    }\n\n    return true;\n  }\n\n  convertQuestionType(source, from) {\n    var map = [ //云播放器弹题的字段值跟ES不太一致\n      {\n        es: 'choice',\n        cloud: 'multiChoice'\n      }, {\n        es: 'single_choice',\n        cloud: 'choice'\n      }, {\n        es: 'determine',\n        cloud: 'judge'\n      }, {\n        es: 'fill',\n        cloud: 'completion'\n      }, {\n        es: 'uncertain_choice',\n        cloud: 'uncertainChoice'\n      }\n    ];\n\n    for (var i in map) {\n      if (from == 'es' && map[i]['es'] == source) {\n        return map[i]['cloud'];\n      }\n      if (from == 'cloud' && map[i]['cloud'] == source) {\n        return map[i]['es'];\n      }\n    }\n\n    return source;\n  }\n\n}\n\nexport default BalloonCloudVideoPlayer;\n"]}