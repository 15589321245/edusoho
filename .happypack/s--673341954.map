{"version":3,"sources":["app/Resources/static-src/app/js/testpaper-manage/create/index.js"],"names":["TestpaperForm","$form","$description","find","validator","difficultySlider","_initEvent","_initEditor","_initValidate","_initSortList","scoreSlider","on","_submit","event","changeMode","changeRange","changeCount","passScore","score","document","getElementById","option","start","connect","tooltips","step","range","updateOptions","noUiSlider","create","values","handle","$","text","toFixed","parseInt","attr","tooltip","html","$this","currentTarget","val","removeClass","initDifficultySlider","addClass","sliders","margin","serialization","resolution","simplePercentage","normalPercentage","difficultyPercentage","Translator","trans","editor","CKEDITOR","replace","toolbar","filebrowserImageUploadUrl","data","height","getData","num","each","index","item","validate","rules","name","required","description","maxlength","limitedTime","min","max","digits","mode","questioncount","messages","self","length","element","itemSelector","ajax","status","form","submit"],"mappings":"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","file":"index.js","sourceRoot":"/Users/kz/projects/edusoho","sourcesContent":["import sortList from 'common/sortable';\n\nclass TestpaperForm{\n  constructor($form) {\n    this.$form = $form;\n    this.$description = this.$form.find('[name=\"description\"]');\n    this.validator = null;\n    this.difficultySlider = null;\n    this._initEvent();\n    this._initEditor();\n    this._initValidate();\n    this._initSortList();\n    this.scoreSlider = null;\n  }\n\n  _initEvent() {\n    this.$form.on('click','[data-role=\"submit\"]',event=>this._submit(event));\n    this.$form.on('click','[name=\"mode\"]',event=>this.changeMode(event));\n    this.$form.on('click','[name=\"range\"]',event=>this.changeRange(event));\n    this.$form.on('blur','[data-role=\"count\"]',event=>this.changeCount(event));\n  }\n\n  initScoreSlider(passScore,score) {\n    let scoreSlider = document.getElementById('score-slider');\n    let option = {\n      start: passScore,\n      connect: [true, false],\n      tooltips: [true],\n      step: 1,\n      range: {\n        'min': 0,\n        'max': score\n      }\n    }\n    if(this.scoreSlider) {\n      this.scoreSlider.updateOptions(option);\n    }else {\n      this.scoreSlider = noUiSlider.create(scoreSlider,option);\n      scoreSlider.noUiSlider.on('update', function( values, handle ){\n        $('.noUi-tooltip').text(`${(values[handle]/score*100).toFixed(0)}%`);\n        $('.js-passScore').text(parseInt(values[handle]));\n      });\n    }\n    $('.noUi-handle').attr('data-placement','top').attr('data-original-title',`达标分数：<span class=\"js-passScore\">${passScore}</span>分`).attr('data-container','body');\n    $('.noUi-handle').tooltip({html: true})\n    $('.noUi-tooltip').text(`${(passScore/score*100).toFixed(0)}%`);\n  }\n\n  changeMode(event) {\n    let $this = $(event.currentTarget);\n    if($this.val() == 'difficulty') {\n      this.$form.find('#difficulty-form-group').removeClass('hidden');\n      this.initDifficultySlider();\n    }else {\n      this.$form.find('#difficulty-form-group').addClass('hidden')\n    }\n  }\n\n  changeRange(event) {\n    let $this = $(event.currentTarget);\n    ($this.val() == 'course') ? this.$form.find('#testpaper-range-selects').addClass('hidden') : this.$form.find('#testpaper-range-selects').removeClass('hidden');\n  }\n\n  initDifficultySlider() {\n    if(!this.difficultySlider ) {\n      let sliders = document.getElementById('difficulty-percentage-slider');\n      this.difficultySlider = noUiSlider.create(sliders, {\n        start: [ 30, 70 ],\n        margin: 30,\n        range: {\n          'min': 0,\n          'max': 100\n        },\n        step: 1,\n        connect: [true, true,true],\n        serialization: {\n          resolution: 1\n        },\n      });\n      sliders.noUiSlider.on('update', function( values, handle ){\n        let simplePercentage = parseInt(values[0]),\n        normalPercentage = values[1] - values[0],\n        difficultyPercentage = 100 - values[1];\n        $('.js-simple-percentage-text').html(Translator.trans('简单') + simplePercentage + '%');\n        $('.js-normal-percentage-text').html(Translator.trans('一般') + normalPercentage + '%');\n        $('.js-difficulty-percentage-text').html(Translator.trans('困难') + difficultyPercentage + '%');\n        $('input[name=\"percentages[simple]\"]').val(simplePercentage);\n        $('input[name=\"percentages[normal]\"]').val(normalPercentage);\n        $('input[name=\"percentages[difficulty]\"]').val(difficultyPercentage);\n      });\n    }\n  }\n\n  _initEditor() {\n    let editor = CKEDITOR.replace(this.$description.attr('id'), {\n      toolbar: 'Simple',\n      filebrowserImageUploadUrl: this.$description.data('imageUploadUrl'),\n      height: 100\n    });\n    editor.on( 'change', () => {    \n      this.$description.val(editor.getData());\n    });\n  }\n\n  changeCount() {\n    let num = 0;\n    this.$form.find('[data-role=\"count\"]').each(function(index,item){\n      num += parseInt($(item).val());\n    });\n    this.$form.find('[name=\"questioncount\"]').val(num > 0 ? num : null);\n  }\n\n  _initValidate() {\n    this.validator = this.$form.validate({\n      rules:{\n        name:{\n          required:true\n        },\n        description:{\n          required:true,\n          maxlength:500\n        },\n        limitedTime:{\n          min:0,\n          max:10000,\n          digits:true\n        },\n        mode:{\n          required:true\n        },\n        range:{\n          required:true\n        },\n        questioncount: {\n          required:true\n        }\n      },\n      messages:{\n        questioncount:\"请选择题目\",\n        name:\"请输入试卷名称\",\n        description:\"请输入试卷描述\",\n        mode:\"请选择生成方式\",\n        range:\"请选择出题范围\"\n      }\n    });\n    this.$form.find('.testpaper-question-option-item').each(function(){\n      let self = $(this);\n      self.find('[data-role=\"count\"]').rules('add',{\n        min:0,\n        max:function(){\n          return parseInt(self.find('[role=\"questionNum\"]').text());\n        },\n        digits:true\n      })\n\n      self.find('[data-role=\"score\"]').rules('add',{\n        min:0,\n        max:100,\n        digits:true\n      })\n\n      if (self.find('[data-role=\"missScore\"]').length > 0) {\n        self.find('[data-role=\"missScore\"]').rules('add',{\n          min:0,\n          max:function(){\n            return parseInt(self.find('[data-role=\"score\"]').val());\n          },\n          digits:true\n        })\n      }\n    })\n\n  }\n\n  _initSortList() {\n    sortList({\n      element:'#testpaper-question-options',\n      itemSelector:'.testpaper-question-option-item',\n      handle: '.question-type-sort-handler',\n      ajax:false\n    });\n  }\n\n  _submit(event){\n    let status = this.validator.form();\n    if (status) {\n      this.$form.submit();\n    }\n  }\n}\n\nnew TestpaperForm($('#testpaper-form'));\n\n\n"]}