{"version":3,"sources":["plugins/VipPlugin/Resources/static-src/js/order/index.js"],"names":["$form","$","validator","validate","rules","duration","required","maxlength","digits","messages","find","on","refresh","refresh_price","val","$defaultBuyMonth","$defaultBuyYear","submit","target","prices","data","coinDisplay","cashRate","coinName","each","price","parent","remove","append","unit","hide","show","startDate","deadline","moment","add","format","html","removeClass"],"mappings":"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","file":"index.js","sourceRoot":"/Users/kz/projects/edusoho","sourcesContent":["import 'moment';\nlet $form = $(\"#member-buy-form\");\n\nlet validator = $form.validate({\n    rules: {\n        duration: {\n            required: true,\n            maxlength: 9999,\n            digits: true\n        }\n    },\n    messages: {\n        duration: {\n            required: '请输入开通时长',\n            maxlength: '开通时长必须小于或者等于999',\n            digits: '开通时长必须为整数'\n        }\n    }\n});\n\n$form.find('[name=level]').on('change', function() {\n    refresh();\n});\n$form.find('[name=targetId]').on('change', function() {\n    refresh_price();\n});\n\n$form.find('[name=unit]').on('change', function() {\n    if ($form.find('[name=unit]:checked').val() == 'month') {\n        let $defaultBuyMonth = $('[name=defaultBuyMonth]').val();\n        $form.find('[name=duration]').val($defaultBuyMonth);\n    } else {\n        let $defaultBuyYear = $('[name=defaultBuyYear]').val();\n        $form.find('[name=duration]').val($defaultBuyYear);\n    }\n    refresh();\n});\n\n$form.find('[name=duration]').on('change', function() {\n    refresh();\n});\n\n$(\"#member-order-confirm-btn\").on('click', function() {\n    $form[0].submit();\n});\n\nrefresh();\nrefresh_price();\n\nfunction refresh_price() {\n    let $form = $(\"#member-buy-form\");\n    let target = $form.find('[name=targetId]:checked').val() || $form.find('[name=targetId]').val();\n    let prices = $form.find('.js-vip-price').data('vipPrice');\n    let coinDisplay = $form.find('.js-vip-price').data('coinDisplay');\n    let cashRate = $form.find('.js-vip-price').data('cashRate');\n    let coinName = $form.find('.js-vip-price').data('coinName');\n    if(coinDisplay) {\n        $form.find('[name=unit]').each(function(){\n            let price = '<span class=\"text-primary\">(' + prices[target][$(this).val()] * cashRate + ' ' + coinName + ')</span>';\n            $(this).parent().find('span').remove();\n            $(this).parent().append(price);\n        });\n    } else {\n        $form.find('[name=unit]').each(function(){\n            let price = '<span class=\"text-primary\">(' + prices[target][$(this).val()] + ' 元)</span>';\n            $(this).parent().find('span').remove();\n            $(this).parent().append(price);\n        });\n    }\n}\n\nfunction refresh() {\n    let $form = $(\"#member-buy-form\");\n\n    let unit = $form.find('[name=unit]:checked').val();\n    let duration = $form.find('[name=duration]').val();\n\n    $form.find('.unit-label').hide();\n    $form.find('.unit-label-' + unit).show();\n\n    let startDate = $form.find('[name=startDate]').val();\n    let deadline = '';\n    if (startDate) {\n        deadline = moment(startDate);\n    } else {\n        deadline = moment();\n    }\n\n    deadline = deadline.add(unit + 's', duration).format('YYYY-MM-DD');\n\n    $form.find('.deadline').html(deadline).parent().removeClass('hide');\n    refresh_price();\n}"]}