webpackJsonp(["app/js/open-course-manage/lesson/index"],{0:function(n,e){n.exports=jQuery},"007f16bb16735f901b3c":function(n,e,t){"use strict";function s(n,e){$.post(e.data("sortUrl"),{ids:n},function(n){var t=chapterNum=unitNum=0;e.find(".item-lesson, .item-chapter").each(function(){var n=$(this);n.hasClass("item-lesson")?(t++,n.find(".number").text(t)):n.hasClass("item-chapter-unit")?(unitNum++,n.find(".number").text(unitNum)):n.hasClass("item-chapter")&&(chapterNum++,unitNum=0,n.find(".number").text(chapterNum))})})}Object.defineProperty(e,"__esModule",{value:!0});var i=t("8f840897d9471c8c1fbd"),o=t.n(i),a=t("b334fd7e4c5a19234db2"),r=t.n(a),d=$("#course-item-list");o()({element:"#course-item-list",distance:20,itemSelector:".item-lesson, .item-chapter"},function(n){s(n,$("#course-item-list"))}),d.on("click",".delete-lesson-btn",function(n){if(confirm("删除课时的同时会删除课时的资料、测验。\n您真的要删除该课时吗？")){var e=$(n.currentTarget),t=function(){return e.parents(".item-chapter")[0]},i=function(){t()?e.parents(".item-chapter").remove():e.parents(".item-lesson").remove()};$.post($(this).data("url"),function(n){i(),s(d),$(".lesson-manage-panel").find(".only-one-lesson-notify").show(),$(".lesson-manage-panel").find("#lesson-create-btn").attr("disabled",!1),r()("success","课时已删除！")},"json")}}),d.on("click",".delete-chapter-btn",function(n){var e=$(this).data("chapter"),t=$(this).data("part");if(confirm("您真的要删除该"+e+t+"吗？")){var i=$(n.currentTarget);$.post($(this).data("url"),function(n){i.parents(".item-chapter").remove(),s(d),r()("success"+e+t+"已删除！")},"json")}}),d.on("click",".replay-lesson-btn",function(n){confirm("您真的要录制回放吗？")&&$.post($(this).data("url"),function(n){if(n.error)10019==n.error.code?r()("danger","录制失败，直播时您没有进行录制！"):r()("danger","录制失败！");else{var e="#"+$(n).attr("id");$(e).replaceWith(n),r()("success","课时已录制！")}})}),d.on("click",".publish-lesson-btn",function(n){$(n.currentTarget);$.post($(this).data("url"),function(n){var e="#"+$(n).attr("id");$(e).find(".item-content .unpublish-warning").remove(),$(e).find(".item-actions .publish-lesson-btn").parent().addClass("hidden").removeClass("show"),$(e).find(".item-actions .unpublish-lesson-btn").parent().addClass("show").removeClass("hidden"),$(e).find(".item-actions .delete-lesson-btn").parent().addClass("hidden").removeClass("show"),$(e).find(".btn-link").tooltip(),r()("success","课时发布成功！")})}),d.on("click",".unpublish-lesson-btn",function(n){$(n.currentTarget);$.post($(this).data("url"),function(n){var e="#"+$(n).attr("id");$(e).find(".item-content").append('<span class="unpublish-warning text-warning">(未发布)</span>'),$(e).find(".item-actions .publish-lesson-btn").parent().addClass("show").removeClass("hidden"),$(e).find(".item-actions .unpublish-lesson-btn").parent().addClass("hidden").removeClass("show"),$(e).find(".item-actions .delete-lesson-btn").parent().addClass("show").removeClass("hidden"),$(e).find(".btn-link").tooltip(),r()("success","课时已取消发布！")})}),d.on("click",".delete-exercise-btn",function(n){if(confirm("您真的要删除该课时练习吗？")){$(n.currentTarget);$.post($(this).data("url"),function(n){r()("success","练习已删除！"),window.location.reload()},"json")}}),d.on("click",".delete-homework-btn",function(n){if(confirm("您真的要删除该课时作业吗？")){$(n.currentTarget);$.post($(this).data("url"),function(n){r()("success","作业已删除！"),window.location.reload()},"json")}}),$("#course-item-list .item-actions .btn-link").tooltip(),$("#course-item-list .fileDeletedLesson").tooltip(),$(".dropdown-menu").parent().on("shown.bs.dropdown",function(){"block"==$(this).find(".dropdown-menu-more").css("display")?($(this).parent().find(".dropdown-menu-more").mouseout(function(){$(this).parent().find(".dropdown-menu-more").hide()}),$(this).parent().find(".dropdown-menu-more").mouseover(function(){$(this).parent().find(".dropdown-menu-more").show()})):$(this).parent().find(".dropdown-menu-more").show()}),$(".dropdown-menu").parent().on("hide.bs.dropdown",function(){$(this).find(".dropdown-menu-more").show()}),function(){var n=$(".lesson-manage-panel").data("file-status-url"),e=new Array;$(".lesson-list .item-lesson").each(function(){isNaN($(this).data("file-id"))||e.push($(this).data("file-id"))}),0!=e.length&&$.post(n,{ids:e.join(",")},function(n){if(n&&0!=n.length)for(var e=0;e<n.length;e++){var t=n[e];$.inArray(t.type,["video","ppt","document"])>-1&&("waiting"==t.convertStatus||"doing"==t.convertStatus?$("li[data-file-id="+t.id+"]").find('span[data-role="mediaStatus"]').append("<span class='text-warning'>(正在文件格式转换)</span>"):"error"==t.convertStatus?$("li[data-file-id="+t.id+"]").find('span[data-role="mediaStatus"]').append("<span class='text-danger'>(文件格式转换失败)</span>"):"success"==t.convertStatus&&($("li[data-file-id="+t.id+"]").find(".mark-manage").show(),$("li[data-file-id="+t.id+"]").find(".mark-manage-divider").show()))}})}(),$("#lesson-create-btn").click(function(){var n=$(this).data("url");$.get(n,function(n){n.result?r()("warning","公开课当前仅支持添加一个课时!"):($("#modal").html(n),$("#modal").modal("show"))})})}},["007f16bb16735f901b3c"]);