{"version":3,"sources":["app/Resources/static-src/app/js/course-chapter-manage/index.js"],"names":["$","on","e","keyCode","which","preventDefault","sortList","$list","data","sortable","get","post","ids","response","lessonNum","chapterNum","unitNum","find","each","$item","hasClass","text","$this","$form","validator","validate","rules","title","ajax","currentDom","submitSuccess","html","closest","modal","attr","length","replaceWith","Translator","trans","$parent","add","nextAll","before","append"],"mappings":";;AAAA;;;;;;AAEAA,EAAE,sBAAF,EAA0BC,EAA1B,CAA6B,UAA7B,EAAyC,UAASC,CAAT,EAAW;AAClD,MAAG,CAACA,EAAEC,OAAF,IAAaD,EAAEE,KAAhB,MAA2B,EAA9B,EAAiC;AAC/BF,MAAEG,cAAF;AACD;AACF,CAJD;;AAMA,IAAIC,WAAW,SAAXA,QAAW,CAAUC,KAAV,EAAiB;AAC9B,MAAIC,OAAOD,MAAME,QAAN,CAAe,WAAf,EAA4BC,GAA5B,EAAX;;AAEAV,IAAEW,IAAF,CAAOJ,MAAMC,IAAN,CAAW,SAAX,CAAP,EAA8B,EAAEI,KAAKJ,IAAP,EAA9B,EAA6C,UAASK,QAAT,EAAmB;AAC9D,QAAIC,YAAY,CAAhB;AACA,QAAIC,aAAa,CAAjB;AACA,QAAIC,UAAU,CAAd;;AAEAT,UAAMU,IAAN,CAAW,yCAAX,EAAsDC,IAAtD,CAA2D,YAAW;AACpE,UAAIC,QAAQnB,EAAE,IAAF,CAAZ;AACA,UAAImB,MAAMC,QAAN,CAAe,aAAf,CAAJ,EAAmC;AACjCN;AACAK,cAAMF,IAAN,CAAW,SAAX,EAAsBI,IAAtB,CAA2BP,SAA3B;AACD,OAHD,MAGO,IAAIK,MAAMC,QAAN,CAAe,kBAAf,CAAJ,EAAwC;AAC7CJ;AACAG,cAAMF,IAAN,CAAW,SAAX,EAAsBI,IAAtB,CAA2BL,OAA3B;AACD,OAHM,MAGA,IAAIG,MAAMC,QAAN,CAAe,qBAAf,CAAJ,EAA2C;AAChDL;AACAC,kBAAU,CAAV;AACAG,cAAMF,IAAN,CAAW,SAAX,EAAsBI,IAAtB,CAA2BN,UAA3B;AACD;AACF,KAbD;AAcD,GAnBD;AAoBD,CAvBD;;AA0BAf,EAAE,qBAAF,EAAyBC,EAAzB,CAA4B,OAA5B,EAAqC,YAAW;AAC9C,MAAIqB,QAAQtB,EAAE,IAAF,CAAZ;AACA,MAAIuB,QAAQvB,EAAE,sBAAF,CAAZ;;AAEA,MAAIwB,YAAYD,MAAME,QAAN,CAAe;AAC7BC,WAAO;AACLC,aAAO;AADF,KADsB;AAI7BC,UAAM,IAJuB;AAK7BC,gBAAYP,KALiB;AAM7BQ,mBAAe,uBAASC,IAAT,EAAe;AAC5BT,YAAMU,OAAN,CAAc,QAAd,EAAwBC,KAAxB,CAA8B,MAA9B;;AAEA,UAAId,QAAQnB,EAAE,MAAMA,EAAE+B,IAAF,EAAQG,IAAR,CAAa,IAAb,CAAR,CAAZ;;AAEA,UAAIf,MAAMgB,MAAV,EAAkB;AAChBhB,cAAMiB,WAAN,CAAkBL,IAAlB;AACA,8BAAO,SAAP,EAAiBM,WAAWC,KAAX,CAAiB,OAAjB,CAAjB;AACD,OAHD,MAGO;AACL,YAAIC,UAAUvC,EAAE,MAAMuB,MAAMf,IAAN,CAAW,UAAX,CAAR,CAAd;AACA,YAAI+B,QAAQJ,MAAZ,EAAoB;AAClB,cAAIK,MAAM,CAAV;AACAD,kBAAQE,OAAR,GAAkBvB,IAAlB,CAAuB,YAAY;AACjC,gBAAIlB,EAAE,IAAF,EAAQoB,QAAR,CAAiB,qBAAjB,CAAJ,EAA6C;AAC3CpB,gBAAE,IAAF,EAAQ0C,MAAR,CAAeX,IAAf;AACAS,oBAAM,CAAN;AACA,qBAAO,KAAP;AACD;AAEF,WAPD;AAQA,cAAIA,OAAO,CAAX,EAAc;AACZxC,cAAE,gBAAF,EAAoB2C,MAApB,CAA2BZ,IAA3B;AACD;AACF,SAbD,MAaO;AACL/B,YAAE,gBAAF,EAAoB2C,MAApB,CAA2BZ,IAA3B;AACD;;AAED,YAAIxB,QAAQP,EAAE,gBAAF,CAAZ;AACAM,iBAASC,KAAT;AACD;AACF;AApC4B,GAAf,CAAhB;AAsCD,CA1CD","file":"index.js","sourceRoot":"/Users/kz/projects/edusoho","sourcesContent":["import notify from \"common/notify\";\n\n$('#chapter-title-field').on('keypress', function(e){\n  if((e.keyCode || e.which) === 13){\n    e.preventDefault();\n  }\n});\n\nlet sortList = function ($list) {\n  let data = $list.sortable(\"serialize\").get();\n\n  $.post($list.data('sortUrl'), { ids: data }, function(response) {\n    let lessonNum = 0;\n    let chapterNum = 0;\n    let unitNum = 0;\n\n    $list.find('.task-manage-unit, .task-manage-chapter').each(function() {\n      let $item = $(this);\n      if ($item.hasClass('item-lesson')) {\n        lessonNum++;\n        $item.find('.number').text(lessonNum);\n      } else if ($item.hasClass('task-manage-unit')) {\n        unitNum++;\n        $item.find('.number').text(unitNum);\n      } else if ($item.hasClass('task-manage-chapter')) {\n        chapterNum++;\n        unitNum = 0;\n        $item.find('.number').text(chapterNum);\n      }\n    });\n  });\n};\n\n\n$('#course-chapter-btn').on('click', function() {\n  let $this = $(this);\n  let $form = $('#course-chapter-form');\n\n  let validator = $form.validate({\n    rules: {\n      title: 'required'\n    },\n    ajax: true,\n    currentDom: $this,\n    submitSuccess: function(html) {\n      $this.closest('.modal').modal('hide');\n\n      let $item = $('#' + $(html).attr('id'));\n\n      if ($item.length) {\n        $item.replaceWith(html);\n        notify('success',Translator.trans('信息已保存'));\n      } else {\n        let $parent = $('#' + $form.data('parentid'));\n        if ($parent.length) {\n          let add = 0;\n          $parent.nextAll().each(function () {\n            if ($(this).hasClass('task-manage-chapter')) {\n              $(this).before(html);\n              add = 1;\n              return false;\n            }\n\n          });\n          if (add != 1) {\n            $(\"#sortable-list\").append(html);\n          }\n        } else {\n          $(\"#sortable-list\").append(html);\n        }\n\n        let $list = $(\"#sortable-list\");\n        sortList($list);\n      }\n    },\n  });\n})\n"]}