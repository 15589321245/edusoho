{"version":3,"sources":["app/Resources/static-src/app/js/testpaper-manage/create/index.js"],"names":["TestpaperForm","$form","$description","find","console","log","validator","difficultySlider","_initEvent","_initValidate","_initSortList","scoreSlider","on","_submit","event","changeMode","changeRange","changeCount","passScore","score","document","getElementById","option","start","connect","tooltips","step","range","updateOptions","noUiSlider","create","values","handle","$","text","toFixed","parseInt","attr","tooltip","html","$this","currentTarget","val","removeClass","initDifficultySlider","addClass","sliders","margin","serialization","resolution","simplePercentage","normalPercentage","difficultyPercentage","Translator","trans","editor","CKEDITOR","replace","toolbar","filebrowserImageUploadUrl","data","height","a","b","c","delHtmlTag","getData","form","str","num","each","index","item","validate","rules","name","required","maxlength","trim","description","limitedTime","min","max","digits","mode","questioncount","messages","self","length","_initEditor","element","itemSelector","ajax","status","submit"],"mappings":"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","file":"index.js","sourceRoot":"/Users/kz/projects/edusoho","sourcesContent":["import sortList from 'common/sortable';\n\nclass TestpaperForm {\n  constructor($form) {\n    this.$form = $form;\n    this.$description = this.$form.find('[name=\"description\"]');\n    console.log(this.$description);\n    this.validator = null;\n    this.difficultySlider = null;\n    this._initEvent();\n    this._initValidate();\n    this._initSortList();\n    this.scoreSlider = null;\n  }\n\n  _initEvent() {\n    this.$form.on('click', '[data-role=\"submit\"]', event => this._submit(event));\n    this.$form.on('click', '[name=\"mode\"]', event => this.changeMode(event));\n    this.$form.on('click', '[name=\"range\"]', event => this.changeRange(event));\n    this.$form.on('blur', '[data-role=\"count\"]', event => this.changeCount(event));\n  }\n\n  initScoreSlider(passScore, score) {\n    let scoreSlider = document.getElementById('score-slider');\n    let option = {\n      start: passScore,\n      connect: [true, false],\n      tooltips: [true],\n      step: 1,\n      range: {\n        'min': 0,\n        'max': score\n      }\n    }\n    if (this.scoreSlider) {\n      this.scoreSlider.updateOptions(option);\n    } else {\n      this.scoreSlider = noUiSlider.create(scoreSlider, option);\n      scoreSlider.noUiSlider.on('update', function (values, handle) {\n        $('.noUi-tooltip').text(`${(values[handle] / score * 100).toFixed(0)}%`);\n        $('.js-passScore').text(parseInt(values[handle]));\n      });\n    }\n    $('.noUi-handle').attr('data-placement', 'top').attr('data-original-title', `达标分数：<span class=\"js-passScore\">${passScore}</span>分`).attr('data-container', 'body');\n    $('.noUi-handle').tooltip({ html: true })\n    $('.noUi-tooltip').text(`${(passScore / score * 100).toFixed(0)}%`);\n  }\n\n  changeMode(event) {\n    let $this = $(event.currentTarget);\n    if ($this.val() == 'difficulty') {\n      this.$form.find('#difficulty-form-group').removeClass('hidden');\n      this.initDifficultySlider();\n    } else {\n      this.$form.find('#difficulty-form-group').addClass('hidden')\n    }\n  }\n\n  changeRange(event) {\n    let $this = $(event.currentTarget);\n    ($this.val() == 'course') ? this.$form.find('#testpaper-range-selects').addClass('hidden') : this.$form.find('#testpaper-range-selects').removeClass('hidden');\n  }\n\n  initDifficultySlider() {\n    if (!this.difficultySlider) {\n      let sliders = document.getElementById('difficulty-percentage-slider');\n      this.difficultySlider = noUiSlider.create(sliders, {\n        start: [30, 70],\n        margin: 30,\n        range: {\n          'min': 0,\n          'max': 100\n        },\n        step: 1,\n        connect: [true, true, true],\n        serialization: {\n          resolution: 1\n        },\n      });\n      sliders.noUiSlider.on('update', function (values, handle) {\n        let simplePercentage = parseInt(values[0]),\n          normalPercentage = values[1] - values[0],\n          difficultyPercentage = 100 - values[1];\n        $('.js-simple-percentage-text').html(Translator.trans('简单') + simplePercentage + '%');\n        $('.js-normal-percentage-text').html(Translator.trans('一般') + normalPercentage + '%');\n        $('.js-difficulty-percentage-text').html(Translator.trans('困难') + difficultyPercentage + '%');\n        $('input[name=\"percentages[simple]\"]').val(simplePercentage);\n        $('input[name=\"percentages[normal]\"]').val(normalPercentage);\n        $('input[name=\"percentages[difficulty]\"]').val(difficultyPercentage);\n      });\n    }\n  }\n\n  _initEditor(validator) {\n    let editor = CKEDITOR.replace(this.$description.attr('id'), {\n      toolbar: 'Simple',\n      filebrowserImageUploadUrl: this.$description.data('imageUploadUrl'),\n      height: 100\n    });\n    editor.on('change', (a, b, c) => {\n      this.$description.val(this.delHtmlTag(editor.getData()));\n    });\n    editor.on('blur', () => {\n      this.$description.val(editor.getData());//fix ie11\n      validator.form();\n    });\n  }\n\n  delHtmlTag(str) {\n    return str.replace(/<[^>]+>/g,'').replace(/&nbsp;/ig,'');\n  }\n\n  changeCount() {\n    let num = 0;\n    this.$form.find('[data-role=\"count\"]').each(function (index, item) {\n      num += parseInt($(item).val());\n    });\n    this.$form.find('[name=\"questioncount\"]').val(num > 0 ? num : null);\n  }\n\n  _initValidate() {\n    this.validator = this.$form.validate({\n      rules: {\n        name: {\n          required: true,\n          maxlength: 50,\n          trim: true,\n        },\n        description: {\n          required: true,\n          maxlength: 500,\n          trim: true,\n        },\n        limitedTime: {\n          min: 0,\n          max: 10000,\n          digits: true\n        },\n        mode: {\n          required: true\n        },\n        range: {\n          required: true\n        },\n        questioncount: {\n          required: true\n        }\n      },\n      messages: {\n        questioncount: \"请选择题目\",\n        name: \"请输入试卷名称\",\n        description: \"请输入试卷描述\",\n        mode: \"请选择生成方式\",\n        range: \"请选择出题范围\"\n      }\n    });\n    this.$form.find('.testpaper-question-option-item').each(function () {\n      let self = $(this);\n      self.find('[data-role=\"count\"]').rules('add', {\n        min: 0,\n        max: function () {\n          return parseInt(self.find('[role=\"questionNum\"]').text());\n        },\n        digits: true\n      })\n\n      self.find('[data-role=\"score\"]').rules('add', {\n        min: 0,\n        max: 100,\n        digits: true\n      })\n\n      if (self.find('[data-role=\"missScore\"]').length > 0) {\n        self.find('[data-role=\"missScore\"]').rules('add', {\n          min: 0,\n          max: function () {\n            return parseInt(self.find('[data-role=\"score\"]').val());\n          },\n          digits: true\n        })\n      }\n    })\n    this._initEditor(this.validator);\n  }\n\n  _initSortList() {\n    sortList({\n      element: '#testpaper-question-options',\n      itemSelector: '.testpaper-question-option-item',\n      handle: '.question-type-sort-handler',\n      ajax: false\n    });\n  }\n\n  _submit(event) {\n    let status = this.validator.form();\n    if (status) {\n      this.$form.submit();\n    }\n  }\n}\n\nnew TestpaperForm($('#testpaper-form'));\n\n\n"]}