{"version":3,"sources":["app/Resources/static-src/app/js/course-manage/info/index.js"],"names":["courseInfo","init","$","length","get","data","done","liveCapacity","capacity","initCkeidtor","initValidator","checkBoxChange","renderMultiGroupComponent","CKEDITOR","replace","allowedContent","toolbar","filebrowserImageUploadUrl","elementId","name","datas","render","document","getElementById","$form","validator","validate","currentDom","groups","date","rules","title","maxlength","required","depends","val","trim","maxStudentNum","live_capacity","positive_integer","expiryDays","digits","max_year","expiryStartDate","after_now_date","before_date","expiryEndDate","after_date","messages","require","Translator","trans","before","after","addMethod","value","element","params","click","form","publishAddMessage","submit","publish","channel","topic","on","event","removeClass","addClass","jQuery","optional","maxCapacity","parseInt","message","parent","siblings","find","html"],"mappings":"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","file":"index.js","sourceRoot":"/Users/kz/projects/edusoho","sourcesContent":["import ReactDOM from 'react-dom';\nimport React from 'react';\nimport MultiInput from 'app/common/component/multi-input';\nimport postal from 'postal';\n\nclass courseInfo {\n\n  constructor() {\n    this.init();\n  }\n\n  init() {\n    if ($('#maxStudentNum-field').length > 0) {\n      $.get($('#maxStudentNum-field').data('liveCapacityUrl')).done((liveCapacity) => {\n        $('#maxStudentNum-field').data('liveCapacity', liveCapacity.capacity);\n      })\n    }\n    this.initCkeidtor();\n    this.initValidator();\n    this.checkBoxChange();\n    \n    this.renderMultiGroupComponent('course-goals', 'goals');\n    this.renderMultiGroupComponent('intended-students', 'audiences');\n  }\n\n  initCkeidtor() {\n    CKEDITOR.replace('summary', {\n      allowedContent: true,\n      toolbar: 'Detail',\n      filebrowserImageUploadUrl: $('#summary').data('imageUploadUrl')\n    });\n  }\n\n  renderMultiGroupComponent(elementId, name) {\n    let datas = $('#' + elementId).data('init-value');\n    ReactDOM.render(<MultiInput\n      dataSource={datas}\n      outputDataElement={name} />, document.getElementById(elementId));\n  }\n\n  initValidator() {\n    let $form = $('#course-info-form');\n    let validator = $form.validate({\n      currentDom: '#course-submit',\n      groups: {\n        date: 'expiryStartDate expiryEndDate'\n      },\n      rules: {\n        title: {\n          maxlength: 100,\n          required: {\n            depends: function () {\n              $(this).val($.trim($(this).val()));\n              return true;\n            }\n          }\n        },\n        maxStudentNum: {\n          required: true,\n          live_capacity: true,\n          positive_integer: true\n        },\n        expiryDays: {\n          required: () => {\n            return $('input[name=\"expiryMode\"]:checked').val() != 'date';\n          },\n          digits: true,\n          max_year: true\n        },\n        expiryStartDate: {\n          required: () => {\n            return $('input[name=\"expiryMode\"]:checked').val() == 'date';\n          },\n          date: true,\n          after_now_date: true,\n          before_date: '#expiryEndDate'\n        },\n        expiryEndDate: {\n          required: () => {\n            return $('input[name=\"expiryMode\"]:checked').val() == 'date';\n          },\n          date: true,\n          after_date: '#expiryStartDate'\n        }\n      },\n      messages: {\n        title: {\n          require: Translator.trans('请输入教学计划课程标题')\n        },\n        maxStudentNum: {\n          required: Translator.trans('请输入课程人数')\n        },\n        expiryDays: {\n          required: Translator.trans('请输入学习有效期'),\n        },\n        expiryStartDate: {\n          required: Translator.trans('请输入开始日期'),\n          before: Translator.trans('开始日期应早于结束日期')\n        },\n        expiryEndDate: {\n          required: Translator.trans('请输入结束日期'),\n          after: Translator.trans('结束日期应晚于开始日期')\n        }\n      }\n    });\n\n    $.validator.addMethod(\n      \"before\",\n      function (value, element, params) {\n        if ($('input[name=\"expiryMode\"]:checked').val() !== 'date') {\n          return true;\n        }\n        return !value || $(params).val() > value;\n      },\n      Translator.trans('开始日期应早于结束日期')\n    );\n\n    $.validator.addMethod(\n      \"after\",\n      function (value, element, params) {\n        if ($('input[name=\"expiryMode\"]:checked').val() !== 'date') {\n          return true;\n        }\n        return !value || $(params).val() < value;\n      },\n      Translator.trans('结束日期应晚于开始日期')\n    );\n\n    $('#course-submit').click(() => {\n      if (validator.form()) {\n        this.publishAddMessage();\n        $form.submit();\n      }\n    });\n  }\n\n  publishAddMessage() {\n    postal.publish({\n      channel: \"courseInfoMultiInput\",\n      topic: \"addMultiInput\",\n    });\n  }\n\n  \n\n  checkBoxChange() {\n    $('input[name=\"expiryMode\"]').on('change', function (event) {\n      if ($('input[name=\"expiryMode\"]:checked').val() == 'date') {\n        $('#expiry-days').removeClass('hidden').addClass('hidden');\n        $('#expiry-date').removeClass('hidden');\n      } else {\n        $('#expiry-date').removeClass('hidden').addClass('hidden');\n        $('#expiry-days').removeClass('hidden');\n      }\n    });\n  }\n}\n\nnew courseInfo();\n\njQuery.validator.addMethod(\"max_year\", function (value, element) {\n  return this.optional(element) || value < 100000;\n}, \"有效期最大值不能超过99,999天\");\n\njQuery.validator.addMethod(\"live_capacity\", function (value, element) {\n  const maxCapacity = parseInt($(element).data('liveCapacity'));\n  if (value > maxCapacity) {\n    const message = Translator.trans('网校可支持最多%capacity%人同时参加直播，您可以设置一个更大的数值，但届时有可能会导致满额后其他学员无法进入直播。', { capacity: maxCapacity });\n    $(element).parent().siblings('.js-course-rule').find('p').html(message);\n  } else {\n    $(element).parent().siblings('.js-course-rule').find('p').html('');\n  }\n\n  return true;\n});\n\n\n"]}