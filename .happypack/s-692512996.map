{"version":3,"sources":["app/Resources/static-src/app/js/course-manage/marketing/index.js"],"names":["Marketing","validator","init","initDatePicker","initValidator","taskPriceSetting","checkBoxChange","initDatetimepicker","setService","$","click","event","$item","currentTarget","$values","val","values","JSON","parse","hasClass","removeClass","addClass","splice","indexOf","text","push","stringify","datetimepicker","format","language","minView","autoclose","on","form","updateDatetimepicker","$form","perfectScrollbar","validate","rules","originPrice","required","positive_currency","ture","tryLookLength","digits","min","max","tryLookLimit","buyExpiryTime","after_now_date","deadline","expiryDays","positive_integer","max_year","expiryStartDate","date","before_date","expiryEndDate","after_date","messages","button","submit","Date","now","$li","toggleClass","$input","find","prop","is","stopPropagation","closest","$id","$picker","endDate"],"mappings":"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","file":"index.js","sourceRoot":"/Users/kz/projects/edusoho","sourcesContent":["class Marketing {\n  constructor() {\n    this.validator = null;\n    this.init();\n  }\n\n  init() {\n    this.initDatePicker('#expiryStartDate');\n    this.initDatePicker('#expiryEndDate');\n    this.initDatePicker('#deadline');\n    this.initValidator();\n    this.taskPriceSetting();\n    this.checkBoxChange();\n    this.initDatetimepicker();\n    this.setService();\n  }\n\n  setService() {\n    $('.js-service-item').click(function (event) {\n      let $item = $(event.currentTarget);\n      let $values = $('#course_services').val();\n      let values;\n      if (!$values) {\n        values = [];\n      } else {\n        values = JSON.parse($values);\n      }\n\n      if ($item.hasClass('label-primary')) {\n        $item.removeClass('label-primary').addClass('label-default');\n        values.splice($values.indexOf($item.text()), 1);\n      } else {\n        $item.removeClass('label-default').addClass('label-primary');\n        values.push($item.text());\n      }\n\n      $('#course_services').val(JSON.stringify(values));\n    });\n  }\n\n  initDatetimepicker() {\n    $('input[name=\"buyExpiryTime\"]').datetimepicker({\n      format: 'yyyy-mm-dd',\n      language: \"zh\",\n      minView: 2, //month\n      autoclose: true,\n    }).on('hide', () => {\n      this.validator && this.validator.form();\n    })\n    this.updateDatetimepicker();\n  }\n\n  initValidator() {\n    let $form = $('#course-marketing-form');\n    $('.js-task-price-setting').perfectScrollbar();\n    this.validator = $form.validate({\n      rules: {\n        originPrice: {\n          required: function () {\n            return $(\"[name=isFree]:checked\").val() == 0;\n          },\n          positive_currency: ture,\n        },\n        tryLookLength: {\n          required: function () {\n            return $(\"[name=tryLookable]:checked\").val() == 1;\n          },\n          digits: true,\n          min: 1,\n          max: 10\n        },\n        tryLookLimit: {\n          digits: true\n        },\n        buyExpiryTime: {\n          required: function () {\n            return $('input[name=\"enableBuyExpiryTime\"]:checked').val() == 1;\n          },\n          after_now_date:true,\n        },\n        deadline: {\n          required: () => {\n            return $('input[name=\"expiryMode\"]:checked').val() === 'days' && $('input[name=\"deadlineType\"]:checked').val() === 'end_date' ;\n          },\n          after_now_date: true,\n        },\n        expiryDays: {\n          required: () => {\n            return $('input[name=\"expiryMode\"]:checked').val() === 'days' && $('input[name=\"deadlineType\"]:checked').val() === 'days' ;\n          },\n          positive_integer: () => {\n            return $('input[name=\"expiryMode\"]:checked').val() === 'days' && $('input[name=\"deadlineType\"]:checked').val() === 'days' ;\n          },\n          max_year: true,\n        },\n        expiryStartDate: {\n          required: () => {\n            return $('input[name=\"expiryMode\"]:checked').val() === 'date';\n          },\n          date: true,\n          after_now_date: true,\n          before_date: '#expiryEndDate'\n        },\n        expiryEndDate: {\n          required: () => {\n            return $('input[name=\"expiryMode\"]:checked').val() === 'date';\n          },\n          date: true,\n          after_date: '#expiryStartDate'\n        }\n      },\n      messages: {\n        buyExpiryTime: {\n          required: '请选择有效的加入截止日期',\n          date: '请选择有效的加入截止日期'\n        },\n        expiryDays: {\n          required: '请输入有效期天数'\n        },\n        deadline: {\n          required: '请输入截至日期'\n        },\n        expiryStartDate: {\n          required: '请输入开始日期'\n        },\n        expiryEndDate: {\n          required: '请输入结束日期'\n        }\n      }\n    });\n    $('#course-submit').click((event) => {\n      if (this.validator && this.validator.form()) {\n        $(event.currentTarget).button('loading');\n        $form.submit();\n      }\n    });\n  }\n\n  updateDatetimepicker() {\n    $('input[name=\"buyExpiryTime\"]').datetimepicker('setStartDate', new Date(Date.now()));\n    $('input[name=\"buyExpiryTime\"]').datetimepicker('setEndDate', new Date(Date.now() + 86400 * 365 * 10 * 1000));\n  }\n\n  checkBoxChange() {\n    $('input[name=\"buyable\"]').on('change', function (event) {\n      if ($('input[name=\"buyable\"]:checked').val() == 0) {\n         $('.js-course-add-close-show').removeClass('hidden');\n         $('.js-course-add-open-show').addClass('hidden');\n      } else {\n        $('.js-course-add-close-show').addClass('hidden');\n         $('.js-course-add-open-show').removeClass('hidden');\n      }\n    });\n\n    $('input[name=\"deadlineType\"]').on('change', function (event) {\n      if ($('input[name=\"deadlineType\"]:checked').val() == 'end_date') {\n         $('#deadlineType-date').removeClass('hidden');\n         $('#deadlineType-days').addClass('hidden');\n      } else {\n        $('#deadlineType-date').addClass('hidden');\n         $('#deadlineType-days').removeClass('hidden');\n      }\n    });\n\n    $('input[name=\"expiryMode\"]').on('change', function (event) {\n      if ($('input[name=\"expiryMode\"]:checked').val() == 'date') {\n        $('#expiry-days').removeClass('hidden').addClass('hidden');\n        $('#expiry-date').removeClass('hidden');\n      } else if($('input[name=\"expiryMode\"]:checked').val() == 'days') {\n        $('#expiry-date').removeClass('hidden').addClass('hidden');\n        $('#expiry-days').removeClass('hidden');\n      } else  {\n        $('#expiry-date').removeClass('hidden').addClass('hidden');\n        $('#expiry-days').removeClass('hidden').addClass('hidden');\n      }\n    });\n\n    $('input[name=\"isFree\"]').on('change', function (event) {\n      if ($('input[name=\"isFree\"]:checked').val() == 0) {\n        $('.js-is-free').removeClass('hidden');\n      } else {\n        $('.js-is-free').addClass('hidden');\n      }\n    });\n    $('input[name=\"tryLookable\"]').on('change', function (event) {\n      if ($('input[name=\"tryLookable\"]:checked').val() == 1) {\n        $('.js-enable-try-look').removeClass('hidden');\n      } else {\n        $('.js-enable-try-look').addClass('hidden');\n      }\n    });\n    $('input[name=\"enableBuyExpiryTime\"]').on('change', (event) => {\n      if ($('input[name=\"enableBuyExpiryTime\"]:checked').val() == 0) {\n        $('#buyExpiryTime').addClass('hidden');\n      } else {\n\n        $('#buyExpiryTime').removeClass('hidden');\n        this.updateDatetimepicker();\n      }\n    });\n\n    $('input[name=\"showServices\"]').on('change', (event) => {\n      if($('input[name=\"showServices\"]:checked').val() == 1){\n        $('.js-services').removeClass('hidden');\n      }else{\n        $('.js-services').addClass('hidden');\n      }\n    });\n  }\n\n  taskPriceSetting() {\n    $('.js-task-price-setting').on('click', 'li', function (event) {\n      let $li = $(this).toggleClass('open');\n      let $input = $li.find('input');\n      $input.prop(\"checked\", !$input.is(\":checked\"))\n    });\n\n    $('.js-task-price-setting').on('click', 'input', function (event) {\n      event.stopPropagation();\n      let $input = $(this);\n      $input.closest('li').toggleClass('open');\n    });\n  }\n\n  initDatePicker($id) {\n    let $picker = $($id);\n    $picker.datetimepicker({\n      format: 'yyyy-mm-dd',\n      language: \"zh\",\n      minView: 2, //month\n      autoclose: true,\n      endDate: new Date(Date.now() + 86400 * 365 * 10 * 1000)\n    });\n    $picker.datetimepicker('setStartDate', new Date());\n  }\n}\n\nnew Marketing();"]}