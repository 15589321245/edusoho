{"version":3,"sources":["app/Resources/static-src/app/common/messenger.js"],"names":["EsMessenger","options","name","project","children","type","setup","self","messenger","addTarget","window","parent","i","length","contentWindow","id","listen","msg","JSON","parse","trigger","eventName","args","target","targets","send","convertToString","child","stringify"],"mappings":";;;;;;;;AAAA;;;;AACA;;;;;;;;;;;;IAEqBA,W;;;AACnB,uBAAYC,OAAZ,EAAqB;AAAA;;AAAA;;AAGnB,UAAKC,IAAL,GAAYD,QAAQC,IAApB;AACA,UAAKC,OAAL,GAAeF,QAAQE,OAAvB;AACA,UAAKC,QAAL,GAAgBH,QAAQG,QAAxB;AACA,UAAKC,IAAL,GAAYJ,QAAQI,IAApB,CANmB,CAMO;AAC1B,UAAKC,KAAL;AAPmB;AAQpB;;;;4BAEO;AACN,UAAIC,OAAO,IAAX;AACA,UAAIC,YAAY,0BAAc,KAAKN,IAAnB,EAAyB,KAAKC,OAA9B,CAAhB;AACA,UAAI,KAAKE,IAAL,IAAa,OAAjB,EAA0B;AAAE;AAC1BG,kBAAUC,SAAV,CAAoBC,OAAOC,MAA3B,EAAmC,QAAnC;AACAH,kBAAUC,SAAV,CAAoBC,OAAOH,IAA3B,EAAiC,SAAjC;AACD,OAHD,MAGO,IAAI,KAAKF,IAAL,IAAa,QAAjB,EAA2B;AAChCG,kBAAUC,SAAV,CAAoBC,OAAOH,IAA3B,EAAiC,OAAjC;AACA,YAAIH,WAAW,KAAKA,QAApB;AACA,aAAK,IAAIQ,IAAIR,SAASS,MAAT,GAAkB,CAA/B,EAAkCD,KAAK,CAAvC,EAA0CA,GAA1C,EAA+C;AAC7CJ,oBAAUC,SAAV,CAAoBL,SAASQ,CAAT,EAAYE,aAAhC,EAA+CV,SAASQ,CAAT,EAAYG,EAA3D;AACD;AACF;;AAEDP,gBAAUQ,MAAV,CAAiB,UAAUC,GAAV,EAAe;AAC9BA,cAAMC,KAAKC,KAAL,CAAWF,GAAX,CAAN;AACAV,aAAKa,OAAL,CAAaH,IAAII,SAAjB,EAA4BJ,IAAIK,IAAhC;AACD,OAHD;AAIA,WAAKd,SAAL,GAAiBA,SAAjB;AAED;;;iCAEYa,S,EAAWC,I,EAAM;AAC5B,WAAK,IAAIC,MAAT,IAAmB,KAAKf,SAAL,CAAegB,OAAlC,EAA2C;AACzC,aAAKhB,SAAL,CAAegB,OAAf,CAAuBD,MAAvB,EAA+BE,IAA/B,CACE,KAAKC,eAAL,CAAqBL,SAArB,EAAgCC,IAAhC,CADF;AAGD;AACF;;;gCAEWK,K,EAAON,S,EAAWC,I,EAAM;AAClC,WAAKd,SAAL,CAAegB,OAAf,CAAuBG,MAAMZ,EAA7B,EAAiCU,IAAjC,CACE,KAAKC,eAAL,CAAqBL,SAArB,EAAgCC,IAAhC,CADF;AAGD;;;oCAEeD,S,EAAWC,I,EAAM;AAC/B,UAAIL,MAAM,EAAC,aAAaI,SAAd,EAAyB,QAAQC,IAAjC,EAAV;AACAL,YAAMC,KAAKU,SAAL,CAAeX,GAAf,CAAN;AACA,aAAOA,GAAP;AACD;;;;;;kBAnDkBjB,W","file":"messenger.js","sourceRoot":"/Users/kz/projects/edusoho","sourcesContent":["import Messenger from 'es-messenger';\nimport Emitter from \"component-emitter\";\n\nexport default class EsMessenger extends Emitter {\n  constructor(options) {\n    super();\n\n    this.name = options.name;\n    this.project = options.project;\n    this.children = options.children;\n    this.type = options.type; //enum: parent,child\n    this.setup();\n  }\n\n  setup() {\n    let self = this;\n    var messenger = new Messenger(this.name, this.project);\n    if (this.type == 'child') { //同时广播同域和者跨域\n      messenger.addTarget(window.parent, 'parent');\n      messenger.addTarget(window.self, 'partner');\n    } else if (this.type == 'parent') {\n      messenger.addTarget(window.self, 'child');\n      var children = this.children;\n      for (var i = children.length - 1; i >= 0; i--) {\n        messenger.addTarget(children[i].contentWindow, children[i].id);\n      }\n    }\n\n    messenger.listen(function (msg) {\n      msg = JSON.parse(msg);\n      self.trigger(msg.eventName, msg.args);\n    });\n    this.messenger = messenger;\n\n  }\n\n  sendToParent(eventName, args) {\n    for (var target in this.messenger.targets) {\n      this.messenger.targets[target].send(\n        this.convertToString(eventName, args)\n      );\n    }\n  }\n\n  sendToChild(child, eventName, args) {\n    this.messenger.targets[child.id].send(\n      this.convertToString(eventName, args)\n    );\n  }\n\n  convertToString(eventName, args) {\n    var msg = {\"eventName\": eventName, \"args\": args};\n    msg = JSON.stringify(msg);\n    return msg;\n  }\n\n}"]}