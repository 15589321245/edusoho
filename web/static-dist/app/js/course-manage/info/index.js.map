{"version":3,"sources":["webpack:///./app/Resources/static-src/app/js/course-manage/info/index.js"],"names":["courseInfo","init","$","length","get","data","done","liveCapacity","capacity","initCkeidtor","initValidator","checkBoxChange","initDatePicker","renderMultiGroupComponent","CKEDITOR","replace","allowedContent","toolbar","filebrowserImageUploadUrl","elementId","name","datas","render","document","getElementById","$form","validator","validate","currentDom","groups","date","rules","title","maxlength","required","depends","val","trim","maxStudentNum","live_capacity","positive_integer","expiryDays","digits","max_year","expiryStartDate","before_date","expiryEndDate","after_date","messages","require","Translator","trans","before","after","addMethod","value","element","params","click","form","publishAddMessage","submit","publish","channel","topic","$id","$picker","datetimepicker","format","language","documentElement","lang","minView","autoclose","endDate","Date","now","on","event","removeClass","addClass","jQuery","optional","maxCapacity","parseInt","message","parent","siblings","find","html"],"mappings":"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","file":"app/js/course-manage/info/index.js","sourcesContent":["import ReactDOM from 'react-dom';\nimport React from 'react';\nimport MultiInput from 'app/common/component/multi-input';\nimport postal from 'postal';\n\nclass courseInfo {\n\n  constructor() {\n    this.init();\n  }\n\n  init() {\n    if ($('#maxStudentNum-field').length > 0) {\n      $.get($('#maxStudentNum-field').data('liveCapacityUrl')).done((liveCapacity) => {\n        $('#maxStudentNum-field').data('liveCapacity', liveCapacity.capacity);\n      })\n    }\n    this.initCkeidtor();\n    this.initValidator();\n    this.checkBoxChange();\n    this.initDatePicker('#expiryStartDate');\n    this.initDatePicker('#expiryEndDate');\n    this.renderMultiGroupComponent('course-goals', 'goals');\n    this.renderMultiGroupComponent('intended-students', 'audiences');\n  }\n\n  initCkeidtor() {\n    CKEDITOR.replace('summary', {\n      allowedContent: true,\n      toolbar: 'Detail',\n      filebrowserImageUploadUrl: $('#summary').data('imageUploadUrl')\n    });\n  }\n\n  renderMultiGroupComponent(elementId, name) {\n    let datas = $('#' + elementId).data('init-value');\n    ReactDOM.render(<MultiInput\n      dataSource={datas}\n      outputDataElement={name} />, document.getElementById(elementId));\n  }\n\n  initValidator() {\n    let $form = $('#course-info-form');\n    let validator = $form.validate({\n      currentDom: '#course-submit',\n      groups: {\n        date: 'expiryStartDate expiryEndDate'\n      },\n      rules: {\n        title: {\n          maxlength: 100,\n          required: {\n            depends: function () {\n              $(this).val($.trim($(this).val()));\n              return true;\n            }\n          }\n        },\n        maxStudentNum: {\n          required: true,\n          live_capacity: true,\n          positive_integer: true\n        },\n        expiryDays: {\n          required: () => {\n            return $('input[name=\"expiryMode\"]:checked').val() != 'date';\n          },\n          digits: true,\n          max_year: true\n        },\n        expiryStartDate: {\n          required: () => {\n            return $('input[name=\"expiryMode\"]:checked').val() == 'date';\n          },\n          date: true,\n          before_date: '#expiryEndDate'\n        },\n        expiryEndDate: {\n          required: () => {\n            return $('input[name=\"expiryMode\"]:checked').val() == 'date';\n          },\n          date: true,\n          after_date: '#expiryStartDate'\n        }\n      },\n      messages: {\n        title: {\n          require: Translator.trans('course.manage.title_required_error_hint')\n        },\n        maxStudentNum: {\n          required: Translator.trans('course.manage.max_student_num_error_hint')\n        },\n        expiryDays: {\n          required: Translator.trans('course.manage.deadline_end_date_error_hint'),\n        },\n        expiryStartDate: {\n          required: Translator.trans('course.manage.expiry_start_date_error_hint'),\n          before: Translator.trans('course.manage.expiry_days_error_hint')\n        },\n        expiryEndDate: {\n          required: Translator.trans('course.manage.expiry_end_date_error_hint'),\n          after: Translator.trans('course.manage.expiry_start_date_error_hint')\n        }\n      }\n    });\n\n    $.validator.addMethod(\n      \"before\",\n      function (value, element, params) {\n        if ($('input[name=\"expiryMode\"]:checked').val() !== 'date') {\n          return true;\n        }\n        return !value || $(params).val() > value;\n      },\n      Translator.trans('course.manage.expiry_end_date_error_hint')\n    );\n\n    $.validator.addMethod(\n      \"after\",\n      function (value, element, params) {\n        if ($('input[name=\"expiryMode\"]:checked').val() !== 'date') {\n          return true;\n        }\n        return !value || $(params).val() < value;\n      },\n      Translator.trans('course.manage.expiry_start_date_error_hint')\n    );\n\n    $('#course-submit').click(() => {\n      if (validator.form()) {\n        this.publishAddMessage();\n        $form.submit();\n      }\n    });\n  }\n\n  publishAddMessage() {\n    postal.publish({\n      channel: \"courseInfoMultiInput\",\n      topic: \"addMultiInput\",\n    });\n  }\n\n  initDatePicker($id) {\n    let $picker = $($id);\n    $picker.datetimepicker({\n      format: 'yyyy-mm-dd',\n      language: document.documentElement.lang,\n      minView: 2, //month\n      autoclose: true,\n      endDate: new Date(Date.now() + 86400 * 365 * 10 * 1000)\n    });\n    $picker.datetimepicker('setStartDate', new Date());\n  }\n\n  checkBoxChange() {\n    $('input[name=\"expiryMode\"]').on('change', function (event) {\n      if ($('input[name=\"expiryMode\"]:checked').val() == 'date') {\n        $('#expiry-days').removeClass('hidden').addClass('hidden');\n        $('#expiry-date').removeClass('hidden');\n      } else {\n        $('#expiry-date').removeClass('hidden').addClass('hidden');\n        $('#expiry-days').removeClass('hidden');\n      }\n    });\n  }\n}\n\nnew courseInfo();\n\njQuery.validator.addMethod(\"max_year\", function (value, element) {\n  return this.optional(element) || value < 100000;\n}, Translator.trans(\"course.manage.max_year_error_hint\"));\n\njQuery.validator.addMethod(\"live_capacity\", function (value, element) {\n  const maxCapacity = parseInt($(element).data('liveCapacity'));\n  if (value > maxCapacity) {\n    const message = Translator.trans('course.manage.max_capacity_hint', { capacity: maxCapacity });\n    $(element).parent().siblings('.js-course-rule').find('p').html(message);\n  } else {\n    $(element).parent().siblings('.js-course-rule').find('p').html('');\n  }\n\n  return true;\n});\n\n\n// WEBPACK FOOTER //\n// ./app/Resources/static-src/app/js/course-manage/info/index.js"],"sourceRoot":""}