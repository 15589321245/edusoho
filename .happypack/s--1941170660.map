{"version":3,"sources":["node_modules/.3.5.5@iframe-resizer/js/iframeResizer.contentWindow.js"],"names":["window","undefined","autoResize","base","bodyBackground","bodyMargin","bodyMarginStr","bodyObserver","bodyPadding","calculateWidth","doubleEventList","eventCancelTimer","firstRun","height","heightCalcModeDefault","heightCalcMode","initLock","initMsg","inPageLinks","interval","intervalTimer","logging","msgID","msgIdLen","length","myID","observer","resetRequiredMethods","max","min","bodyScroll","documentElementScroll","resizeFrom","sendPermit","target","parent","targetOriginDefault","tolerance","triggerLocked","triggerLockedTimer","throttledTimer","width","widthCalcModeDefault","widthCalcMode","win","messageCallback","warn","readyCallback","pageInfoCallback","customCalcMethods","document","documentElement","offsetHeight","body","scrollWidth","addEventListener","el","evt","func","attachEvent","removeEventListener","detachEvent","capitalizeFirstLetter","string","charAt","toUpperCase","slice","throttle","context","args","result","timeout","previous","later","getNow","apply","now","remaining","arguments","clearTimeout","setTimeout","Date","getTime","formatLogMsg","msg","log","console","init","readDataFromParent","location","href","readDataFromPage","setMargin","setBodyStyle","injectClearFixIntoBodyElement","checkHeightMode","checkWidthMode","stopInfiniteResizingOfIFrame","setupPublicMethods","startEventListeners","setupInPageLinks","sendSize","strBool","str","data","substr","split","Number","enable","readData","iFrameResizer","JSON","stringify","targetOrigin","heightCalculationMethod","widthCalculationMethod","setupCustomCalcMethods","calcMode","calcFunc","Object","constructor","chkCSS","attr","value","indexOf","style","manageTriggerEvent","options","handleEvent","eventName","eventType","listener","add","remove","eventNames","Array","prototype","map","method","manageEventListeners","checkCalcMode","calcModeDefault","modes","type","getHeight","getWidth","setupMutationObserver","stopMsgsToParent","removeMsgListener","receiver","disconnectMutationObserver","disconnect","stopEventListeners","clearInterval","teardown","clearFix","createElement","clear","display","appendChild","getPagePosition","x","pageXOffset","scrollLeft","y","pageYOffset","scrollTop","getElementPosition","elPosition","getBoundingClientRect","pagePosition","parseInt","left","top","findTarget","jumpToTarget","jumpPosition","hash","sendMsg","hashData","decodeURIComponent","getElementById","getElementsByName","checkLocationHash","bindAnchors","setupLink","linkClicked","e","preventDefault","getAttribute","forEach","call","querySelectorAll","bindLocationHash","initCheck","enableInPageLinks","parentIFrame","autoResizeF","resize","close","closeF","getId","getIdF","getPageInfo","getPageInfoF","callback","moveToAnchor","moveToAnchorF","reset","resetF","resetIFrame","scrollTo","scrollToF","scrollToOffset","sendMessage","sendMessageF","setHeightCalculationMethod","setHeightCalculationMethodF","setWidthCalculationMethod","setWidthCalculationMethodF","setTargetOrigin","setTargetOriginF","size","sizeF","customHeight","customWidth","valString","initInterval","setInterval","Math","abs","setupBodyMutationObserver","addImageLoadListners","mutation","addImageLoadListener","element","complete","src","imageLoaded","imageError","elements","push","attributeName","removeFromArray","splice","removeImageLoadListener","imageEventTriggered","event","typeDesc","mutationObserved","mutations","createMutationObserver","querySelector","config","attributes","attributeOldValue","characterData","characterDataOldValue","childList","subtree","MutationObserver","observe","WebKitMutationObserver","forceIntervalTimer","getComputedStyle","prop","convertUnitsToPxForIE8","PIXEL","test","runtimeStyle","currentStyle","pixelLeft","retVal","defaultView","chkEventThottle","timer","getMaxElement","side","elementsLength","elVal","maxVal","Side","i","getAllMeasurements","dimention","bodyOffset","documentElementOffset","getTaggedElements","tag","noTaggedElementsFound","getAllElements","getBodyOffsetHeight","offset","getBodyScrollHeight","scrollHeight","custom","getCustomWidth","getDEOffsetHeight","getDEScrollHeight","getMaxHeight","getMinHeight","grow","growHeight","lowestElement","getBestHeight","taggedElement","getTaggedElementsHeight","getBodyScrollWidth","getBodyOffsetWidth","offsetWidth","getDEScrollWidth","getDEOffsetWidth","scroll","getMaxWidth","getMinWidth","rightMostElement","getTaggedElementsWidth","sizeIFrame","triggerEvent","triggerEventDesc","resizeIFrame","currentHeight","currentWidth","isSizeChangeDetected","checkTolarance","a","b","isForceResizableEvent","isForceResizableCalcMode","logIgnored","checkDownSizing","lockTrigger","sizeIFrameThrottled","recordTrigger","isDoubleFiredEvent","triggerReset","hcm","sendToParent","message","postMessage","isMessageForUs","initFromParent","fireInit","source","resetFromParent","resizeFromParent","anchor","getData","getMessageType","isMiddleTier","messageFromParent","msgBody","parse","pageInfoFromParent","isInitMsg","callFromParent","processMessage","chkLateLoaded","readyState"],"mappings":"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","file":"iframeResizer.contentWindow.js","sourceRoot":"/Users/kz/projects/edusoho","sourcesContent":["/*\n * File: iframeResizer.contentWindow.js\n * Desc: Include this file in any page being loaded into an iframe\n *       to force the iframe to resize to the content size.\n * Requires: iframeResizer.js on host page.\n * Doc: https://github.com/davidjbradshaw/iframe-resizer\n * Author: David J. Bradshaw - dave@bradshaw.net\n * Contributor: Jure Mav - jure.mav@gmail.com\n * Contributor: Ian Caunce - ian@hallnet.co.uk\n */\n\n\n;(function(window, undefined) {\n\t'use strict';\n\n\tvar\n\t\tautoResize            = true,\n\t\tbase                  = 10,\n\t\tbodyBackground        = '',\n\t\tbodyMargin            = 0,\n\t\tbodyMarginStr         = '',\n\t\tbodyObserver          = null,\n\t\tbodyPadding           = '',\n\t\tcalculateWidth        = false,\n\t\tdoubleEventList       = {'resize':1,'click':1},\n\t\teventCancelTimer      = 128,\n\t\tfirstRun              = true,\n\t\theight                = 1,\n\t\theightCalcModeDefault = 'bodyOffset',\n\t\theightCalcMode        = heightCalcModeDefault,\n\t\tinitLock              = true,\n\t\tinitMsg               = '',\n\t\tinPageLinks           = {},\n\t\tinterval              = 32,\n\t\tintervalTimer         = null,\n\t\tlogging               = false,\n\t\tmsgID                 = '[iFrameSizer]',  //Must match host page msg ID\n\t\tmsgIdLen              = msgID.length,\n\t\tmyID                  = '',\n\t\tobserver              = null,\n\t\tresetRequiredMethods  = {max:1,min:1,bodyScroll:1,documentElementScroll:1},\n\t\tresizeFrom            = 'child',\n\t\tsendPermit            = true,\n\t\ttarget                = window.parent,\n\t\ttargetOriginDefault   = '*',\n\t\ttolerance             = 0,\n\t\ttriggerLocked         = false,\n\t\ttriggerLockedTimer    = null,\n\t\tthrottledTimer        = 16,\n\t\twidth                 = 1,\n\t\twidthCalcModeDefault  = 'scroll',\n\t\twidthCalcMode         = widthCalcModeDefault,\n\t\twin                   = window,\n\t\tmessageCallback       = function(){ warn('MessageCallback function not defined'); },\n\t\treadyCallback         = function(){},\n\t\tpageInfoCallback      = function(){},\n\t\tcustomCalcMethods     = {\n\t\t\theight: function(){\n\t\t\t\twarn('Custom height calculation function not defined');\n\t\t\t\treturn document.documentElement.offsetHeight;\n\t\t\t}, \n\t\t\twidth: function(){\n\t\t\t\twarn('Custom width calculation function not defined');\n\t\t\t\treturn document.body.scrollWidth;\n\t\t\t}\n\t\t};\n\n\n\tfunction addEventListener(el,evt,func){\n\t\t/* istanbul ignore else */ // Not testable in phantonJS\n\t\tif ('addEventListener' in window){\n\t\t\tel.addEventListener(evt,func, false);\n\t\t} else if ('attachEvent' in window){ //IE\n\t\t\tel.attachEvent('on'+evt,func);\n\t\t}\n\t}\n\n\tfunction removeEventListener(el,evt,func){\n\t\t/* istanbul ignore else */ // Not testable in phantonJS\n\t\tif ('removeEventListener' in window){\n\t\t\tel.removeEventListener(evt,func, false);\n\t\t} else if ('detachEvent' in window){ //IE\n\t\t\tel.detachEvent('on'+evt,func);\n\t\t}\n\t}\n\n\tfunction capitalizeFirstLetter(string) {\n\t\treturn string.charAt(0).toUpperCase() + string.slice(1);\n\t}\n\n\t//Based on underscore.js\n\tfunction throttle(func) {\n\t\tvar\n\t\t\tcontext, args, result,\n\t\t\ttimeout = null,\n\t\t\tprevious = 0,\n\t\t\tlater = function() {\n\t\t\t\tprevious = getNow();\n\t\t\t\ttimeout = null;\n\t\t\t\tresult = func.apply(context, args);\n\t\t\t\tif (!timeout) {\n\t\t\t\t\tcontext = args = null;\n\t\t\t\t}\n\t\t\t};\n\n\t\treturn function() {\n\t\t\tvar now = getNow();\n\n\t\t\tif (!previous) {\n\t\t\t\tprevious = now;\n\t\t\t}\n\n\t\t\tvar remaining = throttledTimer - (now - previous);\n\n\t\t\tcontext = this;\n\t\t\targs = arguments;\n\n\t\t\tif (remaining <= 0 || remaining > throttledTimer) {\n\t\t\t\tif (timeout) {\n\t\t\t\t\tclearTimeout(timeout);\n\t\t\t\t\ttimeout = null;\n\t\t\t\t}\n\n\t\t\t\tprevious = now;\n\t\t\t\tresult = func.apply(context, args);\n\n\t\t\t\tif (!timeout) {\n\t\t\t\t\tcontext = args = null;\n\t\t\t\t}\n\n\t\t\t} else if (!timeout) {\n\t\t\t\ttimeout = setTimeout(later, remaining);\n\t\t\t}\n\n\t\t\treturn result;\n\t\t};\n\t}\n\n\tvar getNow = Date.now || function() {\n\t\t/* istanbul ignore next */ // Not testable in PhantonJS\n\t\treturn new Date().getTime();\n\t};\n\n\tfunction formatLogMsg(msg){\n\t\treturn msgID + '[' + myID + ']' + ' ' + msg;\n\t}\n\n\tfunction log(msg){\n\t\tif (logging && ('object' === typeof window.console)){\n\t\t\tconsole.log(formatLogMsg(msg));\n\t\t}\n\t}\n\n\tfunction warn(msg){\n\t\tif ('object' === typeof window.console){\n\t\t\tconsole.warn(formatLogMsg(msg));\n\t\t}\n\t}\n\n\n\tfunction init(){\n\t\treadDataFromParent();\n\t\tlog('Initialising iFrame ('+location.href+')');\n\t\treadDataFromPage();\n\t\tsetMargin();\n\t\tsetBodyStyle('background',bodyBackground);\n\t\tsetBodyStyle('padding',bodyPadding);\n\t\tinjectClearFixIntoBodyElement();\n\t\tcheckHeightMode();\n\t\tcheckWidthMode();\n\t\tstopInfiniteResizingOfIFrame();\n\t\tsetupPublicMethods();\n\t\tstartEventListeners();\n\t\tinPageLinks = setupInPageLinks();\n\t\tsendSize('init','Init message from host page');\n\t\treadyCallback();\n\t}\n\n\tfunction readDataFromParent(){\n\n\t\tfunction strBool(str){\n\t\t\treturn 'true' === str ? true : false;\n\t\t}\n\n\t\tvar data = initMsg.substr(msgIdLen).split(':');\n\n\t\tmyID               = data[0];\n\t\tbodyMargin         = (undefined !== data[1]) ? Number(data[1])   : bodyMargin; //For V1 compatibility\n\t\tcalculateWidth     = (undefined !== data[2]) ? strBool(data[2])  : calculateWidth;\n\t\tlogging            = (undefined !== data[3]) ? strBool(data[3])  : logging;\n\t\tinterval           = (undefined !== data[4]) ? Number(data[4])   : interval;\n\t\tautoResize         = (undefined !== data[6]) ? strBool(data[6])  : autoResize;\n\t\tbodyMarginStr      = data[7];\n\t\theightCalcMode     = (undefined !== data[8]) ? data[8]           : heightCalcMode;\n\t\tbodyBackground     = data[9];\n\t\tbodyPadding        = data[10];\n\t\ttolerance          = (undefined !== data[11]) ? Number(data[11]) : tolerance;\n\t\tinPageLinks.enable = (undefined !== data[12]) ? strBool(data[12]): false;\n\t\tresizeFrom         = (undefined !== data[13]) ? data[13]         : resizeFrom;\n\t\twidthCalcMode      = (undefined !== data[14]) ? data[14]         : widthCalcMode;\n\t}\n\n\tfunction readDataFromPage(){\n\t\tfunction readData(){\n\t\t\tvar data = window.iFrameResizer;\n\n\t\t\tlog('Reading data from page: ' + JSON.stringify(data));\n\n\t\t\tmessageCallback     = ('messageCallback'         in data) ? data.messageCallback         : messageCallback;\n\t\t\treadyCallback       = ('readyCallback'           in data) ? data.readyCallback           : readyCallback;\n\t\t\ttargetOriginDefault = ('targetOrigin'            in data) ? data.targetOrigin            : targetOriginDefault;\n\t\t\theightCalcMode      = ('heightCalculationMethod' in data) ? data.heightCalculationMethod : heightCalcMode;\n\t\t\twidthCalcMode       = ('widthCalculationMethod'  in data) ? data.widthCalculationMethod  : widthCalcMode;\n\t\t}\n\n\t\tfunction setupCustomCalcMethods(calcMode, calcFunc){\n\t\t\tif ('function' === typeof calcMode) {\n\t\t\t\tlog('Setup custom ' + calcFunc + 'CalcMethod');\n\t\t\t\tcustomCalcMethods[calcFunc] = calcMode;\n\t\t\t\tcalcMode = 'custom';\n\t\t\t}\n\n\t\t\treturn calcMode;\n\t\t}\n\n\t\tif(('iFrameResizer' in window) && (Object === window.iFrameResizer.constructor)) {\n\t\t\treadData();\n\t\t\theightCalcMode = setupCustomCalcMethods(heightCalcMode, 'height');\n\t\t\twidthCalcMode  = setupCustomCalcMethods(widthCalcMode,  'width');\n\t\t}\n\n\t\tlog('TargetOrigin for parent set to: ' + targetOriginDefault);\n\t}\n\n\n\tfunction chkCSS(attr,value){\n\t\tif (-1 !== value.indexOf('-')){\n\t\t\twarn('Negative CSS value ignored for '+attr);\n\t\t\tvalue='';\n\t\t}\n\t\treturn value;\n\t}\n\n\tfunction setBodyStyle(attr,value){\n\t\tif ((undefined !== value) && ('' !== value) && ('null' !== value)){\n\t\t\tdocument.body.style[attr] = value;\n\t\t\tlog('Body '+attr+' set to \"'+value+'\"');\n\t\t}\n\t}\n\n\tfunction setMargin(){\n\t\t//If called via V1 script, convert bodyMargin from int to str\n\t\tif (undefined === bodyMarginStr){\n\t\t\tbodyMarginStr = bodyMargin+'px';\n\t\t}\n\n\t\tsetBodyStyle('margin',chkCSS('margin',bodyMarginStr));\n\t}\n\n\tfunction stopInfiniteResizingOfIFrame(){\n\t\tdocument.documentElement.style.height = '';\n\t\tdocument.body.style.height = '';\n\t\tlog('HTML & body height set to \"auto\"');\n\t}\n\n\n\tfunction manageTriggerEvent(options){\n\t\tfunction handleEvent(){\n\t\t\tsendSize(options.eventName,options.eventType);\n\t\t}\n\n\t\tvar listener = {\n\t\t\tadd:    function(eventName){\n\t\t\t\taddEventListener(window,eventName,handleEvent);\n\t\t\t},\n\t\t\tremove: function(eventName){\n\t\t\t\tremoveEventListener(window,eventName,handleEvent);\n\t\t\t}\n\t\t};\n\n\t\tif(options.eventNames && Array.prototype.map){\n\t\t\toptions.eventName = options.eventNames[0];\n\t\t\toptions.eventNames.map(listener[options.method]);\n\t\t} else {\n\t\t\tlistener[options.method](options.eventName);\n\t\t}\n\n\t\tlog(capitalizeFirstLetter(options.method) + ' event listener: ' + options.eventType);\n\t}\n\n\tfunction manageEventListeners(method){\n\t\tmanageTriggerEvent({method:method, eventType: 'Animation Start',           eventNames: ['animationstart','webkitAnimationStart'] });\n\t\tmanageTriggerEvent({method:method, eventType: 'Animation Iteration',       eventNames: ['animationiteration','webkitAnimationIteration'] });\n\t\tmanageTriggerEvent({method:method, eventType: 'Animation End',             eventNames: ['animationend','webkitAnimationEnd'] });\n\t\tmanageTriggerEvent({method:method, eventType: 'Input',                     eventName:  'input' });\n\t\tmanageTriggerEvent({method:method, eventType: 'Mouse Up',                  eventName:  'mouseup' });\n\t\tmanageTriggerEvent({method:method, eventType: 'Mouse Down',                eventName:  'mousedown' });\n\t\tmanageTriggerEvent({method:method, eventType: 'Orientation Change',        eventName:  'orientationchange' });\n\t\tmanageTriggerEvent({method:method, eventType: 'Print',                     eventName:  ['afterprint', 'beforeprint'] });\n\t\tmanageTriggerEvent({method:method, eventType: 'Ready State Change',        eventName:  'readystatechange' });\n\t\tmanageTriggerEvent({method:method, eventType: 'Touch Start',               eventName:  'touchstart' });\n\t\tmanageTriggerEvent({method:method, eventType: 'Touch End',                 eventName:  'touchend' });\n\t\tmanageTriggerEvent({method:method, eventType: 'Touch Cancel',              eventName:  'touchcancel' });\n\t\tmanageTriggerEvent({method:method, eventType: 'Transition Start',          eventNames: ['transitionstart','webkitTransitionStart','MSTransitionStart','oTransitionStart','otransitionstart'] });\n\t\tmanageTriggerEvent({method:method, eventType: 'Transition Iteration',      eventNames: ['transitioniteration','webkitTransitionIteration','MSTransitionIteration','oTransitionIteration','otransitioniteration'] });\n\t\tmanageTriggerEvent({method:method, eventType: 'Transition End',            eventNames: ['transitionend','webkitTransitionEnd','MSTransitionEnd','oTransitionEnd','otransitionend'] });\n\t\tif('child' === resizeFrom){\n\t\t\tmanageTriggerEvent({method:method, eventType: 'IFrame Resized',        eventName:  'resize' });\n\t\t}\n\t}\n\n\tfunction checkCalcMode(calcMode,calcModeDefault,modes,type){\n\t\tif (calcModeDefault !== calcMode){\n\t\t\tif (!(calcMode in modes)){\n\t\t\t\twarn(calcMode + ' is not a valid option for '+type+'CalculationMethod.');\n\t\t\t\tcalcMode=calcModeDefault;\n\t\t\t}\n\t\t\tlog(type+' calculation method set to \"'+calcMode+'\"');\n\t\t}\n\n\t\treturn calcMode;\n\t}\n\n\tfunction checkHeightMode(){\n\t\theightCalcMode = checkCalcMode(heightCalcMode,heightCalcModeDefault,getHeight,'height');\n\t}\n\n\tfunction checkWidthMode(){\n\t\twidthCalcMode = checkCalcMode(widthCalcMode,widthCalcModeDefault,getWidth,'width');\n\t}\n\n\tfunction startEventListeners(){\n\t\tif ( true === autoResize ) {\n\t\t\tmanageEventListeners('add');\n\t\t\tsetupMutationObserver();\n\t\t}\n\t\telse {\n\t\t\tlog('Auto Resize disabled');\n\t\t}\n\t}\n\n\tfunction stopMsgsToParent(){\n\t\tlog('Disable outgoing messages');\n\t\tsendPermit = false;\n\t}\n\n\tfunction removeMsgListener(){\n\t\tlog('Remove event listener: Message');\n\t\tremoveEventListener(window, 'message', receiver);\n\t}\n\n\tfunction disconnectMutationObserver(){\n\t\tif (null !== bodyObserver){\n\t\t\t/* istanbul ignore next */ // Not testable in PhantonJS\n\t\t\tbodyObserver.disconnect();\n\t\t}\n\t}\n\n\tfunction stopEventListeners(){\n\t\tmanageEventListeners('remove');\n\t\tdisconnectMutationObserver();\n\t\tclearInterval(intervalTimer);\n\t}\n\n\tfunction teardown(){\n\t\tstopMsgsToParent();\n\t\tremoveMsgListener();\n\t\tif (true === autoResize) stopEventListeners();\n\t}\n\n\tfunction injectClearFixIntoBodyElement(){\n\t\tvar clearFix = document.createElement('div');\n\t\tclearFix.style.clear   = 'both';\n\t\tclearFix.style.display = 'block'; //Guard against this having been globally redefined in CSS.\n\t\tdocument.body.appendChild(clearFix);\n\t}\n\n\tfunction setupInPageLinks(){\n\n\t\tfunction getPagePosition (){\n\t\t\treturn {\n\t\t\t\tx: (window.pageXOffset !== undefined) ? window.pageXOffset : document.documentElement.scrollLeft,\n\t\t\t\ty: (window.pageYOffset !== undefined) ? window.pageYOffset : document.documentElement.scrollTop\n\t\t\t};\n\t\t}\n\n\t\tfunction getElementPosition(el){\n\t\t\tvar\n\t\t\t\telPosition   = el.getBoundingClientRect(),\n\t\t\t\tpagePosition = getPagePosition();\n\n\t\t\treturn {\n\t\t\t\tx: parseInt(elPosition.left,10) + parseInt(pagePosition.x,10),\n\t\t\t\ty: parseInt(elPosition.top,10)  + parseInt(pagePosition.y,10)\n\t\t\t};\n\t\t}\n\n\t\tfunction findTarget(location){\n\t\t\tfunction jumpToTarget(target){\n\t\t\t\tvar jumpPosition = getElementPosition(target);\n\n\t\t\t\tlog('Moving to in page link (#'+hash+') at x: '+jumpPosition.x+' y: '+jumpPosition.y);\n\t\t\t\tsendMsg(jumpPosition.y, jumpPosition.x, 'scrollToOffset'); // X&Y reversed at sendMsg uses height/width\n\t\t\t}\n\n\t\t\tvar\n\t\t\t\thash     = location.split('#')[1] || location, //Remove # if present\n\t\t\t\thashData = decodeURIComponent(hash),\n\t\t\t\ttarget   = document.getElementById(hashData) || document.getElementsByName(hashData)[0];\n\n\t\t\tif (undefined !== target){\n\t\t\t\tjumpToTarget(target);\n\t\t\t} else {\n\t\t\t\tlog('In page link (#' + hash + ') not found in iFrame, so sending to parent');\n\t\t\t\tsendMsg(0,0,'inPageLink','#'+hash);\n\t\t\t}\n\t\t}\n\n\t\tfunction checkLocationHash(){\n\t\t\tif ('' !== location.hash && '#' !== location.hash){\n\t\t\t\tfindTarget(location.href);\n\t\t\t}\n\t\t}\n\n\t\tfunction bindAnchors(){\n\t\t\tfunction setupLink(el){\n\t\t\t\tfunction linkClicked(e){\n\t\t\t\t\te.preventDefault();\n\n\t\t\t\t\t/*jshint validthis:true */\n\t\t\t\t\tfindTarget(this.getAttribute('href'));\n\t\t\t\t}\n\n\t\t\t\tif ('#' !== el.getAttribute('href')){\n\t\t\t\t\taddEventListener(el,'click',linkClicked);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tArray.prototype.forEach.call( document.querySelectorAll( 'a[href^=\"#\"]' ), setupLink );\n\t\t}\n\n\t\tfunction bindLocationHash(){\n\t\t\taddEventListener(window,'hashchange',checkLocationHash);\n\t\t}\n\n\t\tfunction initCheck(){ //check if page loaded with location hash after init resize\n\t\t\tsetTimeout(checkLocationHash,eventCancelTimer);\n\t\t}\n\n\t\tfunction enableInPageLinks(){\n\t\t\t/* istanbul ignore else */ // Not testable in phantonJS\n\t\t\tif(Array.prototype.forEach && document.querySelectorAll){\n\t\t\t\tlog('Setting up location.hash handlers');\n\t\t\t\tbindAnchors();\n\t\t\t\tbindLocationHash();\n\t\t\t\tinitCheck();\n\t\t\t} else {\n\t\t\t\twarn('In page linking not fully supported in this browser! (See README.md for IE8 workaround)');\n\t\t\t}\n\t\t}\n\n\t\tif(inPageLinks.enable){\n\t\t\tenableInPageLinks();\n\t\t} else {\n\t\t\tlog('In page linking not enabled');\n\t\t}\n\n\t\treturn {\n\t\t\tfindTarget:findTarget\n\t\t};\n\t}\n\n\tfunction setupPublicMethods(){\n\t\tlog('Enable public methods');\n\n\t\twin.parentIFrame = {\n\n\t\t\tautoResize: function autoResizeF(resize){\n\t\t\t\tif (true === resize && false === autoResize) {\n\t\t\t\t\tautoResize=true;\n\t\t\t\t\tstartEventListeners();\n\t\t\t\t\t//sendSize('autoResize','Auto Resize enabled');\n\t\t\t\t} else if (false === resize && true === autoResize) {\n\t\t\t\t\tautoResize=false;\n\t\t\t\t\tstopEventListeners();\n\t\t\t\t}\n\n\t\t\t\treturn autoResize;\n\t\t\t},\n\n\t\t\tclose: function closeF(){\n\t\t\t\tsendMsg(0,0,'close');\n\t\t\t\tteardown();\n\t\t\t},\n\n\t\t\tgetId: function getIdF(){\n\t\t\t\treturn myID;\n\t\t\t},\n\n\t\t\tgetPageInfo: function getPageInfoF(callback){\n\t\t\t\tif ('function' === typeof callback){\n\t\t\t\t\tpageInfoCallback = callback;\n\t\t\t\t\tsendMsg(0,0,'pageInfo');\n\t\t\t\t} else {\n\t\t\t\t\tpageInfoCallback = function(){};\n\t\t\t\t\tsendMsg(0,0,'pageInfoStop');\n\t\t\t\t}\n\t\t\t},\n\n\t\t\tmoveToAnchor: function moveToAnchorF(hash){\n\t\t\t\tinPageLinks.findTarget(hash);\n\t\t\t},\n\n\t\t\treset: function resetF(){\n\t\t\t\tresetIFrame('parentIFrame.reset');\n\t\t\t},\n\n\t\t\tscrollTo: function scrollToF(x,y){\n\t\t\t\tsendMsg(y,x,'scrollTo'); // X&Y reversed at sendMsg uses height/width\n\t\t\t},\n\n\t\t\tscrollToOffset: function scrollToF(x,y){\n\t\t\t\tsendMsg(y,x,'scrollToOffset'); // X&Y reversed at sendMsg uses height/width\n\t\t\t},\n\n\t\t\tsendMessage: function sendMessageF(msg,targetOrigin){\n\t\t\t\tsendMsg(0,0,'message',JSON.stringify(msg),targetOrigin);\n\t\t\t},\n\n\t\t\tsetHeightCalculationMethod: function setHeightCalculationMethodF(heightCalculationMethod){\n\t\t\t\theightCalcMode = heightCalculationMethod;\n\t\t\t\tcheckHeightMode();\n\t\t\t},\n\n\t\t\tsetWidthCalculationMethod: function setWidthCalculationMethodF(widthCalculationMethod){\n\t\t\t\twidthCalcMode = widthCalculationMethod;\n\t\t\t\tcheckWidthMode();\n\t\t\t},\n\n\t\t\tsetTargetOrigin: function setTargetOriginF(targetOrigin){\n\t\t\t\tlog('Set targetOrigin: '+targetOrigin);\n\t\t\t\ttargetOriginDefault = targetOrigin;\n\t\t\t},\n\n\t\t\tsize: function sizeF(customHeight, customWidth){\n\t\t\t\tvar valString = ''+(customHeight?customHeight:'')+(customWidth?','+customWidth:'');\n\t\t\t\t//lockTrigger();\n\t\t\t\tsendSize('size','parentIFrame.size('+valString+')', customHeight, customWidth);\n\t\t\t}\n\t\t};\n\t}\n\n\tfunction initInterval(){\n\t\tif ( 0 !== interval ){\n\t\t\tlog('setInterval: '+interval+'ms');\n\t\t\tintervalTimer = setInterval(function(){\n\t\t\t\tsendSize('interval','setInterval: '+interval);\n\t\t\t},Math.abs(interval));\n\t\t}\n\t}\n\n\t/* istanbul ignore next */  //Not testable in PhantomJS\n\tfunction setupBodyMutationObserver(){\n\t\tfunction addImageLoadListners(mutation) {\n\t\t\tfunction addImageLoadListener(element){\n\t\t\t\tif (false === element.complete) {\n\t\t\t\t\tlog('Attach listeners to ' + element.src);\n\t\t\t\t\telement.addEventListener('load', imageLoaded, false);\n\t\t\t\t\telement.addEventListener('error', imageError, false);\n\t\t\t\t\telements.push(element);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (mutation.type === 'attributes' && mutation.attributeName === 'src'){\n\t\t\t\taddImageLoadListener(mutation.target);\n\t\t\t} else if (mutation.type === 'childList'){\n\t\t\t\tArray.prototype.forEach.call(\n\t\t\t\t\tmutation.target.querySelectorAll('img'),\n\t\t\t\t\taddImageLoadListener\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\n\t\tfunction removeFromArray(element){\n\t\t\telements.splice(elements.indexOf(element),1);\n\t\t}\n\n\t\tfunction removeImageLoadListener(element){\n\t\t\tlog('Remove listeners from ' + element.src);\n\t\t\telement.removeEventListener('load', imageLoaded, false);\n\t\t\telement.removeEventListener('error', imageError, false);\n\t\t\tremoveFromArray(element);\n\t\t}\n\n\t\tfunction imageEventTriggered(event,type,typeDesc){\n\t\t\tremoveImageLoadListener(event.target);\n\t\t\tsendSize(type, typeDesc + ': ' + event.target.src, undefined, undefined);\n\t\t}\n\n\t\tfunction imageLoaded(event) {\n\t\t\timageEventTriggered(event,'imageLoad','Image loaded');\n\t\t}\n\n\t\tfunction imageError(event) {\n\t\t\timageEventTriggered(event,'imageLoadFailed','Image load failed');\n\t\t}\n\n\t\tfunction mutationObserved(mutations) {\n\t\t\tsendSize('mutationObserver','mutationObserver: ' + mutations[0].target + ' ' + mutations[0].type);\n\n\t\t\t//Deal with WebKit asyncing image loading when tags are injected into the page\n\t\t\tmutations.forEach(addImageLoadListners);\n\t\t}\n\n\t\tfunction createMutationObserver(){\n\t\t\tvar\n\t\t\t\ttarget = document.querySelector('body'),\n\n\t\t\t\tconfig = {\n\t\t\t\t\tattributes            : true,\n\t\t\t\t\tattributeOldValue     : false,\n\t\t\t\t\tcharacterData         : true,\n\t\t\t\t\tcharacterDataOldValue : false,\n\t\t\t\t\tchildList             : true,\n\t\t\t\t\tsubtree               : true\n\t\t\t\t};\n\n\t\t\tobserver = new MutationObserver(mutationObserved);\n\n\t\t\tlog('Create body MutationObserver');\n\t\t\tobserver.observe(target, config);\n\n\t\t\treturn observer;\n\t\t}\n\n\t\tvar\n\t\t\telements         = [],\n\t\t\tMutationObserver = window.MutationObserver || window.WebKitMutationObserver,\n\t\t\tobserver         = createMutationObserver();\n\n\t\treturn {\n\t\t\tdisconnect: function (){\n\t\t\t\tif ('disconnect' in observer){\n\t\t\t\t\tlog('Disconnect body MutationObserver');\n\t\t\t\t\tobserver.disconnect();\n\t\t\t\t\telements.forEach(removeImageLoadListener);\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t}\n\n\tfunction setupMutationObserver(){\n\t\tvar\tforceIntervalTimer = 0 > interval;\n\n\t\t/* istanbul ignore if */ // Not testable in PhantomJS\n\t\tif (window.MutationObserver || window.WebKitMutationObserver){\n\t\t\tif (forceIntervalTimer) {\n\t\t\t\tinitInterval();\n\t\t\t} else {\n\t\t\t\tbodyObserver = setupBodyMutationObserver();\n\t\t\t}\n\t\t} else {\n\t\t\tlog('MutationObserver not supported in this browser!');\n\t\t\tinitInterval();\n\t\t}\n\t}\n\n\n\t// document.documentElement.offsetHeight is not reliable, so\n\t// we have to jump through hoops to get a better value.\n\tfunction getComputedStyle(prop,el) {\n\t\t/* istanbul ignore next */  //Not testable in PhantomJS\n\t\tfunction convertUnitsToPxForIE8(value) {\n\t\t\tvar PIXEL = /^\\d+(px)?$/i;\n\n\t\t\tif (PIXEL.test(value)) {\n\t\t\t\treturn parseInt(value,base);\n\t\t\t}\n\n\t\t\tvar\n\t\t\t\tstyle = el.style.left,\n\t\t\t\truntimeStyle = el.runtimeStyle.left;\n\n\t\t\tel.runtimeStyle.left = el.currentStyle.left;\n\t\t\tel.style.left = value || 0;\n\t\t\tvalue = el.style.pixelLeft;\n\t\t\tel.style.left = style;\n\t\t\tel.runtimeStyle.left = runtimeStyle;\n\n\t\t\treturn value;\n\t\t}\n\n\t\tvar retVal = 0;\n\t\tel =  el || document.body;\n\n\t\t/* istanbul ignore else */ // Not testable in phantonJS\n\t\tif (('defaultView' in document) && ('getComputedStyle' in document.defaultView)) {\n\t\t\tretVal = document.defaultView.getComputedStyle(el, null);\n\t\t\tretVal = (null !== retVal) ? retVal[prop] : 0;\n\t\t} else {//IE8\n\t\t\tretVal =  convertUnitsToPxForIE8(el.currentStyle[prop]);\n\t\t}\n\n\t\treturn parseInt(retVal,base);\n\t}\n\n\tfunction chkEventThottle(timer){\n\t\tif(timer > throttledTimer/2){\n\t\t\tthrottledTimer = 2*timer;\n\t\t\tlog('Event throttle increased to ' + throttledTimer + 'ms');\n\t\t}\n\t}\n\n\t//Idea from https://github.com/guardian/iframe-messenger\n\tfunction getMaxElement(side,elements) {\n\t\tvar\n\t\t\telementsLength = elements.length,\n\t\t\telVal          = 0,\n\t\t\tmaxVal         = 0,\n\t\t\tSide           = capitalizeFirstLetter(side),\n\t\t\ttimer          = getNow();\n\n\t\tfor (var i = 0; i < elementsLength; i++) {\n\t\t\telVal = elements[i].getBoundingClientRect()[side] + getComputedStyle('margin'+Side,elements[i]);\n\t\t\tif (elVal > maxVal) {\n\t\t\t\tmaxVal = elVal;\n\t\t\t}\n\t\t}\n\n\t\ttimer = getNow() - timer;\n\n\t\tlog('Parsed '+elementsLength+' HTML elements');\n\t\tlog('Element position calculated in ' + timer + 'ms');\n\n\t\tchkEventThottle(timer);\n\n\t\treturn maxVal;\n\t}\n\n\tfunction getAllMeasurements(dimention){\n\t\treturn [\n\t\t\tdimention.bodyOffset(),\n\t\t\tdimention.bodyScroll(),\n\t\t\tdimention.documentElementOffset(),\n\t\t\tdimention.documentElementScroll()\n\t\t];\n\t}\n\n\tfunction getTaggedElements(side,tag){\n\t\tfunction noTaggedElementsFound(){\n\t\t\twarn('No tagged elements ('+tag+') found on page');\n\t\t\treturn height; //current height\n\t\t}\n\n\t\tvar elements = document.querySelectorAll('['+tag+']');\n\n\t\treturn 0 === elements.length ?  noTaggedElementsFound() : getMaxElement(side,elements);\n\t}\n\n\tfunction getAllElements(){\n\t\treturn document.querySelectorAll('body *');\n\t}\n\n\tvar\n\t\tgetHeight = {\n\t\t\tbodyOffset: function getBodyOffsetHeight(){\n\t\t\t\treturn  document.body.offsetHeight + getComputedStyle('marginTop') + getComputedStyle('marginBottom');\n\t\t\t},\n\n\t\t\toffset: function(){\n\t\t\t\treturn getHeight.bodyOffset(); //Backwards compatability\n\t\t\t},\n\n\t\t\tbodyScroll: function getBodyScrollHeight(){\n\t\t\t\treturn document.body.scrollHeight;\n\t\t\t},\n\n\t\t\tcustom: function getCustomWidth(){\n\t\t\t\treturn customCalcMethods.height();\n\t\t\t},\n\n\t\t\tdocumentElementOffset: function getDEOffsetHeight(){\n\t\t\t\treturn document.documentElement.offsetHeight;\n\t\t\t},\n\n\t\t\tdocumentElementScroll: function getDEScrollHeight(){\n\t\t\t\treturn document.documentElement.scrollHeight;\n\t\t\t},\n\n\t\t\tmax: function getMaxHeight(){\n\t\t\t\treturn Math.max.apply(null,getAllMeasurements(getHeight));\n\t\t\t},\n\n\t\t\tmin: function getMinHeight(){\n\t\t\t\treturn Math.min.apply(null,getAllMeasurements(getHeight));\n\t\t\t},\n\n\t\t\tgrow: function growHeight(){\n\t\t\t\treturn getHeight.max(); //Run max without the forced downsizing\n\t\t\t},\n\n\t\t\tlowestElement: function getBestHeight(){\n\t\t\t\treturn Math.max(getHeight.bodyOffset(), getMaxElement('bottom',getAllElements()));\n\t\t\t},\n\n\t\t\ttaggedElement: function getTaggedElementsHeight(){\n\t\t\t\treturn getTaggedElements('bottom','data-iframe-height');\n\t\t\t}\n\t\t},\n\n\t\tgetWidth = {\n\t\t\tbodyScroll: function getBodyScrollWidth(){\n\t\t\t\treturn document.body.scrollWidth;\n\t\t\t},\n\n\t\t\tbodyOffset: function getBodyOffsetWidth(){\n\t\t\t\treturn document.body.offsetWidth;\n\t\t\t},\n\n\t\t\tcustom: function getCustomWidth(){\n\t\t\t\treturn customCalcMethods.width();\n\t\t\t},\n\n\t\t\tdocumentElementScroll: function getDEScrollWidth(){\n\t\t\t\treturn document.documentElement.scrollWidth;\n\t\t\t},\n\n\t\t\tdocumentElementOffset: function getDEOffsetWidth(){\n\t\t\t\treturn document.documentElement.offsetWidth;\n\t\t\t},\n\n\t\t\tscroll: function getMaxWidth(){\n\t\t\t\treturn Math.max(getWidth.bodyScroll(), getWidth.documentElementScroll());\n\t\t\t},\n\n\t\t\tmax: function getMaxWidth(){\n\t\t\t\treturn Math.max.apply(null,getAllMeasurements(getWidth));\n\t\t\t},\n\n\t\t\tmin: function getMinWidth(){\n\t\t\t\treturn Math.min.apply(null,getAllMeasurements(getWidth));\n\t\t\t},\n\n\t\t\trightMostElement: function rightMostElement(){\n\t\t\t\treturn getMaxElement('right', getAllElements());\n\t\t\t},\n\n\t\t\ttaggedElement: function getTaggedElementsWidth(){\n\t\t\t\treturn getTaggedElements('right', 'data-iframe-width');\n\t\t\t}\n\t\t};\n\n\n\tfunction sizeIFrame(triggerEvent, triggerEventDesc, customHeight, customWidth){\n\n\t\tfunction resizeIFrame(){\n\t\t\theight = currentHeight;\n\t\t\twidth  = currentWidth;\n\n\t\t\tsendMsg(height,width,triggerEvent);\n\t\t}\n\n\t\tfunction isSizeChangeDetected(){\n\t\t\tfunction checkTolarance(a,b){\n\t\t\t\tvar retVal = Math.abs(a-b) <= tolerance;\n\t\t\t\treturn !retVal;\n\t\t\t}\n\n\t\t\tcurrentHeight = (undefined !== customHeight)  ? customHeight : getHeight[heightCalcMode]();\n\t\t\tcurrentWidth  = (undefined !== customWidth )  ? customWidth  : getWidth[widthCalcMode]();\n\n\t\t\treturn\tcheckTolarance(height,currentHeight) || (calculateWidth && checkTolarance(width,currentWidth));\n\t\t}\n\n\t\tfunction isForceResizableEvent(){\n\t\t\treturn !(triggerEvent in {'init':1,'interval':1,'size':1});\n\t\t}\n\n\t\tfunction isForceResizableCalcMode(){\n\t\t\treturn (heightCalcMode in resetRequiredMethods) || (calculateWidth && widthCalcMode in resetRequiredMethods);\n\t\t}\n\n\t\tfunction logIgnored(){\n\t\t\tlog('No change in size detected');\n\t\t}\n\n\t\tfunction checkDownSizing(){\n\t\t\tif (isForceResizableEvent() && isForceResizableCalcMode()){\n\t\t\t\tresetIFrame(triggerEventDesc);\n\t\t\t} else if (!(triggerEvent in {'interval':1})){\n\t\t\t\tlogIgnored();\n\t\t\t}\n\t\t}\n\n\t\tvar\tcurrentHeight,currentWidth;\n\n\t\tif (isSizeChangeDetected() || 'init' === triggerEvent){\n\t\t\tlockTrigger();\n\t\t\tresizeIFrame();\n\t\t} else {\n\t\t\tcheckDownSizing();\n\t\t}\n\t}\n\n\tvar sizeIFrameThrottled = throttle(sizeIFrame);\n\n\tfunction sendSize(triggerEvent, triggerEventDesc, customHeight, customWidth){\n\t\tfunction recordTrigger(){\n\t\t\tif (!(triggerEvent in {'reset':1,'resetPage':1,'init':1})){\n\t\t\t\tlog( 'Trigger event: ' + triggerEventDesc );\n\t\t\t}\n\t\t}\n\n\t\tfunction isDoubleFiredEvent(){\n\t\t\treturn  triggerLocked && (triggerEvent in doubleEventList);\n\t\t}\n\n\t\tif (!isDoubleFiredEvent()){\n\t\t\trecordTrigger();\n\t\t\tsizeIFrameThrottled(triggerEvent, triggerEventDesc, customHeight, customWidth);\n\t\t} else {\n\t\t\tlog('Trigger event cancelled: '+triggerEvent);\n\t\t}\n\t}\n\n\tfunction lockTrigger(){\n\t\tif (!triggerLocked){\n\t\t\ttriggerLocked = true;\n\t\t\tlog('Trigger event lock on');\n\t\t}\n\t\tclearTimeout(triggerLockedTimer);\n\t\ttriggerLockedTimer = setTimeout(function(){\n\t\t\ttriggerLocked = false;\n\t\t\tlog('Trigger event lock off');\n\t\t\tlog('--');\n\t\t},eventCancelTimer);\n\t}\n\n\tfunction triggerReset(triggerEvent){\n\t\theight = getHeight[heightCalcMode]();\n\t\twidth  = getWidth[widthCalcMode]();\n\n\t\tsendMsg(height,width,triggerEvent);\n\t}\n\n\tfunction resetIFrame(triggerEventDesc){\n\t\tvar hcm = heightCalcMode;\n\t\theightCalcMode = heightCalcModeDefault;\n\n\t\tlog('Reset trigger event: ' + triggerEventDesc);\n\t\tlockTrigger();\n\t\ttriggerReset('reset');\n\n\t\theightCalcMode = hcm;\n\t}\n\n\tfunction sendMsg(height,width,triggerEvent,msg,targetOrigin){\n\t\tfunction setTargetOrigin(){\n\t\t\tif (undefined === targetOrigin){\n\t\t\t\ttargetOrigin = targetOriginDefault;\n\t\t\t} else {\n\t\t\t\tlog('Message targetOrigin: '+targetOrigin);\n\t\t\t}\n\t\t}\n\n\t\tfunction sendToParent(){\n\t\t\tvar\n\t\t\t\tsize  = height + ':' + width,\n\t\t\t\tmessage = myID + ':' +  size + ':' + triggerEvent + (undefined !== msg ? ':' + msg : '');\n\n\t\t\tlog('Sending message to host page (' + message + ')');\n\t\t\ttarget.postMessage( msgID + message, targetOrigin);\n\t\t}\n\n\t\tif(true === sendPermit){\n\t\t\tsetTargetOrigin();\n\t\t\tsendToParent();\n\t\t}\n\t}\n\n\tfunction receiver(event) {\n\t\tfunction isMessageForUs(){\n\t\t\treturn msgID === (''+event.data).substr(0,msgIdLen); //''+ Protects against non-string messages\n\t\t}\n\n\t\tfunction initFromParent(){\n\t\t\tfunction fireInit(){\n\t\t\t\tinitMsg = event.data;\n\t\t\t\ttarget  = event.source;\n\n\t\t\t\tinit();\n\t\t\t\tfirstRun = false;\n\t\t\t\tsetTimeout(function(){ initLock = false;},eventCancelTimer);\n\t\t\t}\n\n\t\t\tif (document.body){\n\t\t\t\tfireInit();\n\t\t\t} else {\n\t\t\t\tlog('Waiting for page ready');\n\t\t\t\taddEventListener(window,'readystatechange',initFromParent);\n\t\t\t}\n\t\t}\n\n\t\tfunction resetFromParent(){\n\t\t\tif (!initLock){\n\t\t\t\tlog('Page size reset by host page');\n\t\t\t\ttriggerReset('resetPage');\n\t\t\t} else {\n\t\t\t\tlog('Page reset ignored by init');\n\t\t\t}\n\t\t}\n\n\t\tfunction resizeFromParent(){\n\t\t\tsendSize('resizeParent','Parent window requested size check');\n\t\t}\n\n\t\tfunction moveToAnchor(){\n\t\t\tvar anchor = getData();\n\t\t\tinPageLinks.findTarget(anchor);\n\t\t}\n\n\t\tfunction getMessageType(){\n\t\t\treturn event.data.split(']')[1].split(':')[0];\n\t\t}\n\n\t\tfunction getData(){\n\t\t\treturn event.data.substr(event.data.indexOf(':')+1);\n\t\t}\n\n\t\tfunction isMiddleTier(){\n\t\t\treturn ('iFrameResize' in window);\n\t\t}\n\n\t\tfunction messageFromParent(){\n\t\t\tvar msgBody = getData();\n\n\t\t\tlog('MessageCallback called from parent: ' + msgBody );\n\t\t\tmessageCallback(JSON.parse(msgBody));\n\t\t\tlog(' --');\n\t\t}\n\n\t\tfunction pageInfoFromParent(){\n\t\t\tvar msgBody = getData();\n\t\t\tlog('PageInfoFromParent called from parent: ' + msgBody );\n\t\t\tpageInfoCallback(JSON.parse(msgBody));\n\t\t\tlog(' --');\n\t\t}\n\n\t\tfunction isInitMsg(){\n\t\t\t//Test if this message is from a child below us. This is an ugly test, however, updating\n\t\t\t//the message format would break backwards compatibity.\n\t\t\treturn event.data.split(':')[2] in {'true':1,'false':1};\n\t\t}\n\n\t\tfunction callFromParent(){\n\t\t\tswitch (getMessageType()){\n\t\t\tcase 'reset':\n\t\t\t\tresetFromParent();\n\t\t\t\tbreak;\n\t\t\tcase 'resize':\n\t\t\t\tresizeFromParent();\n\t\t\t\tbreak;\n\t\t\tcase 'inPageLink':\n\t\t\tcase 'moveToAnchor':\n\t\t\t\tmoveToAnchor();\n\t\t\t\tbreak;\n\t\t\tcase 'message':\n\t\t\t\tmessageFromParent();\n\t\t\t\tbreak;\n\t\t\tcase 'pageInfo':\n\t\t\t\tpageInfoFromParent();\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tif (!isMiddleTier() && !isInitMsg()){\n\t\t\t\t\twarn('Unexpected message ('+event.data+')');\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tfunction processMessage(){\n\t\t\tif (false === firstRun) {\n\t\t\t\tcallFromParent();\n\t\t\t} else if (isInitMsg()) {\n\t\t\t\tinitFromParent();\n\t\t\t} else {\n\t\t\t\tlog('Ignored message of type \"' + getMessageType() + '\". Received before initialization.');\n\t\t\t}\n\t\t}\n\n\t\tif (isMessageForUs()){\n\t\t\tprocessMessage();\n\t\t}\n\t}\n\n\t//Normally the parent kicks things off when it detects the iFrame has loaded.\n\t//If this script is async-loaded, then tell parent page to retry init.\n\tfunction chkLateLoaded(){\n\t\tif('loading' !== document.readyState){\n\t\t\twindow.parent.postMessage('[iFrameResizerChild]Ready','*');\n\t\t}\n\t}\n\n\taddEventListener(window, 'message', receiver);\n\tchkLateLoaded();\n\n\t\n\n})(window || {});\n"]}