{"version":3,"sources":["plugins/GracefulThemePlugin/theme/static-src/js/edit/theme-manage.js"],"names":["ThemeManage","$contentEle","$config","$allConfig","$iframe","element","config","allConfig","currentIframe","currentItem","leftBlock","find","rightBlock","bottomBlock","colorBlock","init","_setupBlockConfig","_setupBottomConfig","_setupColorConfig","$","$item","_saveConfig","_send","_sendSort","configs","color","blocks","left","right","bottom","_getBlockConfig","_getBottomConfig","_getColorConfig","self","each","index","value","prop","data","itemConfig","_getConfigfromAllConfig","attr","$block","push","parents","val","currentData","isChoiced","post","html","replaceWith","show","src","Date","parse","id"],"mappings":";;;;;;;;;;IACMA,W;AACJ,uBAAYC,WAAZ,EAAyBC,OAAzB,EAAkCC,UAAlC,EAA8CC,OAA9C,EAAuD;AAAA;;AACrD,SAAKC,OAAL,GAAeJ,WAAf;AACA,SAAKK,MAAL,GAAcJ,OAAd;AACA,SAAKK,SAAL,GAAiBJ,UAAjB;AACA,SAAKK,aAAL,GAAqBJ,OAArB;AACA,SAAKK,WAAL,GAAmB,IAAnB;;AAEA,SAAKC,SAAL,GAAiB,KAAKL,OAAL,CAAaM,IAAb,CAAkB,0BAAlB,CAAjB;AACA,SAAKC,UAAL,GAAkB,KAAKP,OAAL,CAAaM,IAAb,CAAkB,2BAAlB,CAAlB;AACA,SAAKE,WAAL,GAAmB,KAAKR,OAAL,CAAaM,IAAb,CAAkB,4BAAlB,CAAnB;AACA,SAAKG,UAAL,GAAkB,KAAKT,OAAL,CAAaM,IAAb,CAAkB,2BAAlB,CAAlB;AACA,SAAKI,IAAL;AACD;;;;2BAEM;AACL,WAAKC,iBAAL;AACA,WAAKC,kBAAL;AACA,WAAKC,iBAAL;AACD;;;iCAEY;AACX,aAAOC,EAAE,KAAKd,OAAP,CAAP;AACD;;;mCAEce,K,EAAO;AACpB,WAAKX,WAAL,GAAmBW,KAAnB;AACD;;;qCAEgB;AACf,aAAO,KAAKX,WAAZ;AACD;;;gCAEW;AACV,WAAKY,WAAL;AACA,WAAKC,KAAL;AACD;;;+BAEU;AACT,WAAKD,WAAL;AACA,WAAKE,SAAL;AACD;;;kCAEa;AACZ,UAAIC,UAAU,EAACC,OAAO,EAAR,EAAYC,QAAO,EAACC,MAAK,EAAN,EAAUC,OAAM,EAAhB,EAAnB,EAAwCC,QAAQ,EAAhD,EAAd;;AAEAL,cAAQE,MAAR,CAAeC,IAAf,GAAsB,KAAKG,eAAL,CAAqB,KAAKpB,SAA1B,CAAtB;AACAc,cAAQE,MAAR,CAAeE,KAAf,GAAuB,KAAKE,eAAL,CAAqB,KAAKlB,UAA1B,CAAvB;AACAY,cAAQK,MAAR,GAAiB,KAAKE,gBAAL,CAAsB,KAAKlB,WAA3B,CAAjB;AACAW,cAAQC,KAAR,GAAgB,KAAKO,eAAL,CAAqB,KAAKlB,UAA1B,CAAhB;AACA,WAAKR,MAAL,GAAckB,OAAd;AACD;;;wCAEmB;AAClB,UAAIS,OAAO,IAAX;AACA,WAAKvB,SAAL,CAAeC,IAAf,CAAoB,IAApB,EAA0BuB,IAA1B,CAA+B,UAASC,KAAT,EAAgBC,KAAhB,EAAsB;AACnD,YAAIjB,EAAE,IAAF,EAAQR,IAAR,CAAa,cAAb,EAA6B0B,IAA7B,CAAkC,SAAlC,KAAgD,IAApD,EAA0D;AACxDlB,YAAE,IAAF,EAAQmB,IAAR,CAAa,QAAb,EAAuBL,KAAK3B,MAAL,CAAYoB,MAAZ,CAAmBC,IAAnB,CAAwBQ,KAAxB,CAAvB;AACD,SAFD,MAEO;AACL,cAAII,aAAaN,KAAKO,uBAAL,CAA6BrB,EAAE,IAAF,EAAQsB,IAAR,CAAa,IAAb,CAA7B,EAAiDR,KAAK1B,SAAL,CAAemB,MAAf,CAAsBC,IAAvE,CAAjB;AACAR,YAAE,IAAF,EAAQmB,IAAR,CAAa,QAAb,EAAuBC,UAAvB;AACD;AACF,OAPD;AAQA,WAAK3B,UAAL,CAAgBD,IAAhB,CAAqB,IAArB,EAA2BuB,IAA3B,CAAgC,UAASC,KAAT,EAAgBC,KAAhB,EAAsB;AACpD,YAAIjB,EAAE,IAAF,EAAQR,IAAR,CAAa,cAAb,EAA6B0B,IAA7B,CAAkC,SAAlC,KAAgD,IAApD,EAA0D;AACtDlB,YAAE,IAAF,EAAQmB,IAAR,CAAa,QAAb,EAAuBL,KAAK3B,MAAL,CAAYoB,MAAZ,CAAmBE,KAAnB,CAAyBO,KAAzB,CAAvB;AACH,SAFD,MAEO;AACL,cAAII,aAAaN,KAAKO,uBAAL,CAA6BrB,EAAE,IAAF,EAAQsB,IAAR,CAAa,IAAb,CAA7B,EAAiDR,KAAK1B,SAAL,CAAemB,MAAf,CAAsBE,KAAvE,CAAjB;AACAT,YAAE,IAAF,EAAQmB,IAAR,CAAa,QAAb,EAAuBC,UAAvB;AACD;AACF,OAPD;AAQD;;;yCAEoB;AACnB,WAAK1B,WAAL,CAAiBF,IAAjB,CAAsB,6BAA2B,KAAKL,MAAL,CAAYuB,MAAvC,GAA8C,GAApE,EAAyEQ,IAAzE,CAA8E,SAA9E,EAAyF,IAAzF;AACD;;;wCAEmB;AAClB,WAAKvB,UAAL,CAAgBH,IAAhB,CAAqB,6BAA2B,KAAKL,MAAL,CAAYmB,KAAvC,GAA6C,GAAlE,EAAuEY,IAAvE,CAA4E,SAA5E,EAAuF,IAAvF;AACD;;;oCAEeK,M,EAAQ;AACtB,UAAIpC,SAAS,EAAb;AACAoC,aAAO/B,IAAP,CAAY,8BAAZ,EAA4CuB,IAA5C,CAAiD,YAAU;AACvD5B,eAAOqC,IAAP,CAAYxB,EAAE,IAAF,EAAQyB,OAAR,CAAgB,IAAhB,EAAsBN,IAAtB,CAA2B,QAA3B,CAAZ;AACH,OAFD;;AAIA,aAAOhC,MAAP;AACD;;;qCAEgBoC,M,EAAQ;AACvB,aAAOA,OAAO/B,IAAP,CAAY,2BAAZ,EAAyCkC,GAAzC,EAAP;AACD;;;oCAEeH,M,EAAQ;AACtB,aAAOA,OAAO/B,IAAP,CAAY,2BAAZ,EAAyCkC,GAAzC,EAAP;AACD;;;4BAEO;AACN,UAAIzC,UAAU,KAAKI,aAAnB;AACA,UAAIsC,cAAc3B,EAAE,MAAIA,EAAE,KAAKV,WAAP,EAAoBgC,IAApB,CAAyB,IAAzB,CAAN,EAAsCH,IAAtC,CAA2C,QAA3C,CAAlB;AACA,UAAIS,YAAY5B,EAAE,MAAIA,EAAE,KAAKV,WAAP,EAAoBgC,IAApB,CAAyB,IAAzB,CAAN,EAAsC9B,IAAtC,CAA2C,cAA3C,EAA2D0B,IAA3D,CAAgE,SAAhE,CAAhB;;AAEAlB,QAAE6B,IAAF,CAAO,KAAK3C,OAAL,CAAaiC,IAAb,CAAkB,KAAlB,CAAP,EAAiC,EAAChC,QAAO,KAAKA,MAAb,EAAqBwC,aAAaA,WAAlC,EAAjC,EAAiF,UAASG,IAAT,EAAc;;AAE7F9B,UAAE,MAAIA,EAAE8B,IAAF,EAAQR,IAAR,CAAa,IAAb,CAAN,EAA0BS,WAA1B,CAAsC/B,EAAE8B,IAAF,CAAtC;AACA9B,UAAE,MAAIA,EAAE8B,IAAF,EAAQR,IAAR,CAAa,IAAb,CAAN,EAA0BH,IAA1B,CAA+B,QAA/B,EAAyCQ,WAAzC;AACA,YAAIC,SAAJ,EAAe;AACb5B,YAAE,MAAIA,EAAE8B,IAAF,EAAQR,IAAR,CAAa,IAAb,CAAN,EAA0B9B,IAA1B,CAA+B,cAA/B,EAA+C0B,IAA/C,CAAoD,SAApD,EAA+D,IAA/D;AACAlB,YAAE,MAAIA,EAAE8B,IAAF,EAAQR,IAAR,CAAa,IAAb,CAAN,EAA0B9B,IAA1B,CAA+B,gBAA/B,EAAiDwC,IAAjD;AACD;AACD,YAAIC,MAAMhD,QAAQqC,IAAR,CAAa,KAAb,IAAsB,KAAtB,GAA8BY,KAAKC,KAAL,CAAW,IAAID,IAAJ,EAAX,CAAxC;AACAjD,gBAAQqC,IAAR,CAAa,KAAb,EAAoBW,GAApB;AACD,OAVD;AAWD;;;gCAEW;AACV,UAAIhD,UAAU,KAAKI,aAAnB;;AAEAW,QAAE6B,IAAF,CAAO,KAAK3C,OAAL,CAAaiC,IAAb,CAAkB,KAAlB,CAAP,EAAiC,EAAChC,QAAO,KAAKA,MAAb,EAAjC,EAAuD,UAAS2C,IAAT,EAAc;AACnE,YAAIG,MAAMhD,QAAQqC,IAAR,CAAa,KAAb,IAAsB,KAAtB,GAA8BY,KAAKC,KAAL,CAAW,IAAID,IAAJ,EAAX,CAAxC;AACAjD,gBAAQqC,IAAR,CAAa,KAAb,EAAoBW,GAApB;AACD,OAHD;AAID;;;4CAEuBG,E,EAAIhD,S,EAAU;AACpC,WAAK,IAAIgC,UAAT,IAAuBhC,SAAvB,EAAkC;AAChC,YAAIA,UAAUgC,UAAV,EAAsBgB,EAAtB,IAA4BA,EAAhC,EAAoC;AAClC,iBAAOhD,UAAUgC,UAAV,CAAP;AACD;AACF;AACF;;;;;;kBAGYvC,W","file":"theme-manage.js","sourceRoot":"/Users/kz/projects/edusoho","sourcesContent":["\nclass ThemeManage {\n  constructor($contentEle, $config, $allConfig, $iframe) {\n    this.element = $contentEle;\n    this.config = $config;\n    this.allConfig = $allConfig;\n    this.currentIframe = $iframe;\n    this.currentItem = null;\n\n    this.leftBlock = this.element.find('.theme-custom-left-block');\n    this.rightBlock = this.element.find('.theme-custom-right-block');\n    this.bottomBlock = this.element.find('.theme-custom-bottom-block');\n    this.colorBlock = this.element.find('.theme-custom-color-block');\n    this.init();\n  }\n\n  init() {\n    this._setupBlockConfig();\n    this._setupBottomConfig();\n    this._setupColorConfig();\n  }\n\n  getElement() {\n    return $(this.element); \n  }\n\n  setCurrentItem($item) {\n    this.currentItem = $item;\n  }\n\n  getCurrentItem() {\n    return this.currentItem;\n  }\n\n  saveBlock() {\n    this._saveConfig();\n    this._send();\n  }\n\n  saveSort() {\n    this._saveConfig();\n    this._sendSort();\n  }\n\n  _saveConfig() {\n    let configs = {color: '', blocks:{left:[], right:[]}, bottom: ''};\n\n    configs.blocks.left = this._getBlockConfig(this.leftBlock);\n    configs.blocks.right = this._getBlockConfig(this.rightBlock);\n    configs.bottom = this._getBottomConfig(this.bottomBlock);\n    configs.color = this._getColorConfig(this.colorBlock);\n    this.config = configs;\n  }\n\n  _setupBlockConfig() {\n    let self = this;\n    this.leftBlock.find('li').each(function(index, value){\n      if ($(this).find('.check-block').prop('checked') == true) {\n        $(this).data('config', self.config.blocks.left[index]);\n      } else {\n        let itemConfig = self._getConfigfromAllConfig($(this).attr('id'), self.allConfig.blocks.left);\n        $(this).data('config', itemConfig);\n      }\n    });\n    this.rightBlock.find('li').each(function(index, value){\n      if ($(this).find('.check-block').prop('checked') == true) {\n          $(this).data('config', self.config.blocks.right[index]);\n      } else {\n        let itemConfig = self._getConfigfromAllConfig($(this).attr('id'), self.allConfig.blocks.right);\n        $(this).data('config', itemConfig);\n      }\n    });\n  }\n\n  _setupBottomConfig() {\n    this.bottomBlock.find('input[type=radio][value='+this.config.bottom+']').prop('checked', true);\n  }\n\n  _setupColorConfig() {\n    this.colorBlock.find('input[type=radio][value='+this.config.color+']').prop('checked', true);\n  }\n\n  _getBlockConfig($block) {\n    let config = [];\n    $block.find('input[type=checkbox]:checked').each(function(){\n        config.push($(this).parents('li').data('config'));\n    });\n\n    return config;\n  }\n\n  _getBottomConfig($block) {\n    return $block.find('input[type=radio]:checked').val();\n  }\n\n  _getColorConfig($block) {\n    return $block.find('input[type=radio]:checked').val();\n  }\n\n  _send() {\n    let $iframe = this.currentIframe;\n    let currentData = $('#'+$(this.currentItem).attr('id')).data('config');\n    let isChoiced = $('#'+$(this.currentItem).attr('id')).find('.check-block').prop('checked');\n\n    $.post(this.element.data('url'), {config:this.config, currentData: currentData}, function(html){\n\n      $('#'+$(html).attr('id')).replaceWith($(html));\n      $('#'+$(html).attr('id')).data('config', currentData);\n      if (isChoiced) {\n        $('#'+$(html).attr('id')).find('.check-block').prop('checked', true);\n        $('#'+$(html).attr('id')).find('.item-edit-btn').show();\n      }\n      let src = $iframe.attr('src') + \"?t=\" + Date.parse(new Date());\n      $iframe.attr('src', src);\n    });\n  }\n\n  _sendSort() {\n    let $iframe = this.currentIframe;\n\n    $.post(this.element.data('url'), {config:this.config}, function(html){\n      let src = $iframe.attr('src') + \"?t=\" + Date.parse(new Date());\n      $iframe.attr('src', src);\n    });\n  }\n\n  _getConfigfromAllConfig(id, allConfig){\n    for (let itemConfig in allConfig) {\n      if (allConfig[itemConfig].id == id) {\n        return allConfig[itemConfig];\n      }\n    }\n  }\n}\n\nexport default ThemeManage;\n\n"]}