{"version":3,"sources":["webpack:///./app/Resources/static-src/app/js/liveroom/index.js"],"names":["Live","init","self","isLiveRoomOpened","intervalId","tryCount","setInterval","clearInterval","$","html","Translator","trans","ajax","url","data","success","error","message","roomUrl","triggerLiveEvent","eventName","eventTrigger","length","attr","type","response","live_end"],"mappings":";;;;;;;;;;KAAMA,I;AACJ,mBAAc;AAAA;;AACZ,UAAKC,IAAL;AACD;;;;4BAEM;AACL,WAAIC,OAAO,IAAX;AACA,YAAKC,gBAAL,GAAwB,KAAxB;AACA,WAAIC,aAAa,CAAjB;AACA,WAAIC,WAAW,CAAf;AACAD,oBAAaE,YAAY,YAAW;AAClC,aAAID,WAAW,EAAf,EAAmB;AACjBE,yBAAcH,UAAd;AACAI,aAAE,QAAF,EAAYC,IAAZ,CAAiBC,WAAWC,KAAX,CAAiB,uCAAjB,CAAjB;AACA;AACD;AACDH,WAAEI,IAAF,CAAO;AACLC,gBAAKL,EAAE,QAAF,EAAYM,IAAZ,CAAiB,KAAjB,CADA;AAELC,oBAAS,iBAASD,IAAT,EAAe;AACtB,iBAAIA,KAAKE,KAAT,EAAgB;AACdT,6BAAcH,UAAd;AACAI,iBAAE,QAAF,EAAYC,IAAZ,CAAiBC,WAAWC,KAAX,CAAiB,+CAAjB,EAAkE,EAACM,SAASH,KAAKE,KAAf,EAAlE,CAAjB;AACA;AACD;;AAED,iBAAIF,KAAKI,OAAT,EAAkB;AAChBX,6BAAcH,UAAd;AACAF,oBAAKC,gBAAL,GAAwB,IAAxB;AACA,mBAAIM,OAAO,mCAAmCK,KAAKI,OAAxC,GAAkD,2GAA7D;AACAV,iBAAE,MAAF,EAAUC,IAAV,CAAeA,IAAf;AACD;AACDJ;AACD,YAhBI;AAiBLW,kBAAO,iBAAW;AAChBR,eAAE,QAAF,EAAYC,IAAZ,CAAiBC,WAAWC,KAAX,CAAiB,uCAAjB,CAAjB;AACD;AAnBI,UAAP;AAqBD,QA3BY,EA2BV,IA3BU,CAAb;;AA6BA,YAAKQ,gBAAL;AACD;;;wCAEkB;AACjB,WAAIjB,OAAO,IAAX;;AAEA,WAAIkB,YAAY,IAAhB;AACA,WAAIC,eAAef,YAAY,YAAW;AACxC,aAAI,CAACJ,KAAKC,gBAAN,IAA0BK,EAAE,0BAAF,EAA8Bc,MAA9B,IAAwC,CAAtE,EAAyE;AACzEF,qBAAYA,YAAY,OAAZ,GAAsB,OAAlC;AACAZ,WAAEI,IAAF,CAAO;AACLC,gBAAKL,EAAE,0BAAF,EAA8Be,IAA9B,CAAmC,SAAnC,CADA;AAELC,iBAAM,KAFD;AAGLV,iBAAM,EAAEM,WAAWA,SAAb,EAHD;AAILL,oBAAS,iBAASU,QAAT,EAAmB;AAC1B,iBAAIA,SAASC,QAAb,EAAuB;AACrBnB,6BAAcc,YAAd;AACD;AACF;AARI,UAAP;AAUD,QAbkB,EAahB,KAbgB,CAAnB;AAeD;;;;;;AAGH,KAAIrB,IAAJ,G","file":"app/js/liveroom/index.js","sourcesContent":["class Live {\n  constructor() {\n    this.init();\n  }\n\n  init() {\n    let self = this;\n    this.isLiveRoomOpened = false;\n    let intervalId = 0;\n    let tryCount = 1;\n    intervalId = setInterval(function() {\n      if (tryCount > 10) {\n        clearInterval(intervalId);\n        $(\"#entry\").html(Translator.trans('course_set.live_room.entry_error_hint'));\n        return;\n      }\n      $.ajax({\n        url: $(\"#entry\").data(\"url\"),\n        success: function(data) {\n          if (data.error) {\n            clearInterval(intervalId);\n            $(\"#entry\").html(Translator.trans('course_set.live_room.entry_error_with_message', {message: data.error}));\n            return;\n          }\n\n          if (data.roomUrl) {\n            clearInterval(intervalId);\n            self.isLiveRoomOpened = true;\n            let html = '<iframe name=\"classroom\" src=\"' + data.roomUrl + '\" style=\"position:absolute; left:0; top:0; height:100%; width:100%; border:0px;\" scrolling=\"no\"></iframe>';\n            $(\"body\").html(html);\n          }\n          tryCount++;\n        },\n        error: function() {\n          $(\"#entry\").html(Translator.trans('course_set.live_room.entry_error_hint'));\n        }\n      })\n    }, 3000);\n\n    this.triggerLiveEvent();\n  }\n\n  triggerLiveEvent() {\n    let self = this;\n    \n    let eventName = null;\n    let eventTrigger = setInterval(function() {\n      if (!self.isLiveRoomOpened || $('meta[name=\"trigger_url\"]').length == 0) return;\n      eventName = eventName ? 'doing' : 'start';\n      $.ajax({\n        url: $('meta[name=\"trigger_url\"]').attr('content'),\n        type: 'GET',\n        data: { eventName: eventName },\n        success: function(response) {\n          if (response.live_end) {\n            clearInterval(eventTrigger);\n          }\n        }\n      });\n    }, 60000);\n\n  }\n}\n\nnew Live();\n\n\n// WEBPACK FOOTER //\n// ./app/Resources/static-src/app/js/liveroom/index.js"],"sourceRoot":""}