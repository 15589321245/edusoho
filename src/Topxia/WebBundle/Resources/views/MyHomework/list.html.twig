{% extends 'TopxiaWebBundle:My:layout.html.twig' %}

{% block title %}作业批改 - {{ parent() }}{% endblock %}
{% set side_nav = 'my-teaching-homework-check' %}
{% set statuses = { unchecked:'未批改', uncommitted:'未提交', checked:'已批改' } %}
{% set script_controller = 'course-manage/homework-list' %}

{% block main %}
<div class="panel panel-default panel-col">
  	<div class="panel-heading">作业批改</div>
  	<div class="panel-body">
    	<ul class="nav nav-tabs">
    		{% for key, name in statuses %}
			    <li {% if status == key %} class="active"{% endif %}><a href="{{ url('my_teaching_homework_list', {status:key}) }}">{{ name }}</a></li>
		  	{% endfor %}
  	  	</ul>
  	  	{% if homeworks %}
  	  	<table class="table table-striped" id="homework-student-list">
	      	<thead>
		        <tr>
		          <th width="70%">学员</th>
		          <th width="30%">操作</th>
		        </tr>
	      	</thead>
      		<tbody>
      			{% for student in students %}
      			{% set user = users[student.userId] %}
      			{% set homework = homeworks[student.courseId] %}
      			{% set homeworkResult = homeworkResults[student.userId]|default(null) %}
      			{% import "TopxiaWebBundle::macro.html.twig" as web_macro %}
      			<tr id="student-{{ user.id }}-tr">
					<td class="media">
					    {{ web_macro.user_avatar(user, 'pull-left') }}
					    <a target="_blank" href="{{ path('user_show', {id:user.id}) }}">{{ user.nickname }}</a>
					    {% if status == 'unchecked' %}
					    <div class="text-muted text-sm">批改时间：{{ homeworkResult.usedTime|date('Y-n-d H:i') }}</div>
					    {% endif %}
					</td>
					<td>
					    <div class="btn-group">
					    	{% if status == 'uncommitted' %}
					    		<button class="btn btn-default btn-sm homework-urge-btn" data-url="{{ path('homework_urge', { homeworkId:homework.id, userId:user.id } )}}">私信催缴</button>
					    	{% elseif status == 'unchecked' or status == null %}
					        	<button class="btn btn-default btn-sm" data-url="/user/4/follow">批改</button>
					        {% else %}
					        	<button class="btn btn-default btn-sm" data-url="/user/4/follow">查看</button>
					        {% endif %}
					    </div>
					</td>
				</tr>
				{% else %}
					<tr class="empty">
			          <td>没有相关的作业</td>
			          <td></td>
			        </tr>
				{% endfor %}                
            </tbody>
    	</table>
    	{% else %}
			<div class="empty">没有相关的作业</div>
		{% endif %}
		{{ web_macro.paginator(paginator) }}
  	</div>
</div>
{% endblock %}