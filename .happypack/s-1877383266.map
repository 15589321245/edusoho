{"version":3,"sources":["node_modules/.0.5.3@postal.federation/lib/postal.federation.min.js"],"names":["e","n","exports","module","require","define","amd","postalFedx","_","postal","i","t","o","id","loaded","call","m","c","p","x","signalReady","apply","send","a","onFederatedMsg","r","__esModule","s","u","d","packingSlips","l","getPackingSlip","f","state","g","disconnect","h","NO_OP","configure","I","k","handlers","v","y","b","matchesFilter","S","addFilter","w","removeFilter","M","fedx","FederationClient","clients","_clients","transports","_transports","filters","canSendRemote","sendMessage","_ready","each","_outboundQueue","push","arguments","_getTransports","reduce","_signalQueue","length","addWireTap","channel","topic","subscribe","configuration","SYSTEM_CHANNEL","callback","shift","_inboundQueue","instanceId","createUUID","substr","Math","floor","random","join","publish","data","oldId","newId","Object","prototype","hasOwnProperty","Array","slice","defineProperty","value","ping","type","timeStamp","Date","ticket","pong","pingData","message","envelope","bundle","filterMode","Error","_config","defaults","transport","target","doNotNotify","enabled","filterDirection","packingSlip","source","setInstanceId","handshakeComplete","sendPong","sendBundle","pings","contains","remoteId","localId","without","transportName","lastSender","extend","isArray","direction","include","any","resolver","compare","out","configurable","writable","defineProperties","TypeError","options","sendPing","originId","clone","knownIds","concat","onMessage","shouldProcess","create"],"mappings":"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","file":"postal.federation.min.js","sourceRoot":"/Users/kz/projects/edusoho","sourcesContent":["/*!\n *  * postal.federation - A base plugin for federating instances of postal.js across various boundaries.\n *  * Author: Jim Cowart (http://ifandelse.com)\n *  * Version: v0.5.3\n *  * Url: http://github.com/postaljs/postal.federation\n *  * License(s): (MIT OR GPL-2.0)\n */\n(function(e,n){\"object\"==typeof exports&&\"object\"==typeof module?module.exports=n(require(\"lodash\"),require(\"postal\")):\"function\"==typeof define&&define.amd?define([\"lodash\",\"postal\"],n):\"object\"==typeof exports?exports.postalFedx=n(require(\"lodash\"),require(\"postal\")):e.postalFedx=n(e._,e.postal)})(this,function(e,n){return function(e){function n(i){if(t[i])return t[i].exports;var o=t[i]={exports:{},id:i,loaded:!1};return e[i].call(o.exports,o,o.exports,n),o.loaded=!0,o.exports}var t={};return n.m=e,n.c=t,n.p=\"\",n(0)}([function(e,n,t){function i(e){x.signalReady.apply(this,e)}function o(e){x.send.apply(this,e)}function a(e){x.onFederatedMsg.call(this,e)}var r=function(e){return e&&e.__esModule?e[\"default\"]:e},c=r(t(1)),s=r(t(2));t(3);var u=t(4),d=u.packingSlips,l=u.getPackingSlip,p=t(5),f=p.state,g=p.disconnect,h=p.NO_OP,_=p.configure,I=t(6),k=I.handlers,v=I.onFederatedMsg,y=t(7),b=r(y),m=y.matchesFilter,S=y.addFilter,w=y.removeFilter,M=r(t(8)),x=s.fedx={FederationClient:M,packingSlips:d,handlers:k,clients:f._clients,transports:f._transports,filters:b,addFilter:S,removeFilter:w,canSendRemote:function(e,n){return m(e,n,\"out\")},configure:_,getPackingSlip:l,onFederatedMsg:v,sendMessage:function(e){return f._ready?void c.each(this.transports,function(n){n.sendMessage(e)}):void f._outboundQueue.push(arguments)},disconnect:g,_getTransports:function(){return c.reduce(this.transports,function(e,n,t){return e[t]=!0,e},{})},signalReady:function(e,n,t){if(!f._ready)return void f._signalQueue.push(arguments);var i=this._getTransports();switch(arguments.length){case 1:\"function\"==typeof e?t=e:\"string\"==typeof e&&(i={},i[e]=this.transports[e],t=h);break;case 2:\"string\"==typeof e?(i={},i[e]=this.transports[e]):i=e,t=n||h;break;case 3:i={},i[e]=[n]}c.each(i,function(e,n){e=\"boolean\"==typeof e?[]:e,this.transports[n].signalReady(e,t)},this)}};e.exports=x,s.addWireTap(function(e,n){x.canSendRemote(n.channel,n.topic)&&x.sendMessage(n)}),s.subscribe({channel:s.configuration.SYSTEM_CHANNEL,topic:\"instanceId.changed\",callback:function(){for(f._ready=!0;f._signalQueue.length;)i(f._signalQueue.shift());for(;f._outboundQueue.length;)o(f._outboundQueue.shift());for(;f._inboundQueue.length;)a(f._inboundQueue.shift())}}),void 0!==s.instanceId()&&(f._ready=!0)},function(n,t){n.exports=e},function(e,t){e.exports=n},function(e,n,t){var i=function(e){return e&&e.__esModule?e[\"default\"]:e},o=i(t(2));o.createUUID||(o.createUUID=function(){for(var e=[],n=\"0123456789abcdef\",t=0;36>t;t++)e[t]=n.substr(Math.floor(16*Math.random()),1);return e[14]=\"4\",e[19]=n.substr(3&e[19]|8,1),e[8]=e[13]=e[18]=e[23]=\"-\",e.join(\"\")}),o.instanceId||(o.instanceId=function(){var e=void 0,n=void 0;return function(t){return t&&(n=e,e=t,o.publish({channel:o.configuration.SYSTEM_CHANNEL,topic:\"instanceId.changed\",data:{oldId:n,newId:e}})),e}}())},function(e,n,t){function i(e){return Object.prototype.hasOwnProperty.call(r,e)?r[e].apply(this,Array.prototype.slice.call(arguments,1)):void 0}var o=function(e){return e&&e.__esModule?e[\"default\"]:e};n.getPackingSlip=i,Object.defineProperty(n,\"__esModule\",{value:!0});var a=o(t(2)),r={ping:function(){return{type:\"federation.ping\",instanceId:a.instanceId(),timeStamp:new Date,ticket:a.createUUID()}},pong:function(e){return{type:\"federation.pong\",instanceId:a.instanceId(),timeStamp:new Date,pingData:{instanceId:e.instanceId,timeStamp:e.timeStamp,ticket:e.ticket}}},message:function(e){return{type:\"federation.message\",instanceId:a.instanceId(),timeStamp:new Date,envelope:e}},disconnect:function(){return{type:\"federation.disconnect\",instanceId:a.instanceId(),timeStamp:new Date}},bundle:function(e){return{type:\"federation.bundle\",instanceId:a.instanceId(),timeStamp:new Date,packingSlips:e}}};n.packingSlips=r},function(e,n,t){function i(e){if(e&&e.filterMode&&\"blacklist\"!==e.filterMode&&\"whitelist\"!==e.filterMode)throw new Error(\"postal.fedx filterMode must be 'blacklist' or 'whitelist'.\");return e&&(u._config=r.defaults(e,c)),u._config}function o(e){e=e||{};var n=u._transports;e.transport&&(n={},n[e.transport]=u._transports[e.transport]),r.each(n,function(n){n.disconnect({target:e.target,instanceId:e.instanceId,doNotNotify:!!e.doNotNotify})})}var a=function(e){return e&&e.__esModule?e[\"default\"]:e};n.configure=i,n.disconnect=o,Object.defineProperty(n,\"__esModule\",{value:!0});var r=a(t(1)),c={enabled:!0,filterMode:\"whitelist\",filterDirection:\"both\"},s=function(){};n.NO_OP=s;var u={_clients:[],_transports:{},_ready:!1,_inboundQueue:[],_outboundQueue:[],_signalQueue:[],_config:c};n.state=u},function(e,n,t){function i(e){if(!c._ready)return void c._inboundQueue.push(e);if(!Object.prototype.hasOwnProperty.call(p,e.packingSlip.type))throw new Error(\"postal.federation does not have a message handler for '\"+e.packingSlip.type+\"'.\");p[e.packingSlip.type](e)}var o=function(e){return e&&e.__esModule?e[\"default\"]:e};n.onFederatedMsg=i,Object.defineProperty(n,\"__esModule\",{value:!0});var a=t(4).getPackingSlip,r=t(5),c=r.state,s=r.disconnect,u=t(7).matchesFilter,d=o(t(2)),l=o(t(1)),p={\"federation.ping\":function(e){e.source.setInstanceId(e.packingSlip.instanceId),e.source.handshakeComplete?e.source.sendPong(e.packingSlip):e.source.sendBundle([a(\"pong\",e.packingSlip),a(\"ping\")])},\"federation.pong\":function(e){e.source.handshakeComplete=!0,e.source.setInstanceId(e.packingSlip.instanceId),e.source.pings[e.packingSlip.pingData.ticket]&&(e.source.pings[e.packingSlip.pingData.ticket].callback({ticket:e.packingSlip.pingData.ticket,instanceId:e.packingSlip.instanceId,source:e.source}),e.source.pings[e.packingSlip.pingData.ticket]=void 0),l.contains(c._clients,e.packingSlip.instanceId)||c._clients.push(e.packingSlip.instanceId),d.publish({channel:\"postal.federation\",topic:\"client.federated\",data:{remoteId:e.source.instanceId,localId:d.instanceId(),transport:e.transport}})},\"federation.disconnect\":function(e){c._clients=l.without(c._clients,e.source.instanceId),s({transport:e.source.transportName,instanceId:e.source.instanceId,doNotNotify:!0})},\"federation.message\":function(e){var n=e.packingSlip.envelope;u(n.channel,n.topic,\"in\")&&(n.lastSender=e.packingSlip.instanceId,d.publish(n))},\"federation.bundle\":function(e){l.each(e.packingSlip.packingSlips,function(n){i(l.extend({},e,{packingSlip:n}))})}};n.handlers=p},function(e,n,t){function i(e){e=c.isArray(e)?e:[e],c.each(e,function(e){e.direction=e.direction||s._config.filterDirection,c.each(\"both\"===e.direction?[\"in\",\"out\"]:[e.direction],function(n){d[n][e.channel]?c.include(d[n][e.channel],e.topic)||d[n][e.channel].push(e.topic):d[n][e.channel]=[e.topic]})})}function o(e){e=c.isArray(e)?e:[e],c.each(e,function(e){e.direction=e.direction||s._config.filterDirection,c.each(\"both\"===e.direction?[\"in\",\"out\"]:[e.direction],function(n){d[n][e.channel]&&c.include(d[n][e.channel],e.topic)&&(d[n][e.channel]=c.without(d[n][e.channel],e.topic))})})}function a(e,n,t){var i=Object.prototype.hasOwnProperty.call(d[t],e),o=i&&c.any(d[t][e],function(e){return u.configuration.resolver.compare(e,n)}),a=\"blacklist\"===s._config.filterMode;return s._config.enabled&&(a&&(!i||i&&!o)||!a&&i&&o)}var r=function(e){return e&&e.__esModule?e[\"default\"]:e};n.addFilter=i,n.removeFilter=o,n.matchesFilter=a,Object.defineProperty(n,\"__esModule\",{value:!0});var c=r(t(1)),s=t(5).state,u=r(t(2)),d={\"in\":{},out:{}};n[\"default\"]=d},function(e,n,t){var i=function(e){return e&&e.__esModule?e[\"default\"]:e},o=function(){function e(e,n){for(var t in n){var i=n[t];i.configurable=!0,i.value&&(i.writable=!0)}Object.defineProperties(e,n)}return function(n,t,i){return t&&e(n.prototype,t),i&&e(n,i),n}}(),a=function(e,n){if(!(e instanceof n))throw new TypeError(\"Cannot call a class as a function\")},r=t(4).getPackingSlip,c=t(6).onFederatedMsg,s=t(5),u=s.state,d=s.NO_OP,l=i(t(2)),p=i(t(1)),f=function(){function e(n,t,i){a(this,e),this.target=n,this.options=t||{},this.pings={},this.instanceId=i,this.handshakeComplete=!1}return o(e,{sendPing:{value:function(e){var n=r(\"ping\");this.pings[n.ticket]={ticket:n.ticket,callback:e||d},this.send(n)}},sendPong:{value:function(e){this.send(r(\"pong\",e))}},sendBundle:{value:function(e){this.send(r(\"bundle\",e))}},sendMessage:{value:function(e){if(this.handshakeComplete){e.originId=e.originId||l.instanceId();var n=p.clone(e);!this.instanceId||this.instanceId===n.lastSender||n.knownIds&&n.knownIds.length&&(!n.knownIds||p.include(n.knownIds,this.instanceId))||(n.knownIds=(n.knownIds||[]).concat(p.without(u._clients,this.instanceId)),this.send(r(\"message\",n)))}}},disconnect:{value:function(){this.send(r(\"disconnect\"))}},onMessage:{value:function(e){this.shouldProcess()&&c({transport:this.transportName,packingSlip:e,source:this})}},shouldProcess:{value:function(){return!0}},send:{value:function(){throw new Error(\"An object deriving from FederationClient must provide an implementation for 'send'.\")}},setInstanceId:{value:function(e){this.instanceId=e}}},{extend:{value:function(n,t){function i(){e.apply(this,arguments)}return i.prototype=Object.create(e.prototype),p.extend(i.prototype,n),p.extend(i,t),i}}}),e}();e.exports=f}])});\n//# sourceMappingURL=postal.federation.min.js.map"]}