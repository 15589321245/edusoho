{"version":3,"sources":["node_modules/.0.9.13@jquery-jcrop/js/jquery.Jcrop.js"],"names":["$","Jcrop","obj","opt","options","extend","defaults","docOffset","_ua","navigator","userAgent","toLowerCase","is_msie","test","ie6mode","px","n","Math","round","cssClass","cl","baseClass","supportsColorFade","fx","step","hasOwnProperty","getPos","pos","offset","left","top","mouseAbs","e","pageX","pageY","setOptions","each","i","startDragMode","mode","touch","$img","Tracker","setCursor","activateHandlers","createMover","doneSelect","fc","Coords","getFixed","opp","oppLockCorner","opc","getCorner","setPressed","setCurrent","dragmodeHandler","f","aspectRatio","y2","x2","y","x","Selection","update","lloc","KeyManager","watchKeys","moveOffset","ord","createDragger","disabled","allowMove","btndown","stopPropagation","preventDefault","presize","$obj","w","h","nw","width","nh","height","xscale","yscale","unscale","c","minSelect","enableHandles","done","release","allowSelect","newSelection","disableHandles","selectDrag","type","substring","newTracker","trk","addClass","css","opacity","backgroundColor","img_css","border","visibility","margin","padding","position","$origimg","img_mode","tagName","tempImage","Image","src","clone","removeAttr","show","after","hide","shade","boxWidth","boxHeight","boundx","boundy","$div","bgColor","insertAfter","append","$img2","$img_holder","zIndex","overflow","$hdl_holder","$sel","dblclick","onDblClick","call","api","insertBefore","attr","overflowY","bound","boundary","$trk","mousedown","bgcolor","bgopacity","bgOpacity","xlimit","ylimit","xmin","ymin","enabled","animating","shift_down","Touch","hasTouchSupport","support","events","el","document","createElement","length","eventName","isSupported","setAttribute","touchstart","touchend","touchmove","err","detectSupport","touchSupport","cfilter","originalEvent","changedTouches","x1","y1","ox","oy","rebound","getOffset","getRect","aspect","min_x","minSize","max_x","maxSize","max_y","rw","rh","rwa","abs","rha","real_ratio","xx","yy","makeObj","flipCoords","p","xa","xb","ya","yb","xsize","ysize","delta","a","Shade","holder","shades","createShade","right","bottom","resizeShades","updateAuto","updateShade","shadeColor","appendTo","enableShade","setBgOpacity","setBgColor","isAwake","setOpacity","color","now","colorChangeMacro","getShades","disableShade","remove","bgFade","animate","queue","duration","fadeTime","refreshAll","children","updateRaw","enable","disable","resize","refresh","awake","hdep","borders","handle","dragbar","seehandles","insertBorder","jq","borderOpacity","dragDiv","zi","cursor","bind","insertHandle","hs","handleSize","div","handleOpacity","insertDragbar","createDragbars","li","createBorders","createHandles","moveto","updateVisible","select","onSelect","onChange","force","onRelease","showHandles","allowResize","animMode","v","dragEdges","isArray","drawBorders","currentTarget","hasClass","$track","enableOnly","onMove","onDone","trackDoc","trackDocument","toFront","trackTouchMove","trackTouchEnd","trackMove","trackUp","toBack","unbind","move","t","mousemove","mouseup","mouseout","before","$keymgr","$keywrap","keySupport","focus","onBlur","doNudge","parseKey","ctrlKey","metaKey","shiftKey","nudge","keyCode","keydown","blur","fixedSupport","setClass","cname","removeClass","animateTo","callback","animto","initcr","animat","interv","animationDelay","ix1","iy1","ix2","iy2","pcent","velocity","swingSpeed","anim_timer","queueAnimator","window","setTimeout","animator","setSelectRaw","setSelect","rect","l","tellSelect","tellScaled","setOptionsNew","interfaceUpdate","disableCrop","enableCrop","cancelCrop","destroy","removeData","setImage","img","onload","iw","ih","bw","bh","mycolor","alt","trueSize","outerImage","cancel","getBounds","getWidgetSize","getScaleFactor","getOptions","ui","selection","data","fn","Loader","display","isFunction","imgobj","success","error","completeCheck","complete","jQuery"],"mappings":"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","file":"jquery.Jcrop.js","sourceRoot":"/Users/kz/projects/edusoho","sourcesContent":["/**\n * jquery.Jcrop.js v0.9.12\n * jQuery Image Cropping Plugin - released under MIT License \n * Author: Kelly Hallman <khallman@gmail.com>\n * http://github.com/tapmodo/Jcrop\n * Copyright (c) 2008-2013 Tapmodo Interactive LLC {{{\n *\n * Permission is hereby granted, free of charge, to any person\n * obtaining a copy of this software and associated documentation\n * files (the \"Software\"), to deal in the Software without\n * restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the\n * Software is furnished to do so, subject to the following\n * conditions:\n *\n * The above copyright notice and this permission notice shall be\n * included in all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n *\n * }}}\n */\n\n(function ($) {\n\n  $.Jcrop = function (obj, opt) {\n    var options = $.extend({}, $.Jcrop.defaults),\n        docOffset,\n        _ua = navigator.userAgent.toLowerCase(),\n        is_msie = /msie/.test(_ua),\n        ie6mode = /msie [1-6]\\./.test(_ua);\n\n    // Internal Methods {{{\n    function px(n) {\n      return Math.round(n) + 'px';\n    }\n    function cssClass(cl) {\n      return options.baseClass + '-' + cl;\n    }\n    function supportsColorFade() {\n      return $.fx.step.hasOwnProperty('backgroundColor');\n    }\n    function getPos(obj) //{{{\n    {\n      var pos = $(obj).offset();\n      return [pos.left, pos.top];\n    }\n    //}}}\n    function mouseAbs(e) //{{{\n    {\n      return [(e.pageX - docOffset[0]), (e.pageY - docOffset[1])];\n    }\n    //}}}\n    function setOptions(opt) //{{{\n    {\n      if (typeof(opt) !== 'object') opt = {};\n      options = $.extend(options, opt);\n\n      $.each(['onChange','onSelect','onRelease','onDblClick'],function(i,e) {\n        if (typeof(options[e]) !== 'function') options[e] = function () {};\n      });\n    }\n    //}}}\n    function startDragMode(mode, pos, touch) //{{{\n    {\n      docOffset = getPos($img);\n      Tracker.setCursor(mode === 'move' ? mode : mode + '-resize');\n\n      if (mode === 'move') {\n        return Tracker.activateHandlers(createMover(pos), doneSelect, touch);\n      }\n\n      var fc = Coords.getFixed();\n      var opp = oppLockCorner(mode);\n      var opc = Coords.getCorner(oppLockCorner(opp));\n\n      Coords.setPressed(Coords.getCorner(opp));\n      Coords.setCurrent(opc);\n\n      Tracker.activateHandlers(dragmodeHandler(mode, fc), doneSelect, touch);\n    }\n    //}}}\n    function dragmodeHandler(mode, f) //{{{\n    {\n      return function (pos) {\n        if (!options.aspectRatio) {\n          switch (mode) {\n          case 'e':\n            pos[1] = f.y2;\n            break;\n          case 'w':\n            pos[1] = f.y2;\n            break;\n          case 'n':\n            pos[0] = f.x2;\n            break;\n          case 's':\n            pos[0] = f.x2;\n            break;\n          }\n        } else {\n          switch (mode) {\n          case 'e':\n            pos[1] = f.y + 1;\n            break;\n          case 'w':\n            pos[1] = f.y + 1;\n            break;\n          case 'n':\n            pos[0] = f.x + 1;\n            break;\n          case 's':\n            pos[0] = f.x + 1;\n            break;\n          }\n        }\n        Coords.setCurrent(pos);\n        Selection.update();\n      };\n    }\n    //}}}\n    function createMover(pos) //{{{\n    {\n      var lloc = pos;\n      KeyManager.watchKeys();\n\n      return function (pos) {\n        Coords.moveOffset([pos[0] - lloc[0], pos[1] - lloc[1]]);\n        lloc = pos;\n\n        Selection.update();\n      };\n    }\n    //}}}\n    function oppLockCorner(ord) //{{{\n    {\n      switch (ord) {\n      case 'n':\n        return 'sw';\n      case 's':\n        return 'nw';\n      case 'e':\n        return 'nw';\n      case 'w':\n        return 'ne';\n      case 'ne':\n        return 'sw';\n      case 'nw':\n        return 'se';\n      case 'se':\n        return 'nw';\n      case 'sw':\n        return 'ne';\n      }\n    }\n    //}}}\n    function createDragger(ord) //{{{\n    {\n      return function (e) {\n        if (options.disabled) {\n          return false;\n        }\n        if ((ord === 'move') && !options.allowMove) {\n          return false;\n        }\n        \n        // Fix position of crop area when dragged the very first time.\n        // Necessary when crop image is in a hidden element when page is loaded.\n        docOffset = getPos($img);\n\n        btndown = true;\n        startDragMode(ord, mouseAbs(e));\n        e.stopPropagation();\n        e.preventDefault();\n        return false;\n      };\n    }\n    //}}}\n    function presize($obj, w, h) //{{{\n    {\n      var nw = $obj.width(),\n          nh = $obj.height();\n      if ((nw > w) && w > 0) {\n        nw = w;\n        nh = (w / $obj.width()) * $obj.height();\n      }\n      if ((nh > h) && h > 0) {\n        nh = h;\n        nw = (h / $obj.height()) * $obj.width();\n      }\n      xscale = $obj.width() / nw;\n      yscale = $obj.height() / nh;\n      $obj.width(nw).height(nh);\n    }\n    //}}}\n    function unscale(c) //{{{\n    {\n      return {\n        x: c.x * xscale,\n        y: c.y * yscale,\n        x2: c.x2 * xscale,\n        y2: c.y2 * yscale,\n        w: c.w * xscale,\n        h: c.h * yscale\n      };\n    }\n    //}}}\n    function doneSelect(pos) //{{{\n    {\n      var c = Coords.getFixed();\n      if ((c.w > options.minSelect[0]) && (c.h > options.minSelect[1])) {\n        Selection.enableHandles();\n        Selection.done();\n      } else {\n        Selection.release();\n      }\n      Tracker.setCursor(options.allowSelect ? 'crosshair' : 'default');\n    }\n    //}}}\n    function newSelection(e) //{{{\n    {\n      if (options.disabled) {\n        return;\n      }\n      if (!options.allowSelect) {\n        return;\n      }\n      btndown = true;\n      docOffset = getPos($img);\n      Selection.disableHandles();\n      Tracker.setCursor('crosshair');\n      var pos = mouseAbs(e);\n      Coords.setPressed(pos);\n      Selection.update();\n      Tracker.activateHandlers(selectDrag, doneSelect, e.type.substring(0,5)==='touch');\n      KeyManager.watchKeys();\n\n      e.stopPropagation();\n      e.preventDefault();\n      return false;\n    }\n    //}}}\n    function selectDrag(pos) //{{{\n    {\n      Coords.setCurrent(pos);\n      Selection.update();\n    }\n    //}}}\n    function newTracker() //{{{\n    {\n      var trk = $('<div></div>').addClass(cssClass('tracker'));\n      if (is_msie) {\n        trk.css({\n          opacity: 0,\n          backgroundColor: 'white'\n        });\n      }\n      return trk;\n    }\n    //}}}\n\n    // }}}\n    // Initialization {{{\n    // Sanitize some options {{{\n    if (typeof(obj) !== 'object') {\n      obj = $(obj)[0];\n    }\n    if (typeof(opt) !== 'object') {\n      opt = {};\n    }\n    // }}}\n    setOptions(opt);\n    // Initialize some jQuery objects {{{\n    // The values are SET on the image(s) for the interface\n    // If the original image has any of these set, they will be reset\n    // However, if you destroy() the Jcrop instance the original image's\n    // character in the DOM will be as you left it.\n    var img_css = {\n      border: 'none',\n      visibility: 'visible',\n      margin: 0,\n      padding: 0,\n      position: 'absolute',\n      top: 0,\n      left: 0\n    };\n\n    var $origimg = $(obj),\n      img_mode = true;\n\n    if (obj.tagName == 'IMG') {\n      // Fix size of crop image.\n      // Necessary when crop image is within a hidden element when page is loaded.\n      if ($origimg[0].width != 0 && $origimg[0].height != 0) {\n        // Obtain dimensions from contained img element.\n        $origimg.width($origimg[0].width);\n        $origimg.height($origimg[0].height);\n      } else {\n        // Obtain dimensions from temporary image in case the original is not loaded yet (e.g. IE 7.0). \n        var tempImage = new Image();\n        tempImage.src = $origimg[0].src;\n        $origimg.width(tempImage.width);\n        $origimg.height(tempImage.height);\n      } \n\n      var $img = $origimg.clone().removeAttr('id').css(img_css).show();\n\n      $img.width($origimg.width());\n      $img.height($origimg.height());\n      $origimg.after($img).hide();\n\n    } else {\n      $img = $origimg.css(img_css).show();\n      img_mode = false;\n      if (options.shade === null) { options.shade = true; }\n    }\n\n    presize($img, options.boxWidth, options.boxHeight);\n\n    var boundx = $img.width(),\n        boundy = $img.height(),\n        \n        \n        $div = $('<div />').width(boundx).height(boundy).addClass(cssClass('holder')).css({\n        position: 'relative',\n        backgroundColor: options.bgColor\n      }).insertAfter($origimg).append($img);\n\n    if (options.addClass) {\n      $div.addClass(options.addClass);\n    }\n\n    var $img2 = $('<div />'),\n\n        $img_holder = $('<div />') \n        .width('100%').height('100%').css({\n          zIndex: 310,\n          position: 'absolute',\n          overflow: 'hidden'\n        }),\n\n        $hdl_holder = $('<div />') \n        .width('100%').height('100%').css('zIndex', 320), \n\n        $sel = $('<div />') \n        .css({\n          position: 'absolute',\n          zIndex: 600\n        }).dblclick(function(){\n          var c = Coords.getFixed();\n          options.onDblClick.call(api,c);\n        }).insertBefore($img).append($img_holder, $hdl_holder); \n\n    if (img_mode) {\n\n      $img2 = $('<img />')\n          .attr('src', $img.attr('src')).css(img_css).width(boundx).height(boundy),\n\n      $img_holder.append($img2);\n\n    }\n\n    if (ie6mode) {\n      $sel.css({\n        overflowY: 'hidden'\n      });\n    }\n\n    var bound = options.boundary;\n    var $trk = newTracker().width(boundx + (bound * 2)).height(boundy + (bound * 2)).css({\n      position: 'absolute',\n      top: px(-bound),\n      left: px(-bound),\n      zIndex: 290\n    }).mousedown(newSelection);\n\n    /* }}} */\n    // Set more variables {{{\n    var bgcolor = options.bgColor,\n        bgopacity = options.bgOpacity,\n        xlimit, ylimit, xmin, ymin, xscale, yscale, enabled = true,\n        btndown, animating, shift_down;\n\n    docOffset = getPos($img);\n    // }}}\n    // }}}\n    // Internal Modules {{{\n    // Touch Module {{{ \n    var Touch = (function () {\n      // Touch support detection function adapted (under MIT License)\n      // from code by Jeffrey Sambells - http://github.com/iamamused/\n      function hasTouchSupport() {\n        var support = {}, events = ['touchstart', 'touchmove', 'touchend'],\n            el = document.createElement('div'), i;\n\n        try {\n          for(i=0; i<events.length; i++) {\n            var eventName = events[i];\n            eventName = 'on' + eventName;\n            var isSupported = (eventName in el);\n            if (!isSupported) {\n              el.setAttribute(eventName, 'return;');\n              isSupported = typeof el[eventName] == 'function';\n            }\n            support[events[i]] = isSupported;\n          }\n          return support.touchstart && support.touchend && support.touchmove;\n        }\n        catch(err) {\n          return false;\n        }\n      }\n\n      function detectSupport() {\n        if ((options.touchSupport === true) || (options.touchSupport === false)) return options.touchSupport;\n          else return hasTouchSupport();\n      }\n      return {\n        createDragger: function (ord) {\n          return function (e) {\n            if (options.disabled) {\n              return false;\n            }\n            if ((ord === 'move') && !options.allowMove) {\n              return false;\n            }\n            docOffset = getPos($img);\n            btndown = true;\n            startDragMode(ord, mouseAbs(Touch.cfilter(e)), true);\n            e.stopPropagation();\n            e.preventDefault();\n            return false;\n          };\n        },\n        newSelection: function (e) {\n          return newSelection(Touch.cfilter(e));\n        },\n        cfilter: function (e){\n          e.pageX = e.originalEvent.changedTouches[0].pageX;\n          e.pageY = e.originalEvent.changedTouches[0].pageY;\n          return e;\n        },\n        isSupported: hasTouchSupport,\n        support: detectSupport()\n      };\n    }());\n    // }}}\n    // Coords Module {{{\n    var Coords = (function () {\n      var x1 = 0,\n          y1 = 0,\n          x2 = 0,\n          y2 = 0,\n          ox, oy;\n\n      function setPressed(pos) //{{{\n      {\n        pos = rebound(pos);\n        x2 = x1 = pos[0];\n        y2 = y1 = pos[1];\n      }\n      //}}}\n      function setCurrent(pos) //{{{\n      {\n        pos = rebound(pos);\n        ox = pos[0] - x2;\n        oy = pos[1] - y2;\n        x2 = pos[0];\n        y2 = pos[1];\n      }\n      //}}}\n      function getOffset() //{{{\n      {\n        return [ox, oy];\n      }\n      //}}}\n      function moveOffset(offset) //{{{\n      {\n        var ox = offset[0],\n            oy = offset[1];\n\n        if (0 > x1 + ox) {\n          ox -= ox + x1;\n        }\n        if (0 > y1 + oy) {\n          oy -= oy + y1;\n        }\n\n        if (boundy < y2 + oy) {\n          oy += boundy - (y2 + oy);\n        }\n        if (boundx < x2 + ox) {\n          ox += boundx - (x2 + ox);\n        }\n\n        x1 += ox;\n        x2 += ox;\n        y1 += oy;\n        y2 += oy;\n      }\n      //}}}\n      function getCorner(ord) //{{{\n      {\n        var c = getFixed();\n        switch (ord) {\n        case 'ne':\n          return [c.x2, c.y];\n        case 'nw':\n          return [c.x, c.y];\n        case 'se':\n          return [c.x2, c.y2];\n        case 'sw':\n          return [c.x, c.y2];\n        }\n      }\n      //}}}\n      function getFixed() //{{{\n      {\n        if (!options.aspectRatio) {\n          return getRect();\n        }\n        // This function could use some optimization I think...\n        var aspect = options.aspectRatio,\n            min_x = options.minSize[0] / xscale,\n            \n            \n            //min_y = options.minSize[1]/yscale,\n            max_x = options.maxSize[0] / xscale,\n            max_y = options.maxSize[1] / yscale,\n            rw = x2 - x1,\n            rh = y2 - y1,\n            rwa = Math.abs(rw),\n            rha = Math.abs(rh),\n            real_ratio = rwa / rha,\n            xx, yy, w, h;\n\n        if (max_x === 0) {\n          max_x = boundx * 10;\n        }\n        if (max_y === 0) {\n          max_y = boundy * 10;\n        }\n        if (real_ratio < aspect) {\n          yy = y2;\n          w = rha * aspect;\n          xx = rw < 0 ? x1 - w : w + x1;\n\n          if (xx < 0) {\n            xx = 0;\n            h = Math.abs((xx - x1) / aspect);\n            yy = rh < 0 ? y1 - h : h + y1;\n          } else if (xx > boundx) {\n            xx = boundx;\n            h = Math.abs((xx - x1) / aspect);\n            yy = rh < 0 ? y1 - h : h + y1;\n          }\n        } else {\n          xx = x2;\n          h = rwa / aspect;\n          yy = rh < 0 ? y1 - h : y1 + h;\n          if (yy < 0) {\n            yy = 0;\n            w = Math.abs((yy - y1) * aspect);\n            xx = rw < 0 ? x1 - w : w + x1;\n          } else if (yy > boundy) {\n            yy = boundy;\n            w = Math.abs(yy - y1) * aspect;\n            xx = rw < 0 ? x1 - w : w + x1;\n          }\n        }\n\n        // Magic %-)\n        if (xx > x1) { // right side\n          if (xx - x1 < min_x) {\n            xx = x1 + min_x;\n          } else if (xx - x1 > max_x) {\n            xx = x1 + max_x;\n          }\n          if (yy > y1) {\n            yy = y1 + (xx - x1) / aspect;\n          } else {\n            yy = y1 - (xx - x1) / aspect;\n          }\n        } else if (xx < x1) { // left side\n          if (x1 - xx < min_x) {\n            xx = x1 - min_x;\n          } else if (x1 - xx > max_x) {\n            xx = x1 - max_x;\n          }\n          if (yy > y1) {\n            yy = y1 + (x1 - xx) / aspect;\n          } else {\n            yy = y1 - (x1 - xx) / aspect;\n          }\n        }\n\n        if (xx < 0) {\n          x1 -= xx;\n          xx = 0;\n        } else if (xx > boundx) {\n          x1 -= xx - boundx;\n          xx = boundx;\n        }\n\n        if (yy < 0) {\n          y1 -= yy;\n          yy = 0;\n        } else if (yy > boundy) {\n          y1 -= yy - boundy;\n          yy = boundy;\n        }\n\n        return makeObj(flipCoords(x1, y1, xx, yy));\n      }\n      //}}}\n      function rebound(p) //{{{\n      {\n        if (p[0] < 0) p[0] = 0;\n        if (p[1] < 0) p[1] = 0;\n\n        if (p[0] > boundx) p[0] = boundx;\n        if (p[1] > boundy) p[1] = boundy;\n\n        return [Math.round(p[0]), Math.round(p[1])];\n      }\n      //}}}\n      function flipCoords(x1, y1, x2, y2) //{{{\n      {\n        var xa = x1,\n            xb = x2,\n            ya = y1,\n            yb = y2;\n        if (x2 < x1) {\n          xa = x2;\n          xb = x1;\n        }\n        if (y2 < y1) {\n          ya = y2;\n          yb = y1;\n        }\n        return [xa, ya, xb, yb];\n      }\n      //}}}\n      function getRect() //{{{\n      {\n        var xsize = x2 - x1,\n            ysize = y2 - y1,\n            delta;\n\n        if (xlimit && (Math.abs(xsize) > xlimit)) {\n          x2 = (xsize > 0) ? (x1 + xlimit) : (x1 - xlimit);\n        }\n        if (ylimit && (Math.abs(ysize) > ylimit)) {\n          y2 = (ysize > 0) ? (y1 + ylimit) : (y1 - ylimit);\n        }\n\n        if (ymin / yscale && (Math.abs(ysize) < ymin / yscale)) {\n          y2 = (ysize > 0) ? (y1 + ymin / yscale) : (y1 - ymin / yscale);\n        }\n        if (xmin / xscale && (Math.abs(xsize) < xmin / xscale)) {\n          x2 = (xsize > 0) ? (x1 + xmin / xscale) : (x1 - xmin / xscale);\n        }\n\n        if (x1 < 0) {\n          x2 -= x1;\n          x1 -= x1;\n        }\n        if (y1 < 0) {\n          y2 -= y1;\n          y1 -= y1;\n        }\n        if (x2 < 0) {\n          x1 -= x2;\n          x2 -= x2;\n        }\n        if (y2 < 0) {\n          y1 -= y2;\n          y2 -= y2;\n        }\n        if (x2 > boundx) {\n          delta = x2 - boundx;\n          x1 -= delta;\n          x2 -= delta;\n        }\n        if (y2 > boundy) {\n          delta = y2 - boundy;\n          y1 -= delta;\n          y2 -= delta;\n        }\n        if (x1 > boundx) {\n          delta = x1 - boundy;\n          y2 -= delta;\n          y1 -= delta;\n        }\n        if (y1 > boundy) {\n          delta = y1 - boundy;\n          y2 -= delta;\n          y1 -= delta;\n        }\n\n        return makeObj(flipCoords(x1, y1, x2, y2));\n      }\n      //}}}\n      function makeObj(a) //{{{\n      {\n        return {\n          x: a[0],\n          y: a[1],\n          x2: a[2],\n          y2: a[3],\n          w: a[2] - a[0],\n          h: a[3] - a[1]\n        };\n      }\n      //}}}\n\n      return {\n        flipCoords: flipCoords,\n        setPressed: setPressed,\n        setCurrent: setCurrent,\n        getOffset: getOffset,\n        moveOffset: moveOffset,\n        getCorner: getCorner,\n        getFixed: getFixed\n      };\n    }());\n\n    //}}}\n    // Shade Module {{{\n    var Shade = (function() {\n      var enabled = false,\n          holder = $('<div />').css({\n            position: 'absolute',\n            zIndex: 240,\n            opacity: 0\n          }),\n          shades = {\n            top: createShade(),\n            left: createShade().height(boundy),\n            right: createShade().height(boundy),\n            bottom: createShade()\n          };\n\n      function resizeShades(w,h) {\n        shades.left.css({ height: px(h) });\n        shades.right.css({ height: px(h) });\n      }\n      function updateAuto()\n      {\n        return updateShade(Coords.getFixed());\n      }\n      function updateShade(c)\n      {\n        shades.top.css({\n          left: px(c.x),\n          width: px(c.w),\n          height: px(c.y)\n        });\n        shades.bottom.css({\n          top: px(c.y2),\n          left: px(c.x),\n          width: px(c.w),\n          height: px(boundy-c.y2)\n        });\n        shades.right.css({\n          left: px(c.x2),\n          width: px(boundx-c.x2)\n        });\n        shades.left.css({\n          width: px(c.x)\n        });\n      }\n      function createShade() {\n        return $('<div />').css({\n          position: 'absolute',\n          backgroundColor: options.shadeColor||options.bgColor\n        }).appendTo(holder);\n      }\n      function enableShade() {\n        if (!enabled) {\n          enabled = true;\n          holder.insertBefore($img);\n          updateAuto();\n          Selection.setBgOpacity(1,0,1);\n          $img2.hide();\n\n          setBgColor(options.shadeColor||options.bgColor,1);\n          if (Selection.isAwake())\n          {\n            setOpacity(options.bgOpacity,1);\n          }\n            else setOpacity(1,1);\n        }\n      }\n      function setBgColor(color,now) {\n        colorChangeMacro(getShades(),color,now);\n      }\n      function disableShade() {\n        if (enabled) {\n          holder.remove();\n          $img2.show();\n          enabled = false;\n          if (Selection.isAwake()) {\n            Selection.setBgOpacity(options.bgOpacity,1,1);\n          } else {\n            Selection.setBgOpacity(1,1,1);\n            Selection.disableHandles();\n          }\n          colorChangeMacro($div,0,1);\n        }\n      }\n      function setOpacity(opacity,now) {\n        if (enabled) {\n          if (options.bgFade && !now) {\n            holder.animate({\n              opacity: 1-opacity\n            },{\n              queue: false,\n              duration: options.fadeTime\n            });\n          }\n          else holder.css({opacity:1-opacity});\n        }\n      }\n      function refreshAll() {\n        options.shade ? enableShade() : disableShade();\n        if (Selection.isAwake()) setOpacity(options.bgOpacity);\n      }\n      function getShades() {\n        return holder.children();\n      }\n\n      return {\n        update: updateAuto,\n        updateRaw: updateShade,\n        getShades: getShades,\n        setBgColor: setBgColor,\n        enable: enableShade,\n        disable: disableShade,\n        resize: resizeShades,\n        refresh: refreshAll,\n        opacity: setOpacity\n      };\n    }());\n    // }}}\n    // Selection Module {{{\n    var Selection = (function () {\n      var awake,\n          hdep = 370,\n          borders = {},\n          handle = {},\n          dragbar = {},\n          seehandles = false;\n\n      // Private Methods\n      function insertBorder(type) //{{{\n      {\n        var jq = $('<div />').css({\n          position: 'absolute',\n          opacity: options.borderOpacity\n        }).addClass(cssClass(type));\n        $img_holder.append(jq);\n        return jq;\n      }\n      //}}}\n      function dragDiv(ord, zi) //{{{\n      {\n        var jq = $('<div />').mousedown(createDragger(ord)).css({\n          cursor: ord + '-resize',\n          position: 'absolute',\n          zIndex: zi\n        }).addClass('ord-'+ord);\n\n        if (Touch.support) {\n          jq.bind('touchstart.jcrop', Touch.createDragger(ord));\n        }\n\n        $hdl_holder.append(jq);\n        return jq;\n      }\n      //}}}\n      function insertHandle(ord) //{{{\n      {\n        var hs = options.handleSize,\n\n          div = dragDiv(ord, hdep++).css({\n            opacity: options.handleOpacity\n          }).addClass(cssClass('handle'));\n\n        if (hs) { div.width(hs).height(hs); }\n\n        return div;\n      }\n      //}}}\n      function insertDragbar(ord) //{{{\n      {\n        return dragDiv(ord, hdep++).addClass('jcrop-dragbar');\n      }\n      //}}}\n      function createDragbars(li) //{{{\n      {\n        var i;\n        for (i = 0; i < li.length; i++) {\n          dragbar[li[i]] = insertDragbar(li[i]);\n        }\n      }\n      //}}}\n      function createBorders(li) //{{{\n      {\n        var cl,i;\n        for (i = 0; i < li.length; i++) {\n          switch(li[i]){\n            case'n': cl='hline'; break;\n            case's': cl='hline bottom'; break;\n            case'e': cl='vline right'; break;\n            case'w': cl='vline'; break;\n          }\n          borders[li[i]] = insertBorder(cl);\n        }\n      }\n      //}}}\n      function createHandles(li) //{{{\n      {\n        var i;\n        for (i = 0; i < li.length; i++) {\n          handle[li[i]] = insertHandle(li[i]);\n        }\n      }\n      //}}}\n      function moveto(x, y) //{{{\n      {\n        if (!options.shade) {\n          $img2.css({\n            top: px(-y),\n            left: px(-x)\n          });\n        }\n        $sel.css({\n          top: px(y),\n          left: px(x)\n        });\n      }\n      //}}}\n      function resize(w, h) //{{{\n      {\n        $sel.width(Math.round(w)).height(Math.round(h));\n      }\n      //}}}\n      function refresh() //{{{\n      {\n        var c = Coords.getFixed();\n\n        Coords.setPressed([c.x, c.y]);\n        Coords.setCurrent([c.x2, c.y2]);\n\n        updateVisible();\n      }\n      //}}}\n\n      // Internal Methods\n      function updateVisible(select) //{{{\n      {\n        if (awake) {\n          return update(select);\n        }\n      }\n      //}}}\n      function update(select) //{{{\n      {\n        var c = Coords.getFixed();\n\n        resize(c.w, c.h);\n        moveto(c.x, c.y);\n        if (options.shade) Shade.updateRaw(c);\n\n        awake || show();\n\n        if (select) {\n          options.onSelect.call(api, unscale(c));\n        } else {\n          options.onChange.call(api, unscale(c));\n        }\n      }\n      //}}}\n      function setBgOpacity(opacity,force,now) //{{{\n      {\n        if (!awake && !force) return;\n        if (options.bgFade && !now) {\n          $img.animate({\n            opacity: opacity\n          },{\n            queue: false,\n            duration: options.fadeTime\n          });\n        } else {\n          $img.css('opacity', opacity);\n        }\n      }\n      //}}}\n      function show() //{{{\n      {\n        $sel.show();\n\n        if (options.shade) Shade.opacity(bgopacity);\n          else setBgOpacity(bgopacity,true);\n\n        awake = true;\n      }\n      //}}}\n      function release() //{{{\n      {\n        disableHandles();\n        $sel.hide();\n\n        if (options.shade) Shade.opacity(1);\n          else setBgOpacity(1);\n\n        awake = false;\n        options.onRelease.call(api);\n      }\n      //}}}\n      function showHandles() //{{{\n      {\n        if (seehandles) {\n          $hdl_holder.show();\n        }\n      }\n      //}}}\n      function enableHandles() //{{{\n      {\n        seehandles = true;\n        if (options.allowResize) {\n          $hdl_holder.show();\n          return true;\n        }\n      }\n      //}}}\n      function disableHandles() //{{{\n      {\n        seehandles = false;\n        $hdl_holder.hide();\n      } \n      //}}}\n      function animMode(v) //{{{\n      {\n        if (v) {\n          animating = true;\n          disableHandles();\n        } else {\n          animating = false;\n          enableHandles();\n        }\n      } \n      //}}}\n      function done() //{{{\n      {\n        animMode(false);\n        refresh();\n      } \n      //}}}\n      // Insert draggable elements {{{\n      // Insert border divs for outline\n\n      if (options.dragEdges && $.isArray(options.createDragbars))\n        createDragbars(options.createDragbars);\n\n      if ($.isArray(options.createHandles))\n        createHandles(options.createHandles);\n\n      if (options.drawBorders && $.isArray(options.createBorders))\n        createBorders(options.createBorders);\n\n      //}}}\n\n      // This is a hack for iOS5 to support drag/move touch functionality\n      $(document).bind('touchstart.jcrop-ios',function(e) {\n        if ($(e.currentTarget).hasClass('jcrop-tracker')) e.stopPropagation();\n      });\n\n      var $track = newTracker().mousedown(createDragger('move')).css({\n        cursor: 'move',\n        position: 'absolute',\n        zIndex: 360\n      });\n\n      if (Touch.support) {\n        $track.bind('touchstart.jcrop', Touch.createDragger('move'));\n      }\n\n      $img_holder.append($track);\n      disableHandles();\n\n      return {\n        updateVisible: updateVisible,\n        update: update,\n        release: release,\n        refresh: refresh,\n        isAwake: function () {\n          return awake;\n        },\n        setCursor: function (cursor) {\n          $track.css('cursor', cursor);\n        },\n        enableHandles: enableHandles,\n        enableOnly: function () {\n          seehandles = true;\n        },\n        showHandles: showHandles,\n        disableHandles: disableHandles,\n        animMode: animMode,\n        setBgOpacity: setBgOpacity,\n        done: done\n      };\n    }());\n    \n    //}}}\n    // Tracker Module {{{\n    var Tracker = (function () {\n      var onMove = function () {},\n          onDone = function () {},\n          trackDoc = options.trackDocument;\n\n      function toFront(touch) //{{{\n      {\n        $trk.css({\n          zIndex: 450\n        });\n\n        if (touch)\n          $(document)\n            .bind('touchmove.jcrop', trackTouchMove)\n            .bind('touchend.jcrop', trackTouchEnd);\n\n        else if (trackDoc)\n          $(document)\n            .bind('mousemove.jcrop',trackMove)\n            .bind('mouseup.jcrop',trackUp);\n      } \n      //}}}\n      function toBack() //{{{\n      {\n        $trk.css({\n          zIndex: 290\n        });\n        $(document).unbind('.jcrop');\n      } \n      //}}}\n      function trackMove(e) //{{{\n      {\n        onMove(mouseAbs(e));\n        return false;\n      } \n      //}}}\n      function trackUp(e) //{{{\n      {\n        e.preventDefault();\n        e.stopPropagation();\n\n        if (btndown) {\n          btndown = false;\n\n          onDone(mouseAbs(e));\n\n          if (Selection.isAwake()) {\n            options.onSelect.call(api, unscale(Coords.getFixed()));\n          }\n\n          toBack();\n          onMove = function () {};\n          onDone = function () {};\n        }\n\n        return false;\n      }\n      //}}}\n      function activateHandlers(move, done, touch) //{{{\n      {\n        btndown = true;\n        onMove = move;\n        onDone = done;\n        toFront(touch);\n        return false;\n      }\n      //}}}\n      function trackTouchMove(e) //{{{\n      {\n        onMove(mouseAbs(Touch.cfilter(e)));\n        return false;\n      }\n      //}}}\n      function trackTouchEnd(e) //{{{\n      {\n        return trackUp(Touch.cfilter(e));\n      }\n      //}}}\n      function setCursor(t) //{{{\n      {\n        $trk.css('cursor', t);\n      }\n      //}}}\n\n      if (!trackDoc) {\n        $trk.mousemove(trackMove).mouseup(trackUp).mouseout(trackUp);\n      }\n\n      $img.before($trk);\n      return {\n        activateHandlers: activateHandlers,\n        setCursor: setCursor\n      };\n    }());\n    //}}}\n    // KeyManager Module {{{\n    var KeyManager = (function () {\n      var $keymgr = $('<input type=\"radio\" />').css({\n        position: 'fixed',\n        left: '-120px',\n        width: '12px'\n      }).addClass('jcrop-keymgr'),\n\n        $keywrap = $('<div />').css({\n          position: 'absolute',\n          overflow: 'hidden'\n        }).append($keymgr);\n\n      function watchKeys() //{{{\n      {\n        if (options.keySupport) {\n          $keymgr.show();\n          $keymgr.focus();\n        }\n      }\n      //}}}\n      function onBlur(e) //{{{\n      {\n        $keymgr.hide();\n      }\n      //}}}\n      function doNudge(e, x, y) //{{{\n      {\n        if (options.allowMove) {\n          Coords.moveOffset([x, y]);\n          Selection.updateVisible(true);\n        }\n        e.preventDefault();\n        e.stopPropagation();\n      }\n      //}}}\n      function parseKey(e) //{{{\n      {\n        if (e.ctrlKey || e.metaKey) {\n          return true;\n        }\n        shift_down = e.shiftKey ? true : false;\n        var nudge = shift_down ? 10 : 1;\n\n        switch (e.keyCode) {\n        case 37:\n          doNudge(e, -nudge, 0);\n          break;\n        case 39:\n          doNudge(e, nudge, 0);\n          break;\n        case 38:\n          doNudge(e, 0, -nudge);\n          break;\n        case 40:\n          doNudge(e, 0, nudge);\n          break;\n        case 27:\n          if (options.allowSelect) Selection.release();\n          break;\n        case 9:\n          return true;\n        }\n\n        return false;\n      }\n      //}}}\n\n      if (options.keySupport) {\n        $keymgr.keydown(parseKey).blur(onBlur);\n        if (ie6mode || !options.fixedSupport) {\n          $keymgr.css({\n            position: 'absolute',\n            left: '-20px'\n          });\n          $keywrap.append($keymgr).insertBefore($img);\n        } else {\n          $keymgr.insertBefore($img);\n        }\n      }\n\n\n      return {\n        watchKeys: watchKeys\n      };\n    }());\n    //}}}\n    // }}}\n    // API methods {{{\n    function setClass(cname) //{{{\n    {\n      $div.removeClass().addClass(cssClass('holder')).addClass(cname);\n    }\n    //}}}\n    function animateTo(a, callback) //{{{\n    {\n      var x1 = a[0] / xscale,\n          y1 = a[1] / yscale,\n          x2 = a[2] / xscale,\n          y2 = a[3] / yscale;\n\n      if (animating) {\n        return;\n      }\n\n      var animto = Coords.flipCoords(x1, y1, x2, y2),\n          c = Coords.getFixed(),\n          initcr = [c.x, c.y, c.x2, c.y2],\n          animat = initcr,\n          interv = options.animationDelay,\n          ix1 = animto[0] - initcr[0],\n          iy1 = animto[1] - initcr[1],\n          ix2 = animto[2] - initcr[2],\n          iy2 = animto[3] - initcr[3],\n          pcent = 0,\n          velocity = options.swingSpeed;\n\n      x1 = animat[0];\n      y1 = animat[1];\n      x2 = animat[2];\n      y2 = animat[3];\n\n      Selection.animMode(true);\n      var anim_timer;\n\n      function queueAnimator() {\n        window.setTimeout(animator, interv);\n      }\n      var animator = (function () {\n        return function () {\n          pcent += (100 - pcent) / velocity;\n\n          animat[0] = Math.round(x1 + ((pcent / 100) * ix1));\n          animat[1] = Math.round(y1 + ((pcent / 100) * iy1));\n          animat[2] = Math.round(x2 + ((pcent / 100) * ix2));\n          animat[3] = Math.round(y2 + ((pcent / 100) * iy2));\n\n          if (pcent >= 99.8) {\n            pcent = 100;\n          }\n          if (pcent < 100) {\n            setSelectRaw(animat);\n            queueAnimator();\n          } else {\n            Selection.done();\n            Selection.animMode(false);\n            if (typeof(callback) === 'function') {\n              callback.call(api);\n            }\n          }\n        };\n      }());\n      queueAnimator();\n    }\n    //}}}\n    function setSelect(rect) //{{{\n    {\n      setSelectRaw([rect[0] / xscale, rect[1] / yscale, rect[2] / xscale, rect[3] / yscale]);\n      options.onSelect.call(api, unscale(Coords.getFixed()));\n      Selection.enableHandles();\n    }\n    //}}}\n    function setSelectRaw(l) //{{{\n    {\n      Coords.setPressed([l[0], l[1]]);\n      Coords.setCurrent([l[2], l[3]]);\n      Selection.update();\n    }\n    //}}}\n    function tellSelect() //{{{\n    {\n      return unscale(Coords.getFixed());\n    }\n    //}}}\n    function tellScaled() //{{{\n    {\n      return Coords.getFixed();\n    }\n    //}}}\n    function setOptionsNew(opt) //{{{\n    {\n      setOptions(opt);\n      interfaceUpdate();\n    }\n    //}}}\n    function disableCrop() //{{{\n    {\n      options.disabled = true;\n      Selection.disableHandles();\n      Selection.setCursor('default');\n      Tracker.setCursor('default');\n    }\n    //}}}\n    function enableCrop() //{{{\n    {\n      options.disabled = false;\n      interfaceUpdate();\n    }\n    //}}}\n    function cancelCrop() //{{{\n    {\n      Selection.done();\n      Tracker.activateHandlers(null, null);\n    }\n    //}}}\n    function destroy() //{{{\n    {\n      $div.remove();\n      $origimg.show();\n      $origimg.css('visibility','visible');\n      $(obj).removeData('Jcrop');\n    }\n    //}}}\n    function setImage(src, callback) //{{{\n    {\n      Selection.release();\n      disableCrop();\n      var img = new Image();\n      img.onload = function () {\n        var iw = img.width;\n        var ih = img.height;\n        var bw = options.boxWidth;\n        var bh = options.boxHeight;\n        $img.width(iw).height(ih);\n        $img.attr('src', src);\n        $img2.attr('src', src);\n        presize($img, bw, bh);\n        boundx = $img.width();\n        boundy = $img.height();\n        $img2.width(boundx).height(boundy);\n        $trk.width(boundx + (bound * 2)).height(boundy + (bound * 2));\n        $div.width(boundx).height(boundy);\n        Shade.resize(boundx,boundy);\n        enableCrop();\n\n        if (typeof(callback) === 'function') {\n          callback.call(api);\n        }\n      };\n      img.src = src;\n    }\n    //}}}\n    function colorChangeMacro($obj,color,now) {\n      var mycolor = color || options.bgColor;\n      if (options.bgFade && supportsColorFade() && options.fadeTime && !now) {\n        $obj.animate({\n          backgroundColor: mycolor\n        }, {\n          queue: false,\n          duration: options.fadeTime\n        });\n      } else {\n        $obj.css('backgroundColor', mycolor);\n      }\n    }\n    function interfaceUpdate(alt) //{{{\n    // This method tweaks the interface based on options object.\n    // Called when options are changed and at end of initialization.\n    {\n      if (options.allowResize) {\n        if (alt) {\n          Selection.enableOnly();\n        } else {\n          Selection.enableHandles();\n        }\n      } else {\n        Selection.disableHandles();\n      }\n\n      Tracker.setCursor(options.allowSelect ? 'crosshair' : 'default');\n      Selection.setCursor(options.allowMove ? 'move' : 'default');\n\n      if (options.hasOwnProperty('trueSize')) {\n        xscale = options.trueSize[0] / boundx;\n        yscale = options.trueSize[1] / boundy;\n      }\n\n      if (options.hasOwnProperty('setSelect')) {\n        setSelect(options.setSelect);\n        Selection.done();\n        delete(options.setSelect);\n      }\n\n      Shade.refresh();\n\n      if (options.bgColor != bgcolor) {\n        colorChangeMacro(\n          options.shade? Shade.getShades(): $div,\n          options.shade?\n            (options.shadeColor || options.bgColor):\n            options.bgColor\n        );\n        bgcolor = options.bgColor;\n      }\n\n      if (bgopacity != options.bgOpacity) {\n        bgopacity = options.bgOpacity;\n        if (options.shade) Shade.refresh();\n          else Selection.setBgOpacity(bgopacity);\n      }\n\n      xlimit = options.maxSize[0] || 0;\n      ylimit = options.maxSize[1] || 0;\n      xmin = options.minSize[0] || 0;\n      ymin = options.minSize[1] || 0;\n\n      if (options.hasOwnProperty('outerImage')) {\n        $img.attr('src', options.outerImage);\n        delete(options.outerImage);\n      }\n\n      Selection.refresh();\n    }\n    //}}}\n    //}}}\n\n    if (Touch.support) $trk.bind('touchstart.jcrop', Touch.newSelection);\n\n    $hdl_holder.hide();\n    interfaceUpdate(true);\n\n    var api = {\n      setImage: setImage,\n      animateTo: animateTo,\n      setSelect: setSelect,\n      setOptions: setOptionsNew,\n      tellSelect: tellSelect,\n      tellScaled: tellScaled,\n      setClass: setClass,\n\n      disable: disableCrop,\n      enable: enableCrop,\n      cancel: cancelCrop,\n      release: Selection.release,\n      destroy: destroy,\n\n      focus: KeyManager.watchKeys,\n\n      getBounds: function () {\n        return [boundx * xscale, boundy * yscale];\n      },\n      getWidgetSize: function () {\n        return [boundx, boundy];\n      },\n      getScaleFactor: function () {\n        return [xscale, yscale];\n      },\n      getOptions: function() {\n        // careful: internal values are returned\n        return options;\n      },\n\n      ui: {\n        holder: $div,\n        selection: $sel\n      }\n    };\n\n    if (is_msie) $div.bind('selectstart', function () { return false; });\n\n    $origimg.data('Jcrop', api);\n    return api;\n  };\n  $.fn.Jcrop = function (options, callback) //{{{\n  {\n    var api;\n    // Iterate over each object, attach Jcrop\n    this.each(function () {\n      // If we've already attached to this object\n      if ($(this).data('Jcrop')) {\n        // The API can be requested this way (undocumented)\n        if (options === 'api') return $(this).data('Jcrop');\n        // Otherwise, we just reset the options...\n        else $(this).data('Jcrop').setOptions(options);\n      }\n      // If we haven't been attached, preload and attach\n      else {\n        if (this.tagName == 'IMG')\n          $.Jcrop.Loader(this,function(){\n            $(this).css({display:'block',visibility:'hidden'});\n            api = $.Jcrop(this, options);\n            if ($.isFunction(callback)) callback.call(api);\n          });\n        else {\n          $(this).css({display:'block',visibility:'hidden'});\n          api = $.Jcrop(this, options);\n          if ($.isFunction(callback)) callback.call(api);\n        }\n      }\n    });\n\n    // Return \"this\" so the object is chainable (jQuery-style)\n    return this;\n  };\n  //}}}\n  // $.Jcrop.Loader - basic image loader {{{\n\n  $.Jcrop.Loader = function(imgobj,success,error){\n    var $img = $(imgobj), img = $img[0];\n\n    function completeCheck(){\n      if (img.complete) {\n        $img.unbind('.jcloader');\n        if ($.isFunction(success)) success.call(img);\n      }\n      else window.setTimeout(completeCheck,50);\n    }\n\n    $img\n      .bind('load.jcloader',completeCheck)\n      .bind('error.jcloader',function(e){\n        $img.unbind('.jcloader');\n        if ($.isFunction(error)) error.call(img);\n      });\n\n    if (img.complete && $.isFunction(success)){\n      $img.unbind('.jcloader');\n      success.call(img);\n    }\n  };\n\n  //}}}\n  // Global Defaults {{{\n  $.Jcrop.defaults = {\n\n    // Basic Settings\n    allowSelect: true,\n    allowMove: true,\n    allowResize: true,\n\n    trackDocument: true,\n\n    // Styling Options\n    baseClass: 'jcrop',\n    addClass: null,\n    bgColor: 'black',\n    bgOpacity: 0.6,\n    bgFade: false,\n    borderOpacity: 0.4,\n    handleOpacity: 0.5,\n    handleSize: null,\n\n    aspectRatio: 0,\n    keySupport: true,\n    createHandles: ['n','s','e','w','nw','ne','se','sw'],\n    createDragbars: ['n','s','e','w'],\n    createBorders: ['n','s','e','w'],\n    drawBorders: true,\n    dragEdges: true,\n    fixedSupport: true,\n    touchSupport: null,\n\n    shade: null,\n\n    boxWidth: 0,\n    boxHeight: 0,\n    boundary: 2,\n    fadeTime: 400,\n    animationDelay: 20,\n    swingSpeed: 3,\n\n    minSelect: [0, 0],\n    maxSize: [0, 0],\n    minSize: [0, 0],\n\n    // Callbacks / Event Handlers\n    onChange: function () {},\n    onSelect: function () {},\n    onDblClick: function () {},\n    onRelease: function () {}\n  };\n\n  // }}}\n}(jQuery));\n"]}