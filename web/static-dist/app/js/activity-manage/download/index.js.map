{"version":3,"sources":["webpack:///./app/Resources/static-src/app/js/activity-manage/download/download.js","webpack:///./app/Resources/static-src/app/js/activity-manage/download/index.js"],"names":["DownLoad","$form","$","validator2","firstName","val","initStep2Form","bindEvent","initFileChooser","validate","rules","title","required","maxlength","trim","course_title","link","materials","messages","Translator","trans","data","on","event","itemDelete","videoImport","addFileBtn","titleChange","$parent","currentTarget","closest","mediaId","items","isEmpty","JSON","parse","stringify","siblings","length","remove","state","addFile","fileSelect","file","console","log","text","name","fileChooser","$this","obj","undefined","Object","keys","addToList","hide","valid","source","id","summary","size","media","show","setTimeout","slideUp","item_tpl","append","tooltip","removeClass","form"],"mappings":"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","file":"app/js/activity-manage/download/index.js","sourcesContent":["import FileChooser from '../../file-chooser/file-choose';\nimport notify from 'common/notify';\nimport { chooserUiOpen } from '../widget/chooser-ui.js';\n\nexport default class DownLoad {\n  constructor() {\n    this.$form = $('#step2-form');\n    this.validator2 = null;\n    this.firstName = $('#title').val();\n    this.initStep2Form();\n    this.bindEvent();\n    this.initFileChooser();\n  }\n  initStep2Form() {\n    let validator2 = this.$form.validate({\n      rules: {\n        title: {\n          required: true,\n          maxlength: 50,\n          trim: true,\n          course_title: true,\n        },\n        link: 'url',\n        materials: 'required',\n      },\n      messages: {\n        link: Translator.trans(\"activity.download_manage.link_error_hint\"),\n        materials: Translator.trans('activity.download_manage.materials_error_hint')\n      }\n    });\n    this.$form.data('validator', validator2);\n  }\n\n  bindEvent() {\n    this.$form.on('click', '.js-btn-delete', (event) => this.itemDelete(event));\n    this.$form.on('click', '.js-video-import', () => this.videoImport(false));\n    this.$form.on('click', '.js-add-file-list', () => this.addFileBtn(true));\n    this.$form.on('blur', '#title', (event) => this.titleChange(event));\n  }\n\n  itemDelete(event) {\n    let $parent = $(event.currentTarget).closest('li');\n    let mediaId = $parent.data('id');\n    let items = this.isEmpty($(\"#materials\").val()) ? {} : JSON.parse($(\"#materials\").val());\n    if (items && items[mediaId]) {\n      delete items[mediaId];\n      $(\"#materials\").val(JSON.stringify(items));\n    }\n    if ($parent.siblings('li').length <= 0) {\n      $(\"#materials\").val(null);\n    }\n    $parent.remove();\n  }\n\n  videoImport(state) {\n    this.addFile(state);\n  }\n\n  addFileBtn(state) {\n    this.addFile(state);\n  }\n\n  initFileChooser() {\n    const fileSelect = file => {\n      $(\"input[name=media]\").val(JSON.stringify(file));\n      chooserUiOpen();\n      this.addFile(false);\n      console.log(this.firstName);\n      if (this.firstName) {\n        $('#title').val(this.firstName);\n      } else {\n        $('#title').val('');\n      }\n      $('.js-current-file').text(file.name);\n    }\n\n    const fileChooser = new FileChooser();\n\n    fileChooser.on('select', fileSelect);\n  }\n\n  titleChange(event) {\n  \n    let $this = $(event.currentTarget);\n    this.firstName = $this.val();\n    console.log(this.firstName);\n  }\n\n  isEmpty(obj) {\n    return obj == null || obj == \"\" || obj == undefined || Object.keys(obj).length == 0;\n  }\n\n  addFile(addToList) {\n    //@TODO重构代码\n    $('.js-success-redmine').hide();\n    if (this.isEmpty($(\"#media\").val()) && $(\"#step2-form\").data('validator') && $(\"#step2-form\").data('validator').valid() && $(\"#link\").val().length > 0) {\n      if (!addToList) {\n        $(\"#verifyLink\").val($(\"#link\").val());\n      }\n      let data = {\n        source: 'link',\n        id: $(\"#verifyLink\").val(),\n        name: $(\"#verifyLink\").val(),\n        link: $(\"#verifyLink\").val(),\n        summary: $(\"#file-summary\").val(),\n        size: 0\n      };\n      $('.js-current-file').text($(\"#verifyLink\").val());\n      $(\"#media\").val(JSON.stringify(data));\n    }\n\n\n    let media = this.isEmpty($(\"#media\").val()) ? {} : JSON.parse($(\"#media\").val());\n    let items = this.isEmpty($(\"#materials\").val()) ? {} : JSON.parse($(\"#materials\").val());\n\n    if (!this.isEmpty(items) && items[media.id]) {\n      $('.js-danger-redmine').text(Translator.trans('activity.download_manage.materials_exist_error_hint')).show();\n      setTimeout(function () {\n        $('.js-danger-redmine').slideUp();\n      }, 3000);\n      $('.js-current-file').text('');\n      $(\"#media\").val(null);\n      media = null;\n      return;\n    }\n\n    if (!addToList) {\n      return;\n    }\n\n    if (addToList && this.isEmpty(media)) {\n      $('.js-danger-redmine').text(Translator.trans('activity.download_manage.materials_error_hint')).show();\n      $('.js-current-file').text('');\n      setTimeout(function () {\n        $('.js-danger-redmine').slideUp();\n      }, 3000);\n      return;\n    }\n\n\n    $('.js-current-file').text('');\n    media.summary = $(\"#file-summary\").val();\n    items[media.id] = media;\n    $(\"#materials\").val(JSON.stringify(items));\n\n    $(\"#media\").val(null);\n    $('#link').val(null);\n    $(\"#file-summary\").val(null);\n\n    if (!this.firstName) {\n      this.firstName = media.name;\n      $('#title').val(media.name);\n    }\n\n\n    let item_tpl = '';\n    if (media.link) {\n      item_tpl = `\n    <li class=\"download-item \" data-id=\"${media.link}\">\n        <a class=\"gray-primary\" href=\"${ media.link}\" target=\"_blank\">${media.name}</a>\n        <a class=\"gray-primary phm btn-delete  js-btn-delete\"  href=\"javascript:;\"  data-url=\"\" data-toggle=\"tooltip\" data-placement=\"top\" title=\"${Translator.trans('activity.download_manage.materials_delete_btn')}\"><i class=\"es-icon es-icon-delete\"></i></a>\n        <span class=\"glyphicon glyphicon-new-window text-muted text-sm\" title=\"${Translator.trans('activity.download_manage.materials_delete_btn')}\"></span>\n    </li>\n  `;\n    } else {\n      item_tpl = `\n    <li class=\"download-item \" data-id=\"${media.id}\">\n      <a class=\"gray-primary\" href=\"/materiallib/${ media.id}/download\">${media.name}</a>\n      <a class=\"gray-primary phm  btn-delete js-btn-delete\" href=\"javascript:;\"  data-url=\"\" data-toggle=\"tooltip\" data-placement=\"top\" title=\"${Translator.trans('activity.download_manage.materials_delete_btn')}\"><i class=\"es-icon es-icon-delete\"></i></a>\n    </li>\n  `;\n    }\n    $(\"#material-list\").append(item_tpl);\n    $('[data-toggle=\"tooltip\"]').tooltip();\n    $('.file-browser-item').removeClass('active');\n    $('.js-danger-redmine').hide();\n    $('.js-success-redmine').text(Translator.trans('activity.download_manage.materials_add_success_hint')).show();\n    setTimeout(function () {\n      $('.js-success-redmine').slideUp();\n    }, 3000);\n    if ($('.jq-validate-error:visible').length > 0) {\n      $(\"#step2-form\").data('validator').form();\n    }\n  }\n}\n\n\n// WEBPACK FOOTER //\n// ./app/Resources/static-src/app/js/activity-manage/download/download.js","import DownLoad from './download.js';\n\nnew DownLoad();\n\n\n// WEBPACK FOOTER //\n// ./app/Resources/static-src/app/js/activity-manage/download/index.js"],"sourceRoot":""}