webpackJsonp(["app/js/task-manage/create/index"],{0:function(t,e){t.exports=jQuery},"1e40d679eceea65d7dcd":function(t,e,n){"use strict";var s=n("3ad8c84eedca8b0af9ff");new(function(t){return t&&t.__esModule?t:{default:t}}(s).default)($("#modal"))},"3ad8c84eedca8b0af9ff":function(t,e,n){"use strict";function s(t){return t&&t.__esModule?t:{default:t}}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var a=function(){function t(t,e){for(var n=0;n<e.length;n++){var s=e[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(e,n,s){return n&&t(e.prototype,n),s&&t(e,s),e}}(),r=n("b4fbf03f4f16003fe503"),o=s(r);n("015a62750c9975765604");var l=n("b334fd7e4c5a19234db2"),u=s(l),d=n("423d5c93d4f10f876e3b"),c=s(d),_=(n("4e68e437f5b716377a9d"),function(){function t(e){i(this,t),this.$element=e,this.$task_manage_content=$("#task-create-content"),this.$task_manage_finish=$("#task-create-finish"),this.$task_manage_type=$("#task-create-type"),this.$frame=null,this.$iframe_body=null,this.iframe_jQuery=null,this.content_iframe_name="task-create-content-iframe",this.finish_iframe_name="task-create-content-iframe",this.mode=this.$task_manage_type.data("editorMode"),this.type=this.$task_manage_type.data("editorType"),this.step=1,this.content_loaded=!1,this.finish_loaded=!1,this.contentUrl="",this.finishUrl="",this._init(),this._initEvent()}return a(t,[{key:"_initEvent",value:function(){var t=this;$("#course-tasks-submit").click(function(e){return t._onSave(e)}),$("#course-tasks-next").click(function(e){return t._onNext(e)}),$("#course-tasks-prev").click(function(e){return t._onPrev(e)}),"edit"!=this.mode?$(".js-course-tasks-item").click(function(e){return t._onSetType(e)}):$(".delete-task").click(function(e){return t._onDelete(e)})}},{key:"_init",value:function(){this._inItStep1form(),this._renderContent(this.step),"edit"==this.mode&&(this.contentUrl=this.$task_manage_type.data("contentUrl"),this.finishUrl=this.$task_manage_type.data("finishUrl"),this.step=2,this._switchPage())}},{key:"_onNext",value:function(t){3!==this.step&&this._validator(this.step)&&(this.step+=1,this._switchPage(),this.$element.trigger("afterNext"))}},{key:"_onPrev",value:function(){1===this.step||3==this.step&&!this._validator(this.step)||(this.step-=1,this._switchPage())}},{key:"_onSetType",value:function(t){var e=$(t.currentTarget).addClass("active");e.siblings().removeClass("active");var n=e.data("type");$('[name="mediaType"]').val(n),this.contentUrl=e.data("contentUrl"),this.finishUrl=e.data("finishUrl"),this.content_loaded=this.type===n,this.type=n,this._onNext(t)}},{key:"_onSave",value:function(t){var e=this;if(this._validator(this.step)){$(t.currentTarget).attr("disabled","disabled").button("loading");var n=$("#step1-form").serializeArray().concat(this.$iframe_body.find("#step2-form").serializeArray()).concat(this.$iframe_body.find("#step3-form").serializeArray());$.post(this.$task_manage_type.data("saveUrl"),n).done(function(t){e.$element.modal("hide"),t&&$("#sortable-list").trigger("addItem",t)}).fail(function(t){var e="",n=JSON.parse(t.responseText);n.error&&n.error.message&&(e=n.error.message),(0,u.default)("warning",Translator.trans("task_manage.edit_error_hint")+":"+e),$("#course-tasks-submit").attr("disabled",null)})}}},{key:"initIntro",value:function(){setTimeout(function(){if(1===$(".js-settings-list").length){(new c.default).initTaskDetailIntro(".js-settings-list")}},500)}},{key:"_onDelete",value:function(t){var e=this,n=$(t.currentTarget),s=n.data("url");void 0!==s&&confirm(Translator.trans(Translator.trans("task_manage.delete_hint")))&&$.post(s).then(function(t){(0,u.default)("success",Translator.trans("task_manage.delete_success_hint")),e.$element.modal("hide"),document.location.reload()}).fail(function(t){(0,u.default)("warning",Translator.trans("task_manage.delete_failed_hint"))})}},{key:"_switchPage",value:function(){this._renderStep(this.step),this._renderContent(this.step),this._rendStepIframe(this.step),this._rendButton(this.step),2!=this.step||this.content_loaded||this._initContentIframe(),3!=this.step||this.finish_loaded||this._initFinishIframe()}},{key:"_initContentIframe",value:function(){var t=this,e='<iframe class="'+this.content_iframe_name+'" id="'+this.content_iframe_name+'" name="'+this.content_iframe_name+'" scrolling="no" src="'+this.contentUrl+'"></iframe>';this.$task_manage_content.html(e).show(),this.$frame=$("#"+this.content_iframe_name).iFrameResize();var n=function(){t.content_loaded=!0;t.iframe_jQuery=t.$frame[0].contentWindow.$,t.$iframe_body=t.$frame.contents().find("body").addClass("task-iframe-body"),t._rendButton(2)};this.$frame.load((0,o.default)(n,this.$task_manage_content))}},{key:"_initFinishIframe",value:function(){var t='<iframe class="'+this.finish_iframe_name+'" id="'+this.finish_iframe_name+'" name="'+this.finish_iframe_name+'" scrolling="no" src="'+this.finishUrl+'"></iframe>';this.$task_manage_finish.html(t).show(),this.$frame=$("#"+this.finish_iframe_name).iFrameResize()}},{key:"_inItStep1form",value:function(){var t=$("#step1-form"),e=t.validate({rules:{mediaType:{required:!0}},messages:{mediaType:Translator.trans("validate.choose_item.message")}});t.data("validator",e)}},{key:"_validator",value:function(t){return!0}},{key:"_rendButton",value:function(t){if(1===t)this._renderPrev(!1),this._rendSubmit(!1),this._renderNext(!0);else if(2===t){if(this._renderPrev(!0),"edit"===this.mode&&this._renderPrev(!1),!this.content_loaded)return this._rendSubmit(!1),void this._renderNext(!1);this._rendSubmit(!0),this._renderNext(!0)}else 3===t&&(this._renderNext(!1),this._renderPrev(!0))}},{key:"_rendStepIframe",value:function(t){}},{key:"_renderStep",value:function(t){$("#task-create-step").find("li:eq("+(t-1)+")").addClass("doing").prev().addClass("done").removeClass("doing"),$("#task-create-step").find("li:eq("+(t-1)+")").next().removeClass("doing").removeClass("done")}},{key:"_renderContent",value:function(t){1===t?this.$task_manage_type.removeClass("hidden"):this.$task_manage_type.addClass("hidden"),2===t?this.$task_manage_content.removeClass("hidden"):this.$task_manage_content.addClass("hidden"),3===t?this.$task_manage_finish.removeClass("hidden"):this.$task_manage_finish.addClass("hidden")}},{key:"_renderNext",value:function(t){t?$("#course-tasks-next").removeClass("hidden").removeAttr("disabled"):$("#course-tasks-next").addClass("hidden")}},{key:"_renderPrev",value:function(t){t?$("#course-tasks-prev").removeClass("hidden"):$("#course-tasks-prev").addClass("hidden")}},{key:"_rendSubmit",value:function(t){t?$("#course-tasks-submit").removeClass("hidden"):$("#course-tasks-submit").addClass("hidden")}}]),t}());e.default=_},"423d5c93d4f10f876e3b":function(t,e,n){"use strict";function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var s=e[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(e,n,s){return n&&t(e.prototype,n),s&&t(e,s),e}}();n("d5e8fa5f17ac5fe79c78");var a=n("fe53252afd7b6c35cb73"),r=function(t){return t&&t.__esModule?t:{default:t}}(a),o=function(){function t(){var e=this;s(this,t),this.intro=null,this.customClass="es-intro-help multistep",$("body").on("click",".js-skip",function(t){e.intro.exit()})}return i(t,[{key:"introType",value:function(){return this.isTaskCreatePage()?void this.initTaskCreatePageIntro():this.isCourseListPage()?void this.initCourseListPageIntro():void this.initNotTaskCreatePageIntro()}},{key:"isCourseListPage",value:function(){return!!$("#courses-list-table").length}},{key:"isTaskCreatePage",value:function(){return!!$("#step-3").length}},{key:"isInitTaskDetailIntro",value:function(){return $(".js-task-manage-item").attr("into-step-id","step-5"),!!$(".js-settings-list").length}},{key:"introStart",value:function(t){var e=this,n='<i class="es-icon es-icon-close01"></i>';this.intro=introJs(),t.length<2?(n=Translator.trans("intro.confirm_hint"),this.customClass="es-intro-help"):this.customClass="es-intro-help multistep",this.intro.setOptions({steps:t,skipLabel:n,nextLabel:Translator.trans("course_set.manage.next_label"),prevLabel:Translator.trans("course_set.manage.prev_label"),doneLabel:n,showBullets:!1,tooltipPosition:"auto",showStepNumbers:!1,exitOnEsc:!1,exitOnOverlayClick:!1,tooltipClass:this.customClass}),this.intro.start().onexit(function(){}).onchange(function(){e.intro._currentStep==e.intro._introItems.length-1?$(".introjs-nextbutton").before('<a class="introjs-button  done-button js-skip">'+Translator.trans("intro.confirm_hint")+"<a/>"):$(".js-skip").remove()})}},{key:"initTaskCreatePageIntro",value:function(){$(".js-task-manage-item:first .js-item-content").trigger("click"),store.get("COURSE_BASE_INTRO")||store.get("COURSE_TASK_INTRO")?store.get("COURSE_TASK_INTRO")||(store.set("COURSE_TASK_INTRO",!0),this.introStart(this.initTaskSteps())):(store.set("COURSE_BASE_INTRO",!0),store.set("COURSE_TASK_INTRO",!0),this.introStart(this.initAllSteps()))}},{key:"initTaskDetailIntro",value:function(t){store.get("COURSE_TASK_DETAIL_INTRO")||(store.set("COURSE_TASK_DETAIL_INTRO",!0),this.introStart(this.initTaskDetailSteps(t)))}},{key:"initNotTaskCreatePageIntro",value:function(){store.get("COURSE_BASE_INTRO")||(store.set("COURSE_BASE_INTRO",!0),this.introStart(this.initNotTaskPageSteps()))}},{key:"isSetCourseListCookies",value:function(){store.get("COURSE_LIST_INTRO")||r.default.set("COURSE_LIST_INTRO_COOKIE",!0)}},{key:"initCourseListPageIntro",value:function(){var t=this;2===$("#courses-list-table").find("tbody tr").length&&!store.get("COURSE_LIST_INTRO")&&r.default.get("COURSE_LIST_INTRO_COOKIE")&&(r.default.remove("COURSE_LIST_INTRO_COOKIE"),new Promise(function(t,e){setTimeout(function(){if(!$(".js-sidenav-course-menu").length)return void t();$(".js-sidenav-course-menu").slideUp(function(){t()})},100)}).then(function(){setTimeout(function(){t.initCourseListIntro(".js-sidenav")},100)}))}},{key:"initCourseListIntro",value:function(t){store.get("COURSE_LIST_INTRO")||(store.set("COURSE_LIST_INTRO",!0),this.introStart(this.initCourseListSteps(t)))}},{key:"initAllSteps",value:function(){var t=[{intro:Translator.trans("course_set.manage.upgrade_hint")},{element:"#step-1",intro:Translator.trans("course_set.manage.upgrade_step1_hint")},{element:"#step-2",intro:Translator.trans("course_set.manage.upgrade_step2_hint")},{element:"#step-3",intro:Translator.trans("course_set.manage.upgrade_step3_hint")}];return this.isInitTaskDetailIntro()&&(t.push({element:'[into-step-id="step-5"]',intro:Translator.trans("course_set.manage.upgrade_step5_hint")}),store.get("COURSE_TASK_DETAIL_INTRO")||store.set("COURSE_TASK_DETAIL_INTRO",!0)),t}},{key:"initNotTaskPageSteps",value:function(){return[{intro:Translator.trans("course_set.manage.upgrade_hint")},{element:"#step-1",intro:Translator.trans("course_set.manage.upgrade_step1_hint")},{element:"#step-2",intro:Translator.trans("course_set.manage.upgrade_step2_hint")}]}},{key:"initTaskSteps",value:function(){var t=[{element:"#step-3",intro:Translator.trans("course_set.manage.upgrade_step3_hint")}];return this.isInitTaskDetailIntro()&&(t.push({element:"#step-5",intro:Translator.trans("course_set.manage.upgrade_step5_hint"),position:"bottom"}),store.get("COURSE_TASK_DETAIL_INTRO")||store.set("COURSE_TASK_DETAIL_INTRO",!0)),t}},{key:"initTaskDetailSteps",value:function(t){return[{element:t,intro:Translator.trans("course_set.manage.activity_link_hint"),position:"bottom"}]}},{key:"initCourseListSteps",value:function(t){return[{element:t,intro:Translator.trans("course_set.manage.hint")}]}},{key:"initResetStep",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return[{element:".js-intro-btn-group",intro:Translator.trans("course_set.manage.all_tutorial",{introBtnClassName:t}),position:"top"}]}}]),t}();e.default=o},b4fbf03f4f16003fe503:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=arguments,i=function(t,e){var n=$('<div class="load-animation"></div>');n.prependTo(e).nextAll().hide(),e.append();var i=[],a=t.length;return function(e){return i.push(e),n.hide().nextAll().show(),i.length<a?s.callee:t.apply(null,i)}};e.default=i}},["1e40d679eceea65d7dcd"]);