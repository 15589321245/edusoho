webpackJsonp(["app/js/task/index"],{0:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_sidebar=__webpack_require__("5f0af4efa4df981e1cb2"),_sidebar2=_interopRequireDefault(_sidebar),_taskUi=__webpack_require__("8564292a81bb30f6618a"),_taskUi2=_interopRequireDefault(_taskUi),_taskPipe=__webpack_require__("d1f69fe143d8968fb6c3"),_taskPipe2=_interopRequireDefault(_taskPipe),_esEventEmitter=__webpack_require__("63fff8fb24f3bd1f61cd"),_esEventEmitter2=_interopRequireDefault(_esEventEmitter),TaskShow=function(_Emitter){function TaskShow(_ref){var element=_ref.element,mode=_ref.mode;_classCallCheck(this,TaskShow);var _this=_possibleConstructorReturn(this,(TaskShow.__proto__||Object.getPrototypeOf(TaskShow)).call(this));return _this.element=$(element),_this.mode=mode,_this.ui=new _taskUi2["default"]({element:".js-task-dashboard-page"}),_this.init(),_this}return _inherits(TaskShow,_Emitter),_createClass(TaskShow,[{key:"init",value:function(){this.initPlugin(),this.initSidebar(),"preview"!=this.mode&&(this.initTaskPipe(),this.initLearnBtn())}},{key:"initPlugin",value:function(){$('[data-toggle="tooltip"]').tooltip(),$('[data-toggle="popover"]').popover({html:!0,trigger:"hover"})}},{key:"initLearnBtn",value:function(){var _this2=this;this.element.on("click","#learn-btn",function(event){$.post($("#learn-btn").data("url"),function(response){$("#modal").modal("show"),$("#modal").html(response),$('input[name="task-result-status"]',$("#js-hidden-data")).val("finish"),_this2.ui.learned()})})}},{key:"initTaskPipe",value:function(){var _this3=this;this.eventEmitter=new _taskPipe2["default"](this.element.find("#task-content-iframe")),this.eventEmitter.addListener("finish",function(response){_this3._receiveFinish(response)})}},{key:"_receiveFinish",value:function(response){var _this4=this;"finish"!=$('input[name="task-result-status"]',$("#js-hidden-data")).val()&&$.get($(".js-learned-prompt").data("url"),function(html){$(".js-learned-prompt").attr("data-content",html),_this4.ui.learnedWeakPrompt(),_this4.ui.learned(),_this4.sidebar.reload(),$('input[name="task-result-status"]',$("#js-hidden-data")).val("finish")})}},{key:"initSidebar",value:function(){var _this5=this;this.sidebar=new _sidebar2["default"]({element:this.element.find("#dashboard-sidebar"),url:this.element.find('#js-hidden-data [name="plugins_url"]').val()}),this.sidebar.on("popup",function(px,time){_this5.element.find("#dashboard-content").animate({right:px},time)}).on("fold",function(px,time){_this5.element.find("#dashboard-content").animate({right:px},time)})}}]),TaskShow}(_esEventEmitter2["default"]);new TaskShow({element:$("body"),mode:$("body").find('#js-hidden-data [name="mode"]').val()})},"5f0af4efa4df981e1cb2":function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_componentEmitter=__webpack_require__("2e9942ac598f958fc741"),_componentEmitter2=_interopRequireDefault(_componentEmitter),TaskSidebar=function(_Emitter){function TaskSidebar(_ref){var element=_ref.element,url=_ref.url;_classCallCheck(this,TaskSidebar);var _this=_possibleConstructorReturn(this,(TaskSidebar.__proto__||Object.getPrototypeOf(TaskSidebar)).call(this));return _this.url=url,_this.isManualOperation=!0,_this.element=$(element),_this.init(),_this}return _inherits(TaskSidebar,_Emitter),_createClass(TaskSidebar,[{key:"init",value:function(){var _this2=this;this.fixIconInChrome(),this.fetchPlugins().then(function(plugins){_this2.plugins=plugins,_this2.renderToolbar(),_this2.renderPane(),_this2.element.hide().show(),_this2.bindEvent()}).fail(function(error){})}},{key:"fetchPlugins",value:function(){return $.post(this.url)}},{key:"fixIconInChrome",value:function(){var html='<i class="es-icon es-icon-chevronleft"></i>';this.element.html(html)}},{key:"renderToolbar",value:function(){var html='\n    <div class="dashboard-toolbar">\n      <ul class="dashboard-toolbar-nav" id="dashboard-toolbar-nav">\n        '+this.plugins.reduce(function(html,plugin){return html+='<li data-plugin="'+plugin.code+'" data-url="'+plugin.url+'"><a href="#"><div class="mbs es-icon '+plugin.icon+'"></div>'+plugin.name+"</a></li>"},"")+"\n      </ul>\n    </div>";this.element.html(html)}},{key:"renderPane",value:function(){var html=this.plugins.reduce(function(html,plugin){return html+='<div data-pane="'+plugin.code+'" class=" '+plugin.code+'-pane js-sidebar-pane" ><div class="'+plugin.code+'-pane-body js-sidebar-pane-body"></div></div>'},"");this.element.append(html)}},{key:"bindEvent",value:function(){var _this3=this;this.element.find("#dashboard-toolbar-nav").on("click","li",function(event){var $btn=$(event.currentTarget),pluginCode=$btn.data("plugin"),url=$btn.data("url"),$pane=_this3.element.find('[data-pane="'+pluginCode+'"]'),$paneBody=$pane.find(".js-sidebar-pane-body");if(void 0!==pluginCode&&void 0!==url)return $btn.data("loaded")?void _this3.operationContent($btn):void $.get(url).then(function(html){$paneBody.html(html),$pane.perfectScrollbar(),$btn.data("loaded",!0),_this3.isManualOperation&&_this3.operationContent($btn),_this3.isManualOperation=!0})})}},{key:"operationContent",value:function($btn){$btn.hasClass("active")?(this.foldContent(),$btn.removeClass("active")):(this.element.find("#dashboard-toolbar-nav li").removeClass("active"),$btn.addClass("active"),this.element.find("[data-pane]").hide(),this.element.find('[data-pane="'+$btn.data("plugin")+'"]').show(),this.popupContent())}},{key:"popupContent",value:function(){var time=arguments.length>0&&void 0!==arguments[0]?arguments[0]:500,side_right="0px",content_right="395px";this.emit("popup",content_right,time),this.element.animate({right:side_right},time)}},{key:"foldContent",value:function(){var time=arguments.length>0&&void 0!==arguments[0]?arguments[0]:500,side_right="-"+this.element.width()+"px",content_right="35px";this.emit("fold",content_right,time),this.element.animate({right:side_right},time)}},{key:"reload",value:function(){var $currentPane=this.element.find(".js-sidebar-pane:visible"),pluginCode=$currentPane.data("pane");$currentPane.undelegate(),this.element.find("#dashboard-toolbar-nav").children('[data-plugin="'+pluginCode+'"]').data("loaded",!1).click(),this.isManualOperation=!1}}]),TaskSidebar}(_componentEmitter2["default"]);exports["default"]=TaskSidebar},d1f69fe143d8968fb6c3:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_postal=__webpack_require__("5d0c27d11736d24f7053"),_postal2=_interopRequireDefault(_postal);__webpack_require__("1164c07bd2965da0f98c"),__webpack_require__("9fd3dd805a081fae8343");var TaskPipe=function(){function TaskPipe(element){if(_classCallCheck(this,TaskPipe),this.element=$(element),this.eventUrl=this.element.data("eventUrl"),void 0===this.eventUrl)throw Error("task event url is undefined");this.eventDatas={},this.intervalId=null,this.lastTime=this.element.data("lastTime"),this.eventMap={receives:{}},this._registerChannel(),this._initInterval()}return _createClass(TaskPipe,[{key:"_registerChannel",value:function(){var _this=this;return _postal2["default"].instanceId("task"),_postal2["default"].fedx.addFilter([{channel:"activity-events",topic:"#",direction:"in"},{channel:"task-events",topic:"#",direction:"out"}]),_postal2["default"].subscribe({channel:"activity-events",topic:"#",callback:function(_ref){var event=_ref.event,data=_ref.data;_this.eventDatas[event]=data,_this._flush()}}),this}},{key:"_initInterval",value:function(){var _this2=this;window.onbeforeunload=function(){_this2._clearInterval(),_this2._flush()},this._clearInterval();var minute=6e4;this.intervalId=setInterval(function(){return _this2._flush()},minute)}},{key:"_clearInterval",value:function(){clearInterval(this.intervalId)}},{key:"_flush",value:function(){var _this3=this;Object.assign(this.eventDatas,{stay:{lastTime:this.lastTime}});var ajax=$.post(this.eventUrl,{data:{lastTime:this.lastTime,events:this.eventDatas}}).done(function(response){if(_this3._publishResponse(response),_this3.eventDatas={},_this3.lastTime=response.lastTime,response.result.status){var listners=_this3.eventMap.receives[response.result.status];if(listners)for(var i=listners.length-1;i>=0;i--){var listner=listners[i];listner(response)}}}).fail(function(error){});return ajax}},{key:"_publishResponse",value:function(response){_postal2["default"].publish({channel:"task-events",topic:"#",data:{event:response.event,data:response.data}})}},{key:"addListener",value:function(event,callback){this.eventMap.receives[event]=this.eventMap.receives[event]||[],this.eventMap.receives[event].push(callback)}}]),TaskPipe}();exports["default"]=TaskPipe},"8564292a81bb30f6618a":function(module,exports){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),TaskUi=function(){function TaskUi(option){_classCallCheck(this,TaskUi),this.element=$(option.element),this.learningPrompt=this.element.find(".js-learning-prompt"),this.learnedPrompt=this.element.find(".js-learned-prompt"),this.learnprompt=this.element.find(".js-learn-prompt"),this.btnLearn=this.element.find(".js-btn-learn")}return _createClass(TaskUi,[{key:"learnedWeakPrompt",value:function(){var _this=this;this.learnprompt.removeClass("open"),this.learningPrompt.addClass("moveup"),window.setTimeout(function(){_this.learningPrompt.removeClass("moveup"),_this.learnedPrompt.addClass("moveup")},2e3)}},{key:"learned",value:function(){this.btnLearn.addClass("active")}}]),TaskUi}();exports["default"]=TaskUi}});