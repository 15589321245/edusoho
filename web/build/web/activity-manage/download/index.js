webpackJsonp(["web/activity-manage/download/index"],[function(a,t,e){"use strict";function i(a){return a&&a.__esModule?a:{default:a}}function n(){var a=$("#step2-form"),t=a.validate({onkeyup:!1,ignore:"",rules:{link:"url"},messages:{link:"链接地址不正确"}});a.data("validator",t)}function l(){var a=$(window.parent.document).find("#task-manage-content-iframe");$("[data-role=placeholder]").empty(),$(".file-chooser-bar").addClass("hidden"),$(".file-chooser-main").removeClass("hidden"),a.height(a.contents().find("body").height())}function s(a){return null==a||""==a||void 0==a||0==Object.keys(a).length}var r=e("6951aa140a8a4d030429"),d=i(r);jQuery.validator.addMethod("url",function(a,t){return this.optional(t)||/^(http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?$/.test(a)},"URL的格式不正确"),n(),$("#step2-form").on("click",".close.delete-btn",function(){var a=$(this).parents(".list-group-item"),t=a.data("id"),e=s($("#materials").val())?{}:JSON.parse($("#materials").val());e&&e[t]&&(delete e[t],$("#materials").val(JSON.stringify(e))),a.remove()}),$("#step2-form").on("click",".js-download-material-add",function(){if(s($("#media").val())&&$("#step2-form").data("validator")&&$("#step2-form").data("validator").valid()&&$("#link").val().length>0){var a={source:"link",id:$("#link").val(),name:$("#link").val(),link:$("#link").val(),size:0};$("#media").val(JSON.stringify(a))}var t=s($("#media").val())?{}:JSON.parse($("#media").val()),e=s($("#materials").val())?{}:JSON.parse($("#materials").val());if(s(t))return void alert("add file first");if(!s(e)&&e[t.id])return void $("#media").val(null);e[t.id]=t,$("#materials").val(JSON.stringify(e)),$("#media").val(null),$("#link").val(null);var i="";i=t.link?'\n        <li class="list-group-item clearfix" data-id="'+t.link+'">\n          <button class="close delete-btn" type="button" title="{{\'删除\'|trans}}" data-url="">&times;</button>\n            <a href="'+t.link+'" target="_blank">'+t.name+'</a>\n            <span class="glyphicon glyphicon-new-window text-muted text-sm" title="{{\'网络链接资料\'|trans}}"></span>\n        </li>\n    ':'\n        <li class="list-group-item clearfix" data-id="'+t.id+'">\n          <button class="close delete-btn" type="button" title="{{\'删除\'|trans}}" data-url="">&times;</button>\n            <a href="'+t.id+'">'+t.name+"</a>\n        </li>\n    ",$(".js-empty-list").addClass("hidden"),$("#material-list").append(i),l()}),setTimeout(function(){l()},500);var o=function(a){$("input[name=media]").val(JSON.stringify(a))},u=new d.default;u.on("select",o)}]);