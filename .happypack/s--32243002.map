{"version":3,"sources":["app/Resources/static-src/app/common/doc-player.js"],"names":["DocPlayer","element","swfUrl","pdfUrl","watermarkOptions","canCopy","$","swfPlayerWidth","swfPlayerHeight","swfPlayerUrl","init","console","log","isSupportHtml5","isIE9","initPDFJSViewer","initSwfViewer","navigator","appVersion","indexOf","support","leadingWhitespace","attr","src","iframe","document","createElement","style","height","allowfullscreen","width","id","before","addWatermark","html","Translator","trans","flashVars","doc_url","decodeURI","value","params","bgcolor","allowFullScreen","wmode","allowNetworking","allowscriptaccess","autoPlay","attributes","embedSWF","WaterMark","DocumentPlayer","Widget","extend","attrs","swfFileUrl","pdfFileUrl","swfPlayerheight","watermark","events","setup","self","docPlayer","$thiz","jsPath","__URL_PROTOCOL","app","lessonCopyEnabled","get","flashvars","escape"],"mappings":"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","file":"doc-player.js","sourceRoot":"/Users/kz/projects/edusoho","sourcesContent":["import swfobject from 'es-swfobject';\nimport 'app/common/watermark';\n\nclass DocPlayer {\n  constructor({ element, swfUrl, pdfUrl, watermarkOptions, canCopy }) {\n    this.element = $(element);\n    this.swfUrl = swfUrl || '';\n    this.pdfUrl = pdfUrl || '';\n    this.swfPlayerWidth = '100%';\n    this.swfPlayerHeight = '100%';\n    this.swfPlayerUrl = '';\n    this.watermarkOptions = watermarkOptions || '';\n    this.canCopy = canCopy || false;\n    this.init();\n\n    console.log(watermarkOptions);\n  }\n\n  init() {\n    if (this.isSupportHtml5() && !this.isIE9()) {\n      this.initPDFJSViewer();\n    } else {\n      this.initSwfViewer();\n    }\n  }\n\n  isIE9() {\n    return navigator.appVersion.indexOf(\"MSIE 9.\") != -1;\n  }\n\n  isSupportHtml5() {\n    return $.support.leadingWhitespace;\n  }\n\n  initPDFJSViewer() {\n    $(\"html\").attr('dir', 'ltr');\n\n    let src = 'http://opencdn.edusoho.net/pdf.js/v3/viewer.html#' + this.pdfUrl;\n\n    if (!this.canCopy) {\n      src += '#false';\n    }\n\n    let iframe = document.createElement('iframe');\n    iframe.style.height = '100%';\n    iframe.allowfullscreen = true;\n    iframe.style.width = '100%';\n    iframe.id = 'doc-pdf-player';\n    iframe.src = src;\n    // this.element.get(0).appendChild(iframe);\n\n    $('#task-content-iframe').before();\n    this.addWatermark();\n  }\n\n  initSwfViewer() {\n    $.html(`<div id=\"website\"><p align=\"center\" class=\"style1\">${Translator.trans('您还没有安装flash播放器 请点击')}<a href=\"http://www.adobe.com/go/getflashplayer\">${Translator.trans('这里')}</a>${Translator.trans('安装')}</p></div>`);\n\n    let flashVars = {\n      doc_url: decodeURI(this.swfUrl.value)\n    };\n\n    let params = {\n      bgcolor: '#efefef',\n      allowFullScreen: true,\n      wmode: 'window',\n      allowNetworking: 'all',\n      allowscriptaccess: 'always',\n      autoPlay: false\n    };\n\n    let attributes = {\n      id: 'website'\n    };\n\n    swfobject.embedSWF(\n      this.swfPlayerUrl,\n      'website',\n      this.swfPlayerWidth,\n      this.swfPlayerHeight,\n      \"9.0.45\",\n      null,\n      flashVars,\n      params,\n      attributes\n    );\n\n    this.addWatermark();\n  }\n\n  addWatermark() {\n    this.watermarkOptions && this.element.WaterMark(this.watermarkOptions);\n  }\n}\n\nvar DocumentPlayer = Widget.extend({\n        attrs: {\n            swfFileUrl:'',\n            pdfFileUrl:'',\n            swfPlayerUrl:'../../bundles/topxiaweb/js/controller/swf/edusohoViewer.swf',\n            swfPlayerWidth:'100%',\n            swfPlayerheight:'100%',\n            watermark: ''\n        },\n\n        events: {\n        },\n\n        setup: function() {\n            var self = this;\n            docPlayer = $(this.element).attr(\"id\");\n            self.init(this.element);\n        },\n\n        init: function ($thiz) {\n\n            if (this.isSupportHtml5() && !this.isIE9()) {\n                this.initPDFJSViewer($thiz);\n            }else{\n                this.initSwfViewer($thiz);\n            }\n\n        },\n        isIE9: function(){\n            return navigator.appVersion.indexOf(\"MSIE 9.\")!=-1;\n        },\n        isSupportHtml5: function(){\n\n            return $.support.leadingWhitespace;\n\n        },\n\n        initPDFJSViewer: function($thiz) {\n            self=this;\n            $(\"html\").attr('dir','ltr');\n            var jsPath = __URL_PROTOCOL + '://service-cdn.qiqiuyun.net/js-sdk/document-player/v7/viewer.html#'+self.attrs.pdfFileUrl.value;\n            if(app.lessonCopyEnabled==0){\n                jsPath = jsPath+'#false';\n            }\n\n            $('#viewerIframe').attr('src', jsPath);\n\n            if (this.get('watermark')) {\n                this.element.WaterMark(this.get('watermark'));\n            }\n        },\n\n        initSwfViewer: function($thiz){\n\n            $thiz.html('<div id=\"website\"><p align=\"center\" class=\"style1\">'+Translator.trans('您还没有安装flash播放器 请点击')+'<a href=\"http://www.adobe.com/go/getflashplayer\">'+Translator.trans('这里')+'</a>'+Translator.trans('安装')+'</p></div>');\n            var flashvars = {\n              doc_url: escape(this.attrs.swfFileUrl.value) \n            };\n            var params = {\n                //menu: \"false\",\n                bgcolor: '#efefef',\n                allowFullScreen: 'true',\n                wmode:'window',\n                allowNetworking:'all',\n                allowscriptaccess:'always',\n                wmode: 'transparent',\n                autoPlay:false\n              };\n            var attributes = {\n                id: 'website'\n            };\n\n            swfobject.embedSWF(\n                this.get('swfPlayerUrl'),\n                'website',\n                this.get('swfPlayerWidth'),  this.get('swfPlayerheight') , \"9.0.45\", null, flashvars, params, attributes\n            );\n\n            if (this.get('watermark')) {\n                this.element.WaterMark(this.get('watermark'));\n            }\n\n        }\n\n    });\n\nexport default DocPlayer;\n"]}