{"version":3,"sources":["webpack:///./app/Resources/static-src/app/js/auth/captcha-mobile-modal.js","webpack:///./app/Resources/static-src/app/js/auth/captcha-modal/index.js"],"names":["CaptchaModal","$element","dataTo","smsType","captchaNum","CaptchaValidator","init","on","event","changeCaptcha","$","click","submitForm","initValidator","e","$code","currentTarget","attr","data","Math","random","form","submit","_captchaValidated","validate","onkeyup","onfocusout","rules","captcha_num","required","alphanumeric","messages","Translator","trans","submitHandler","console","log","get","value","val","response","success","parents","modal","smsSender","element","url","captcha","captchaValidated","preSmsSend","couldSender","off","find","html","show","keydown","keyCode","length","captchaModal"],"mappings":"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","file":"app/js/auth/captcha-modal/index.js","sourcesContent":["import SmsSender from 'app/common/widget/sms-sender';\n\nexport default class CaptchaModal {\n  constructor($element, dataTo, smsType, captchaNum) {\n    this.$element = $element;\n    this.dataTo = dataTo;\n    this.smsType = smsType;\n    this.captchaNum = captchaNum;\n    this.CaptchaValidator = null;\n    this.init();\n  }\n  init() {\n    this.$element.on('click', '#getcode_num', (event) => this.changeCaptcha(event));\n    $('.js-captcha-btn').click((event) => this.submitForm(event));\n    this.initValidator();\n  }\n  changeCaptcha(e) {\n    var $code = $(e.currentTarget);\n    $code.attr(\"src\", $code.data(\"url\") + \"?\" + Math.random());\n  }\n\n  submitForm() {\n    if(this.CaptchaValidator.form()) {\n      this.$element.submit();\n    }\n  }\n\n  initValidator() {\n    this._captchaValidated = false;\n    this.CaptchaValidator = this.$element.validate({\n      onkeyup: false,\n      onfocusout: false,\n      rules: {\n        captcha_num: {\n          required: true,\n          alphanumeric: true,\n        }\n      },\n      messages: {\n        captcha_num: {\n          required: Translator.trans('auth.mobile_captcha_required_error_hint'),\n        }\n      },\n      submitHandler:  (form) =>{\n        console.log('submitHandler');\n        $.get(this.$element.attr('action'), { value: $('#captcha_num_modal').val() }, (response) => {\n          if (response.success) {\n            this.$element.parents('.modal').modal('hide');\n            this._captchaValidated = true;\n            var smsSender = new SmsSender({\n              element: '.js-sms-send',\n              url: $('.js-sms-send').data('smsUrl'),\n              smsType: this.smsType,\n              dataTo: this.dataTo,\n              captchaNum: this.captchaNum,\n              captcha: true,\n              captchaValidated: this._captchaValidated,\n              preSmsSend: function () {\n                var couldSender = true;\n                return couldSender;\n              }\n            });\n            $('.js-sms-send').off('click');\n          } else {\n            this._captchaValidated = false;\n            this.$element.find('#getcode_num').attr(\"src\", $(\"#getcode_num\").data(\"url\") + \"?\" + Math.random());\n            this.$element.find('.help-block').html('<span class=\"color-danger\">' + Translator.trans('auth.mobile_captcha_error_hint') + '</span>');\n            this.$element.find('.help-block').show();\n          }\n        }, 'json');\n      }\n    });\n    $('#captcha_num_modal').keydown((event) => {\n      if (event.keyCode == 13) {\n        this.CaptchaValidator.form();\n      }\n    });\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./app/Resources/static-src/app/js/auth/captcha-mobile-modal.js","import CaptchaModal from 'app/js/auth/captcha-mobile-modal';\n\nlet dataTo = '';\nlet smsType = '';\nlet captchaNum = 'captcha_num';\nif ($('input[name=\"set_bind_emailOrMobile\"]').length > 0) {\n  dataTo = 'set_bind_emailOrMobile';\n  smsType = 'sms_registration';\n} else if ($('input[name=\"mobile\"]').length > 0) {\n  dataTo = 'mobile';\n  if ($('#password-reset-by-mobile-form').length > 0) {\n    smsType = 'sms_forget_password';\n  } else if ($('#settings-find-pay-password-form').length > 0) {\n    smsType = 'sms_forget_pay_password';\n  } else {\n    smsType = 'sms_bind';\n  }\n} else {\n  dataTo = $('[name=\"verifiedMobile\"]').val() == null ? 'emailOrMobile' : 'verifiedMobile';\n  smsType = 'sms_registration';\n}\n\n$('#captcha-form').find('#getcode_num').attr(\"src\", $(\"#getcode_num\").data(\"url\") + \"?\" + Math.random());\n\nlet captchaModal = new CaptchaModal($('#captcha-form'),dataTo,smsType,captchaNum);\n\nconsole.log($('#captcha-form'));\nconsole.log(captchaModal);\n\n\n\n\n\n// WEBPACK FOOTER //\n// ./app/Resources/static-src/app/js/auth/captcha-modal/index.js"],"sourceRoot":""}