webpackJsonp(["app/js/task/index"],{0:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_sidebar=__webpack_require__("5f0af4efa4df981e1cb2"),_sidebar2=_interopRequireDefault(_sidebar),_taskUi=__webpack_require__("8564292a81bb30f6618a"),_taskUi2=_interopRequireDefault(_taskUi),_taskEventEmitter=__webpack_require__("ee4a357784724c191c9e"),_taskEventEmitter2=_interopRequireDefault(_taskEventEmitter),_esEventEmitter=__webpack_require__("63fff8fb24f3bd1f61cd"),_esEventEmitter2=_interopRequireDefault(_esEventEmitter),TaskShow=function(_Emitter){function TaskShow(_ref){var element=_ref.element,courseId=_ref.courseId,taskId=_ref.taskId,mode=_ref.mode;_classCallCheck(this,TaskShow);var _this=_possibleConstructorReturn(this,(TaskShow.__proto__||Object.getPrototypeOf(TaskShow)).call(this));return _this.element=$(element),_this.courseId=courseId,_this.taskId=taskId,_this.mode=mode,_this.eventEmitter=new _taskEventEmitter2["default"](_this.element.find("#task-content-iframe")),_this.ui=new _taskUi2["default"]({element:".js-task-dashboard-page"}),_this.init(),_this}return _inherits(TaskShow,_Emitter),_createClass(TaskShow,[{key:"init",value:function(){this.initPlugin(),this.initSidebar(),"preview"!=this.mode&&this.bindEvent()}},{key:"initPlugin",value:function(){$('[data-toggle="tooltip"]').tooltip(),$('[data-toggle="popover"]').popover({html:!0,trigger:"hover"})}},{key:"bindEvent",value:function(){var _this2=this,learnedTime=0,minute=6e4,timeStep=2;this.delay("doing",function(timeStep){learnedTime=parseInt(timeStep)+parseInt(learnedTime),_this2.eventEmitter.emit("doing",{timeStep:timeStep,learnedTime:learnedTime,taskId:_this2.taskId}).then(function(response){_this2.trigger("doing",timeStep),"finish"==response.result.status&&"finish"!=$('input[name="task-result-status"]',$("#js-hidden-data")).val()&&(_this2.ui.learnedWeakPrompt(),_this2.ui.learned(),$('input[name="task-result-status"]',$("#js-hidden-data")).val("finish"))})},timeStep*minute),this.trigger("doing",timeStep),this.element.on("click","#learn-btn",function(event){$.post($("#learn-btn").data("url"),function(response){$("#modal").modal("show"),$("#modal").html(response),$('input[name="task-result-status"]',$("#js-hidden-data")).val("finish"),_this2.ui.learned()})}),this.eventEmitter.receive("finish",function(response){"finish"==response.result.status&&"finish"!=$('input[name="task-result-status"]',$("#js-hidden-data")).val()&&(_this2.ui.learnedWeakPrompt(),_this2.ui.learned(),$('input[name="task-result-status"]',$("#js-hidden-data")).val("finish"))})}},{key:"initSidebar",value:function(){var _this3=this;this.sidebar=new _sidebar2["default"]({element:this.element.find("#dashboard-sidebar"),url:this.element.find('#js-hidden-data [name="plugins_url"]').val()}),this.sidebar.on("popup",function(px,time){_this3.element.find("#dashboard-content").animate({right:px},time)}).on("fold",function(px,time){_this3.element.find("#dashboard-content").animate({right:px},time)})}}]),TaskShow}(_esEventEmitter2["default"]);new TaskShow({element:$("body"),courseId:$("body").find('#js-hidden-data [name="course-id"]').val(),taskId:$("body").find('#js-hidden-data [name="task-id"]').val(),mode:$("body").find('#js-hidden-data [name="mode"]').val()})},"5f0af4efa4df981e1cb2":function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_es6EventEmitter=__webpack_require__("f3404f3e29d10cb74973"),_es6EventEmitter2=_interopRequireDefault(_es6EventEmitter),TaskSidebar=function(_Emitter){function TaskSidebar(_ref){var element=_ref.element,url=_ref.url;_classCallCheck(this,TaskSidebar);var _this=_possibleConstructorReturn(this,(TaskSidebar.__proto__||Object.getPrototypeOf(TaskSidebar)).call(this));return _this.url=url,_this.element=$(element),_this.init(),_this}return _inherits(TaskSidebar,_Emitter),_createClass(TaskSidebar,[{key:"init",value:function(){var _this2=this;this.fetchPlugins().then(function(plugins){_this2.plugins=plugins,_this2.renderToolbar(),_this2.renderPane(),_this2.bindEvent()}).fail(function(error){console.log(error)})}},{key:"fetchPlugins",value:function(){return $.post(this.url)}},{key:"renderToolbar",value:function(){var html='\n    <div class="dashboard-toolbar">\n      <ul class="dashboard-toolbar-nav" id="dashboard-toolbar-nav">\n        '+this.plugins.reduce(function(html,plugin){return html+='<li data-plugin="'+plugin.code+'" data-url="'+plugin.url+'"><a href="#"><div class="mbs es-icon '+plugin.icon+'"></div>'+plugin.name+"</a></li>"},"")+"\n      </ul>\n    </div>";this.element.html(html)}},{key:"renderPane",value:function(){var html=this.plugins.reduce(function(html,plugin){return html+='<div data-pane="'+plugin.code+'" class="task-pane"></div>'},"");this.element.append(html)}},{key:"bindEvent",value:function(){var _this3=this;this.element.find("#dashboard-toolbar-nav").on("click","li",function(event){var $btn=$(event.currentTarget),pluginCode=$btn.data("plugin"),url=$btn.data("url"),$pane=_this3.element.find('[data-pane="'+pluginCode+'"]');if(void 0!==pluginCode&&void 0!==url)return $btn.data("loaded")?void _this3.operationContent($btn):void $.get(url).then(function(html){$pane.html(html),$btn.data("loaded",!0),_this3.operationContent($btn)})})}},{key:"operationContent",value:function($btn){$btn.hasClass("active")?(this.foldContent(),$btn.removeClass("active")):(this.element.find("#dashboard-toolbar-nav li").removeClass("active"),$btn.addClass("active"),this.element.find("[data-pane]").hide(),this.element.find('[data-pane="'+$btn.data("plugin")+'"]').show(),this.popupContent())}},{key:"popupContent",value:function(){var time=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,side_right="0px",content_right="379px";this.trigger("popup",content_right,time),this.element.animate({right:side_right},time)}},{key:"foldContent",value:function(){var time=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,side_right="-"+this.element.width()+"px",content_right="26px";this.trigger("fold",content_right,time),this.element.animate({right:side_right},time)}}]),TaskSidebar}(_es6EventEmitter2["default"]);exports["default"]=TaskSidebar},ee4a357784724c191c9e:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_esMessenger=__webpack_require__("3397b808463bda5eafcd"),_esMessenger2=_interopRequireDefault(_esMessenger),TaskEventEmitter=function(){function TaskEventEmitter(element){var _this=this;if(_classCallCheck(this,TaskEventEmitter),this.element=$(element),this.eventUrl=this.element.data("eventUrl"),void 0===this.eventUrl)throw Error("task event url is undefined");this.eventMap={receives:{}},this.receiveMessenger=new _esMessenger2["default"]("TaskMessenger","ActivityEvent"),this.receiveMessenger.addTarget(this.element.get(0).contentWindow,"task-content-iframe"),this.receiveMessenger.listen(function(message){var _JSON$parse=JSON.parse(message),event=_JSON$parse.event,data=_JSON$parse.data;console.log("event, data",event,data);var listeners=_this.eventMap.receives[event];$.post(_this.element.data("eventUrl"),{eventName:event,data:data}).done(function(response){"undefined"!=typeof listeners&&listeners.forEach(function(callback){return callback(response)}),_this.receiveMessenger.send(JSON.stringify(response))}).fail(function(error){_this.receiveMessenger.send(JSON.stringify({event:event,error:error}))})}),this.emitMessenger=new _esMessenger2["default"]("TaskMessenger","TaskEvent"),this.emitMessenger.addTarget(this.element.get(0).contentWindow,"task-content-iframe")}return _createClass(TaskEventEmitter,[{key:"emit",value:function(event,data){var _this2=this;return new Promise(function(resolve,reject){$.post(_this2.eventUrl,{eventName:event,data:data}).done(function(response){_this2.emitMessenger.send(JSON.stringify({event:response.event,data:response.data})),resolve(response)}).fail(function(error){reject(error)})})}},{key:"receive",value:function(event,callback){this.eventMap.receives[event]=this.eventMap.receives[event]||[],this.eventMap.receives[event].push(callback)}}]),TaskEventEmitter}();exports["default"]=TaskEventEmitter},"8564292a81bb30f6618a":function(module,exports){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),TaskUi=function(){function TaskUi(option){_classCallCheck(this,TaskUi),this.element=$(option.element),this.learningPrompt=this.element.find(".js-learning-prompt"),this.learnedPrompt=this.element.find(".js-learned-prompt"),this.learnprompt=this.element.find(".js-learn-prompt"),this.btnLearn=this.element.find(".js-btn-learn")}return _createClass(TaskUi,[{key:"learnedWeakPrompt",value:function(){var _this=this;this.learnprompt.removeClass("open"),this.learningPrompt.addClass("moveup"),window.setTimeout(function(){_this.learningPrompt.removeClass("moveup"),_this.learnedPrompt.addClass("moveup")},2e3)}},{key:"learned",value:function(){this.btnLearn.addClass("active")}}]),TaskUi}();exports["default"]=TaskUi}});