{"version":3,"sources":["webpack:///./app/Resources/static-src/app/js/open-course/member-sms/index.js","webpack:///./app/Resources/static-src/app/js/open-course/member-sms/member-sms.js"],"names":["element","formSubmit","MembarSMS","options","$element","$","$formSubmit","validator","initEvent","initValidator","on","onModifyMobile","event","onGetCode","onSmsSend","onFormSubmit","$this","currentTarget","hide","find","attr","show","addRules","data","Math","random","isCanSmsSend","url","smsType","captchaValidated","captchaNum","captcha","form","submit","isMobile","validate","isCaptcha","$form","ajax","currentDom","submitSuccess","closest","modal","addClass","removeClass","text","parseInt","number","submitError","Translator","trans","site","submit_error","rules","required","phone","es_remote","alphanumeric","maxlength","minlength"],"mappings":"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","file":"app/js/open-course/member-sms/index.js","sourcesContent":["import MembarSMS from './member-sms';\n\nnew MembarSMS({\n  element: '#sms-modal-form',\n  formSubmit: '#form-submit'\n})\n\n\n// WEBPACK FOOTER //\n// ./app/Resources/static-src/app/js/open-course/member-sms/index.js","import SmsSender from 'app/common/widget/sms-sender';\nimport notify from 'common/notify';\n\nclass MembarSMS {\n  constructor(options) {\n    this.$element = $(options.element);\n    this.formSubmit = options.formSubmit;\n    this.$formSubmit = $(this.formSubmit);\n    this.validator = null;\n\n    this.initEvent();\n    this.initValidator();\n  }\n\n  initEvent() {\n    this.$element.on('click', '.js-modify-mobile', event => this.onModifyMobile(event));\n    this.$element.on('click', '.js-get-code', event => this.onGetCode(event));\n    this.$element.on('click', '.js-sms-send', event => this.onSmsSend(event));\n    this.$formSubmit.on('click', event => this.onFormSubmit(event));\n  }\n\n  onModifyMobile(event) {\n    let $this = $(event.currentTarget);\n    $this.hide();\n    \n    this.$element.find('input[name=\"mobile\"]').attr('readonly',false);\n    this.$element.find('.form-group').show();\n\n    this.addRules();\n  }\n\n  onGetCode(event) {\n    let $this = $(event.currentTarget);\n    $this.attr('src', $this.data('url') + '?' + Math.random());\n  }\n\n  onSmsSend(event) {\n    if (!this.isCanSmsSend()) return;\n    \n    let $this = $(event.currentTarget);\n    new SmsSender({\n      element: '.js-sms-send',\n      url: $this.data('url'),\n      smsType: 'system_remind',\n      captchaValidated: true,\n      captchaNum: 'captcha_code',\n      captcha: true,\n    })\n  }\n\n  onFormSubmit(event) {\n    if (this.validator.form()) {\n      this.$element.submit();\n    }\n  }\n\n  isCanSmsSend() {\n    let isMobile = this.$element.validate().element($('[name=\"mobile\"]')); \n    if (!isMobile) {\n      return false;\n    }\n\n    let isCaptcha = this.$element.validate().element($('[name=\"captcha_code\"]'));\n    if (!isCaptcha) {\n      return false;\n    }\n\n    return true;\n  }\n\n  initValidator() {\n    let $form = this.$element;\n    this.validator = this.$element.validate({\n      ajax: true,\n      currentDom: this.formSubmit,\n      submitSuccess(data) {\n        $form.closest('.modal').modal('hide');\n       \n        $(\"#alert-btn\").addClass('hidden');\n        $(\"#alerted-btn\").removeClass('hidden');\n        $('.js-member-num span').text(parseInt(data.number));\n      },\n      submitError() {\n        notify('error',  Translator.trans(site.form.submit_error));\n      }\n    });\n\n    if (this.$element.find('input[name=\"mobile\"]').attr('readonly') != 'readonly') {\n      this.addRules();\n    }\n  }\n\n  addRules() {\n    $('[name=\"mobile\"]').rules('add', {\n      required: true,\n      phone: true,\n      es_remote: true\n    })\n    $('[name=\"captcha_code\"]').rules('add', {\n      required: true,\n      alphanumeric: true,\n      es_remote: true\n    })\n    $('[name=\"sms_code_modal\"]').rules('add', {\n      required: true,\n      maxlength: 6,\n      minlength: 6,\n      es_remote: true\n    })\n  }\n}\n\nexport default MembarSMS;\n\n\n// WEBPACK FOOTER //\n// ./app/Resources/static-src/app/js/open-course/member-sms/member-sms.js"],"sourceRoot":""}