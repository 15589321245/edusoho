{% extends 'course-manage/layout.html.twig' %}
{% block title %}{{'学员管理'|trans}} - {{ course.title }} - {{ parent() }}{% endblock %}
{% do script(['app/js/course-manage/students/index.js']) %}
{% set side_nav = 'students' %}

{% block main %}
  <div class="panel panel-default">
    {% if courseSet.type != 'live' %}
      <div class="panel-heading">
        {{ course.title }}<span class="mh5">／</span>{{'学员管理'|trans}}
        <div class="pull-right">
          {% if course.status != 'published' %}
            <button class="btn btn-success btn-sm js-publish-course" 
              data-url="{{ path('course_set_manage_course_publish', {courseSetId: courseSet.id, courseId: course.id}) }}">
              {{ '发布计划'|trans }}
            </button>
          {% endif %}


          {# 管理学员-导入、添加 #}
          {% if app.user.isAdmin() or setting('course.teacher_manage_student', 0) %}
            <button class="btn btn-info btn-sm mhs" id="student-add-btn" data-toggle="modal" data-target="#modal" data-url="{{ path('course_set_manage_course_students_add', {courseSetId:courseSet.id, courseId: course.id}) }}"><i class="es-icon es-icon-anonymous-iconfont"></i> {{'添加学员'|trans}}</button>
            {% if course.status == 'published' %}
            {#  <a class="btn btn-info btn-sm mhs" data-toggle="modal" data-target="#modal" data-url="{{ path('importer_index', {type: 'classroom-member',classroomId:classroom.id}) }}"><i class="glyphicon glyphicon-import"></i> {{'批量导入'|trans}}</a> #}
            {% else %}
              {# <a class="btn btn-info pull-right btn-sm mhs" disabled data-toggle="tooltip" data-placement="top" title="班级未发布,不可导入学员"><i class="glyphicon glyphicon-import"></i> {{'批量导入'|trans}}</a> #}
            {% endif %}
          {% endif %}

          {# <a class="btn btn-info btn-sm mhs" href="{{ path('classroom_manage_student_export_csv', {id:classroom.id,role:role}) }}"><i class="glyphicon glyphicon-export"></i> {{'导出学员'|trans}}</a> #}
      </div>
      </div>
    {% endif %}
    <div class="panel-body">
      <ul class="nav nav-pills mbl">
        <li class="active">
          <a href="javascript:;">{{ '正式学员'|trans }}</a>
        </li>
        <li class="">
          <a href="{{path('course_set_manage_course_quit_records', {courseSetId: courseSet.id, courseId: course.id})}}">{{ '退出记录'|trans }}</a>
        </li>
      </ul>
      <form class="form-inline well well-sm" action="{{path('course_set_manage_course_students', {courseSetId: courseSet.id, courseId: course.id})}}" method="get" novalidate>
        <div class="form-group col-md-7">
          <input class="form-control " type="text" style="width:45%" placeholder="{{'请输入用户名/邮箱/手机号'|trans}}" name="keyword" value="{{ app.request.get('keyword') }}">
          <button type="submit" class="btn btn-primary">{{'搜索'|trans}}</button>
        </div>
        <div class="clearfix"></div>
      </form>
      <table class="table table-middle table-striped" id="course-student-list">
        <thead>
          <tr>
            <th width="40%">{% if setting('default.user_name') %}{{setting('default.user_name')|default('学员'|trans)}}{% else %}{{'学员'|trans}}{% endif %}</th>
            {# <th width="20%">{{'服务期限'|trans}}</th> #}
            <th width="30%">{{'学习进度'|trans}}</th>
            <th width="30%%">{{'操作'|trans}}</th>
          </tr>
        </thead>
        <tbody>
          {% for student in students %}
            <tr class="students-item js-students-item">
              <td class="media media-middle" >
                <a class="pull-left js-user-card" href="/user/{{student.userId}}" data-card-url="/user/{{student.userId}}/card/show" data-user-id="{{student.userId}}">
                  {# <img class="avatar-sm" src="{{student.smallAvatar}}"> #}
                  {{ web_macro.user_avatar(student, 'pull-left', 'avatar-sm') }}
                </a>
                <a target="_blank" href="/user/{{student.userId}}">{{student.nickname}}</a>
                <div class="text-muted text-sm">{{student.createdTime|date_format()}}</div>
              </td>
            {#  <td>
              剩余：360天
              </td> #}
              <td>
                <a class="btn link-gray" href="javascript:;"  data-toggle="modal" data-target="#modal" data-url="{{path('course_set_manage_course_students_process', {'courseSetId': courseSet.id, 'courseId': course.id, 'userId': student.userId})}}"><span class="color-primary">{{processes[student.userId]|default(0)}}%</span><span class="text-xs">（查看详情）</span></a>
              </td>
              <td>
                <a class="mrm" href="javascript:;" data-toggle="modal" data-target="#modal" data-url="/message/create/{{student.userId}}">发私信</a>
                <a class="mrm" href="javascript:;"  data-toggle="modal" data-target="#modal" data-url="{{path('course_set_manage_course_students_show', {'courseSetId': courseSet.id, 'courseId': course.id, 'userId': student.userId})}}">查看资料</a>
                <div class="btn-group">
                  <a href="#" class="mrm dropdown-toggle" data-toggle="dropdown">
                    更多
                    <span class="caret mls"></span>
                  </a>
                  <ul class="dropdown-menu pull-right">
                    <li>
                      <a class="" href="" data-toggle="modal" data-target="#modal" data-url="/course/{{course.id}}/manage/student/{{student.userId}}/remark">备注</a>
                    </li>
                    {# <li>
                      <a class="follow-student-btn" href="javascript:;" data-url="/user/{{student.userId}}/follow">关注</a>
                      <a class="unfollow-student-btn" href="javascript:;" data-url="/user/{{student.userId}}/unfollow" style="display:none;">已关注</a>
                    </li> #}
                  {#  <li>
                      <a class="" href="" data-toggle="modal" data-target="#modal" data-url="/course/{{course.id}}/set_expiryday/{{student.userId}}">增加有效期</a>
                    </li> #}

                    {% if app.user.isAdmin() or setting('course.teacher_manage_student', 0) %}
                      <li>
                        <a class="js-remove-student" href="javascript:;" data-url="{{path('course_set_manage_course_students_remove', {courseSetId: courseSet.id, courseId: course.id, userId: student.userId})}}" data-user="学员">移除</a>
                      </li>
                    {% endif %}

                  </ul>
                </div>
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
{% endblock %}
