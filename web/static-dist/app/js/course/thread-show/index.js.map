{"version":3,"sources":["webpack:///./app/Resources/static-src/app/js/course/thread-show/index.js"],"names":["editor","CKEDITOR","replace","toolbar","filebrowserImageUploadUrl","$","data","on","val","getData","$form","validator","validate","rules","required","click","form","button","find","remove","ajax","attr","serialize","success","html","console","log","text","parseInt","id","appendTo","setData","empty","removeClass","removeAttr","window","location","href","error","parseJSON","responseText","Notify","danger","message","Translator","trans","$btn","confirm","post","url","reload","userName","focus","insertHtml"],"mappings":"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","file":"app/js/course/thread-show/index.js","sourcesContent":["// var Validator = require('bootstrap.validator');\n// require('es-ckeditor');\n// Notify = require('common/bootstrap-notify');\n// require('./common').run();\n\nvar editor = CKEDITOR.replace('post_content', {\n  toolbar: 'Thread',\n  filebrowserImageUploadUrl: $('#post_content').data('imageUploadUrl')\n});\neditor.on('change', () => {\n  $('#post_content').val(editor.getData());\n});\neditor.on('blur', () => {\n  $('#post_content').val(editor.getData());\n});\n\nlet $form = $('#thread-post-form');\n\nlet validator = $form.validate({\n  rules: {\n    'post[content]': {\n      required: true,\n    }\n  }\n});\n\n$('.js-btn-thread-post-form-save').click(() => {\n  if (validator.form()) {\n    $('.js-btn-thread-post-form-save').button('loading');\n    $('.thread-post-list').find('li.empty').remove();\n    var $form = $(\"#thread-post-form\");\n    $.ajax({\n      'url': $form.attr('action'),\n      'type': 'post',\n      'data': $form.serialize(),\n      success: function (html) {\n        $('.js-btn-thread-post-form-save').button('reset');\n        console.log('success');\n        $(\"#thread-post-num\").text(parseInt($(\"#thread-post-num\").text()) + 1);\n        var id = $(html).appendTo('.thread-post-list').attr('id');\n        editor.setData('');\n        //清除附件\n        $('.js-attachment-list').empty();\n        $('.js-attachment-ids').val(\"\");\n        $('.js-upload-file').removeClass('hidden');\n\n        $form.find('[type=submit]').removeAttr('disabled');\n\n        window.location.href = '#' + id;\n      },\n      error: function (data) {\n        $('.js-btn-thread-post-form-save').button('reset');\n        data = $.parseJSON(data.responseText);\n        if (data.error) {\n          Notify.danger(data.error.message);\n        } else {\n          Notify.danger(Translator.trans('course.thread_replay_failed_hint'));\n        }\n      }\n    });\n  }\n})\n\n$('[data-role=confirm-btn]').click(function () {\n  var $btn = $(this);\n  if (!confirm($btn.data('confirmMessage'))) {\n    return false;\n  }\n  $.post($btn.data('url'), function () {\n    var url = $btn.data('afterUrl');\n    if (url) {\n      window.location.href = url;\n    } else {\n      window.location.reload();\n    }\n  });\n});\n\n$('.thread-post-list').on('click', '.thread-post-action', function () {\n\n  var userName = $(this).data('user');\n\n  editor.focus();\n  editor.insertHtml('@' + userName + '&nbsp;');\n\n});\n\n$(\".thread-post-list\").on('click', '[data-action=post-delete]', function () {\n  if (!confirm(Translator.trans('course.thread_delete_hint'))) {\n    return false;\n  }\n  var $btn = $(this);\n  $.post($btn.data('url'), function () {\n    window.location.reload();\n  });\n});\n\n\n\n// var validator = new Validator({\n//   element: '#thread-post-form'\n// });\n\n// validator.addItem({\n//   element: '[name=\"post[content]\"]',\n//   required: true\n// });\n\n// Validator.query('#thread-post-form').on('formValidate', function (elemetn, event) {\n//   editor.updateElement();\n// });\n\n// Validator.query('#thread-post-form').on('formValidated', function (err, msg, ele) {\n//   if (err == true) {\n//     return;\n//   }\n\n//   $('.thread-post-list').find('li.empty').remove();\n//   var $form = $(\"#thread-post-form\");\n\n//   $.ajax({\n//     'url': $form.attr('action'),\n//     'type': 'post',\n//     'data': $form.serialize(),\n//     'success': function (html) {\n//       $(\"#thread-post-num\").text(parseInt($(\"#thread-post-num\").text()) + 1);\n//       var id = $(html).appendTo('.thread-post-list').attr('id');\n//       editor.setData('');\n//       //清除附件\n//       $('.js-attachment-list').empty();\n//       $('.js-attachment-ids').val(\"\");\n//       $('.js-upload-file').removeClass('hidden');\n\n//       $form.find('[type=submit]').removeAttr('disabled');\n\n//       window.location.href = '#' + id;\n//     },\n//     'error': function (data) {\n//       data = $.parseJSON(data.responseText);\n//       if (data.error) {\n//         Notify.danger(data.error.message);\n//       } else {\n//         Notify.danger(Translator.trans('发表回复失败，请重试'));\n//       }\n//     }\n//   });\n\n//   return false;\n// });\n\n\n\n\n// WEBPACK FOOTER //\n// ./app/Resources/static-src/app/js/course/thread-show/index.js"],"sourceRoot":""}