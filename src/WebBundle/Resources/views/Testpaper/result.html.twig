{% extends 'WebBundle:Testpaper:testpaper-layout.html.twig' %}
{% do load_script('quiz-question/testpaper-result') %}

{% block paper_result_bar %}
  {% include 'WebBundle:Testpaper/Part:paper-result-objective.html.twig' %}
{% endblock %}

{% set questionTypeDict = getQuestionTypes() %}

{% block paper_warning %}
  {% if app.user.id == paperResult.userId %}
    {% if paperResult.status == 'reviewing' %}
      <div class="alert alert-warning">{{'老师正在批阅试卷，批阅完成后会以站内私信通知您批阅结果，请稍等。'|trans}}</div>
    {% elseif paperResult.status == 'finished' %}
      {% if paperResult.teacherSay %}
        <div class="alert alert-success">
          <div class=""><strong>{{'评语：'|trans}}</strong></div>
          <div class="mtm">{{ paperResult.teacherSay|bbCode2Html|raw }}</div>
        </div>
      {% endif %}
      {% if paperResult.passedStatus == 'unpassed' and target|default(null) %}
        {% if target.doTimes|default('0') %}
          <div class="alert alert-danger">{{ '您未通过考试'|trans }}</div>
        {% elseif target.redoInterval|default('0') and ("now"|date("U")) < (paperResult.checkedTime + target.redoInterval * 3600) %}
          {% set countTime = (paperResult.checkedTime + target.redoInterval * 3600)|date('Y-m-d H:i:s') %}
          <div class="alert alert-danger">
            {{ '您未通过考试，%countTime%后可重考，请复习'|trans({'%countTime%': '<span class="text-success">' ~ countTime ~ ' </span>'})|raw }}
          </div>
        {% else %}
          <div class="alert alert-danger">
            您未通过考试，请<a href="{{ path('course_lesson_redo_test', {lessonId:target.id,testId:paperResult.testId}) }}">重新参加考试</a>，或者重新学习课程。
          </div>
        {% endif %}
      {% elseif paperResult.passedStatus in ['passed','good','excellent'] %}
        <div class="alert alert-success">{{'恭喜您已通过本次考试。'|trans}}</div>
      {% endif %}
    {% endif %}
  {% endif %}
{% endblock %}

{% block paper_sidebar %}

{% if ( paperResult.status in ['finished','reviewing'] and setting('questions.testpaper_answers_show_mode','submitted') == 'submitted' ) or ( setting('questions.testpaper_answers_show_mode','submitted') == 'reviewed' ) and paperResult.status|default(null) == 'finished' %}
  
  

  <div class="testpaper-card affix" >
    {% if not doTimes|default(0) %}
      <div class="testpaper-timer">
        <button class="btn btn-success do-test" id="finishPaper" data-ajax="{{ path('testpaper_result_submit', { resultId: paperResult.id|default(0) }) }}"  data-toggle="modal" data-target="#testpaper-finished-dialog">{{'再考一次'|trans}}</button>
      </div>
    {% endif %}

    <div class="panel panel-gray border-radius-none ">
      <div class="panel-heading">
        {{'答题卡'|trans}}
        {% if target|default(null) and target.doTimes|default('0') %}
          <span class="color-danger">{{'本次考试仅一次机会'|trans}}</span>
        {% endif %}
        <a class="pull-right link-medium" href="javascript:;" data-container="body" data-toggle="popover" data-placement="bottom" data-trigger="hover" data-content='<div>本次考试共<span class="color-primary">{{ paper.itemCount }}题</span>，总分<span class="color-primary">{{ paper.score }}分</span>{% if testpaperActivity.finishCondition.type|default(null) == 'score' %}，及格为<span class="color-primary">{{ testpaperActivity.finishCondition.finishScore|default(0) }}</span>分{% endif %}。{% if paper.limitedTime > 0 %}请在<span class="color-primary">{{ limitedTime }}分钟</span>内作答。{% endif %}</div>'><i class="es-icon es-icon-info"></i></a>
      </div>
      <div class="panel-body">
        {% for type in questionTypes|default([]) %}
          <p>{{ questionTypeDict[type] }}</p>
          {% for question in questions[type] %}
            {% if question.type == 'material' %}
              {% for questionSub in question.subs|default([]) %}
                <a href="javascript:;" data-anchor="#question{{ question.id }}" class="js-btn-index color-lump mrm mbmpull-left {% if paperResult.status == 'reviewing' and questionSub.type == 'essay' %}lump-warning{% elseif questionSub.testResult.status|default('noAnswer') == 'right' %}lump-success{% else %}lump-danger{% endif %}">{{ question.seq }}</a>
              {% endfor %}
            {% else %}
              <a href="javascript:;" data-anchor="#question{{ question.id }}" class="js-btn-index color-lump mrm mbmpull-left {% if paperResult.status == 'reviewing' and question.type == 'essay' %}lump-warning{% elseif question.testResult.status|default('noAnswer') in ['partRight','wrong'] %}lump-danger{% else %}lump-success{% endif %}">{{ question.seq }}</a>
            {% endif %}
          {% endfor %}
        {% endfor %}

        <div class="testpaper-card-explain clearfix">
          <a href="javascript:;" class="btn btn-success js-btn-index"></a><small class="text-muted">{{'正确'|trans}}</small>
          <a href="javascript:;" class="btn btn-danger js-btn-index"></a><small class="text-muted">{{'错误'|trans}}</small>
          <a href="javascript:;" class="btn btn-warning js-btn-index"></a><small class="text-muted">{{'待批阅'|trans}}</small>
          <a href="javascript:;" class="js-btn-index color-lump mrm"></a><small class="text-muted">{{'未做'|trans}}</small>
        </div>
      </div>
      <div class="panel-footer">
        <div class="checkbox">
          <label>
            <input type="checkbox" id="showWrong" />
            <span class="text-info">{{'只看错题'|trans}}</span>
          </label>
        </div>
      </div>

    </div>
  </div>
{% endif %}

{% endblock %}