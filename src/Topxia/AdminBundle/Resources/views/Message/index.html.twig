{% extends 'TopxiaAdminBundle:User:layout.html.twig' %}

{% block title %}私信管理 - {{ parent() }}{% endblock %}

{% set script_controller = 'message/list' %}

{% set menu = 'message' %}

{% block main %}
  <div class="page-header">
    <h1>私信管理</h1>
  </div>

  <form id="message-search-form" class="form-inline well well-sm" action="" method="get" novalidate> 
      <div class="form-group">
        {{ form_widget(form.content, {attr:{class:'form-control', placeholder:'关键词'}}) }}
      </div>
      <div class="form-group">
        {{ form_widget(form.nickname, {attr:{class:'form-control', placeholder:'发信人'}}) }}
      </div>
      <div class="form-group">
        {{ form_widget(form.startDate, {attr:{class:'form-control'}}) }}
      </div>
      <div class="form-group">
        {{ form_widget(form.endDate, {attr:{class:'form-control'}}) }}
      </div>
      <button class="btn btn-primary">搜索</button>
      {{ form_rest(form) }}
  </form>

<div id="message-table-container">

  <table class="table table-striped table-hover" id="message-table">
    <thead>
      <tr >
        <th width="10%"> <input type="checkbox"  data-role="batch-select"> 发信人</th>
        <th width="10%">收信人</th>
        <th width="65%">内容</th>
        <th width="15%">发送时间</th>
      </tr>
    </thead>
    <tbody>
      {% for message in messages %}
        <tr class="message-tr" id="message-table-tr-{{message.id}}">
          <td><input value="{{message.id}}" type="checkbox" data-role="batch-item" >
           {{ admin_macro.user_link(users[message.fromId]) }}
          </td>

          <td>{{ admin_macro.user_link(users[message.toId]) }} </td>
          <td>
              <div class="short-long-text">
                <div class="short-text text-sm text-muted">{{ message.content|plain_text(60) }} <span class="trigger">(展开)</span></div>
                <div class="long-text">{{ message.content|raw }} <span class="trigger">(收起)</span></div>
              </div>
          </td>
          <td>{{ message.createdTime|date('Y-n-d H:i')}}</td>
        </tr>
      {% endfor %}
    </tbody>
  </table>

  <div>
    <label class="checkbox-inline"><input type="checkbox" data-role="batch-select"> 全选</label>
    <button class="btn btn-default btn-sm mlm" data-role="batch-delete"  data-name="私信" data-url="{{ path('admin_message_delete_messages') }}">删除</button>
  </div>

</div>

  <div>
    {{ web_macro.paginator(paginator) }}
  </div>

{% endblock %}
