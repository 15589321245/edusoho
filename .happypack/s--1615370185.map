{"version":3,"sources":["app/Resources/static-src/app/js/activity-manage/video/index.js"],"names":["jQuery","validator","addMethod","value","element","optional","test","parseInt","$","val","on","event","openUI","_inItStep3from","$step3_forom","data","validate","rules","required","unsigned_integer","max","min","messages","_inItStep2form","$step2_form","groups","date","title","maxlength","trim","minute","second","time_length","second_range","blur","form","fileChooser","subtitleDialog","onSelectFile","closeUI","file","length","Math","round","source","id","uri","render","children","removeClass","target","addClass"],"mappings":"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","file":"index.js","sourceRoot":"/Users/kz/projects/edusoho","sourcesContent":["import FileChooser from '../../file-chooser/file-choose';\nimport SubtitleDialog from './subtitle/dialog';\n\n\njQuery.validator.addMethod(\"unsigned_integer\", function (value, element) {\n  return this.optional(element) || /^([1-9]\\d*|0)$/.test(value);\n}, \"时长必须为非负整数\");\n\njQuery.validator.addMethod(\"second_range\", function (value, element) {\n  return this.optional(element) || /^([0-9]|[012345][0-9]|59)$/.test(value);\n}, \"秒数只能在0-59之间\");\n\njQuery.validator.addMethod(\"time_length\", function (value, element) {\n  return parseInt($(\"#minute\").val()) + parseInt($(\"#second\").val()) > 0\n}, \"时长不能等于0\");\n\n$('#iframe-content').on('click', '.js-choose-trigger', (event) => {\n  FileChooser.openUI();\n  $('[name=\"ext[mediaSource]\"]').val(null);\n});\n\nfunction _inItStep3from() {\n\n  var $step3_forom = $('#step3-form');\n  var validator = $step3_forom.data('validator');\n\n  $step3_forom.validate({\n    rules: {\n      'ext[finishDetail]': {\n        required: true,\n        unsigned_integer: true,\n        max: 300,\n        min: 1,\n      }\n    },\n    messages: {\n      'ext[finishDetail]': {\n        required: '请输入时长',\n        max: '时长不能大于300分钟',\n        min: '时长不能小于1分钟'\n      }\n    }\n  });\n  $step3_forom.data('validator', validator);\n}\nfunction _inItStep2form() {\n  var $step2_form = $('#step2-form');\n  var validator = $step2_form.data('validator');\n  $step2_form.validate({\n    groups: {\n      date: 'minute second'\n    },\n    rules: {\n      title: {\n        required: true,\n        maxlength: 50,\n        trim: true,\n      },\n      minute: 'required unsigned_integer time_length',\n      second: 'required second_range time_length',\n      'ext[mediaSource]': 'required',\n      'ext[finishDetail]': 'unsigned_integer'\n    },\n    messages: {\n      minute: {\n        required: '请输入时长',\n        time_length: '时长必须大于0'\n      },\n      second: {\n        required: '请输入时长',\n        second_range: '秒数只能在0-59之间',\n        time_length: '时长必须大于0'\n      },\n      'ext[mediaSource]': \"请上传或选择%display%\",\n      'ext[finishDetail]': 'dddd'\n    }\n  });\n  $step2_form.data('validator', validator);\n}\n\n_inItStep2form();\n\n\n$(\".js-length\").blur(function () {\n  let validator = $(\"#step2-form\").data('validator');\n  if (validator && validator.form()) {\n    const minute = parseInt($('#minute').val()) | 0;\n    const second = parseInt($('#second').val()) | 0;\n    $(\"#length\").val(minute * 60 + second);\n  }\n});\n\nconst fileChooser = new FileChooser();\n//字幕组件\nconst subtitleDialog = new SubtitleDialog('.js-subtitle-list');\n\n\nconst onSelectFile = file => {\n  FileChooser.closeUI();\n  if (file.length && file.length > 0) {\n    let minute = parseInt(file.length / 60);\n    let second = Math.round(file.length % 60);\n    $(\"#minute\").val(minute);\n    $(\"#second\").val(second);\n    $(\"#length\").val(minute * 60 + second);\n  }\n\n  $('[name=\"ext[mediaSource]\"]').val(file.source);\n  if (file.source == 'self') {\n    $(\"#ext_mediaId\").val(file.id);\n    $(\"#ext_mediaUri\").val('');\n  } else {\n    $(\"#ext_mediaUri\").val(file.uri);\n    $(\"#ext_mediaId\").val(0);\n  }\n\n  //渲染字幕\n  subtitleDialog.render(file);\n};\n\n// 完成条件是观看时长的情况\nif($(\"#finish-condition\").children('option:selected').val() === 'time') {\n  $('.viewLength').removeClass('hidden');\n  _inItStep3from();\n}\n\n$(\"#finish-condition\").on('change', function (event) {\n  if (event.target.value == 'time') {\n    $('.viewLength').removeClass('hidden');\n    _inItStep3from();\n  } else {\n    $('.viewLength').addClass('hidden');\n    $('input[name=\"ext[finishDetail]\"]').rules('remove')\n  }\n})\n\nfileChooser.on('select', onSelectFile);\n"]}