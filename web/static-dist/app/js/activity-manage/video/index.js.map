{"version":3,"sources":["webpack:///./app/Resources/static-src/app/js/activity-manage/video/index.js","webpack:///./app/Resources/static-src/app/js/activity-manage/video/subtitle/dialog.js?8ea6","webpack:///./app/Resources/static-src/app/js/activity-manage/video/video.js"],"names":["SubtitleDialog","element","upload_id","inited","$","length","init","$container","closest","find","val","render","id","self","on","$elem","post","data","Translator","trans","parent","remove","show","media","html","get","mediaId","initUploader","globalId","uploader","_destroyUploader","UploaderSDK","initUrl","finishUrl","ui","multi","accept","extensions","mimeTypes","type","process","videoNo","locale","document","documentElement","lang","err","error","file","name","success","convertStatus","waiting","doing","none","append","hide","responseJSON","message","removeClass","addClass","__events","destroy","e","Video","showChooseContent","initStep2form","isInitStep3from","autoValidatorLength","initfileChooser","hideSubtitleWidget","subtitleWidget","click","event","openUI","source","console","log","removeAttr","text","attr","initStep3from","$step2_form","validator","validate","groups","date","rules","title","required","maxlength","trim","course_title","minute","second","messages","second_range","$step3_forom","positive_integer","max","min","blur","form","parseInt","children","target","value","fileChooser","subtitleDialog","onSelectFile","displayFinishCondition","closeUI","placeMediaAttr","undefined","$minute","$second","$length","JSON","stringify","valid","uri"],"mappings":"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","file":"app/js/activity-manage/video/index.js","sourcesContent":["import Video from './video';\n\nnew Video();\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n// WEBPACK FOOTER //\n// ./app/Resources/static-src/app/js/activity-manage/video/index.js","import notify from 'common/notify';\n\nclass SubtitleDialog {\n\n  upload_id = 'subtitle-uploader';\n  inited = false;\n\n  constructor(element) {\n    this.element = $(element);\n\n    if (this.element.length > 0) {\n      this.init();\n      this.inited = true;\n    }\n\n    let $container = this.element.closest('#video-subtitle-form-group');\n    if ($container.find('#ext_mediaId_for_subtitle').val() > 0) {\n      this.render({id: $container.find('#ext_mediaId_for_subtitle').val()});\n    }\n  }\n\n  init() {\n\n    let self = this;\n    //删除字幕\n    this.element.on('click', '.js-subtitle-delete', function () {\n      let $elem = $(this);\n      $.post($elem.data('subtitleDeleteUrl'), function (data) {\n        if (data) {\n          notify('success', Translator.trans('activity.video_manage.delete_success_hint'));\n          $elem.parent().remove();\n          $('#' + self.upload_id).show();\n        }\n      });\n    });\n  }\n\n\n  render(media) {\n    if (!this.inited) {\n      return;\n    }\n\n    if (media && 'id' in media && media.id > 0) {\n      this.media = media;\n      this.element.html(Translator.trans('activity.video_manage.subtitle_load_hint'));\n      let self = this;\n      $.get(this.element.data('dialogUrl'), {mediaId: this.media.id}, function (html) {\n        self.element.html(html);\n        self.initUploader();\n      });\n    }\n  }\n\n  initUploader() {\n    let self = this;\n    let $elem = $('#' + this.upload_id);\n    let mediaId = $('.js-subtitle-dialog').data('mediaId');\n    let globalId = $elem.data('mediaGlobalId');\n\n    if (this.uploader) {\n      this._destroyUploader();\n    }\n    let uploader = new UploaderSDK({\n      initUrl: $elem.data('initUrl'),\n      finishUrl: $elem.data('finishUrl'),\n      id: this.upload_id,\n      ui: 'simple',\n      multi: true,\n      accept: {\n        extensions: ['srt'],\n        mimeTypes: ['text/srt']\n      },\n      type: 'sub',\n      process: {\n        videoNo: globalId,\n      },\n      locale: document.documentElement.lang\n    });\n\n    uploader.on('error', function (err) {\n      if (err.error === 'Q_TYPE_DENIED') {\n        notify('danger', Translator.trans('activity.video_manage.subtitle_upload_error_hint'));\n      }\n    });\n\n    uploader.on('file.finish', function (file) {\n      $.post($elem.data('subtitleCreateUrl'), {\n        \"name\": file.name,\n        \"subtitleId\": file.id,\n        \"mediaId\": mediaId\n      }).success(function (data) {\n        let convertStatus = {\n          waiting: Translator.trans('activity.video_manage.convert_status_waiting'),\n          doing: Translator.trans('activity.video_manage.convert_status_doing'),\n          success: Translator.trans('activity.video_manage.convert_status_success'),\n          error: Translator.trans('activity.video_manage.convert_status_error'),\n          none: Translator.trans('activity.video_manage.convert_status_none')\n        };\n        $('.js-media-subtitle-list').append('<li class=\"pvs\">' +\n          '<span class=\"subtitle-name prl\">' + data.name + '</span>' +\n          '<span class=\"subtitle-transcode-status ' + data.convertStatus + '\">' + convertStatus[data.convertStatus] + '</span>' +\n          '<a href=\"javascript:;\" class=\"btn-link pll color-primary js-subtitle-delete\" data-subtitle-delete-url=\"/media/' + mediaId + '/subtitle/' + data.id + '/delete\">'+Translator.trans('activity.video_manage.subtitle_delete_hint')+'</a>' +\n          '</li>');\n        if ($('.js-media-subtitle-list li').length > 3) {\n          $('#' + self.upload_id).hide();\n        }\n        notify('success', Translator.trans('activity.video_manage.subtitle_upload_success_hint'));\n      }).error(function (data) {\n        notify('danger', data.responseJSON.error.message);\n      });\n    });\n\n    this.uploader = uploader;\n  }\n\n  show() {\n    let parent = this.element.parent('.form-group');\n    if (parent.length > 0) {\n      parent.removeClass('hide');\n    }\n  }\n\n  hide() {\n    let parent = this.element.parent('.form-group');\n    if (parent.length > 0) {\n      parent.addClass('hide');\n    }\n  }\n\n  _destroyUploader() {\n    if (!this.uploader) {\n      return;\n    }\n    this.uploader.__events = null;\n    try {\n      this.uploader.destroy();\n    } catch (e) {\n      //忽略destroy异常\n    }\n    this.uploader = null;\n  }\n\n  destroy() {\n    if (!this.inited) {\n      return;\n    }\n    this._destroyUploader();\n  }\n}\n\nexport default SubtitleDialog;\n\n\n\n// WEBPACK FOOTER //\n// ./app/Resources/static-src/app/js/activity-manage/video/subtitle/dialog.js","import FileChooser from 'app/js/file-chooser/file-choose';\nimport SubtitleDialog from 'app/js/activity-manage/video/subtitle/dialog';\n\nexport default class Video {\n  constructor() {\n    this.showChooseContent();\n    this.initStep2form();\n    this.isInitStep3from();\n    this.autoValidatorLength();\n    this.initfileChooser();\n    this.hideSubtitleWidget();\n  }\n\n  hideSubtitleWidget() {\n    var subtitleWidget = $('#video-subtitle-form-group');\n    $('[role=\"presentation\"] a[href!=\"#import-video-panel\"]').click(function () {\n      subtitleWidget.show();\n    });\n    $('a[href=\"#import-video-panel\"]').click(function () {\n      subtitleWidget.hide();\n    });\n  }\n\n  showChooseContent() {\n    $('#iframe-content').on('click', '.js-choose-trigger', (event) => {\n      FileChooser.openUI();\n      $('[name=\"ext[mediaSource]\"]').val(null);\n    });\n  }\n\n  displayFinishCondition(source) {\n    console.log(source);\n    if (source === 'self') {\n      $(\"#finish-condition option[value=end]\").removeAttr('disabled');\n      $(\"#finish-condition option[value=end]\").text(Translator.trans('activity.video_manage.finish_detail'));\n    } else {\n      $(\"#finish-condition option[value=end]\").text(Translator.trans('activity.video_manage.other_finish_detail'));\n      $(\"#finish-condition option[value=end]\").attr('disabled', 'disabled');\n      $(\"#finish-condition option[value=time]\").attr('selected', false);\n      $(\"#finish-condition option[value=time]\").attr('selected', true);\n      $('.viewLength').removeClass('hidden');\n      this.initStep3from();\n      }\n  }\n\n  initStep2form() {\n    var $step2_form = $('#step2-form');\n    var validator = $step2_form.data('validator');\n    $step2_form.validate({\n      groups: {\n        date: 'minute second'\n      },\n      rules: {\n        title: {\n          required: true,\n          maxlength: 50,\n          trim: true,\n          course_title: true,\n        },\n        minute: 'required unsigned_integer',\n        second: 'required second_range',\n        'ext[mediaSource]': 'required',\n        'ext[finishDetail]': 'unsigned_integer'\n      },\n      messages: {\n        minute: {\n          required: Translator.trans('activity.video_manage.length_required_error_hint'),\n        },\n        second: {\n          required: Translator.trans('activity.video_manage.length_unsigned_integer_error_hint'),\n          second_range: Translator.trans('activity.video_manage.second_range_error_hint'),\n        },\n        'ext[mediaSource]': Translator.trans(\"activity.video_manage.media_error_hint\"),\n      }\n    });\n    $step2_form.data('validator', validator);\n  }\n\n  initStep3from() {\n    var $step3_forom = $('#step3-form');\n    var validator = $step3_forom.data('validator');\n    $step3_forom.validate({\n      rules: {\n        'ext[finishDetail]': {\n          required: true,\n          positive_integer: true,\n          max: 300,\n          min: 1,\n        }\n      },\n      messages: {\n        'ext[finishDetail]': {\n          required: Translator.trans('activity.video_manage.length_required_error_hint'),\n        }\n      }\n    });\n    $step3_forom.data('validator', validator);\n  }\n\n  autoValidatorLength() {\n    $(\".js-length\").blur(function () {\n      let validator = $(\"#step2-form\").data('validator');\n      if (validator && validator.form()) {\n        const minute = parseInt($('#minute').val()) | 0;\n        const second = parseInt($('#second').val()) | 0;\n        $(\"#length\").val(minute * 60 + second);\n      }\n    });\n  }\n\n  isInitStep3from() {\n    // 完成条件是观看时长的情况\n    if ($(\"#finish-condition\").children('option:selected').val() === 'time') {\n      $('.viewLength').removeClass('hidden');\n      this.initStep3from();\n    }\n\n    $(\"#finish-condition\").on('change', (event) => {\n      if (event.target.value == 'time') {\n        $('.viewLength').removeClass('hidden');\n        this.initStep3from();\n      } else {\n        $('.viewLength').addClass('hidden');\n        $('input[name=\"ext[finishDetail]\"]').rules('remove')\n      }\n    })\n  }\n\n  initfileChooser() {\n    const fileChooser = new FileChooser();\n    //字幕组件\n    const subtitleDialog = new SubtitleDialog('.js-subtitle-list');\n    const onSelectFile = file => {\n      this.displayFinishCondition(file.source);\n      FileChooser.closeUI();\n\n      let placeMediaAttr = (file) => {\n        if (file.length !== 0 && file.length !== undefined) {\n          let $minute = $('#minute');\n          let $second = $('#second');\n          let $length = $('#length');\n          \n          let length = parseInt(file.length);\n          let minute = parseInt(length / 60);\n          let second = length % 60;\n          $minute.val(minute);\n          $second.val(second);\n          $length.val(length);\n          file.minute = minute;\n          file.second = second;\n        }\n        $('[name=\"media\"]').val(JSON.stringify(file));\n\n      };\n      placeMediaAttr(file);\n\n      $('[name=\"ext[mediaSource]\"]').val(file.source);\n      $(\"#step2-form\").valid();\n      if (file.source == 'self') {\n        $(\"#ext_mediaId\").val(file.id);\n        $(\"#ext_mediaUri\").val('');\n      } else {\n        $(\"#ext_mediaUri\").val(file.uri);\n        $(\"#ext_mediaId\").val(0);\n      }\n      //渲染字幕\n      subtitleDialog.render(file);\n    };\n\n    fileChooser.on('select', onSelectFile);\n  }\n}\n\n\n// WEBPACK FOOTER //\n// ./app/Resources/static-src/app/js/activity-manage/video/video.js"],"sourceRoot":""}