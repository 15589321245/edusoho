{"version":3,"sources":["webpack:///./app/Resources/static-src/app/js/open-course/header/course-ad.js","webpack:///./app/Resources/static-src/app/js/open-course/header/index.js","webpack:///./app/Resources/static-src/app/js/open-course/header/open-course-player.js"],"names":["CourseAd","element","courseUrl","$element","$","init","html","get","then","data","console","log","map","item","template","id","cover","title","find","ua","navigator","userAgent","toLowerCase","test","parent","length","middle","isWxPreviewType","isWxAndroidBrowser","document","getElementById","contentWindow","style","display","on","modal","backdrop","openCoursePlayer","url","OpenCoursePlayer","player","lesson","courseAd","initEvent","showPlayer","replay","event","onLiveVideoPlay","mediaError","show","hide","mediaSourceActionsMap","onIframe","onVideo","caller","mediaSource","bind","undefined","type","onSWF","$ifrimeContent","empty","mediaUri","convertStatus","storage","Translator","trans","playerUrl","courseId","videoPlay","$swfContent","removeSWF","embedSWF","wmode","allowFullScreen","window","location","reload","e","$target","currentTarget","replayStatus","referer","frames","BalloonPlayer","$videoContent","messenger","name","project","children","getPlayer","onPlayEnd","showADModal"],"mappings":"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","file":"app/js/open-course/header/index.js","sourcesContent":["class CourseAd {\n  constructor({ element, courseUrl }) {\n    this.$element = $(element);\n    this.courseUrl = courseUrl;\n    this.init();\n  }\n\n  init() {\n    let html = '';\n\n    $.get(this.courseUrl).then((data) => {\n      console.log(data);\n      data.map((item) => {\n        html =  html + this.template(item.id, item.cover, item.title)\n      })\n\n      this.$element.find('.modal-body').html(html);\n    })\n  }\n\n  isWxAndroidBrowser() {\n    let ua = navigator.userAgent.toLowerCase();\n    return /android/.test(ua) && /micromessenger/i.test(ua);\n  }\n\n  isWxPreviewType () {\n    return this.$element.parent('.js-open-course-wechat-preview').length > 0;\n  }\n\n  template(id, cover, title) {\n    return `<div class=\"modal-img\">\n        <a href=\"/course_set/${id}\">\n          <img class=\"img-responsive\" src=\"${cover.middle}\" alt=\"\">\n        </a>\n        <div class=\"title\"><a class=\"link-dark\" href=\"/course_set/${id}\">${title}</a></div>\n      </div>`;\n  }\n\n  show() {\n    if (this.isWxPreviewType()) {\n      return;\n    }\n\n    if (this.isWxAndroidBrowser()) {\n      document.getElementById('viewerIframe').contentWindow.document.getElementById('lesson-player').style.display = \"none\";\n\n      this.$element.on('hide.bs.modal', () => {\n        document.getElementById('viewerIframe').contentWindow.document.getElementById('lesson-player').style.display = \"block\";\n      });\n    }\n\n    this.$element.modal({\n      backdrop: false\n    });\n  }\n\n  hide() {\n    this.$element.modal('hide');\n  }\n}\n\nexport default CourseAd;\n\n\n// WEBPACK FOOTER //\n// ./app/Resources/static-src/app/js/open-course/header/course-ad.js","import OpenCoursePlayer from './open-course-player';\n\nif ($('#firstLesson').length > 0) {\n  let openCoursePlayer = new OpenCoursePlayer({\n    url: $('#firstLesson').data('url'),\n    element: '.open-course-views',\n  });\n}\n\n\n\n// WEBPACK FOOTER //\n// ./app/Resources/static-src/app/js/open-course/header/index.js","import EsMessenger from 'app/common/messenger';\nimport swfobject from 'es-swfobject';\n\nimport CourseAd from './course-ad';\n\nclass OpenCoursePlayer {\n  constructor({\n    url,\n    element,\n  }) {\n    this.url = url;\n    this.$element = $(element);\n\n    this.player = null;\n    this.lesson = null;\n    this.courseAd = null;\n\n    this.init();\n    this.initEvent();\n  }\n\n  init() {\n    this.showPlayer();\n  }\n\n  initEvent() {\n    this.$element.on('click', '.js-player-replay', event => this.replay(event));\n    this.$element.on('click', '.js-live-video-replay-btn', event => this.onLiveVideoPlay(event));\n  }\n\n  showPlayer() {\n    $.get(this.url, (lesson) => {\n      console.log(this.url, lesson)\n      if (lesson.mediaError) {\n        $('#media-error-dialog').show();\n        $('#media-error-dialog').find('.modal-body .media-error').html(lesson.mediaError);\n        return;\n      }\n      $('#media-error-dialog').hide();\n      this.lesson = lesson;\n\n      let mediaSourceActionsMap = {\n        'iframe': this.onIframe,\n        'self': this.onVideo\n      };\n\n      let caller = mediaSourceActionsMap[lesson.mediaSource] ? mediaSourceActionsMap[lesson.mediaSource].bind(this) : undefined;\n\n      if (caller === undefined && (lesson.type == 'video' || lesson.type == 'audio')) {\n        caller = this.onSWF.bind(this);\n      }\n\n      if (caller === undefined) {\n        return;\n      }\n      \n      caller(this);\n      \n    })\n  }\n\n  onIframe() {\n    let $ifrimeContent = $('#lesson-preview-iframe');\n    $ifrimeContent.empty();\n\n    var html = `<iframe class=\"embed-responsive-item\" src=\"${this.lesson.mediaUri}\" style=\"position:absolute; left:0; top:0; height:100%; width:100%; border:0px;\" scrolling=\"no\"></iframe>`;\n\n    $ifrimeContent.html(html);\n    $ifrimeContent.show();\n  }\n\n  onVideo() {\n    let lesson = this.lesson;\n            \n    if (lesson.type == 'video' || lesson.type == 'audio') {\n      if (lesson.convertStatus != 'success' && lesson.storage == 'cloud') {\n        $('#media-error-dialog').show();\n        $('#media-error-dialog').find('.modal-body .media-error').html(Translator.trans('open_course.converting_hint'));\n        return;\n      }\n      let playerUrl = `/open/course/${lesson.courseId}/lesson/${lesson.id}/player`;\n\n      this.videoPlay(playerUrl);\n\n    } else {\n      return;\n    }\n  }\n\n  onSWF() {\n    let lesson = this.lesson;\n    let $swfContent = $('#lesson-preview-swf-player');\n\n    swfobject.removeSWF('lesson-preview-swf-player');\n    $swfContent.html('<div id=\"lesson-swf-player\"></div>');\n    swfobject.embedSWF(lesson.mediaUri,\n      'lesson-swf-player', '100%', '100%', \"9.0.0\", null, null, {\n        wmode: 'opaque',\n        allowFullScreen: 'true'\n      });\n    $swfContent.show();\n  }\n\n  replay() {\n    if (!this.player) {\n      window.location.reload();\n    } else {\n      this.player.replay();\n      this.courseAd.hide();\n    }\n  }\n\n  onLiveVideoPlay(e) {\n    this.$element.find('.js-live-header-mask').hide();\n\n    let $target = $(e.currentTarget);\n\n    let lesson = this.lesson;\n    \n    if (lesson.mediaError) {\n      $('#media-error-dialog').show();\n      $('#media-error-dialog').find('.modal-body .media-error').html(lesson.mediaError);\n      return;\n    }\n\n    $('#media-error-dialog').hide();\n\n    if (lesson.type == 'liveOpen' && lesson.replayStatus == 'videoGenerated') {\n      if ((lesson.convertStatus != 'success' && lesson.storage == 'cloud')) {\n          $('#media-error-dialog').show();\n          $('#media-error-dialog').find('.modal-body .media-error').html(Translator.trans('open_course.converting_hint'));\n          return;\n      }\n\n      let referer = $target.data('referer');\n      let playerUrl = `/open/course/${lesson.courseId}/lesson/${lesson.id}/player?referer=${referer}`;\n\n      this.videoPlay(playerUrl);\n\n    } else {\n      return;\n    }\n  }\n\n  getPlayer() {\n    return window.frames[\"viewerIframe\"].window.BalloonPlayer ||\n           window.frames[\"viewerIframe\"].window.player;\n  }\n\n  videoPlay(playerUrl) {\n    let $videoContent = $('#lesson-preview-player');\n    $videoContent.html('');\n\n    let html = `<iframe \n      class=\"embed-responsive-item\" \n      src=\"${playerUrl}\" \n      name=\"viewerIframe\" \n      id=\"viewerIframe\" \n      width=\"100%\" \n      allowfullscreen \n      webkitallowfullscreen \n      height=\"100%\"\" \n      style=\"border:0px;position:absolute; left:0; top:0;\"></iframe>`;\n\n    $videoContent.html(html).show();\n\n    let messenger = new EsMessenger({\n      name: 'parent',\n      project: 'PlayerProject',\n      children: [document.getElementById('viewerIframe')],\n      type: 'parent'\n    });\n\n    messenger.on(\"ready\", () => {\n      // @TODO 不清楚这边有什么用\n      let player = this.getPlayer();\n      this.player = player;\n      console.log('player', player)\n    });\n\n    messenger.on(\"ended\", () => {\n      console.log('ended');\n      this.onPlayEnd();\n    });\n  }\n\n  onPlayEnd() {\n    this.showADModal();\n  }\n\n  showADModal() {\n    if (this.courseAd) {\n      this.courseAd.show();\n      return;\n    }\n\n    this.courseAd = new CourseAd({\n      element: '#open-course-ad-modal',\n      courseUrl: this.$element.data('get-recommend-course-url')\n    })\n    this.courseAd.show();\n  }\n\n}\n\nexport default OpenCoursePlayer;\n\n\n// WEBPACK FOOTER //\n// ./app/Resources/static-src/app/js/open-course/header/open-course-player.js"],"sourceRoot":""}