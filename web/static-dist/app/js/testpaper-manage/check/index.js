webpackJsonp(["app/js/testpaper-manage/check/index"],[function(t,e,a){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var o=function(){function t(t,e){for(var a=0;a<e.length;a++){var n=e[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,a,n){return a&&t(e.prototype,a),n&&t(e,n),e}}(),r=a("2d148eb38b93bb0ef45c");n(r);$.validator.addMethod("score",function(t,e){var a=/^\d+(\.\d)?$/.test(t);return!!a&&Number(t)<=Number($(e).data("score"))},$.validator.format("分数只能是<=题目分数、且>=0的整数或者1位小数"));var s=function(){function t(e){i(this,t),this.$container=e,this.checkContent={},this.$form=e.find("form"),this.$dialog=e.find("#testpaper-checked-dialog"),this.validator=null,this._initEvent(),this._init(),this._initValidate()}return o(t,[{key:"_initEvent",value:function(){var t=this;this.$container.on("focusin","textarea",function(e){return t._showEssayInputEditor(e)}),this.$container.on("click",'[data-role="check-submit"]',function(e){return t._submitValidate(e)}),this.$container.on("click","*[data-anchor]",function(e){return t._quick2Question(e)}),this.$dialog.on("click",'[type="button"]',function(e){return t._submit(e)}),this.$dialog.on("change","select",function(e){return t._teacherSayFill(e)})}},{key:"_init",value:function(){}},{key:"_showEssayInputEditor",value:function(t){var e=this,a=$(t.currentTarget);a.hasClass("essay-teacher-say-short")&&!function(){t.preventDefault(),t.stopPropagation(),$(e).blur();var n=a.siblings(".essay-teacher-say-long"),i=n.siblings(".essay-teacher-say-btn");a.hide(),n.show(),i.show();var o=CKEDITOR.replace(n.attr("id"),{toolbar:"Minimal",filebrowserImageUploadUrl:n.data("imageUploadUrl")});o.on("blur",function(t){o.updateElement(),setTimeout(function(){n.val(o.getData()),n.change()},1)}),o.on("instanceReady",function(t){this.focus(),i.one("click",function(){a.val($(o.getData()).text()),o.destroy(),n.hide(),i.hide(),a.show()})}),o.on("key",function(){o.updateElement(),setTimeout(function(){n.val(o.getData()),n.change()},1)}),o.on("insertHtml",function(t){o.updateElement(),setTimeout(function(){n.val(o.getData()),n.change()},1)})}()}},{key:"_initValidate",value:function(t){this.validator=this.$form.validate(),$("*[data-score]:visible").length>0&&$("*[data-score]:visible").each(function(t){$(this).rules("add",{required:!0,score:!0,min:0,messages:{required:"请输入分数"}})})}},{key:"_quick2Question",value:function(t){var e=$(t.currentTarget),a=$(e.data("anchor")).offset();$(document).scrollTop(a.top-55)}},{key:"_submitValidate",value:function(t){var e=this,a=($(t.currentTarget),0);(void 0==this.validator||this.validator.form())&&!function(){var t={},n=e;$("*[data-score]").each(function(){var e=$(this).data("id");t.score=Number($(this).val()),t.teacherSay=$('[name="teacherSay_'+e+'"]').val(),n.checkContent[e]=t,a+=Number($(this).val())});var i=Number(e.$dialog.find('[name="objectiveScore"]').val()),o=Number(a)+i;e.$dialog.find("#totalScore").html(o),e.$dialog.modal("show")}()}},{key:"_submit",value:function(t){var e=$(t.currentTarget),a=this.$dialog.find("textarea").val(),n=this.$dialog.find('[name="passedStatus"]:checked').val();$.post(e.data("postUrl"),{result:this.checkContent,teacherSay:a,passedStatus:n},function(t){window.location.href=e.data("goto")})}},{key:"_teacherSayFill",value:function(t){var e=$(t.currentTarget),a=e.find("option:selected");""==a.val()?this.$dialog.find("textarea").val(""):this.$dialog.find("textarea").val(a.text())}}]),t}();new s($(".testpaper-activity-show"))}]);