function baseController(a){this.getService=function(a){return angular.injector(["AppService","ng"]).get(a)}}function AppInitController(a,b,c,d){console.log("AppInitController"),a.toggle=function(){c.toggleMenu()},a.showMyView=function(c){a.user?b.go(c):b.go("login")},d.getSchoolPlugins(null,function(b){a.plugins=b})}function CourseReviewController(a,b,c,d){var e=this;a.canLoad=!0,a.start=a.start||0,a.loadMore=function(){a.canLoad&&setTimeout(function(){e.loadReviews()},200)},this.loadReviews=function(){c.getReviews({start:a.start,limit:10,courseId:b.courseId},function(b){var c=b?b.data.length:0;(!b||0==c||10>c)&&(a.canLoad=!1),a.reviews=a.reviews||[];for(var d=0;c>d;d++)a.reviews.push(b.data[d]);a.start+=b.limit})},this.loadReviewInfo=function(){c.getCourseReviewInfo({courseId:b.courseId},function(b){a.reviewData=b})},this.loadReviewInfo(),this.loadReviews()}function CourseSettingController(a,b,c,d){a.isLearn=b.isLearn,a.exitLearnCourse=function(){a.showLoad(),c.unLearnCourse({courseId:b.courseId,token:a.token},function(b){a.hideLoad(),200==b.meta.code?(d.history.back(),setTimeout(function(){a.$emit("refresh",{})},10)):a.toast(b.meta.message)})}}function CourseDetailController(a,b,c){c.getCourse({courseId:b.courseId,token:a.token},function(b){a.course=b.course})}function CourseController(a,b,c,d,e){a.showLoad();var f=c.getService("CourseService"),g=c.getService("LessonService");f.getCourse({courseId:b.courseId,token:a.token},function(b){if(a.ratingArray=d.createArray(5),a.vipLevels=b.vipLevels,a.course=b.course,a.member=b.member,a.isFavorited=b.userFavorited,a.discount=b.discount,b.member){var c=0==b.course.lessonNum?0:b.member.learnedNum/b.course.lessonNum;a.learnProgress=100*c+"%"}a.courseView=app.viewFloder+(b.member?"view/course_learn.html":"view/course_no_learn.html"),a.hideLoad(),a.loadLessons(),a.loadReviews()}),a.loadLessons=function(){g.getCourseLessons({courseId:b.courseId,token:a.token},function(b){a.$apply(function(){a.lessons=b.lessons,a.learnStatuses=b.learnStatuses;for(index in b.learnStatuses)a.lastLearnStatusIndex=index})})},a.loadReviews=function(){f.getReviews({courseId:b.courseId,token:a.token,limit:1},function(b){a.reviews=b.data})},a.favoriteCourse=function(){if(null==a.user)return void e.go("login",{"goto":"/course/"+b.courseId});var c={courseId:b.courseId,token:a.token};a.isFavorited?f.unFavoriteCourse(c,function(b){1==b&&a.$apply(function(){a.isFavorited=!1})}):f.favoriteCourse(c,function(b){1==b&&a.$apply(function(){a.isFavorited=!0})})};var h=this;this.payCourse=function(){c.getService("OrderService").payCourse({courseId:b.courseId,token:a.token},function(b){1==b.paid?window.location.reload():a.toast("加入学习失败!")},function(a){console.log(a)})},a.vipLeand=function(){return null==a.user?void e.go("login",{"goto":"/course/"+b.courseId}):void f.vipLearn({courseId:b.courseId,token:a.token},function(b){200==b.meta.code?window.location.reload():a.toast(b.meta.message)},function(a){console.log(a)})},a.joinCourse=function(){return null==a.user?void e.go("login",{"goto":"/course/"+b.courseId}):void(a.course.price<=0?h.payCourse():e.go("coursePay",{courseId:a.course.id}))},a.shardCourse=function(){return a.platform["native"]?void esNativeCore.share("","课程","关于",a.course.largePicture):void alert("请在客户端分享课程")},a.$parent.$on("refresh",function(a,b){window.location.reload()}),a.learnLesson=function(b){return a.member||1==b.free?"text"==b.type?void e.go("lesson",{courseId:b.courseId,lessonId:b.id}):a.platform["native"]?void esNativeCore.learnCourseLesson(b.courseId,b.id):void alert("请在客户端学习非图文课时"):void alert("请先加入学习")}}function CourseListController(a,b,c,d,e,f){function g(){a.canLoad=!0,a.start=0,a.courses=null}a.categoryTab={category:"分类",type:"全部分类",sort:"综合排序"},a.canLoad=!0,a.start=a.start||0,console.log("CourseListController"),a.loadMore=function(){a.canLoad&&setTimeout(function(){a.loadCourseList(b.sort)},200)},a.loadCourseList=function(c){a.showLoad(),e.searchCourse({limit:10,start:a.start,categoryId:b.categoryId,sort:c,type:b.type},function(b){a.hideLoad();var c=b?b.data.length:0;(!b||0==c||10>c)&&(a.canLoad=!1),a.courses=a.courses||[];for(var d=0;c>d;d++)a.courses.push(b.data[d]);a.start+=b.limit})},a.courseListSorts=d.getCourseListSorts(),a.courseListTypes=d.getCourseListTypes(),f.getCategorieTree(function(b){a.categoryTree=b}),a.selectType=function(c){a.$emit("closeTab",{}),a.categoryTab.type=c.name,g(),b.type=c.type,setTimeout(function(){a.loadCourseList(a.sort)},100)},a.selectSort=function(b){a.$emit("closeTab",{}),a.categoryTab.sort=b.name,a.sort=b.type,g(),setTimeout(function(){a.loadCourseList(b.type)},100)},a.onRefresh=function(){g(),a.loadCourseList(a.sort)},a.categorySelectedListener=function(c){a.$emit("closeTab",{}),a.categoryTab.category=c.name,g(),b.type=null,b.categoryId=c.id,a.loadCourseList(a.sort)},a.loadCourseList()}function CourseNoticeController(a,b,c){function d(d,e){b.getCourseNotices({start:a.start,limit:e,courseId:c.courseId},function(b){if(a.notices=a.notices||[],!b||0==b.length)return a.showLoadMore=!1,void a.toast("没有更多消息");for(var c=0;c<b.length;c++)a.notices.push(b[c]);a.start+=e})}var e=10;a.start=0,a.showLoadMore=!0,a.loadMore=function(){d(a.start,e)},d(a.start,e)}function FoundCourseController(a,b,c){console.log("FoundCourseController"),b.getSchoolBanner(function(b){a.banners=b}),b.getSchoolBanner(function(b){a.banners=b}),b.getRecommendCourses({limit:3},function(b){a.recommedCourses=b.data}),b.getLatestCourses({limit:3},function(b){a.latestCourses=b.data})}function FoundLiveController(a,b){console.log("FoundLiveController"),b.getLiveRecommendCourses({limit:3},function(b){a.liveRecommedCourses=b.data}),b.getLiveLatestCourses({limit:3},function(b){a.liveLatestCourses=b.data})}function FoundClassRoomController(a,b,c){console.log("FoundClassRoomController"),c.getSchoolBanner(function(b){a.banners=b}),b.getClassRooms({limit:3},function(b){a.classRooms=b.data})}function LessonController(a,b,c){var d=this;d.loadLesson=function(){c.getLesson({courseId:b.courseId,lessonId:b.lessonId},function(b){a.lesson=b,a.lessonView="view/lesson_"+b.type+".html"})},this.loadLesson()}function LoginController(a,b,c,d,e){console.log("LoginController"),a.user={username:null,password:null},a.jumpToMain=function(){c.go("slideView.mainTab")},a.login=function(c){a.showLoad(),b.login({_username:c.username,_password:c.password},function(b){return a.hideLoad(),b.error?void a.toast(b.error.message):void(d["goto"]?(e.history.back(),setTimeout(function(){a.$emit("refresh",{})},10)):a.jumpToMain())})}}function MainTabController(a,b,c){console.log("MainTabController")}function FoundTabController(a,b,c,d,e){console.log("FoundTabController"),a.toggleView=function(a){e.go("slideView.mainTab."+a)},a.toggle=function(){return a.platform["native"]?void window.esNativeCore.openDrawer("open"):void d.toggleMenu()},a.categorySelectedListener=function(a){e.go("courseList",{categoryId:a.id})},b.getCategorieTree(function(b){a.categoryTree=b,a.openModal=function(a){var b=$(".ui-dialog");b.dialog("show"),$(".ui-dialog-bg").click(function(a){b.dialog("hide")})}});var f=this;this.parseBannerAction=function(b){return this.courseAction=function(b){return a.platform["native"]?void esNativeCore.openWebView(app.rootPath+"#/course/"+b):void e.go("course",{courseId:b})},this.webviewAction=function(b){return a.platform["native"]?void esNativeCore.openWebView(b):void(window.location.href=b)},this.noneAction=function(){},this[b+"Action"]},a.bannerClick=function(a){var b=f.parseBannerAction(a.action);b(a.params)}}function MessageTabController(a){console.log("MessageTabController")}function ContactTabController(a){console.log("ContactTabController"),console.log(a)}function MyFavoriteController(a,b,c,d){console.log("MyFavoriteController");var e=this;a.data=c.getFavoriteListTypes(),this.loadDataList=function(c){var d=a.data[c];b.getFavoriteCourse(d.url,{limit:100,start:d.start,token:a.token},function(a){a&&0!=a.data.length||(d.canLoad=!1),d.data=d.data.concat(a.data),d.start+=a.limit,a.total&&d.start>=a.total&&(d.canLoad=!1)})},this.loadCourses=function(){e.loadDataList("course")},this.loadLiveCourses=function(){e.loadDataList("live")},this.loadCourses(),this.loadLiveCourses()}function MyGroupBaseController(a,b){var c=this;this.limit=10,a.data=[],a.canLoad=!0,a.start=a.start||0,this.loadDataList=function(d){b({limit:c.limit,start:a.start,type:d,token:a.token},function(b){var d=b?b.data.length:0;(!b||0==d||d<c.limit)&&(a.canLoad=!1),a.data=a.data.concat(b.data),a.start+=c.limit})}}function MyGroupNoteController(a,b){console.log("MyGroupNoteController");var c=this;this.__proto__=new MyGroupBaseController(a,b.getNoteList),a.canLoadMore=function(){return a.canLoad},a.loadMore=function(){c.loadDataList()},this.loadDataList()}function MyGroupQuestionController(a,b){console.log("MyGroupQuestionController"),this.__proto__=new MyGroupBaseController(a,b.getCourseThreads),a.canLoadMore=function(){return a.canLoad},a.loadMore=function(){self.loadDataList("question")},this.loadDataList("question")}function MyGroupThreadController(a,b){console.log("MyGroupThreadController"),this.__proto__=new MyGroupBaseController(a,b.getCourseThreads),a.canLoadMore=function(){return a.canLoad},a.loadMore=function(){self.loadDataList("discussion")},this.loadDataList("discussion")}function MyLearnController(a,b){var c=this;c.content={course:{start:0,canLoad:!0,data:[]},live:{start:0,canLoad:!0,data:[]}},a.course=c.content.course,a.live=c.content.live,c.loadDataList=function(b,c){c({limit:10,start:b.start,token:a.token},function(a){a&&0!=a.data.length||(b.canLoad=!1),b.data=b.data.concat(a.data),b.start+=a.limit,a.total&&b.start>=a.total&&(b.canLoad=!1)})},a.canLoadMore=function(a){return c.content[a].canLoad},a.loadMore=function(b){a.loadDataList(b)},a.loadCourses=function(){c.loadDataList(c.content.course,b.getLearningCourse)},a.loadLiveCourses=function(){c.loadDataList(c.content.live,b.getLiveCourses)},a.loadCourses(),a.loadLiveCourses()}function VipPayController(a,b,c,d){a.showLoad(),c.getVipPayInfo({levelId:b.levelId,token:a.token},function(b){a.hideLoad(),a.data=b,a.payModes=d.getPayMode(b.buyType),a.selectedNum=1,a.selectedPayMode=a.payModes[0],a.sumTotalPirce(),a.initPopver()}),a.sumTotalPirce=function(){var b=a.data.level,c=d.getPayType(),e=a.selectedPayMode.type==c.byMonth?b.monthPrice:b.yearPrice;a.totalPayPrice=a.selectedNum*e},a.add=function(){a.selectedNum<12&&(a.selectedNum++,a.sumTotalPirce())},a.sub=function(){a.selectedNum>1&&(a.selectedNum--,a.sumTotalPirce())},a.initPopver=function(){a.showPopover=function(b){a.isShowPayMode=!a.isShowPayMode},a.selectPayMode=function(b){a.selectedPayMode=b,a.sumTotalPirce(),a.isShowPayMode=!1}}}function VipListController(a,b,c){c.getSchoolVipList({userId:a.user.id},function(b){a.data=b})}function CourseCouponController(a,b,c,d){a.formData={code:""},a.checkCoupon=function(){a.formData.error="",a.showLoad(),b.checkCoupon({courseId:c.courseId,type:"course",code:a.formData.code},function(b){return a.hideLoad(),200!=b.meta.code?void(a.formData.error=b.meta.message):(d.history.back(),void a.$emit("coupon",{coupon:b.data}))},function(b){a.hideLoad(),a.toast("检验优惠码错误")})}}function CoursePayController(a,b,c,d){var e=this;c.getService("OrderService").getPayOrder({courseId:b.courseId,token:a.token},function(b){a.$apply(function(){a.data=b})}),a.$parent.$on("coupon",function(b,c){a.$apply(function(){a.coupon=c.coupon})}),a.selectCoupon=function(){e.dialog=$(".ui-dialog"),e.dialog.dialog("show")},a.pay=function(){c.getService("CourseService");c.getService("OrderService").payCourse({courseId:b.courseId,token:a.token},function(b){if("ok"==b.status&&""!=b.payUrl){if(!a.platform["native"])return void alert("请在客户端内支付!");esNativeCore.payCourse("支付课程",b.payUrl)}})},a.formData={code:""},a.checkCoupon=function(){a.formData.error="",a.showLoad(),c.getService("CouponService").checkCoupon({courseId:b.courseId,type:"course",code:a.formData.code},function(b){return a.hideLoad(),200!=b.meta.code?void(a.formData.error=b.meta.message):(a.$emit("coupon",{coupon:b.data}),void a.close())},function(b){a.hideLoad(),a.toast("检验优惠码错误")})},a.close=function(){e.dialog.dialog("hide")}}function QuestionController(a,b,c){var d=this;this.loadQuestion=function(){a.showLoad(),b.getThread({courseId:c.courseId,threadId:c.threadId,token:a.token},function(b){a.thread=b,a.hideLoad(),d.loadTeacherPost(),d.loadTheadPost()})},this.loadTeacherPost=function(){b.getThreadTeacherPost({courseId:c.courseId,threadId:c.threadId,token:a.token},function(b){a.teacherPosts=b})},this.loadTheadPost=function(){b.getThreadPost({courseId:c.courseId,threadId:c.threadId,token:a.token},function(b){a.threadPosts=b.data})},d.loadQuestion()}function NoteController(a,b,c){var d=this;this.loadNote=function(){a.showLoad(),b.getNote({noteId:c.noteId,token:a.token},function(b){a.note=b,a.hideLoad()})},d.loadNote()}function RegistController(a,b,c,d){console.log("RegistController"),a.user={phone:null,code:null,password:null},a.jumpToMain=function(){d.go("slideView.mainTab")},a.checkCode=function(a){return!a||0==a.length},a.sendSmsCode=function(b){return parseInt(b)?void c.smsSend({phoneNumber:b},function(b){a.toast(b.meta.message)}):void alert("手机格式不正确!")},a.registWithPhone=function(b){return parseInt(b.phone)?b.password&&(b.password.length<5||b.password.length>20)?void alert("密码格式不正确!"):a.checkCode(b.code)?void alert("验证码不正确!"):(a.showLoad(),void c.regist({phone:b.phone,smsCode:b.code,password:b.password},function(b){return console.log(b),500==b.meta.code?void a.toast(b.meta.message):(a.hideLoad(),void a.jumpToMain())},function(b){a.toast("注册失败")})):void alert("手机格式不正确!")},a.registWithEmail=function(b){return b.email?b.password&&(b.password.length<5||b.password.length>20)?void alert("密码格式不正确!"):(a.showLoad(),void c.regist({email:b.email,password:b.password},function(b){return 500==b.meta.code?void a.toast(b.meta.message):(a.hideLoad(),void a.jumpToMain())},function(b){a.toast("注册失败")})):void alert("邮箱格式不正确!")}}function SettingController(a,b,c){a.isShowLogoutBtn=a.user?!0:!1,a.logout=function(){a.showLoad(),b.logout({token:a},function(b){a.hideLoad(),c.go("slideView.mainTab.found")})}}function TeacherListController(a,b,c){b.getCourseTeachers({courseId:c.courseId},function(b){a.users=b})}function MyInfoController(a,b,c){b.get({url:app.host+"/mapi_v2/User/getUserInfo",params:{userId:a.user.id},success:function(b){a.userinfo=b},error:function(a){$ionicLoading.hide()}})}function UserInfoController(a,b,c,d){var e=this;a.isFollower=null,a.uiBarTransparent=!0,a.changeTabStatus=function(b,c){var d=b>c;d!=a.uiBarTransparent&&a.$apply(function(){a.uiBarTransparent=d})},this.isTeacher=function(a){return d.inArray("ROLE_TEACHER",a)>0},this.getUserLearnCourse=function(){b.getLearningCourseWithoutToken({userId:c.userId},function(b){a.courses=b.data})},this.getUserTeachCourse=function(){b.getUserTeachCourse({userId:c.userId},function(b){a.courses=b.data})},b.getUserInfo({userId:c.userId},function(d){return d?(a.userinfo=d,a.isTeacher=e.isTeacher(d.roles),a.isTeacher?e.getUserTeachCourse():e.getUserLearnCourse(),void(a.user&&b.searchUserIsFollowed({userId:a.user.id,toId:c.userId},function(b){a.isFollower=1==b?!0:!1}))):void a.toast("获取用户信息失败！")}),this.follow=function(){b.follow({token:a.token,toId:c.userId},function(b){b&&b.toId==c.userId&&(a.isFollower=!0)})},this.unfollow=function(){b.unfollow({token:a.token,toId:c.userId},function(b){b&&(a.isFollower=!1)})},a.changeFollowUser=function(){1==a.isFollower?e.unfollow():e.follow()}}var app=angular.module("EduSohoApp",["ngSanitize","ui.router","AppService","AppFactory","AppProvider","ngSideView","pasvaz.bindonce"]);app.viewFloder="/bundles/topxiamobilebundlev2/esmobile/",app.config(["$httpProvider",function(a){a.defaults.headers.put["Content-Type"]="application/x-www-form-urlencoded",a.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded",a.defaults.transformRequest=[function(a){var b=function(a){var c,d,e,f,g,h,i,j="";for(c in a)if(d=a[c],d instanceof Array)for(i=0;i<d.length;++i)g=d[i],e=c+"["+i+"]",h={},h[e]=g,j+=b(h)+"&";else if(d instanceof Object)for(f in d)g=d[f],e=c+"["+f+"]",h={},h[e]=g,j+=b(h)+"&";else void 0!==d&&null!==d&&(j+=encodeURIComponent(c)+"="+encodeURIComponent(d)+"&");return j.length?j.substr(0,j.length-1):j};return angular.isObject(a)&&"[object File]"!==String(a)?b(a):a}]}]),app.config(["$stateProvider","$urlRouterProvider",function(a,b){b.when("/","/index").otherwise("/"),a.state("slideView",{"abstract":!0,views:{rootView:{templateUrl:app.viewFloder+"view/main.html",controller:AppInitController}}}).state("slideView.mainTab",{url:"/index",views:{menuContent:{templateUrl:app.viewFloder+"view/main_content.html",controller:FoundTabController}}}).state("slideView.mainTab.found",{url:"/found",views:{"found-tab":{templateUrl:app.viewFloder+"view/found.html",controller:FoundTabController}}}).state("slideView.mainTab.found.course",{url:"/course",views:{"found-course":{templateUrl:app.viewFloder+"view/found_course.html",controller:FoundCourseController},"found-live":{templateUrl:app.viewFloder+"view/found_live.html",controller:FoundLiveController},"found-classroom":{templateUrl:app.viewFloder+"view/found_classroom.html",controller:FoundClassRoomController}}}),a.state("courseList",{url:"/courselist/:categoryId",views:{rootView:{templateUrl:app.viewFloder+"view/course_list.html",controller:CourseListController}}}).state("courseList.type",{url:"/type",views:{"courselist-content":{templateUrl:app.viewFloder+"view/courselist_type.html"}}}).state("courseList.sort",{url:"/sort",views:{"courselist-content":{templateUrl:app.viewFloder+"view/courselist_sort.html"}}}),a.state("login",{url:"/login/:goto",views:{rootView:{templateUrl:app.viewFloder+"view/login.html",controller:LoginController}}}).state("regist",{url:"/regist",views:{rootView:{templateUrl:app.viewFloder+"view/regist.html",controller:RegistController}}}),a.state("myinfo",{url:"/myinfo/:userId",views:{rootView:{templateUrl:app.viewFloder+"view/myinfo.html",controller:MyInfoController}}}),a.state("mylearn",{url:"/mylearn",views:{rootView:{templateUrl:app.viewFloder+"view/mylearn.html",controller:MyLearnController}}}),a.state("myfavorite",{url:"/myfavorite",views:{rootView:{templateUrl:app.viewFloder+"view/myfavorite.html",controller:MyFavoriteController}}}),a.state("mygroup",{url:"/mygroup",views:{rootView:{templateUrl:app.viewFloder+"view/mygroup.html"}}}).state("mygroup.question",{url:"/question",views:{"mygroup-question":{templateUrl:app.viewFloder+"view/mygroup_question.html",controller:MyGroupQuestionController}}}).state("mygroup.note",{url:"/note",views:{"mygroup-note":{templateUrl:app.viewFloder+"view/mygroup_note.html",controller:MyGroupNoteController}}}).state("mygroup.thread",{url:"/thread",views:{"mygroup-thread":{templateUrl:app.viewFloder+"view/mygroup_thread.html",controller:MyGroupQuestionController}}}),a.state("setting",{url:"/setting",views:{rootView:{templateUrl:app.viewFloder+"view/setting.html",controller:SettingController}}}),a.state("question",{url:"/question/:courseId/:threadId",views:{rootView:{templateUrl:app.viewFloder+"view/question.html",controller:QuestionController}}}),a.state("note",{url:"/note/:noteId/",views:{rootView:{templateUrl:app.viewFloder+"view/note.html",controller:NoteController}}}),a.state("course",{url:"/course/:courseId",views:{rootView:{templateUrl:app.viewFloder+"view/course.html",controller:CourseController}}}),a.state("courseDetail",{url:"/coursedetail/:courseId",views:{rootView:{templateUrl:app.viewFloder+"view/course_detail.html",controller:CourseDetailController}}}),a.state("teacherlist",{url:"/teacherlist/:courseId",views:{rootView:{templateUrl:app.viewFloder+"view/teacher_list.html",controller:TeacherListController}}}),a.state("coursePay",{url:"/coursepay/:courseId",views:{rootView:{templateUrl:app.viewFloder+"view/course_pay.html",controller:CoursePayController}}}),a.state("courseCoupon",{url:"/coursecoupon/:courseId",views:{rootView:{templateUrl:app.viewFloder+"view/coupon.html",controller:CourseCouponController}}}),a.state("viplist",{url:"/viplist",views:{rootView:{templateUrl:app.viewFloder+"view/vip_list.html",controller:VipListController}}}),a.state("courseSetting",{url:"/coursesetting/:courseId/:isLearn",views:{rootView:{templateUrl:app.viewFloder+"view/course_setting.html",controller:CourseSettingController}}}),a.state("vipPay",{url:"/vippay/:levelId",views:{rootView:{templateUrl:app.viewFloder+"view/vip_pay.html",controller:VipPayController}}}),a.state("courseNotice",{url:"/coursenotice/:courseId",views:{rootView:{templateUrl:app.viewFloder+"view/course_notice.html",controller:CourseNoticeController}}}),a.state("courseReview",{url:"/coursereview/:courseId",views:{rootView:{templateUrl:app.viewFloder+"view/course_review.html",controller:CourseReviewController}}}),a.state("userInfo",{url:"/userinfo/:userId",views:{rootView:{templateUrl:app.viewFloder+"view/user_info.html",controller:UserInfoController}}}),a.state("lesson",{url:"/lesson/:courseId/:lessonId",views:{rootView:{templateUrl:app.viewFloder+"view/lesson.html",controller:LessonController}}})}]),app.run(["applicationProvider","$rootScope","$timeout",function(a,b,c){b.platform=browser.v,b.showLoad=function(a){b.loadPop=$.loading({content:"加载中..."}),c(function(){b.loadPop&&b.loadPop.loading("hide")},5e3)},b.toast=function(a){var b=$.tips({content:a,stayTime:2e3,type:"info"});c(function(){b.loading("hide")},2e3)},b.hideLoad=function(){b.loadPop&&(b.loadPop.loading("hide"),b.loadPop=null)},app.host=window.location.origin,app.rootPath=window.location.origin+window.location.pathname,b.stateParams={},angular.$client={},a.init(app.host),FastClick.attach(document.body)}]);var browser={v:function(){var a=navigator.userAgent,b=navigator.platform;return{trident:a.indexOf("Trident")>-1,presto:a.indexOf("Presto")>-1,webKit:a.indexOf("AppleWebKit")>-1,gecko:a.indexOf("Gecko")>-1&&-1==a.indexOf("KHTML"),mobile:!!a.match(/AppleWebKit.*Mobile.*/),ios:!!a.match(/i[^;]+;( U;)? CPU.+Mac OS X/),android:a.indexOf("Android")>-1,iPhone:a.indexOf("iPhone")>-1,iPad:a.indexOf("iPad")>-1,weixin:a.indexOf("MicroMessenger")>-1,webApp:-1==a.indexOf("Safari"),UCB:"UCBrowser"==a.match(/UCBrowser/i),QQB:"MQQBrowser"==a.match(/MQQBrowser/i),win:b.indexOf("Win")>-1,mac:b.indexOf("Mac")>-1,"native":a.indexOf("kuozhi")>-1}}()};browser.v["native"]?document.addEventListener("deviceready",function(){angular.bootstrap(document,["EduSohoApp"])}):angular.element(document).ready(function(){angular.bootstrap(document,["EduSohoApp"])});var appService=angular.module("AppService",[]);appService.service("localStore",["$rootScope",function(a){this.save=function(a,b){localStorage.setItem(a,b)},this.remove=function(a){localStorage.removeItem(a)},this.get=function(a){return value=localStorage.getItem(a),value?value:null},this.clear=function(){localStorage.clear()}}]).service("CategoryService",["httpService",function(a){this.getCategorieTree=function(b){a.get({url:app.host+"/mapi_v2/Category/getCategorieTree",success:function(a,c,d,e){b(a)},error:function(a){}})}}]).service("LessonService",["httpService",function(a){this.getLesson=function(b){a.simpleGet("/mapi_v2/Lesson/getLesson",arguments)},this.getCourseLessons=function(b,c){a.get({url:app.host+"/mapi_v2/Lesson/getCourseLessons",params:b,success:function(a,b,d,e){c(a)},error:function(a){}})}}]).service("OrderService",["httpService",function(a){this.payCourse=function(b,c){a.simpleGet("/mapi_v2/Order/payCourse",arguments)},this.getPayOrder=function(){a.simpleGet("/mapi_v2/Order/getPayOrder",arguments)}}]).service("NoteService",["httpService",function(a){this.getNote=function(b,c){a.simpleGet("/mapi_v2/Course/getOneNote",arguments)},this.getNoteList=function(b,c){a.get({url:app.host+"/mapi_v2/Course/getNoteList",params:b,success:function(a,b,d,e){c(a)},error:function(a){}})}}]).service("CouponService",["httpService",function(a){this.checkCoupon=function(){a.simpleGet("/mapi_v2/Course/coupon",arguments)}}]).service("UserService",["httpService","applicationProvider",function(a,b){this.follow=function(b,c){a.simpleGet("/mapi_v2/User/follow",arguments)},this.unfollow=function(b,c){a.simpleGet("/mapi_v2/User/unfollow",arguments)},this.searchUserIsFollowed=function(b,c){a.simpleGet("/mapi_v2/User/searchUserIsFollowed",arguments)},this.getUserTeachCourse=function(b,c){a.simpleGet("/mapi_v2/Course/getUserTeachCourse",arguments)},this.getLearningCourseWithoutToken=function(b,c){a.simpleGet("/mapi_v2/Course/getLearningCourseWithoutToken",arguments)},this.getUserInfo=function(b,c){a.simpleGet("/mapi_v2/User/getUserInfo",arguments)},this.smsSend=function(b,c){a.post({url:app.host+"/mapi_v2/User/smsSend",params:b,success:function(a,b,d,e){c(a)},error:function(a){}})},this.getCourseTeachers=function(b,c){a.get({url:app.host+"/mapi_v2/User/getCourseTeachers",params:b,success:function(a,b,d,e){c(a)},error:function(a){}})},this.regist=function(c,d){a.post({url:app.host+"/mapi_v2/User/regist",params:c,success:function(a,c,e,f){d(a),a.data&&b.setUser(a.data.user,a.data.token)},error:function(a){}})},this.login=function(c,d){a.post({url:app.host+"/mapi_v2/User/login",params:c,success:function(a,c,e,f){d(a),a&&b.setUser(a.user,a.token)},error:function(a){}})},this.logout=function(c,d){a.post({url:app.host+"/mapi_v2/User/logout",params:c,success:function(a,c,e,f){d(a),b.clearUser()},error:function(a){}})}}]).service("ClassRoomService",["httpService",function(a){this.getClassRooms=function(b,c){a.get({url:app.host+"/mapi_v2/ClassRoom/getClassRooms",params:{limit:b.limit},success:function(a,b,d,e){c(a)},error:function(a){}})},this.myClassRooms=function(b,c){a.get({url:app.host+"/mapi_v2/ClassRoom/myClassRooms",params:b,success:function(a,b,d,e){c(a)},error:function(a){}})}}]).service("QuestionService",["httpService",function(a){this.getCourseThreads=function(b,c){a.get({url:app.host+"/mapi_v2/Course/getCourseThreads",params:b,success:function(a,b,d,e){c(a)},error:function(a){}})},this.getThread=function(b,c){a.get({url:app.host+"/mapi_v2/Course/getThread",params:b,success:function(a,b,d,e){c(a)},error:function(a){}})},this.getThreadTeacherPost=function(b,c){a.get({url:app.host+"/mapi_v2/Course/getThreadTeacherPost",params:b,success:function(a,b,d,e){c(a)},error:function(a){}})},this.getThreadPost=function(b,c){a.get({url:app.host+"/mapi_v2/Course/getThreadPost",params:b,success:function(a,b,d,e){c(a)},error:function(a){}})}}]).service("CourseService",["httpService",function(a){this.getCourseNotices=function(b,c){a.simpleGet("/mapi_v2/Course/getCourseNotices",arguments)},this.unLearnCourse=function(b,c){a.simpleGet("/mapi_v2/Course/unLearnCourse",arguments)},this.vipLearn=function(b,c){a.simpleGet("/mapi_v2/Course/vipLearn",arguments)},this.favoriteCourse=function(b,c){a.simpleGet("/mapi_v2/Course/favoriteCourse",arguments)},this.unFavoriteCourse=function(b,c){a.simpleGet("/mapi_v2/Course/unFavoriteCourse",arguments)},this.getCourseReviewInfo=function(b,c){a.simpleGet("/mapi_v2/Course/getCourseReviewInfo",arguments)},this.getReviews=function(b,c){a.get({url:app.host+"/mapi_v2/Course/getReviews",params:b,success:function(a,b,d,e){c(a)},error:function(a){}})},this.getLiveCourses=function(b,c){a.get({url:app.host+"/mapi_v2/Course/getLiveCourses",params:b,success:function(a,b,d,e){c(a)},error:function(a){}})},this.getLearningCourse=function(b,c){a.get({url:app.host+"/mapi_v2/Course/getLearningCourse",params:b,success:function(a,b,d,e){c(a)},error:function(a){}})},this.getFavoriteCourse=function(b,c,d){a.get({url:app.host+"/mapi_v2/"+b,params:c,success:function(a,b,c,e){d(a)},error:function(a){}})},this.getAllLiveCourses=function(b,c){a.get({url:app.host+"/mapi_v2/Course/getAllLiveCourses",params:b,success:function(a,b,d,e){c(a)},error:function(a){}})},this.searchCourse=function(b,c,d){a.get({url:app.host+"/mapi_v2/Course/searchCourse",params:{limit:b.limit,start:b.start,categoryId:b.categoryId,sort:b.sort,type:b.type},success:function(a,b,d,e){c(a)},error:function(a){d&&d(a)}})},this.getCourse=function(b,c){a.simpleGet("/mapi_v2/Course/getCourse",arguments)},this.getCourses=function(b,c,d){a.get({url:app.host+"/mapi_v2/Course/getCourses",params:{limit:b.limit,start:b.start,categoryId:b.categoryId,sort:b.sort},success:function(a,b,d,e){c(a)},error:function(a){d&&d(a)}})}}]).service("SchoolService",["httpService",function(a){this.getLiveLatestCourses=function(b,c){a.simpleGet("/mapi_v2/School/getLiveLatestCourses",arguments)},this.getLiveRecommendCourses=function(b,c){a.simpleGet("/mapi_v2/School/getLiveRecommendCourses",arguments)},this.getLatestCourses=function(b,c){a.simpleGet("/mapi_v2/School/getLatestCourses",arguments)},this.getVipPayInfo=function(b,c){a.simpleGet("/mapi_v2/School/getVipPayInfo",arguments)},this.getSchoolVipList=function(b,c){a.simpleGet("/mapi_v2/School/getSchoolVipList",arguments)},this.getSchoolPlugins=function(b,c){a.simpleGet("/mapi_v2/School/getSchoolPlugins",arguments)},this.getSchoolBanner=function(b){a.get({url:app.host+"/mapi_v2/School/getSchoolBanner",success:function(a,c,d,e){b(a)}})},this.getRecommendCourses=function(b,c){a.get({url:app.host+"/mapi_v2/School/getRecommendCourses",params:b,success:function(a,b,d,e){c(a)}})}}]).service("httpService",["$http","$rootScope",function(a,b){var c=this;this.getOptions=function(a,b,c,d){return{method:"get",url:app.host+a,params:b,success:function(a,b,d,e){c(a)},error:function(a){d&&d(a)}}},this.simpleGet=function(b){params=arguments[1][0],callback=arguments[1][1],errorCallback=arguments[1][2];var d=c.getOptions(b,params,callback,errorCallback),e=a(d).success(d.success);d.error?e.error(d.error):e.error(function(a){console.log(a)})},this.get=function(b){b.method="get";var c=a(b).success(b.success);b.error?c.error(b.error):c.error(function(a){console.log(a)})},this.post=function(b){b.method="post";var c=a(b).success(b.success);b.error?c.error(b.error):c.error(function(a){console.log(a)})}}]),Date.prototype.Format=function(a){var b={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};/(y+)/.test(a)&&(a=a.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length)));for(var c in b)new RegExp("("+c+")").test(a)&&(a=a.replace(RegExp.$1,1==RegExp.$1.length?b[c]:("00"+b[c]).substr((""+b[c]).length)));return a},app.filter("blockStr",["$rootScope",function(a){return function(a,b){return a?(a=a.replace(/<[^>]+>/g,""),b&&(a=a.substring(0,b)),a):""}}]).filter("array",["AppUtil",function(a){return function(b){return a.createArray(b)}}]).filter("coverIncludePath",function(){return function(a){return app.viewFloder+a}}).filter("formatPrice",["$rootScope",function(a){return function(a){return a?(a=parseFloat(a),parseFloat(a)<=0?"免费":"¥"+a.toFixed(2)):""}}]).filter("coverLearnProsser",["$rootScope",function(a){return function(a){var b=a.lessonNum,c=a.memberLearnedNum;return{width:c/b*100+"%"}}}]).filter("reviewProgress",function(){return function(a,b){return 0==b?"0%":(a/b*100).toFixed(0)+"%"}}).filter("formatChapterNumber",["$rootScope",function(a){return function(a){if("chapter"!=a.type&&"unit"!=a.type)return"";var b=a.number;return"第"+b+("chapter"==a.type?"章":"节")}}]).filter("coverLearnTime",["$rootScope",function(a){return function(a){if(!a)return"还没开始学习";var b=(new Date).getTime()-new Date(a).getTime(),c=parseInt(b/36e5-1);if(c>=72)c=new Date(a).Format("yyyy-MM-dd");else if(c>=24)c=parseInt(c/24)+"天前";else if(0==c){var d=parseInt(b/6e4);c=d>=60?"1小时前":d+"分钟前"}else c+="小时前";return c}}]).filter("coverDiscountTime",["$rootScope",function(a){return function(a){return new Date(new Date(a)-new Date).Format("d天h小时m分钟")}}]).filter("coverViewPath",["$rootScope",function(a){return function(a){return app.viewFloder+a}}]).filter("coverNoticeIcon",["$rootScope",function(a){return function(a){return app.viewFloder+"img/course_notice.png"}}]).filter("coverGender",["$rootScope",function(a){
return function(a){switch(a){case"male":return"男士";case"female":return"女士";default:return"保密"}}}]).filter("coverPic",["$rootScope",function(a){return function(a){return a?a:app.viewFloder+"img/course_default.jpg"}}]).filter("coverDiscount",["$rootScope",function(a){return function(a,b){if("free"==a)return"限免";var c=parseFloat(b);return c+"折"}}]).filter("coverAvatar",["$rootScope",function(a){return function(a){return a?a:app.viewFloder+"img/avatar.png"}}]);var appFactory=angular.module("AppFactory",[]);appFactory.factory("AppUtil",["$rootScope","$timeout",function(a,b){var c={createArray:function(a){for(var b=[],c=a-1;c>=0;c--)b.unshift(c);return b},coverCategoty:function(a){for(var b=[],c=a.length-1;c>=0;c--)b.unshift(a[c])},showPop:function(a,b){var c=$ionicPopup.confirm({title:a.title,template:a.template,okText:a.okText||"确定",cancelText:a.cancelText||"取消"});c.then(function(a){b(a)})},createDialog:function(a,b,c,d){var e=$.dialog({title:a,content:b,button:c||["确认"]});e.on("dialog:action",function(a){d(a.index),e.dialog("hide")})},inArray:function(a,b,c){var d,e=[],f=e.indexOf;if(b){if(f)return f.call(b,a,c);for(d=b.length,c=c?0>c?Math.max(0,d+c):c:0;d>c;c++)if(c in b&&b[c]===a)return c}return-1}};return c}]).factory("ServcieUtil",function(){return{getService:function(a){return angular.injector(["AppService","ng"]).get(a)}}}).factory("VipUtil",function(){var a={title:"按年支付",type:20},b={title:"按月支付",type:30};return{getPayType:function(){return{byYead:20,byMonth:30}},getPayMode:function(c){return 10==c?[a,b]:20==c?[a]:[b]}}}).factory("broadCast",["$rootScope",function(a){angular.broadQueue=[];var b={bind:function(a,b){angular.broadQueue[a]=b},send:function(a,b){callback=angular.broadQueue[a],callback(a,b)}};return b}]).factory("CourseUtil",["$rootScope","CourseService","ClassRoomService",function(a,b,c){return{getFavoriteListTypes:function(){return{course:{url:"Course/getFavoriteNormalCourse",data:[],start:0,canLoad:!0},live:{url:"Course/getFavoriteLiveCourse",data:[],start:0,canLoad:!0}}},getCourseListTypes:function(){return[{name:"课程",type:"normal"},{name:"班级",type:"classroom"},{name:"直播",type:"live"}]},getCourseListSorts:function(){return[{name:"最新",type:"latest"},{name:"最热",type:"popular"},{name:"推荐",type:"recommendedSeq"}]}}}]).factory("ImageUtil",["$rootScope",function(a){function b(){var a=window.screen.width;switch(window.orientation){case 0:a=window.screen.width;break;case 90:case-90:a=window.screen.height}return a=.96*a}function c(a,b){var c=a.height,d=a.width;a.width=b,a.height=b/d*c}function d(){for(var a=b(),d=angular.element(document.images),e=0;e<d.length;e++)c(d[e],a)}var e={zoom:function(){for(var a=new Array,e=angular.element(document.images),f=0;f<e.length;f++){var g=e[f];g.addEventListener("load",function(){var a=b();c(this,a)}),g.alt=f,a.push(g.src),g.addEventListener("click",function(){window.location="imageIndexNUrls://?"+this.alt+".partation."+a.join(".partation."),window.jsobj.showImages(this.alt,a)})}window.addEventListener("orientationchange",function(){d()},!1)}};return e}]);var appProvider=angular.module("AppProvider",[]);appProvider.provider("applicationProvider",function(){this.$get=function(a,b,c){var d={host:null,user:null,token:null};return d.setHost=function(a){this.host=a},d.init=function(e){if(d.setHost(e),b.platform["native"]){var f=esNativeCore.getUserToken(c);return void f.then(function(a){d.user=a.user,d.token=a.token,d.updateScope(b)})}d.user=angular.fromJson(a.get("user")),d.token=a.get("token"),d.updateScope(b)},d.clearUser=function(){this.user=null,this.token=null,b.user=null,b.token=null,a.remove("user"),a.remove("token"),b.platform["native"]&&esNativeCore.clearUserToken()},d.setUser=function(c,d){this.user=c,this.token=d,this.updateScope(b),a.save("user",angular.toJson(c)),a.save("token",d),b.platform["native"]&&(console.log(d),esNativeCore.saveUserToken(c,d))},d.updateScope=function(a){a.user=d.user,a.token=d.token},d}}),app.controller("AppInitController",["$scope","$state","sideDelegate","SchoolService",AppInitController]),app.controller("CourseController",["$scope","$stateParams","ServcieUtil","AppUtil","$state",CourseController]),app.controller("CourseDetailController",["$scope","$stateParams","CourseService",CourseDetailController]),app.controller("CourseSettingController",["$scope","$stateParams","CourseService","$window",CourseSettingController]),app.controller("CourseListController",["$scope","$stateParams","$state","CourseUtil","CourseService","CategoryService",CourseListController]),app.controller("CourseNoticeController",["$scope","CourseService","$stateParams",CourseNoticeController]),app.controller("FoundCourseController",["$scope","SchoolService","$state",FoundCourseController]),app.controller("FoundLiveController",["$scope","SchoolService",FoundLiveController]),app.controller("FoundClassRoomController",["$scope","$http",FoundClassRoomController]),app.controller("LessonController",["$scope","$stateParams","LessonService",LessonController]),app.controller("LoginController",["$scope","UserService","$state","$stateParams","$window",LoginController]),app.controller("FoundTabController",["$scope","CategoryService","AppUtil","sideDelegate","$state",FoundTabController]),app.controller("MessageTabController",["$scope",FoundTabController]),app.controller("ContactTabController",["$scope",ContactTabController]),app.controller("MyFavoriteController",["$scope","httpService","$timeout",MyFavoriteController]),app.controller("MyGroupQuestionController",["$scope","QuestionService",MyGroupQuestionController]),app.controller("MyGroupNoteController",["$scope","NoteService",MyGroupNoteController]),app.controller("MyGroupThreadController",["$scope","QuestionService",MyGroupThreadController]),app.controller("MyLearnController",["$scope","CourseService",MyLearnController]),app.controller("CoursePayController",["$scope","$stateParams","ServcieUtil","AppUtil",CoursePayController]),app.controller("CourseCouponController",["$scope","CouponService","$stateParams","$window",CourseCouponController]),app.controller("VipListController",["$scope","$stateParams","SchoolService",VipListController]),app.controller("VipPayController",["$scope","$stateParams","SchoolService","VipUtil",VipPayController]),app.controller("QuestionController",["$scope","QuestionService","$stateParams",QuestionController]),app.controller("NoteController",["$scope","NoteService","$stateParams",NoteController]),app.controller("RegistController",["$scope","$http","UserService","$state",RegistController]),app.controller("SettingController",["$scope","UserService","$state",SettingController]),app.controller("MyInfoController",["$scope","httpService","$stateParams",MyInfoController]),app.controller("TeacherListController",["$scope","UserService","$stateParams",TeacherListController]),app.controller("UserInfoController",["$scope","UserService","$stateParams","AppUtil",UserInfoController]);