{"version":3,"sources":["app/Resources/static-src/libs/js/fex-webuploader/webuploader.js"],"names":["root","factory","modules","_require","deps","callback","args","len","i","getModule","length","push","apply","_define","id","arguments","setModule","module","exports","returned","undefined","Error","exportsTo","obj","key","host","parts","part","last","ucFirst","str","charAt","toUpperCase","substr","hasOwnProperty","split","pop","shift","makeExport","dollar","__dollar","origin","define","amd","WebUploader","noConflict","window","require","$","jQuery","Zepto","_","Deferred","when","isPromise","anything","then","promise","noop","call","Function","uncurryThis","fn","bindFn","context","createObject","proto","f","Object","create","prototype","version","browser","ua","ret","webkit","match","chrome","ie","firefox","safari","opera","parseFloat","navigator","userAgent","os","android","ios","replace","inherits","Super","protos","staticProtos","child","constructor","extend","__super__","log","console","nextTick","cb","setTimeout","slice","guid","counter","prefix","Date","toString","Math","floor","random","formatSize","size","pointLength","units","unit","toFixed","Base","separator","findHandlers","arr","name","grep","handler","e","_cb","ctx","eachEvent","events","iterator","each","triggerHanders","stoped","ctx2","on","me","set","_events","once","off","trigger","type","allEvents","installTo","Mediator","Uploader","opts","options","_init","upload","stop","getFile","getFiles","addFile","addFiles","sort","removeFile","cancelFile","skipFile","retry","isInProgress","makeThumb","md5File","getDimension","addButton","predictRuntimeType","refresh","disable","enable","reset","command","request","state","option","val","isPlainObject","getStats","stats","successNum","numOfSuccess","progressNum","numOfProgress","cancelNum","numOfCancel","invalidNum","numOfInvalid","uploadFailNum","numOfUploadFailed","queueNum","numOfQueue","interruptNum","numofInterrupt","substring","isFunction","concat","destroy","factories","getFirstKey","Runtime","container","document","body","uid","getContainer","parent","_container","createElement","attr","css","position","top","left","width","height","overflow","append","addClass","_parent","init","exec","remove","removeClass","orders","addRuntime","hasRuntime","runtime","cache","add","get","ruid","standalone","__standalone","RuntimeClient","component","deferred","runtimeReady","done","connectRuntime","runtimeOrder","__promise","resolve","__client","getRuntime","disconnectRuntime","unshift","getRuid","RuntimeClent","DragAndDrop","accept","disableGlobalDnd","_destroy","IGNORE","widgetClass","isArrayLike","nodeType","Widget","uploader","owner","invoke","apiName","map","responseMap","widgets","_widgets","deactives","disableWidgets","klass","indexOf","_name","rlts","dfds","widget","rlt","pipe","register","widgetProto","toLowerCase","unRegister","splice","Dnd","dnd","files","items","FilePaste","paste","Blob","source","ext","start","end","getSource","rExt","File","file","RegExp","$1","lastModifiedDate","toLocaleString","FilePicker","innerHTML","label","html","button","multiple","_refer","_resizeHandler","shimContainer","outerWidth","outerHeight","pos","offset","bottom","right","btn","pick","pickers","addBtn","promises","picker","swf","Image","_info","_meta","quality","crop","preserveHeaders","allowMagnify","info","meta","loadFromBlob","blob","resize","getAsDataUrl","getAsBlob","throttle","max","occupied","waiting","tick","item","emiter","thumb","compress","image","reason","beforeSendFile","compressSize","noCompressIfLarger","_compressed","always","reject","idPrefix","idSuffix","statusMap","gid","WUFile","statusText","Status","INITED","loaded","msg","setStatus","ERROR","status","text","prevStatus","getStatus","QUEUED","PROGRESS","COMPLETE","CANCELLED","INTERRUPT","INVALID","STATUS","Queue","numofDeleted","_queue","_map","_fileAdded","prepend","fileId","fetch","sts","inArray","existing","cur","pre","_onFileStatusChange","curStatus","preStatus","extensions","join","queue","placeholder","_ruid","_wrapFile","acceptFile","invalid","test","_addFile","auto","fetchFile","noForceStart","sortFiles","support","Transport","_blob","_formData","formData","_headers","headers","_timeout","clearTimeout","_timer","server","method","withCredentials","fileVal","timeout","sendAsBinary","appendBlob","filename","value","setRequestHeader","send","abort","getResponse","getResponseAsJson","duration","prepareNextFile","chunked","chunkSize","chunkRetry","threads","CuteFile","pending","total","chunks","ceil","index","api","has","block","min","chunk","cuted","blocks","remaning","runing","progress","pool","stack","__tick","_tick","v","transport","_trigged","_promise","startUpload","stopUpload","interrupt","_putback","_popBlock","_tr","_getStats","skipped","_nextBlock","_startSend","idx","_getStack","act","next","preparing","_prepareNextFile","_finishFile","fail","_doSend","percentage","updateFileProgress","tr","data","requestAccept","_raw","flag","retried","hds","totalPercent","uploaded","validators","addValidator","removeValidator","count","parseInt","fileNumLimit","fileSizeLimit","fileSingleSizeLimit","mapping","duplicate","hashString","hash","_char","charCodeAt","__hash","Md5","getResult","md5","notify","CompBase","components","Html5Runtime","comp","client","instance","FileReader","DataView","webkitSlice","mozSlice","elem","dragEnterHandler","_dragEnterHandler","dragOverHandler","_dragOverHandler","dragLeaveHandler","_dragLeaveHandler","dropHandler","_dropHandler","dndOver","denied","_denied","originalEvent","dataTransfer","dropEffect","parentElem","contains","currentTarget","_leaveTimer","getData","err","_getTansferFiles","results","canAccessFolder","webkitGetAsEntry","isDirectory","_traverseDirectoryTree","entry","isFile","createReader","readEntries","entries","mimeTypes","hander","_pasteHander","allowed","clipboardData","kind","getAsFile","preventDefault","stopPropagation","input","mouseHandler","inputChange","opacity","display","cursor","background","clone","target","cloneNode","parentNode","replaceChild","urlAPI","createObjectURL","URL","revokeObjectURL","webkitURL","dataURL2Blob","dataURI","byteStr","intArray","ab","mimetype","atob","decodeURIComponent","ArrayBuffer","Uint8Array","arrayBufferToBlob","dataURL2ArrayBuffer","buffer","builder","BlobBuilder","WebKitBlobBuilder","bb","getBlob","canvasToDataUrl","canvas","toDataURL","parseMeta","updateImageHead","Util","parsers","maxMetaDataSize","parse","fr","onload","_parse","result","onerror","message","readAsArrayBuffer","noParse","byteLength","dataview","maxOffset","headLength","markerBytes","markerLength","getUint16","imageHead","subarray","head","buf1","buf2","bodyoffset","ImageMeta","EXIF","ExifMap","exifTagTypes","getValue","dataView","dataOffset","getUint8","String","fromCharCode","ascii","littleEndian","getUint32","getInt32","getExifValue","tiffOffset","tagType","tagSize","values","c","parseExifTag","tag","exif","parseExifTags","dirOffset","tagsNumber","dirEndOffset","parseExifData","JPEGEncoder","self","fround","round","ffloor","YTable","Array","UVTable","fdtbl_Y","fdtbl_UV","YDC_HT","UVDC_HT","YAC_HT","UVAC_HT","bitcode","category","outputfDCTQuant","DU","byteout","bytenew","bytepos","YDU","UDU","VDU","clt","RGB_YUV_TABLE","currentQuality","ZigZag","std_dc_luminance_nrcodes","std_dc_luminance_values","std_ac_luminance_nrcodes","std_ac_luminance_values","std_dc_chrominance_nrcodes","std_dc_chrominance_values","std_ac_chrominance_nrcodes","std_ac_chrominance_values","initQuantTables","sf","YQT","t","UVQT","j","u","aasf","k","row","col","computeHuffmanTbl","nrcodes","std_table","codevalue","pos_in_table","HT","initHuffmanTbl","initCategoryNumber","nrlower","nrupper","cat","nr","nrneg","initRGBYUVTable","writeBits","bs","posval","writeByte","writeWord","fDCTQuant","fdtbl","d0","d1","d2","d3","d4","d5","d6","d7","dataOff","I8","I64","tmp0","tmp7","tmp1","tmp6","tmp2","tmp5","tmp3","tmp4","tmp10","tmp13","tmp11","tmp12","z1","z5","z2","z4","z3","z11","z13","tmp0p2","tmp7p2","tmp1p2","tmp6p2","tmp2p2","tmp5p2","tmp3p2","tmp4p2","tmp10p2","tmp13p2","tmp11p2","tmp12p2","z1p2","z5p2","z2p2","z4p2","z3p2","z11p2","z13p2","writeAPP0","writeSOF0","writeDQT","writeDHT","l","m","n","o","p","writeSOS","processDU","CDU","DC","HTDC","HTAC","EOB","M16zeroes","I16","I63","DU_DCT","Diff","end0pos","lng","startpos","nrzeroes","nrmarker","initCharLookupTable","sfcc","encode","setQuality","DCY","DCU","DCV","displayName","imageData","quadWidth","tripleWidth","x","y","r","g","b","fillbits","jpegDataUri","btoa","encoder","supportJpeg","w","h","fragement","getContext","getImageData","BLANK","modified","img","_metas","error","_img","src","_canvas","_resize","s","cvs","iw","naturalWidth","ih","naturalHeight","orientation","getOrientation","_rotate2Orientaion","_renderImageToCanvas","clearRect","scale","translate","rotate","PI","drawImage","detectVerticalSquash","sy","ey","py","alpha","ratio","vertSquashRatio","detectSubsampling","subsampled","doSquash","d","dy","tmpCanvas","tmpCtx","dw","dh","sx","dx","save","restore","_status","_response","xhr","_initAjax","binary","param","FormData","open","_setRequestHeader","overrideMimeType","_parseJson","_xhr","onprogress","onreadystatechange","XMLHttpRequest","XDomainRequest","lengthComputable","readyState","responseText","json","JSON","ex","FlashRuntime","add32","a","cmn","q","ff","gg","hh","ii","md5cycle","md5blk","md5blks","md5blk_array","md51","tail","tmp","lo","hi","md51_array","hex_chr","rhex","hex","SparkMD5","lsw","msw","unescape","encodeURIComponent","appendBinary","contents","_buff","_length","_state","raw","buff","_finish","hashBinary","content","_concatArrayBuffer","first","second","firstLength","spark","blobSlice","loadNext","onloadend","getFlashVersion","plugins","description","ActiveXObject","GetVariable","ex2","clients","jsreciver","flashExec","evt","flash","getFlash","_flash","copy","title","_responseJson","url","forceURLStream","mimeType","percent","readBody","logUrl","product","location","hostname","base","dv","master","online","code","c_error_code","c_reason","c_count","c_size","c_usage","preset"],"mappings":"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","file":"webuploader.js","sourceRoot":"/Users/kz/projects/edusoho","sourcesContent":["\n/*! WebUploader 0.1.5 */\n\n\n/**\n * @fileOverview 让内部各个部件的代码可以用[amd](https://github.com/amdjs/amdjs-api/wiki/AMD)模块定义方式组织起来。\n *\n * AMD API 内部的简单不完全实现，请忽略。只有当WebUploader被合并成一个文件的时候才会引入。\n */\n /**\n  * rewrite malianbo@howzhi.com\n  * https://github.com/fex-team/webuploader 这里提供的实现，存在arguments.callee这样的代码，由于上述代码已被ES5废弃，Babel使用严格模式编译时会出错。\n  * 参见：https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Functions/arguments/callee\n  *\n  */\n(function( root, factory ) {\n    var modules = {},\n\n        // 内部require, 简单不完全实现。\n        // https://github.com/amdjs/amdjs-api/wiki/require\n        _require = function( deps, callback ) {\n            var args, len, i;\n\n            // 如果deps不是数组，则直接返回指定module\n            if ( typeof deps === 'string' ) {\n                return getModule( deps );\n            } else {\n                args = [];\n                for( len = deps.length, i = 0; i < len; i++ ) {\n                    args.push( getModule( deps[ i ] ) );\n                }\n\n                return callback.apply( null, args );\n            }\n        },\n\n        // 内部define，暂时不支持不指定id.\n        _define = function( id, deps, factory ) {\n            if ( arguments.length === 2 ) {\n                factory = deps;\n                deps = null;\n            }\n\n            _require( deps || [], function() {\n                setModule( id, factory, arguments );\n            });\n        },\n\n        // 设置module, 兼容CommonJs写法。\n        setModule = function( id, factory, args ) {\n            var module = {\n                    exports: factory\n                },\n                returned;\n\n            if ( typeof factory === 'function' ) {\n                args.length || (args = [ _require, module.exports, module ]);\n                returned = factory.apply( null, args );\n                returned !== undefined && (module.exports = returned);\n            }\n\n            modules[ id ] = module.exports;\n        },\n\n        // 根据id获取module\n        getModule = function( id ) {\n            var module = modules[ id ] || root[ id ];\n\n            if ( !module ) {\n                throw new Error( '`' + id + '` is undefined' );\n            }\n\n            return module;\n        },\n\n        // 将所有modules，将路径ids装换成对象。\n        exportsTo = function( obj ) {\n            var key, host, parts, part, last, ucFirst;\n\n            // make the first character upper case.\n            ucFirst = function( str ) {\n                return str && (str.charAt( 0 ).toUpperCase() + str.substr( 1 ));\n            };\n\n            for ( key in modules ) {\n                host = obj;\n\n                if ( !modules.hasOwnProperty( key ) ) {\n                    continue;\n                }\n\n                parts = key.split('/');\n                last = ucFirst( parts.pop() );\n\n                while( (part = ucFirst( parts.shift() )) ) {\n                    host[ part ] = host[ part ] || {};\n                    host = host[ part ];\n                }\n\n                host[ last ] = modules[ key ];\n            }\n\n            return obj;\n        },\n\n        makeExport = function( dollar ) {\n            root.__dollar = dollar;\n\n            // exports every module.\n            return exportsTo( factory( root, _define, _require ) );\n        },\n\n        origin;\n\n    if ( typeof module === 'object' && typeof module.exports === 'object' ) {\n\n        // For CommonJS and CommonJS-like environments where a proper window is present,\n        module.exports = makeExport();\n    } else if ( typeof define === 'function' && define.amd ) {\n\n        // Allow using this built library as an AMD module\n        // in another project. That other project will only\n        // see this AMD call, not the internal modules in\n        // the closure below.\n        define([ 'jquery' ], makeExport );\n    } else {\n\n        // Browser globals case. Just assign the\n        // result to a property on the global.\n        origin = root.WebUploader;\n        root.WebUploader = makeExport();\n        root.WebUploader.noConflict = function() {\n            root.WebUploader = origin;\n        };\n    }\n})( window, function( window, define, require ) {\n\n\n    /**\n     * @fileOverview jQuery or Zepto\n     */\n    define('dollar-third',[],function() {\n        var $ = window.__dollar || window.jQuery || window.Zepto;\n    \n        if ( !$ ) {\n            throw new Error('jQuery or Zepto not found!');\n        }\n    \n        return $;\n    });\n    /**\n     * @fileOverview Dom 操作相关\n     */\n    define('dollar',[\n        'dollar-third'\n    ], function( _ ) {\n        return _;\n    });\n    /**\n     * @fileOverview 使用jQuery的Promise\n     */\n    define('promise-third',[\n        'dollar'\n    ], function( $ ) {\n        return {\n            Deferred: $.Deferred,\n            when: $.when,\n    \n            isPromise: function( anything ) {\n                return anything && typeof anything.then === 'function';\n            }\n        };\n    });\n    /**\n     * @fileOverview Promise/A+\n     */\n    define('promise',[\n        'promise-third'\n    ], function( _ ) {\n        return _;\n    });\n    /**\n     * @fileOverview 基础类方法。\n     */\n    \n    /**\n     * Web Uploader内部类的详细说明，以下提及的功能类，都可以在`WebUploader`这个变量中访问到。\n     *\n     * As you know, Web Uploader的每个文件都是用过[AMD](https://github.com/amdjs/amdjs-api/wiki/AMD)规范中的`define`组织起来的, 每个Module都会有个module id.\n     * 默认module id为该文件的路径，而此路径将会转化成名字空间存放在WebUploader中。如：\n     *\n     * * module `base`：WebUploader.Base\n     * * module `file`: WebUploader.File\n     * * module `lib/dnd`: WebUploader.Lib.Dnd\n     * * module `runtime/html5/dnd`: WebUploader.Runtime.Html5.Dnd\n     *\n     *\n     * 以下文档中对类的使用可能省略掉了`WebUploader`前缀。\n     * @module WebUploader\n     * @title WebUploader API文档\n     */\n    define('base',[\n        'dollar',\n        'promise'\n    ], function( $, promise ) {\n    \n        var noop = function() {},\n            call = Function.call;\n    \n        // http://jsperf.com/uncurrythis\n        // 反科里化\n        function uncurryThis( fn ) {\n            return function() {\n                return call.apply( fn, arguments );\n            };\n        }\n    \n        function bindFn( fn, context ) {\n            return function() {\n                return fn.apply( context, arguments );\n            };\n        }\n    \n        function createObject( proto ) {\n            var f;\n    \n            if ( Object.create ) {\n                return Object.create( proto );\n            } else {\n                f = function() {};\n                f.prototype = proto;\n                return new f();\n            }\n        }\n    \n    \n        /**\n         * 基础类，提供一些简单常用的方法。\n         * @class Base\n         */\n        return {\n    \n            /**\n             * @property {String} version 当前版本号。\n             */\n            version: '0.1.5',\n    \n            /**\n             * @property {jQuery|Zepto} $ 引用依赖的jQuery或者Zepto对象。\n             */\n            $: $,\n    \n            Deferred: promise.Deferred,\n    \n            isPromise: promise.isPromise,\n    \n            when: promise.when,\n    \n            /**\n             * @description  简单的浏览器检查结果。\n             *\n             * * `webkit`  webkit版本号，如果浏览器为非webkit内核，此属性为`undefined`。\n             * * `chrome`  chrome浏览器版本号，如果浏览器为chrome，此属性为`undefined`。\n             * * `ie`  ie浏览器版本号，如果浏览器为非ie，此属性为`undefined`。**暂不支持ie10+**\n             * * `firefox`  firefox浏览器版本号，如果浏览器为非firefox，此属性为`undefined`。\n             * * `safari`  safari浏览器版本号，如果浏览器为非safari，此属性为`undefined`。\n             * * `opera`  opera浏览器版本号，如果浏览器为非opera，此属性为`undefined`。\n             *\n             * @property {Object} [browser]\n             */\n            browser: (function( ua ) {\n                var ret = {},\n                    webkit = ua.match( /WebKit\\/([\\d.]+)/ ),\n                    chrome = ua.match( /Chrome\\/([\\d.]+)/ ) ||\n                        ua.match( /CriOS\\/([\\d.]+)/ ),\n    \n                    ie = ua.match( /MSIE\\s([\\d\\.]+)/ ) ||\n                        ua.match( /(?:trident)(?:.*rv:([\\w.]+))?/i ),\n                    firefox = ua.match( /Firefox\\/([\\d.]+)/ ),\n                    safari = ua.match( /Safari\\/([\\d.]+)/ ),\n                    opera = ua.match( /OPR\\/([\\d.]+)/ );\n    \n                webkit && (ret.webkit = parseFloat( webkit[ 1 ] ));\n                chrome && (ret.chrome = parseFloat( chrome[ 1 ] ));\n                ie && (ret.ie = parseFloat( ie[ 1 ] ));\n                firefox && (ret.firefox = parseFloat( firefox[ 1 ] ));\n                safari && (ret.safari = parseFloat( safari[ 1 ] ));\n                opera && (ret.opera = parseFloat( opera[ 1 ] ));\n    \n                return ret;\n            })( navigator.userAgent ),\n    \n            /**\n             * @description  操作系统检查结果。\n             *\n             * * `android`  如果在android浏览器环境下，此值为对应的android版本号，否则为`undefined`。\n             * * `ios` 如果在ios浏览器环境下，此值为对应的ios版本号，否则为`undefined`。\n             * @property {Object} [os]\n             */\n            os: (function( ua ) {\n                var ret = {},\n    \n                    // osx = !!ua.match( /\\(Macintosh\\; Intel / ),\n                    android = ua.match( /(?:Android);?[\\s\\/]+([\\d.]+)?/ ),\n                    ios = ua.match( /(?:iPad|iPod|iPhone).*OS\\s([\\d_]+)/ );\n    \n                // osx && (ret.osx = true);\n                android && (ret.android = parseFloat( android[ 1 ] ));\n                ios && (ret.ios = parseFloat( ios[ 1 ].replace( /_/g, '.' ) ));\n    \n                return ret;\n            })( navigator.userAgent ),\n    \n            /**\n             * 实现类与类之间的继承。\n             * @method inherits\n             * @grammar Base.inherits( super ) => child\n             * @grammar Base.inherits( super, protos ) => child\n             * @grammar Base.inherits( super, protos, statics ) => child\n             * @param  {Class} super 父类\n             * @param  {Object | Function} [protos] 子类或者对象。如果对象中包含constructor，子类将是用此属性值。\n             * @param  {Function} [protos.constructor] 子类构造器，不指定的话将创建个临时的直接执行父类构造器的方法。\n             * @param  {Object} [statics] 静态属性或方法。\n             * @return {Class} 返回子类。\n             * @example\n             * function Person() {\n             *     console.log( 'Super' );\n             * }\n             * Person.prototype.hello = function() {\n             *     console.log( 'hello' );\n             * };\n             *\n             * var Manager = Base.inherits( Person, {\n             *     world: function() {\n             *         console.log( 'World' );\n             *     }\n             * });\n             *\n             * // 因为没有指定构造器，父类的构造器将会执行。\n             * var instance = new Manager();    // => Super\n             *\n             * // 继承子父类的方法\n             * instance.hello();    // => hello\n             * instance.world();    // => World\n             *\n             * // 子类的__super__属性指向父类\n             * console.log( Manager.__super__ === Person );    // => true\n             */\n            inherits: function( Super, protos, staticProtos ) {\n                var child;\n    \n                if ( typeof protos === 'function' ) {\n                    child = protos;\n                    protos = null;\n                } else if ( protos && protos.hasOwnProperty('constructor') ) {\n                    child = protos.constructor;\n                } else {\n                    child = function() {\n                        return Super.apply( this, arguments );\n                    };\n                }\n    \n                // 复制静态方法\n                $.extend( true, child, Super, staticProtos || {} );\n    \n                /* jshint camelcase: false */\n    \n                // 让子类的__super__属性指向父类。\n                child.__super__ = Super.prototype;\n    \n                // 构建原型，添加原型方法或属性。\n                // 暂时用Object.create实现。\n                child.prototype = createObject( Super.prototype );\n                protos && $.extend( true, child.prototype, protos );\n    \n                return child;\n            },\n    \n            /**\n             * 一个不做任何事情的方法。可以用来赋值给默认的callback.\n             * @method noop\n             */\n            noop: noop,\n    \n            /**\n             * 返回一个新的方法，此方法将已指定的`context`来执行。\n             * @grammar Base.bindFn( fn, context ) => Function\n             * @method bindFn\n             * @example\n             * var doSomething = function() {\n             *         console.log( this.name );\n             *     },\n             *     obj = {\n             *         name: 'Object Name'\n             *     },\n             *     aliasFn = Base.bind( doSomething, obj );\n             *\n             *  aliasFn();    // => Object Name\n             *\n             */\n            bindFn: bindFn,\n    \n            /**\n             * 引用Console.log如果存在的话，否则引用一个[空函数noop](#WebUploader:Base.noop)。\n             * @grammar Base.log( args... ) => undefined\n             * @method log\n             */\n            log: (function() {\n                if ( window.console ) {\n                    return bindFn( console.log, console );\n                }\n                return noop;\n            })(),\n    \n            nextTick: (function() {\n    \n                return function( cb ) {\n                    setTimeout( cb, 1 );\n                };\n    \n                // @bug 当浏览器不在当前窗口时就停了。\n                // var next = window.requestAnimationFrame ||\n                //     window.webkitRequestAnimationFrame ||\n                //     window.mozRequestAnimationFrame ||\n                //     function( cb ) {\n                //         window.setTimeout( cb, 1000 / 60 );\n                //     };\n    \n                // // fix: Uncaught TypeError: Illegal invocation\n                // return bindFn( next, window );\n            })(),\n    \n            /**\n             * 被[uncurrythis](http://www.2ality.com/2011/11/uncurrying-this.html)的数组slice方法。\n             * 将用来将非数组对象转化成数组对象。\n             * @grammar Base.slice( target, start[, end] ) => Array\n             * @method slice\n             * @example\n             * function doSomthing() {\n             *     var args = Base.slice( arguments, 1 );\n             *     console.log( args );\n             * }\n             *\n             * doSomthing( 'ignored', 'arg2', 'arg3' );    // => Array [\"arg2\", \"arg3\"]\n             */\n            slice: uncurryThis( [].slice ),\n    \n            /**\n             * 生成唯一的ID\n             * @method guid\n             * @grammar Base.guid() => String\n             * @grammar Base.guid( prefx ) => String\n             */\n            guid: (function() {\n                var counter = 0;\n    \n                return function( prefix ) {\n                    var guid = (+new Date()).toString( 32 ),\n                        i = 0;\n    \n                    for ( ; i < 5; i++ ) {\n                        guid += Math.floor( Math.random() * 65535 ).toString( 32 );\n                    }\n    \n                    return (prefix || 'wu_') + guid + (counter++).toString( 32 );\n                };\n            })(),\n    \n            /**\n             * 格式化文件大小, 输出成带单位的字符串\n             * @method formatSize\n             * @grammar Base.formatSize( size ) => String\n             * @grammar Base.formatSize( size, pointLength ) => String\n             * @grammar Base.formatSize( size, pointLength, units ) => String\n             * @param {Number} size 文件大小\n             * @param {Number} [pointLength=2] 精确到的小数点数。\n             * @param {Array} [units=[ 'B', 'K', 'M', 'G', 'TB' ]] 单位数组。从字节，到千字节，一直往上指定。如果单位数组里面只指定了到了K(千字节)，同时文件大小大于M, 此方法的输出将还是显示成多少K.\n             * @example\n             * console.log( Base.formatSize( 100 ) );    // => 100B\n             * console.log( Base.formatSize( 1024 ) );    // => 1.00K\n             * console.log( Base.formatSize( 1024, 0 ) );    // => 1K\n             * console.log( Base.formatSize( 1024 * 1024 ) );    // => 1.00M\n             * console.log( Base.formatSize( 1024 * 1024 * 1024 ) );    // => 1.00G\n             * console.log( Base.formatSize( 1024 * 1024 * 1024, 0, ['B', 'KB', 'MB'] ) );    // => 1024MB\n             */\n            formatSize: function( size, pointLength, units ) {\n                var unit;\n    \n                units = units || [ 'B', 'K', 'M', 'G', 'TB' ];\n    \n                while ( (unit = units.shift()) && size > 1024 ) {\n                    size = size / 1024;\n                }\n    \n                return (unit === 'B' ? size : size.toFixed( pointLength || 2 )) +\n                        unit;\n            }\n        };\n    });\n    /**\n     * 事件处理类，可以独立使用，也可以扩展给对象使用。\n     * @fileOverview Mediator\n     */\n    define('mediator',[\n        'base'\n    ], function( Base ) {\n        var $ = Base.$,\n            slice = [].slice,\n            separator = /\\s+/,\n            protos;\n    \n        // 根据条件过滤出事件handlers.\n        function findHandlers( arr, name, callback, context ) {\n            return $.grep( arr, function( handler ) {\n                return handler &&\n                        (!name || handler.e === name) &&\n                        (!callback || handler.cb === callback ||\n                        handler.cb._cb === callback) &&\n                        (!context || handler.ctx === context);\n            });\n        }\n    \n        function eachEvent( events, callback, iterator ) {\n            // 不支持对象，只支持多个event用空格隔开\n            $.each( (events || '').split( separator ), function( _, key ) {\n                iterator( key, callback );\n            });\n        }\n    \n        function triggerHanders( events, args ) {\n            var stoped = false,\n                i = -1,\n                len = events.length,\n                handler;\n    \n            while ( ++i < len ) {\n                handler = events[ i ];\n    \n                if ( handler.cb.apply( handler.ctx2, args ) === false ) {\n                    stoped = true;\n                    break;\n                }\n            }\n    \n            return !stoped;\n        }\n    \n        protos = {\n    \n            /**\n             * 绑定事件。\n             *\n             * `callback`方法在执行时，arguments将会来源于trigger的时候携带的参数。如\n             * ```javascript\n             * var obj = {};\n             *\n             * // 使得obj有事件行为\n             * Mediator.installTo( obj );\n             *\n             * obj.on( 'testa', function( arg1, arg2 ) {\n             *     console.log( arg1, arg2 ); // => 'arg1', 'arg2'\n             * });\n             *\n             * obj.trigger( 'testa', 'arg1', 'arg2' );\n             * ```\n             *\n             * 如果`callback`中，某一个方法`return false`了，则后续的其他`callback`都不会被执行到。\n             * 切会影响到`trigger`方法的返回值，为`false`。\n             *\n             * `on`还可以用来添加一个特殊事件`all`, 这样所有的事件触发都会响应到。同时此类`callback`中的arguments有一个不同处，\n             * 就是第一个参数为`type`，记录当前是什么事件在触发。此类`callback`的优先级比脚低，会再正常`callback`执行完后触发。\n             * ```javascript\n             * obj.on( 'all', function( type, arg1, arg2 ) {\n             *     console.log( type, arg1, arg2 ); // => 'testa', 'arg1', 'arg2'\n             * });\n             * ```\n             *\n             * @method on\n             * @grammar on( name, callback[, context] ) => self\n             * @param  {String}   name     事件名，支持多个事件用空格隔开\n             * @param  {Function} callback 事件处理器\n             * @param  {Object}   [context]  事件处理器的上下文。\n             * @return {self} 返回自身，方便链式\n             * @chainable\n             * @class Mediator\n             */\n            on: function( name, callback, context ) {\n                var me = this,\n                    set;\n    \n                if ( !callback ) {\n                    return this;\n                }\n    \n                set = this._events || (this._events = []);\n    \n                eachEvent( name, callback, function( name, callback ) {\n                    var handler = { e: name };\n    \n                    handler.cb = callback;\n                    handler.ctx = context;\n                    handler.ctx2 = context || me;\n                    handler.id = set.length;\n    \n                    set.push( handler );\n                });\n    \n                return this;\n            },\n    \n            /**\n             * 绑定事件，且当handler执行完后，自动解除绑定。\n             * @method once\n             * @grammar once( name, callback[, context] ) => self\n             * @param  {String}   name     事件名\n             * @param  {Function} callback 事件处理器\n             * @param  {Object}   [context]  事件处理器的上下文。\n             * @return {self} 返回自身，方便链式\n             * @chainable\n             */\n            once: function( name, callback, context ) {\n                var me = this;\n    \n                if ( !callback ) {\n                    return me;\n                }\n    \n                eachEvent( name, callback, function( name, callback ) {\n                    var once = function() {\n                            me.off( name, once );\n                            return callback.apply( context || me, arguments );\n                        };\n    \n                    once._cb = callback;\n                    me.on( name, once, context );\n                });\n    \n                return me;\n            },\n    \n            /**\n             * 解除事件绑定\n             * @method off\n             * @grammar off( [name[, callback[, context] ] ] ) => self\n             * @param  {String}   [name]     事件名\n             * @param  {Function} [callback] 事件处理器\n             * @param  {Object}   [context]  事件处理器的上下文。\n             * @return {self} 返回自身，方便链式\n             * @chainable\n             */\n            off: function( name, cb, ctx ) {\n                var events = this._events;\n    \n                if ( !events ) {\n                    return this;\n                }\n    \n                if ( !name && !cb && !ctx ) {\n                    this._events = [];\n                    return this;\n                }\n    \n                eachEvent( name, cb, function( name, cb ) {\n                    $.each( findHandlers( events, name, cb, ctx ), function() {\n                        delete events[ this.id ];\n                    });\n                });\n    \n                return this;\n            },\n    \n            /**\n             * 触发事件\n             * @method trigger\n             * @grammar trigger( name[, args...] ) => self\n             * @param  {String}   type     事件名\n             * @param  {*} [...] 任意参数\n             * @return {Boolean} 如果handler中return false了，则返回false, 否则返回true\n             */\n            trigger: function( type ) {\n                var args, events, allEvents;\n    \n                if ( !this._events || !type ) {\n                    return this;\n                }\n    \n                args = slice.call( arguments, 1 );\n                events = findHandlers( this._events, type );\n                allEvents = findHandlers( this._events, 'all' );\n    \n                return triggerHanders( events, args ) &&\n                        triggerHanders( allEvents, arguments );\n            }\n        };\n    \n        /**\n         * 中介者，它本身是个单例，但可以通过[installTo](#WebUploader:Mediator:installTo)方法，使任何对象具备事件行为。\n         * 主要目的是负责模块与模块之间的合作，降低耦合度。\n         *\n         * @class Mediator\n         */\n        return $.extend({\n    \n            /**\n             * 可以通过这个接口，使任何对象具备事件功能。\n             * @method installTo\n             * @param  {Object} obj 需要具备事件行为的对象。\n             * @return {Object} 返回obj.\n             */\n            installTo: function( obj ) {\n                return $.extend( obj, protos );\n            }\n    \n        }, protos );\n    });\n    /**\n     * @fileOverview Uploader上传类\n     */\n    define('uploader',[\n        'base',\n        'mediator'\n    ], function( Base, Mediator ) {\n    \n        var $ = Base.$;\n    \n        /**\n         * 上传入口类。\n         * @class Uploader\n         * @constructor\n         * @grammar new Uploader( opts ) => Uploader\n         * @example\n         * var uploader = WebUploader.Uploader({\n         *     swf: 'path_of_swf/Uploader.swf',\n         *\n         *     // 开起分片上传。\n         *     chunked: true\n         * });\n         */\n        function Uploader( opts ) {\n            this.options = $.extend( true, {}, Uploader.options, opts );\n            this._init( this.options );\n        }\n    \n        // default Options\n        // widgets中有相应扩展\n        Uploader.options = {};\n        Mediator.installTo( Uploader.prototype );\n    \n        // 批量添加纯命令式方法。\n        $.each({\n            upload: 'start-upload',\n            stop: 'stop-upload',\n            getFile: 'get-file',\n            getFiles: 'get-files',\n            addFile: 'add-file',\n            addFiles: 'add-file',\n            sort: 'sort-files',\n            removeFile: 'remove-file',\n            cancelFile: 'cancel-file',\n            skipFile: 'skip-file',\n            retry: 'retry',\n            isInProgress: 'is-in-progress',\n            makeThumb: 'make-thumb',\n            md5File: 'md5-file',\n            getDimension: 'get-dimension',\n            addButton: 'add-btn',\n            predictRuntimeType: 'predict-runtime-type',\n            refresh: 'refresh',\n            disable: 'disable',\n            enable: 'enable',\n            reset: 'reset'\n        }, function( fn, command ) {\n            Uploader.prototype[ fn ] = function() {\n                return this.request( command, arguments );\n            };\n        });\n    \n        $.extend( Uploader.prototype, {\n            state: 'pending',\n    \n            _init: function( opts ) {\n                var me = this;\n    \n                me.request( 'init', opts, function() {\n                    me.state = 'ready';\n                    me.trigger('ready');\n                });\n            },\n    \n            /**\n             * 获取或者设置Uploader配置项。\n             * @method option\n             * @grammar option( key ) => *\n             * @grammar option( key, val ) => self\n             * @example\n             *\n             * // 初始状态图片上传前不会压缩\n             * var uploader = new WebUploader.Uploader({\n             *     compress: null;\n             * });\n             *\n             * // 修改后图片上传前，尝试将图片压缩到1600 * 1600\n             * uploader.option( 'compress', {\n             *     width: 1600,\n             *     height: 1600\n             * });\n             */\n            option: function( key, val ) {\n                var opts = this.options;\n    \n                // setter\n                if ( arguments.length > 1 ) {\n    \n                    if ( $.isPlainObject( val ) &&\n                            $.isPlainObject( opts[ key ] ) ) {\n                        $.extend( opts[ key ], val );\n                    } else {\n                        opts[ key ] = val;\n                    }\n    \n                } else {    // getter\n                    return key ? opts[ key ] : opts;\n                }\n            },\n    \n            /**\n             * 获取文件统计信息。返回一个包含一下信息的对象。\n             * * `successNum` 上传成功的文件数\n             * * `progressNum` 上传中的文件数\n             * * `cancelNum` 被删除的文件数\n             * * `invalidNum` 无效的文件数\n             * * `uploadFailNum` 上传失败的文件数\n             * * `queueNum` 还在队列中的文件数\n             * * `interruptNum` 被暂停的文件数\n             * @method getStats\n             * @grammar getStats() => Object\n             */\n            getStats: function() {\n                // return this._mgr.getStats.apply( this._mgr, arguments );\n                var stats = this.request('get-stats');\n    \n                return stats ? {\n                    successNum: stats.numOfSuccess,\n                    progressNum: stats.numOfProgress,\n    \n                    // who care?\n                    // queueFailNum: 0,\n                    cancelNum: stats.numOfCancel,\n                    invalidNum: stats.numOfInvalid,\n                    uploadFailNum: stats.numOfUploadFailed,\n                    queueNum: stats.numOfQueue,\n                    interruptNum: stats.numofInterrupt\n                } : {};\n            },\n    \n            // 需要重写此方法来来支持opts.onEvent和instance.onEvent的处理器\n            trigger: function( type/*, args...*/ ) {\n                var args = [].slice.call( arguments, 1 ),\n                    opts = this.options,\n                    name = 'on' + type.substring( 0, 1 ).toUpperCase() +\n                        type.substring( 1 );\n    \n                if (\n                        // 调用通过on方法注册的handler.\n                        Mediator.trigger.apply( this, arguments ) === false ||\n    \n                        // 调用opts.onEvent\n                        $.isFunction( opts[ name ] ) &&\n                        opts[ name ].apply( this, args ) === false ||\n    \n                        // 调用this.onEvent\n                        $.isFunction( this[ name ] ) &&\n                        this[ name ].apply( this, args ) === false ||\n    \n                        // 广播所有uploader的事件。\n                        Mediator.trigger.apply( Mediator,\n                        [ this, type ].concat( args ) ) === false ) {\n    \n                    return false;\n                }\n    \n                return true;\n            },\n    \n            /**\n             * 销毁 webuploader 实例\n             * @method destroy\n             * @grammar destroy() => undefined\n             */\n            destroy: function() {\n                this.request( 'destroy', arguments );\n                this.off();\n            },\n    \n            // widgets/widget.js将补充此方法的详细文档。\n            request: Base.noop\n        });\n    \n        /**\n         * 创建Uploader实例，等同于new Uploader( opts );\n         * @method create\n         * @class Base\n         * @static\n         * @grammar Base.create( opts ) => Uploader\n         */\n        Base.create = Uploader.create = function( opts ) {\n            return new Uploader( opts );\n        };\n    \n        // 暴露Uploader，可以通过它来扩展业务逻辑。\n        Base.Uploader = Uploader;\n    \n        return Uploader;\n    });\n    /**\n     * @fileOverview Runtime管理器，负责Runtime的选择, 连接\n     */\n    define('runtime/runtime',[\n        'base',\n        'mediator'\n    ], function( Base, Mediator ) {\n    \n        var $ = Base.$,\n            factories = {},\n    \n            // 获取对象的第一个key\n            getFirstKey = function( obj ) {\n                for ( var key in obj ) {\n                    if ( obj.hasOwnProperty( key ) ) {\n                        return key;\n                    }\n                }\n                return null;\n            };\n    \n        // 接口类。\n        function Runtime( options ) {\n            this.options = $.extend({\n                container: document.body\n            }, options );\n            this.uid = Base.guid('rt_');\n        }\n    \n        $.extend( Runtime.prototype, {\n    \n            getContainer: function() {\n                var opts = this.options,\n                    parent, container;\n    \n                if ( this._container ) {\n                    return this._container;\n                }\n    \n                parent = $( opts.container || document.body );\n                container = $( document.createElement('div') );\n    \n                container.attr( 'id', 'rt_' + this.uid );\n                container.css({\n                    position: 'absolute',\n                    top: '0px',\n                    left: '0px',\n                    width: '100%',\n                    height: '100%',\n                    overflow: 'hidden'\n                });\n    \n                parent.append( container );\n                parent.addClass('webuploader-container');\n                this._container = container;\n                this._parent = parent;\n                return container;\n            },\n    \n            init: Base.noop,\n            exec: Base.noop,\n    \n            destroy: function() {\n                this._container && this._container.remove();\n                this._parent && this._parent.removeClass('webuploader-container');\n                this.off();\n            }\n        });\n    \n        Runtime.orders = 'html5,flash';\n    \n    \n        /**\n         * 添加Runtime实现。\n         * @param {String} type    类型\n         * @param {Runtime} factory 具体Runtime实现。\n         */\n        Runtime.addRuntime = function( type, factory ) {\n            factories[ type ] = factory;\n        };\n    \n        Runtime.hasRuntime = function( type ) {\n            return !!(type ? factories[ type ] : getFirstKey( factories ));\n        };\n    \n        Runtime.create = function( opts, orders ) {\n            var type, runtime;\n    \n            orders = orders || Runtime.orders;\n            $.each( orders.split( /\\s*,\\s*/g ), function() {\n                if ( factories[ this ] ) {\n                    type = this;\n                    return false;\n                }\n            });\n    \n            type = type || getFirstKey( factories );\n    \n            if ( !type ) {\n                throw new Error('Runtime Error');\n            }\n    \n            runtime = new factories[ type ]( opts );\n            return runtime;\n        };\n    \n        Mediator.installTo( Runtime.prototype );\n        return Runtime;\n    });\n    \n    /**\n     * @fileOverview Runtime管理器，负责Runtime的选择, 连接\n     */\n    define('runtime/client',[\n        'base',\n        'mediator',\n        'runtime/runtime'\n    ], function( Base, Mediator, Runtime ) {\n    \n        var cache;\n    \n        cache = (function() {\n            var obj = {};\n    \n            return {\n                add: function( runtime ) {\n                    obj[ runtime.uid ] = runtime;\n                },\n    \n                get: function( ruid, standalone ) {\n                    var i;\n    \n                    if ( ruid ) {\n                        return obj[ ruid ];\n                    }\n    \n                    for ( i in obj ) {\n                        // 有些类型不能重用，比如filepicker.\n                        if ( standalone && obj[ i ].__standalone ) {\n                            continue;\n                        }\n    \n                        return obj[ i ];\n                    }\n    \n                    return null;\n                },\n    \n                remove: function( runtime ) {\n                    delete obj[ runtime.uid ];\n                }\n            };\n        })();\n    \n        function RuntimeClient( component, standalone ) {\n            var deferred = Base.Deferred(),\n                runtime;\n    \n            this.uid = Base.guid('client_');\n    \n            // 允许runtime没有初始化之前，注册一些方法在初始化后执行。\n            this.runtimeReady = function( cb ) {\n                return deferred.done( cb );\n            };\n    \n            this.connectRuntime = function( opts, cb ) {\n    \n                // already connected.\n                if ( runtime ) {\n                    throw new Error('already connected!');\n                }\n    \n                deferred.done( cb );\n    \n                if ( typeof opts === 'string' && cache.get( opts ) ) {\n                    runtime = cache.get( opts );\n                }\n    \n                // 像filePicker只能独立存在，不能公用。\n                runtime = runtime || cache.get( null, standalone );\n    \n                // 需要创建\n                if ( !runtime ) {\n                    runtime = Runtime.create( opts, opts.runtimeOrder );\n                    runtime.__promise = deferred.promise();\n                    runtime.once( 'ready', deferred.resolve );\n                    runtime.init();\n                    cache.add( runtime );\n                    runtime.__client = 1;\n                } else {\n                    // 来自cache\n                    Base.$.extend( runtime.options, opts );\n                    runtime.__promise.then( deferred.resolve );\n                    runtime.__client++;\n                }\n    \n                standalone && (runtime.__standalone = standalone);\n                return runtime;\n            };\n    \n            this.getRuntime = function() {\n                return runtime;\n            };\n    \n            this.disconnectRuntime = function() {\n                if ( !runtime ) {\n                    return;\n                }\n    \n                runtime.__client--;\n    \n                if ( runtime.__client <= 0 ) {\n                    cache.remove( runtime );\n                    delete runtime.__promise;\n                    runtime.destroy();\n                }\n    \n                runtime = null;\n            };\n    \n            this.exec = function() {\n                if ( !runtime ) {\n                    return;\n                }\n    \n                var args = Base.slice( arguments );\n                component && args.unshift( component );\n    \n                return runtime.exec.apply( this, args );\n            };\n    \n            this.getRuid = function() {\n                return runtime && runtime.uid;\n            };\n    \n            this.destroy = (function( destroy ) {\n                return function() {\n                    destroy && destroy.apply( this, arguments );\n                    this.trigger('destroy');\n                    this.off();\n                    this.exec('destroy');\n                    this.disconnectRuntime();\n                };\n            })( this.destroy );\n        }\n    \n        Mediator.installTo( RuntimeClient.prototype );\n        return RuntimeClient;\n    });\n    /**\n     * @fileOverview 错误信息\n     */\n    define('lib/dnd',[\n        'base',\n        'mediator',\n        'runtime/client'\n    ], function( Base, Mediator, RuntimeClent ) {\n    \n        var $ = Base.$;\n    \n        function DragAndDrop( opts ) {\n            opts = this.options = $.extend({}, DragAndDrop.options, opts );\n    \n            opts.container = $( opts.container );\n    \n            if ( !opts.container.length ) {\n                return;\n            }\n    \n            RuntimeClent.call( this, 'DragAndDrop' );\n        }\n    \n        DragAndDrop.options = {\n            accept: null,\n            disableGlobalDnd: false\n        };\n    \n        Base.inherits( RuntimeClent, {\n            constructor: DragAndDrop,\n    \n            init: function() {\n                var me = this;\n    \n                me.connectRuntime( me.options, function() {\n                    me.exec('init');\n                    me.trigger('ready');\n                });\n            }\n        });\n    \n        Mediator.installTo( DragAndDrop.prototype );\n    \n        return DragAndDrop;\n    });\n    /**\n     * @fileOverview 组件基类。\n     */\n    define('widgets/widget',[\n        'base',\n        'uploader'\n    ], function( Base, Uploader ) {\n    \n        var $ = Base.$,\n            _init = Uploader.prototype._init,\n            _destroy = Uploader.prototype.destroy,\n            IGNORE = {},\n            widgetClass = [];\n    \n        function isArrayLike( obj ) {\n            if ( !obj ) {\n                return false;\n            }\n    \n            var length = obj.length,\n                type = $.type( obj );\n    \n            if ( obj.nodeType === 1 && length ) {\n                return true;\n            }\n    \n            return type === 'array' || type !== 'function' && type !== 'string' &&\n                    (length === 0 || typeof length === 'number' && length > 0 &&\n                    (length - 1) in obj);\n        }\n    \n        function Widget( uploader ) {\n            this.owner = uploader;\n            this.options = uploader.options;\n        }\n    \n        $.extend( Widget.prototype, {\n    \n            init: Base.noop,\n    \n            // 类Backbone的事件监听声明，监听uploader实例上的事件\n            // widget直接无法监听事件，事件只能通过uploader来传递\n            invoke: function( apiName, args ) {\n    \n                /*\n                    {\n                        'make-thumb': 'makeThumb'\n                    }\n                 */\n                var map = this.responseMap;\n    \n                // 如果无API响应声明则忽略\n                if ( !map || !(apiName in map) || !(map[ apiName ] in this) ||\n                        !$.isFunction( this[ map[ apiName ] ] ) ) {\n    \n                    return IGNORE;\n                }\n    \n                return this[ map[ apiName ] ].apply( this, args );\n    \n            },\n    \n            /**\n             * 发送命令。当传入`callback`或者`handler`中返回`promise`时。返回一个当所有`handler`中的promise都完成后完成的新`promise`。\n             * @method request\n             * @grammar request( command, args ) => * | Promise\n             * @grammar request( command, args, callback ) => Promise\n             * @for  Uploader\n             */\n            request: function() {\n                return this.owner.request.apply( this.owner, arguments );\n            }\n        });\n    \n        // 扩展Uploader.\n        $.extend( Uploader.prototype, {\n    \n            /**\n             * @property {String | Array} [disableWidgets=undefined]\n             * @namespace options\n             * @for Uploader\n             * @description 默认所有 Uploader.register 了的 widget 都会被加载，如果禁用某一部分，请通过此 option 指定黑名单。\n             */\n    \n            // 覆写_init用来初始化widgets\n            _init: function() {\n                var me = this,\n                    widgets = me._widgets = [],\n                    deactives = me.options.disableWidgets || '';\n    \n                $.each( widgetClass, function( _, klass ) {\n                    (!deactives || !~deactives.indexOf( klass._name )) &&\n                        widgets.push( new klass( me ) );\n                });\n    \n                return _init.apply( me, arguments );\n            },\n    \n            request: function( apiName, args, callback ) {\n                var i = 0,\n                    widgets = this._widgets,\n                    len = widgets && widgets.length,\n                    rlts = [],\n                    dfds = [],\n                    widget, rlt, promise, key;\n    \n                args = isArrayLike( args ) ? args : [ args ];\n    \n                for ( ; i < len; i++ ) {\n                    widget = widgets[ i ];\n                    rlt = widget.invoke( apiName, args );\n    \n                    if ( rlt !== IGNORE ) {\n    \n                        // Deferred对象\n                        if ( Base.isPromise( rlt ) ) {\n                            dfds.push( rlt );\n                        } else {\n                            rlts.push( rlt );\n                        }\n                    }\n                }\n    \n                // 如果有callback，则用异步方式。\n                if ( callback || dfds.length ) {\n                    promise = Base.when.apply( Base, dfds );\n                    key = promise.pipe ? 'pipe' : 'then';\n    \n                    // 很重要不能删除。删除了会死循环。\n                    // 保证执行顺序。让callback总是在下一个 tick 中执行。\n                    return promise[ key ](function() {\n                                var deferred = Base.Deferred(),\n                                    args = arguments;\n    \n                                if ( args.length === 1 ) {\n                                    args = args[ 0 ];\n                                }\n    \n                                setTimeout(function() {\n                                    deferred.resolve( args );\n                                }, 1 );\n    \n                                return deferred.promise();\n                            })[ callback ? key : 'done' ]( callback || Base.noop );\n                } else {\n                    return rlts[ 0 ];\n                }\n            },\n    \n            destroy: function() {\n                _destroy.apply( this, arguments );\n                this._widgets = null;\n            }\n        });\n    \n        /**\n         * 添加组件\n         * @grammar Uploader.register(proto);\n         * @grammar Uploader.register(map, proto);\n         * @param  {object} responseMap API 名称与函数实现的映射\n         * @param  {object} proto 组件原型，构造函数通过 constructor 属性定义\n         * @method Uploader.register\n         * @for Uploader\n         * @example\n         * Uploader.register({\n         *     'make-thumb': 'makeThumb'\n         * }, {\n         *     init: function( options ) {},\n         *     makeThumb: function() {}\n         * });\n         *\n         * Uploader.register({\n         *     'make-thumb': function() {\n         *         \n         *     }\n         * });\n         */\n        Uploader.register = Widget.register = function( responseMap, widgetProto ) {\n            var map = { init: 'init', destroy: 'destroy', name: 'anonymous' },\n                klass;\n    \n            if ( arguments.length === 1 ) {\n                widgetProto = responseMap;\n    \n                // 自动生成 map 表。\n                $.each(widgetProto, function(key) {\n                    if ( key[0] === '_' || key === 'name' ) {\n                        key === 'name' && (map.name = widgetProto.name);\n                        return;\n                    }\n    \n                    map[key.replace(/[A-Z]/g, '-$&').toLowerCase()] = key;\n                });\n    \n            } else {\n                map = $.extend( map, responseMap );\n            }\n    \n            widgetProto.responseMap = map;\n            klass = Base.inherits( Widget, widgetProto );\n            klass._name = map.name;\n            widgetClass.push( klass );\n    \n            return klass;\n        };\n    \n        /**\n         * 删除插件，只有在注册时指定了名字的才能被删除。\n         * @grammar Uploader.unRegister(name);\n         * @param  {string} name 组件名字\n         * @method Uploader.unRegister\n         * @for Uploader\n         * @example\n         *\n         * Uploader.register({\n         *     name: 'custom',\n         *     \n         *     'make-thumb': function() {\n         *         \n         *     }\n         * });\n         *\n         * Uploader.unRegister('custom');\n         */\n        Uploader.unRegister = Widget.unRegister = function( name ) {\n            if ( !name || name === 'anonymous' ) {\n                return;\n            }\n            \n            // 删除指定的插件。\n            for ( var i = widgetClass.length; i--; ) {\n                if ( widgetClass[i]._name === name ) {\n                    widgetClass.splice(i, 1)\n                }\n            }\n        };\n    \n        return Widget;\n    });\n    /**\n     * @fileOverview DragAndDrop Widget。\n     */\n    define('widgets/filednd',[\n        'base',\n        'uploader',\n        'lib/dnd',\n        'widgets/widget'\n    ], function( Base, Uploader, Dnd ) {\n        var $ = Base.$;\n    \n        Uploader.options.dnd = '';\n    \n        /**\n         * @property {Selector} [dnd=undefined]  指定Drag And Drop拖拽的容器，如果不指定，则不启动。\n         * @namespace options\n         * @for Uploader\n         */\n        \n        /**\n         * @property {Selector} [disableGlobalDnd=false]  是否禁掉整个页面的拖拽功能，如果不禁用，图片拖进来的时候会默认被浏览器打开。\n         * @namespace options\n         * @for Uploader\n         */\n    \n        /**\n         * @event dndAccept\n         * @param {DataTransferItemList} items DataTransferItem\n         * @description 阻止此事件可以拒绝某些类型的文件拖入进来。目前只有 chrome 提供这样的 API，且只能通过 mime-type 验证。\n         * @for  Uploader\n         */\n        return Uploader.register({\n            name: 'dnd',\n            \n            init: function( opts ) {\n    \n                if ( !opts.dnd ||\n                        this.request('predict-runtime-type') !== 'html5' ) {\n                    return;\n                }\n    \n                var me = this,\n                    deferred = Base.Deferred(),\n                    options = $.extend({}, {\n                        disableGlobalDnd: opts.disableGlobalDnd,\n                        container: opts.dnd,\n                        accept: opts.accept\n                    }),\n                    dnd;\n    \n                this.dnd = dnd = new Dnd( options );\n    \n                dnd.once( 'ready', deferred.resolve );\n                dnd.on( 'drop', function( files ) {\n                    me.request( 'add-file', [ files ]);\n                });\n    \n                // 检测文件是否全部允许添加。\n                dnd.on( 'accept', function( items ) {\n                    return me.owner.trigger( 'dndAccept', items );\n                });\n    \n                dnd.init();\n    \n                return deferred.promise();\n            },\n    \n            destroy: function() {\n                this.dnd && this.dnd.destroy();\n            }\n        });\n    });\n    \n    /**\n     * @fileOverview 错误信息\n     */\n    define('lib/filepaste',[\n        'base',\n        'mediator',\n        'runtime/client'\n    ], function( Base, Mediator, RuntimeClent ) {\n    \n        var $ = Base.$;\n    \n        function FilePaste( opts ) {\n            opts = this.options = $.extend({}, opts );\n            opts.container = $( opts.container || document.body );\n            RuntimeClent.call( this, 'FilePaste' );\n        }\n    \n        Base.inherits( RuntimeClent, {\n            constructor: FilePaste,\n    \n            init: function() {\n                var me = this;\n    \n                me.connectRuntime( me.options, function() {\n                    me.exec('init');\n                    me.trigger('ready');\n                });\n            }\n        });\n    \n        Mediator.installTo( FilePaste.prototype );\n    \n        return FilePaste;\n    });\n    /**\n     * @fileOverview 组件基类。\n     */\n    define('widgets/filepaste',[\n        'base',\n        'uploader',\n        'lib/filepaste',\n        'widgets/widget'\n    ], function( Base, Uploader, FilePaste ) {\n        var $ = Base.$;\n    \n        /**\n         * @property {Selector} [paste=undefined]  指定监听paste事件的容器，如果不指定，不启用此功能。此功能为通过粘贴来添加截屏的图片。建议设置为`document.body`.\n         * @namespace options\n         * @for Uploader\n         */\n        return Uploader.register({\n            name: 'paste',\n            \n            init: function( opts ) {\n    \n                if ( !opts.paste ||\n                        this.request('predict-runtime-type') !== 'html5' ) {\n                    return;\n                }\n    \n                var me = this,\n                    deferred = Base.Deferred(),\n                    options = $.extend({}, {\n                        container: opts.paste,\n                        accept: opts.accept\n                    }),\n                    paste;\n    \n                this.paste = paste = new FilePaste( options );\n    \n                paste.once( 'ready', deferred.resolve );\n                paste.on( 'paste', function( files ) {\n                    me.owner.request( 'add-file', [ files ]);\n                });\n                paste.init();\n    \n                return deferred.promise();\n            },\n    \n            destroy: function() {\n                this.paste && this.paste.destroy();\n            }\n        });\n    });\n    /**\n     * @fileOverview Blob\n     */\n    define('lib/blob',[\n        'base',\n        'runtime/client'\n    ], function( Base, RuntimeClient ) {\n    \n        function Blob( ruid, source ) {\n            var me = this;\n    \n            me.source = source;\n            me.ruid = ruid;\n            this.size = source.size || 0;\n    \n            // 如果没有指定 mimetype, 但是知道文件后缀。\n            if ( !source.type && this.ext &&\n                    ~'jpg,jpeg,png,gif,bmp'.indexOf( this.ext ) ) {\n                this.type = 'image/' + (this.ext === 'jpg' ? 'jpeg' : this.ext);\n            } else {\n                this.type = source.type || 'application/octet-stream';\n            }\n    \n            RuntimeClient.call( me, 'Blob' );\n            this.uid = source.uid || this.uid;\n    \n            if ( ruid ) {\n                me.connectRuntime( ruid );\n            }\n        }\n    \n        Base.inherits( RuntimeClient, {\n            constructor: Blob,\n    \n            slice: function( start, end ) {\n                return this.exec( 'slice', start, end );\n            },\n    \n            getSource: function() {\n                return this.source;\n            }\n        });\n    \n        return Blob;\n    });\n    /**\n     * 为了统一化Flash的File和HTML5的File而存在。\n     * 以至于要调用Flash里面的File，也可以像调用HTML5版本的File一下。\n     * @fileOverview File\n     */\n    define('lib/file',[\n        'base',\n        'lib/blob'\n    ], function( Base, Blob ) {\n    \n        var uid = 1,\n            rExt = /\\.([^.]+)$/;\n    \n        function File( ruid, file ) {\n            var ext;\n    \n            this.name = file.name || ('untitled' + uid++);\n            ext = rExt.exec( file.name ) ? RegExp.$1.toLowerCase() : '';\n    \n            // todo 支持其他类型文件的转换。\n            // 如果有 mimetype, 但是文件名里面没有找出后缀规律\n            if ( !ext && file.type ) {\n                ext = /\\/(jpg|jpeg|png|gif|bmp)$/i.exec( file.type ) ?\n                        RegExp.$1.toLowerCase() : '';\n                this.name += '.' + ext;\n            }\n    \n            this.ext = ext;\n            this.lastModifiedDate = file.lastModifiedDate ||\n                    (new Date()).toLocaleString();\n    \n            Blob.apply( this, arguments );\n        }\n    \n        return Base.inherits( Blob, File );\n    });\n    \n    /**\n     * @fileOverview 错误信息\n     */\n    define('lib/filepicker',[\n        'base',\n        'runtime/client',\n        'lib/file'\n    ], function( Base, RuntimeClent, File ) {\n    \n        var $ = Base.$;\n    \n        function FilePicker( opts ) {\n            opts = this.options = $.extend({}, FilePicker.options, opts );\n    \n            opts.container = $( opts.id );\n    \n            if ( !opts.container.length ) {\n                throw new Error('按钮指定错误');\n            }\n    \n            opts.innerHTML = opts.innerHTML || opts.label ||\n                    opts.container.html() || '';\n    \n            opts.button = $( opts.button || document.createElement('div') );\n            opts.button.html( opts.innerHTML );\n            opts.container.html( opts.button );\n    \n            RuntimeClent.call( this, 'FilePicker', true );\n        }\n    \n        FilePicker.options = {\n            button: null,\n            container: null,\n            label: null,\n            innerHTML: null,\n            multiple: true,\n            accept: null,\n            name: 'file'\n        };\n    \n        Base.inherits( RuntimeClent, {\n            constructor: FilePicker,\n    \n            init: function() {\n                var me = this,\n                    opts = me.options,\n                    button = opts.button;\n    \n                button.addClass('webuploader-pick');\n    \n                me.on( 'all', function( type ) {\n                    var files;\n    \n                    switch ( type ) {\n                        case 'mouseenter':\n                            button.addClass('webuploader-pick-hover');\n                            break;\n    \n                        case 'mouseleave':\n                            button.removeClass('webuploader-pick-hover');\n                            break;\n    \n                        case 'change':\n                            files = me.exec('getFiles');\n                            me.trigger( 'select', $.map( files, function( file ) {\n                                file = new File( me.getRuid(), file );\n    \n                                // 记录来源。\n                                file._refer = opts.container;\n                                return file;\n                            }), opts.container );\n                            break;\n                    }\n                });\n    \n                me.connectRuntime( opts, function() {\n                    me.refresh();\n                    me.exec( 'init', opts );\n                    me.trigger('ready');\n                });\n    \n                this._resizeHandler = Base.bindFn( this.refresh, this );\n                $( window ).on( 'resize', this._resizeHandler );\n            },\n    \n            refresh: function() {\n                var shimContainer = this.getRuntime().getContainer(),\n                    button = this.options.button,\n                    width = button.outerWidth ?\n                            button.outerWidth() : button.width(),\n    \n                    height = button.outerHeight ?\n                            button.outerHeight() : button.height(),\n    \n                    pos = button.offset();\n    \n                width && height && shimContainer.css({\n                    bottom: 'auto',\n                    right: 'auto',\n                    width: width + 'px',\n                    height: height + 'px'\n                }).offset( pos );\n            },\n    \n            enable: function() {\n                var btn = this.options.button;\n    \n                btn.removeClass('webuploader-pick-disable');\n                this.refresh();\n            },\n    \n            disable: function() {\n                var btn = this.options.button;\n    \n                this.getRuntime().getContainer().css({\n                    top: '-99999px'\n                });\n    \n                btn.addClass('webuploader-pick-disable');\n            },\n    \n            destroy: function() {\n                var btn = this.options.button;\n                $( window ).off( 'resize', this._resizeHandler );\n                btn.removeClass('webuploader-pick-disable webuploader-pick-hover ' +\n                    'webuploader-pick');\n            }\n        });\n    \n        return FilePicker;\n    });\n    \n    /**\n     * @fileOverview 文件选择相关\n     */\n    define('widgets/filepicker',[\n        'base',\n        'uploader',\n        'lib/filepicker',\n        'widgets/widget'\n    ], function( Base, Uploader, FilePicker ) {\n        var $ = Base.$;\n    \n        $.extend( Uploader.options, {\n    \n            /**\n             * @property {Selector | Object} [pick=undefined]\n             * @namespace options\n             * @for Uploader\n             * @description 指定选择文件的按钮容器，不指定则不创建按钮。\n             *\n             * * `id` {Seletor|dom} 指定选择文件的按钮容器，不指定则不创建按钮。**注意** 这里虽然写的是 id, 但是不是只支持 id, 还支持 class, 或者 dom 节点。\n             * * `label` {String} 请采用 `innerHTML` 代替\n             * * `innerHTML` {String} 指定按钮文字。不指定时优先从指定的容器中看是否自带文字。\n             * * `multiple` {Boolean} 是否开起同时选择多个文件能力。\n             */\n            pick: null,\n    \n            /**\n             * @property {Arroy} [accept=null]\n             * @namespace options\n             * @for Uploader\n             * @description 指定接受哪些类型的文件。 由于目前还有ext转mimeType表，所以这里需要分开指定。\n             *\n             * * `title` {String} 文字描述\n             * * `extensions` {String} 允许的文件后缀，不带点，多个用逗号分割。\n             * * `mimeTypes` {String} 多个用逗号分割。\n             *\n             * 如：\n             *\n             * ```\n             * {\n             *     title: 'Images',\n             *     extensions: 'gif,jpg,jpeg,bmp,png',\n             *     mimeTypes: 'image/*'\n             * }\n             * ```\n             */\n            accept: null/*{\n                title: 'Images',\n                extensions: 'gif,jpg,jpeg,bmp,png',\n                mimeTypes: 'image/*'\n            }*/\n        });\n    \n        return Uploader.register({\n            name: 'picker',\n    \n            init: function( opts ) {\n                this.pickers = [];\n                return opts.pick && this.addBtn( opts.pick );\n            },\n    \n            refresh: function() {\n                $.each( this.pickers, function() {\n                    this.refresh();\n                });\n            },\n    \n            /**\n             * @method addButton\n             * @for Uploader\n             * @grammar addButton( pick ) => Promise\n             * @description\n             * 添加文件选择按钮，如果一个按钮不够，需要调用此方法来添加。参数跟[options.pick](#WebUploader:Uploader:options)一致。\n             * @example\n             * uploader.addButton({\n             *     id: '#btnContainer',\n             *     innerHTML: '选择文件'\n             * });\n             */\n            addBtn: function( pick ) {\n                var me = this,\n                    opts = me.options,\n                    accept = opts.accept,\n                    promises = [];\n    \n                if ( !pick ) {\n                    return;\n                }\n    \n                $.isPlainObject( pick ) || (pick = {\n                    id: pick\n                });\n    \n                $( pick.id ).each(function() {\n                    var options, picker, deferred;\n    \n                    deferred = Base.Deferred();\n    \n                    options = $.extend({}, pick, {\n                        accept: $.isPlainObject( accept ) ? [ accept ] : accept,\n                        swf: opts.swf,\n                        runtimeOrder: opts.runtimeOrder,\n                        id: this\n                    });\n    \n                    picker = new FilePicker( options );\n    \n                    picker.once( 'ready', deferred.resolve );\n                    picker.on( 'select', function( files ) {\n                        me.owner.request( 'add-file', [ files ]);\n                    });\n                    picker.init();\n    \n                    me.pickers.push( picker );\n    \n                    promises.push( deferred.promise() );\n                });\n    \n                return Base.when.apply( Base, promises );\n            },\n    \n            disable: function() {\n                $.each( this.pickers, function() {\n                    this.disable();\n                });\n            },\n    \n            enable: function() {\n                $.each( this.pickers, function() {\n                    this.enable();\n                });\n            },\n    \n            destroy: function() {\n                $.each( this.pickers, function() {\n                    this.destroy();\n                });\n                this.pickers = null;\n            }\n        });\n    });\n    /**\n     * @fileOverview Image\n     */\n    define('lib/image',[\n        'base',\n        'runtime/client',\n        'lib/blob'\n    ], function( Base, RuntimeClient, Blob ) {\n        var $ = Base.$;\n    \n        // 构造器。\n        function Image( opts ) {\n            this.options = $.extend({}, Image.options, opts );\n            RuntimeClient.call( this, 'Image' );\n    \n            this.on( 'load', function() {\n                this._info = this.exec('info');\n                this._meta = this.exec('meta');\n            });\n        }\n    \n        // 默认选项。\n        Image.options = {\n    \n            // 默认的图片处理质量\n            quality: 90,\n    \n            // 是否裁剪\n            crop: false,\n    \n            // 是否保留头部信息\n            preserveHeaders: false,\n    \n            // 是否允许放大。\n            allowMagnify: false\n        };\n    \n        // 继承RuntimeClient.\n        Base.inherits( RuntimeClient, {\n            constructor: Image,\n    \n            info: function( val ) {\n    \n                // setter\n                if ( val ) {\n                    this._info = val;\n                    return this;\n                }\n    \n                // getter\n                return this._info;\n            },\n    \n            meta: function( val ) {\n    \n                // setter\n                if ( val ) {\n                    this._meta = val;\n                    return this;\n                }\n    \n                // getter\n                return this._meta;\n            },\n    \n            loadFromBlob: function( blob ) {\n                var me = this,\n                    ruid = blob.getRuid();\n    \n                this.connectRuntime( ruid, function() {\n                    me.exec( 'init', me.options );\n                    me.exec( 'loadFromBlob', blob );\n                });\n            },\n    \n            resize: function() {\n                var args = Base.slice( arguments );\n                return this.exec.apply( this, [ 'resize' ].concat( args ) );\n            },\n    \n            crop: function() {\n                var args = Base.slice( arguments );\n                return this.exec.apply( this, [ 'crop' ].concat( args ) );\n            },\n    \n            getAsDataUrl: function( type ) {\n                return this.exec( 'getAsDataUrl', type );\n            },\n    \n            getAsBlob: function( type ) {\n                var blob = this.exec( 'getAsBlob', type );\n    \n                return new Blob( this.getRuid(), blob );\n            }\n        });\n    \n        return Image;\n    });\n    /**\n     * @fileOverview 图片操作, 负责预览图片和上传前压缩图片\n     */\n    define('widgets/image',[\n        'base',\n        'uploader',\n        'lib/image',\n        'widgets/widget'\n    ], function( Base, Uploader, Image ) {\n    \n        var $ = Base.$,\n            throttle;\n    \n        // 根据要处理的文件大小来节流，一次不能处理太多，会卡。\n        throttle = (function( max ) {\n            var occupied = 0,\n                waiting = [],\n                tick = function() {\n                    var item;\n    \n                    while ( waiting.length && occupied < max ) {\n                        item = waiting.shift();\n                        occupied += item[ 0 ];\n                        item[ 1 ]();\n                    }\n                };\n    \n            return function( emiter, size, cb ) {\n                waiting.push([ size, cb ]);\n                emiter.once( 'destroy', function() {\n                    occupied -= size;\n                    setTimeout( tick, 1 );\n                });\n                setTimeout( tick, 1 );\n            };\n        })( 5 * 1024 * 1024 );\n    \n        $.extend( Uploader.options, {\n    \n            /**\n             * @property {Object} [thumb]\n             * @namespace options\n             * @for Uploader\n             * @description 配置生成缩略图的选项。\n             *\n             * 默认为：\n             *\n             * ```javascript\n             * {\n             *     width: 110,\n             *     height: 110,\n             *\n             *     // 图片质量，只有type为`image/jpeg`的时候才有效。\n             *     quality: 70,\n             *\n             *     // 是否允许放大，如果想要生成小图的时候不失真，此选项应该设置为false.\n             *     allowMagnify: true,\n             *\n             *     // 是否允许裁剪。\n             *     crop: true,\n             *\n             *     // 为空的话则保留原有图片格式。\n             *     // 否则强制转换成指定的类型。\n             *     type: 'image/jpeg'\n             * }\n             * ```\n             */\n            thumb: {\n                width: 110,\n                height: 110,\n                quality: 70,\n                allowMagnify: true,\n                crop: true,\n                preserveHeaders: false,\n    \n                // 为空的话则保留原有图片格式。\n                // 否则强制转换成指定的类型。\n                // IE 8下面 base64 大小不能超过 32K 否则预览失败，而非 jpeg 编码的图片很可\n                // 能会超过 32k, 所以这里设置成预览的时候都是 image/jpeg\n                type: 'image/jpeg'\n            },\n    \n            /**\n             * @property {Object} [compress]\n             * @namespace options\n             * @for Uploader\n             * @description 配置压缩的图片的选项。如果此选项为`false`, 则图片在上传前不进行压缩。\n             *\n             * 默认为：\n             *\n             * ```javascript\n             * {\n             *     width: 1600,\n             *     height: 1600,\n             *\n             *     // 图片质量，只有type为`image/jpeg`的时候才有效。\n             *     quality: 90,\n             *\n             *     // 是否允许放大，如果想要生成小图的时候不失真，此选项应该设置为false.\n             *     allowMagnify: false,\n             *\n             *     // 是否允许裁剪。\n             *     crop: false,\n             *\n             *     // 是否保留头部meta信息。\n             *     preserveHeaders: true,\n             *\n             *     // 如果发现压缩后文件大小比原来还大，则使用原来图片\n             *     // 此属性可能会影响图片自动纠正功能\n             *     noCompressIfLarger: false,\n             *\n             *     // 单位字节，如果图片大小小于此值，不会采用压缩。\n             *     compressSize: 0\n             * }\n             * ```\n             */\n            compress: {\n                width: 1600,\n                height: 1600,\n                quality: 90,\n                allowMagnify: false,\n                crop: false,\n                preserveHeaders: true\n            }\n        });\n    \n        return Uploader.register({\n    \n            name: 'image',\n    \n    \n            /**\n             * 生成缩略图，此过程为异步，所以需要传入`callback`。\n             * 通常情况在图片加入队里后调用此方法来生成预览图以增强交互效果。\n             *\n             * 当 width 或者 height 的值介于 0 - 1 时，被当成百分比使用。\n             *\n             * `callback`中可以接收到两个参数。\n             * * 第一个为error，如果生成缩略图有错误，此error将为真。\n             * * 第二个为ret, 缩略图的Data URL值。\n             *\n             * **注意**\n             * Date URL在IE6/7中不支持，所以不用调用此方法了，直接显示一张暂不支持预览图片好了。\n             * 也可以借助服务端，将 base64 数据传给服务端，生成一个临时文件供预览。\n             *\n             * @method makeThumb\n             * @grammar makeThumb( file, callback ) => undefined\n             * @grammar makeThumb( file, callback, width, height ) => undefined\n             * @for Uploader\n             * @example\n             *\n             * uploader.on( 'fileQueued', function( file ) {\n             *     var $li = ...;\n             *\n             *     uploader.makeThumb( file, function( error, ret ) {\n             *         if ( error ) {\n             *             $li.text('预览错误');\n             *         } else {\n             *             $li.append('<img alt=\"\" src=\"' + ret + '\" />');\n             *         }\n             *     });\n             *\n             * });\n             */\n            makeThumb: function( file, cb, width, height ) {\n                var opts, image;\n    \n                file = this.request( 'get-file', file );\n    \n                // 只预览图片格式。\n                if ( !file.type.match( /^image/ ) ) {\n                    cb( true );\n                    return;\n                }\n    \n                opts = $.extend({}, this.options.thumb );\n    \n                // 如果传入的是object.\n                if ( $.isPlainObject( width ) ) {\n                    opts = $.extend( opts, width );\n                    width = null;\n                }\n    \n                width = width || opts.width;\n                height = height || opts.height;\n    \n                image = new Image( opts );\n    \n                image.once( 'load', function() {\n                    file._info = file._info || image.info();\n                    file._meta = file._meta || image.meta();\n    \n                    // 如果 width 的值介于 0 - 1\n                    // 说明设置的是百分比。\n                    if ( width <= 1 && width > 0 ) {\n                        width = file._info.width * width;\n                    }\n    \n                    // 同样的规则应用于 height\n                    if ( height <= 1 && height > 0 ) {\n                        height = file._info.height * height;\n                    }\n    \n                    image.resize( width, height );\n                });\n    \n                // 当 resize 完后\n                image.once( 'complete', function() {\n                    cb( false, image.getAsDataUrl( opts.type ) );\n                    image.destroy();\n                });\n    \n                image.once( 'error', function( reason ) {\n                    cb( reason || true );\n                    image.destroy();\n                });\n    \n                throttle( image, file.source.size, function() {\n                    file._info && image.info( file._info );\n                    file._meta && image.meta( file._meta );\n                    image.loadFromBlob( file.source );\n                });\n            },\n    \n            beforeSendFile: function( file ) {\n                var opts = this.options.compress || this.options.resize,\n                    compressSize = opts && opts.compressSize || 0,\n                    noCompressIfLarger = opts && opts.noCompressIfLarger || false,\n                    image, deferred;\n    \n                file = this.request( 'get-file', file );\n    \n                // 只压缩 jpeg 图片格式。\n                // gif 可能会丢失针\n                // bmp png 基本上尺寸都不大，且压缩比比较小。\n                if ( !opts || !~'image/jpeg,image/jpg'.indexOf( file.type ) ||\n                        file.size < compressSize ||\n                        file._compressed ) {\n                    return;\n                }\n    \n                opts = $.extend({}, opts );\n                deferred = Base.Deferred();\n    \n                image = new Image( opts );\n    \n                deferred.always(function() {\n                    image.destroy();\n                    image = null;\n                });\n                image.once( 'error', deferred.reject );\n                image.once( 'load', function() {\n                    var width = opts.width,\n                        height = opts.height;\n    \n                    file._info = file._info || image.info();\n                    file._meta = file._meta || image.meta();\n    \n                    // 如果 width 的值介于 0 - 1\n                    // 说明设置的是百分比。\n                    if ( width <= 1 && width > 0 ) {\n                        width = file._info.width * width;\n                    }\n    \n                    // 同样的规则应用于 height\n                    if ( height <= 1 && height > 0 ) {\n                        height = file._info.height * height;\n                    }\n    \n                    image.resize( width, height );\n                });\n    \n                image.once( 'complete', function() {\n                    var blob, size;\n    \n                    // 移动端 UC / qq 浏览器的无图模式下\n                    // ctx.getImageData 处理大图的时候会报 Exception\n                    // INDEX_SIZE_ERR: DOM Exception 1\n                    try {\n                        blob = image.getAsBlob( opts.type );\n    \n                        size = file.size;\n    \n                        // 如果压缩后，比原来还大则不用压缩后的。\n                        if ( !noCompressIfLarger || blob.size < size ) {\n                            // file.source.destroy && file.source.destroy();\n                            file.source = blob;\n                            file.size = blob.size;\n    \n                            file.trigger( 'resize', blob.size, size );\n                        }\n    \n                        // 标记，避免重复压缩。\n                        file._compressed = true;\n                        deferred.resolve();\n                    } catch ( e ) {\n                        // 出错了直接继续，让其上传原始图片\n                        deferred.resolve();\n                    }\n                });\n    \n                file._info && image.info( file._info );\n                file._meta && image.meta( file._meta );\n    \n                image.loadFromBlob( file.source );\n                return deferred.promise();\n            }\n        });\n    });\n    /**\n     * @fileOverview 文件属性封装\n     */\n    define('file',[\n        'base',\n        'mediator'\n    ], function( Base, Mediator ) {\n    \n        var $ = Base.$,\n            idPrefix = 'WU_FILE_',\n            idSuffix = 0,\n            rExt = /\\.([^.]+)$/,\n            statusMap = {};\n    \n        function gid() {\n            return idPrefix + idSuffix++;\n        }\n    \n        /**\n         * 文件类\n         * @class File\n         * @constructor 构造函数\n         * @grammar new File( source ) => File\n         * @param {Lib.File} source [lib.File](#Lib.File)实例, 此source对象是带有Runtime信息的。\n         */\n        function WUFile( source ) {\n    \n            /**\n             * 文件名，包括扩展名（后缀）\n             * @property name\n             * @type {string}\n             */\n            this.name = source.name || 'Untitled';\n    \n            /**\n             * 文件体积（字节）\n             * @property size\n             * @type {uint}\n             * @default 0\n             */\n            this.size = source.size || 0;\n    \n            /**\n             * 文件MIMETYPE类型，与文件类型的对应关系请参考[http://t.cn/z8ZnFny](http://t.cn/z8ZnFny)\n             * @property type\n             * @type {string}\n             * @default 'application/octet-stream'\n             */\n            this.type = source.type || 'application/octet-stream';\n    \n            /**\n             * 文件最后修改日期\n             * @property lastModifiedDate\n             * @type {int}\n             * @default 当前时间戳\n             */\n            this.lastModifiedDate = source.lastModifiedDate || (new Date() * 1);\n    \n            /**\n             * 文件ID，每个对象具有唯一ID，与文件名无关\n             * @property id\n             * @type {string}\n             */\n            this.id = gid();\n    \n            /**\n             * 文件扩展名，通过文件名获取，例如test.png的扩展名为png\n             * @property ext\n             * @type {string}\n             */\n            this.ext = rExt.exec( this.name ) ? RegExp.$1 : '';\n    \n    \n            /**\n             * 状态文字说明。在不同的status语境下有不同的用途。\n             * @property statusText\n             * @type {string}\n             */\n            this.statusText = '';\n    \n            // 存储文件状态，防止通过属性直接修改\n            statusMap[ this.id ] = WUFile.Status.INITED;\n    \n            this.source = source;\n            this.loaded = 0;\n    \n            this.on( 'error', function( msg ) {\n                this.setStatus( WUFile.Status.ERROR, msg );\n            });\n        }\n    \n        $.extend( WUFile.prototype, {\n    \n            /**\n             * 设置状态，状态变化时会触发`change`事件。\n             * @method setStatus\n             * @grammar setStatus( status[, statusText] );\n             * @param {File.Status|String} status [文件状态值](#WebUploader:File:File.Status)\n             * @param {String} [statusText=''] 状态说明，常在error时使用，用http, abort,server等来标记是由于什么原因导致文件错误。\n             */\n            setStatus: function( status, text ) {\n    \n                var prevStatus = statusMap[ this.id ];\n    \n                typeof text !== 'undefined' && (this.statusText = text);\n    \n                if ( status !== prevStatus ) {\n                    statusMap[ this.id ] = status;\n                    /**\n                     * 文件状态变化\n                     * @event statuschange\n                     */\n                    this.trigger( 'statuschange', status, prevStatus );\n                }\n    \n            },\n    \n            /**\n             * 获取文件状态\n             * @return {File.Status}\n             * @example\n                     文件状态具体包括以下几种类型：\n                     {\n                         // 初始化\n                        INITED:     0,\n                        // 已入队列\n                        QUEUED:     1,\n                        // 正在上传\n                        PROGRESS:     2,\n                        // 上传出错\n                        ERROR:         3,\n                        // 上传成功\n                        COMPLETE:     4,\n                        // 上传取消\n                        CANCELLED:     5\n                    }\n             */\n            getStatus: function() {\n                return statusMap[ this.id ];\n            },\n    \n            /**\n             * 获取文件原始信息。\n             * @return {*}\n             */\n            getSource: function() {\n                return this.source;\n            },\n    \n            destroy: function() {\n                this.off();\n                delete statusMap[ this.id ];\n            }\n        });\n    \n        Mediator.installTo( WUFile.prototype );\n    \n        /**\n         * 文件状态值，具体包括以下几种类型：\n         * * `inited` 初始状态\n         * * `queued` 已经进入队列, 等待上传\n         * * `progress` 上传中\n         * * `complete` 上传完成。\n         * * `error` 上传出错，可重试\n         * * `interrupt` 上传中断，可续传。\n         * * `invalid` 文件不合格，不能重试上传。会自动从队列中移除。\n         * * `cancelled` 文件被移除。\n         * @property {Object} Status\n         * @namespace File\n         * @class File\n         * @static\n         */\n        WUFile.Status = {\n            INITED:     'inited',    // 初始状态\n            QUEUED:     'queued',    // 已经进入队列, 等待上传\n            PROGRESS:   'progress',    // 上传中\n            ERROR:      'error',    // 上传出错，可重试\n            COMPLETE:   'complete',    // 上传完成。\n            CANCELLED:  'cancelled',    // 上传取消。\n            INTERRUPT:  'interrupt',    // 上传中断，可续传。\n            INVALID:    'invalid'    // 文件不合格，不能重试上传。\n        };\n    \n        return WUFile;\n    });\n    \n    /**\n     * @fileOverview 文件队列\n     */\n    define('queue',[\n        'base',\n        'mediator',\n        'file'\n    ], function( Base, Mediator, WUFile ) {\n    \n        var $ = Base.$,\n            STATUS = WUFile.Status;\n    \n        /**\n         * 文件队列, 用来存储各个状态中的文件。\n         * @class Queue\n         * @extends Mediator\n         */\n        function Queue() {\n    \n            /**\n             * 统计文件数。\n             * * `numOfQueue` 队列中的文件数。\n             * * `numOfSuccess` 上传成功的文件数\n             * * `numOfCancel` 被取消的文件数\n             * * `numOfProgress` 正在上传中的文件数\n             * * `numOfUploadFailed` 上传错误的文件数。\n             * * `numOfInvalid` 无效的文件数。\n             * * `numofDeleted` 被移除的文件数。\n             * @property {Object} stats\n             */\n            this.stats = {\n                numOfQueue: 0,\n                numOfSuccess: 0,\n                numOfCancel: 0,\n                numOfProgress: 0,\n                numOfUploadFailed: 0,\n                numOfInvalid: 0,\n                numofDeleted: 0,\n                numofInterrupt: 0\n            };\n    \n            // 上传队列，仅包括等待上传的文件\n            this._queue = [];\n    \n            // 存储所有文件\n            this._map = {};\n        }\n    \n        $.extend( Queue.prototype, {\n    \n            /**\n             * 将新文件加入对队列尾部\n             *\n             * @method append\n             * @param  {File} file   文件对象\n             */\n            append: function( file ) {\n                this._queue.push( file );\n                this._fileAdded( file );\n                return this;\n            },\n    \n            /**\n             * 将新文件加入对队列头部\n             *\n             * @method prepend\n             * @param  {File} file   文件对象\n             */\n            prepend: function( file ) {\n                this._queue.unshift( file );\n                this._fileAdded( file );\n                return this;\n            },\n    \n            /**\n             * 获取文件对象\n             *\n             * @method getFile\n             * @param  {String} fileId   文件ID\n             * @return {File}\n             */\n            getFile: function( fileId ) {\n                if ( typeof fileId !== 'string' ) {\n                    return fileId;\n                }\n                return this._map[ fileId ];\n            },\n    \n            /**\n             * 从队列中取出一个指定状态的文件。\n             * @grammar fetch( status ) => File\n             * @method fetch\n             * @param {String} status [文件状态值](#WebUploader:File:File.Status)\n             * @return {File} [File](#WebUploader:File)\n             */\n            fetch: function( status ) {\n                var len = this._queue.length,\n                    i, file;\n    \n                status = status || STATUS.QUEUED;\n    \n                for ( i = 0; i < len; i++ ) {\n                    file = this._queue[ i ];\n    \n                    if ( status === file.getStatus() ) {\n                        return file;\n                    }\n                }\n    \n                return null;\n            },\n    \n            /**\n             * 对队列进行排序，能够控制文件上传顺序。\n             * @grammar sort( fn ) => undefined\n             * @method sort\n             * @param {Function} fn 排序方法\n             */\n            sort: function( fn ) {\n                if ( typeof fn === 'function' ) {\n                    this._queue.sort( fn );\n                }\n            },\n    \n            /**\n             * 获取指定类型的文件列表, 列表中每一个成员为[File](#WebUploader:File)对象。\n             * @grammar getFiles( [status1[, status2 ...]] ) => Array\n             * @method getFiles\n             * @param {String} [status] [文件状态值](#WebUploader:File:File.Status)\n             */\n            getFiles: function() {\n                var sts = [].slice.call( arguments, 0 ),\n                    ret = [],\n                    i = 0,\n                    len = this._queue.length,\n                    file;\n    \n                for ( ; i < len; i++ ) {\n                    file = this._queue[ i ];\n    \n                    if ( sts.length && !~$.inArray( file.getStatus(), sts ) ) {\n                        continue;\n                    }\n    \n                    ret.push( file );\n                }\n    \n                return ret;\n            },\n    \n            /**\n             * 在队列中删除文件。\n             * @grammar removeFile( file ) => Array\n             * @method removeFile\n             * @param {File} 文件对象。\n             */\n            removeFile: function( file ) {\n                var me = this,\n                    existing = this._map[ file.id ];\n    \n                if ( existing ) {\n                    delete this._map[ file.id ];\n                    file.destroy();\n                    this.stats.numofDeleted++;\n                }\n            },\n    \n            _fileAdded: function( file ) {\n                var me = this,\n                    existing = this._map[ file.id ];\n    \n                if ( !existing ) {\n                    this._map[ file.id ] = file;\n    \n                    file.on( 'statuschange', function( cur, pre ) {\n                        me._onFileStatusChange( cur, pre );\n                    });\n                }\n            },\n    \n            _onFileStatusChange: function( curStatus, preStatus ) {\n                var stats = this.stats;\n    \n                switch ( preStatus ) {\n                    case STATUS.PROGRESS:\n                        stats.numOfProgress--;\n                        break;\n    \n                    case STATUS.QUEUED:\n                        stats.numOfQueue --;\n                        break;\n    \n                    case STATUS.ERROR:\n                        stats.numOfUploadFailed--;\n                        break;\n    \n                    case STATUS.INVALID:\n                        stats.numOfInvalid--;\n                        break;\n    \n                    case STATUS.INTERRUPT:\n                        stats.numofInterrupt--;\n                        break;\n                }\n    \n                switch ( curStatus ) {\n                    case STATUS.QUEUED:\n                        stats.numOfQueue++;\n                        break;\n    \n                    case STATUS.PROGRESS:\n                        stats.numOfProgress++;\n                        break;\n    \n                    case STATUS.ERROR:\n                        stats.numOfUploadFailed++;\n                        break;\n    \n                    case STATUS.COMPLETE:\n                        stats.numOfSuccess++;\n                        break;\n    \n                    case STATUS.CANCELLED:\n                        stats.numOfCancel++;\n                        break;\n    \n    \n                    case STATUS.INVALID:\n                        stats.numOfInvalid++;\n                        break;\n    \n                    case STATUS.INTERRUPT:\n                        stats.numofInterrupt++;\n                        break;\n                }\n            }\n    \n        });\n    \n        Mediator.installTo( Queue.prototype );\n    \n        return Queue;\n    });\n    /**\n     * @fileOverview 队列\n     */\n    define('widgets/queue',[\n        'base',\n        'uploader',\n        'queue',\n        'file',\n        'lib/file',\n        'runtime/client',\n        'widgets/widget'\n    ], function( Base, Uploader, Queue, WUFile, File, RuntimeClient ) {\n    \n        var $ = Base.$,\n            rExt = /\\.\\w+$/,\n            Status = WUFile.Status;\n    \n        return Uploader.register({\n            name: 'queue',\n    \n            init: function( opts ) {\n                var me = this,\n                    deferred, len, i, item, arr, accept, runtime;\n    \n                if ( $.isPlainObject( opts.accept ) ) {\n                    opts.accept = [ opts.accept ];\n                }\n    \n                // accept中的中生成匹配正则。\n                if ( opts.accept ) {\n                    arr = [];\n    \n                    for ( i = 0, len = opts.accept.length; i < len; i++ ) {\n                        item = opts.accept[ i ].extensions;\n                        item && arr.push( item );\n                    }\n    \n                    if ( arr.length ) {\n                        accept = '\\\\.' + arr.join(',')\n                                .replace( /,/g, '$|\\\\.' )\n                                .replace( /\\*/g, '.*' ) + '$';\n                    }\n    \n                    me.accept = new RegExp( accept, 'i' );\n                }\n    \n                me.queue = new Queue();\n                me.stats = me.queue.stats;\n    \n                // 如果当前不是html5运行时，那就算了。\n                // 不执行后续操作\n                if ( this.request('predict-runtime-type') !== 'html5' ) {\n                    return;\n                }\n    \n                // 创建一个 html5 运行时的 placeholder\n                // 以至于外部添加原生 File 对象的时候能正确包裹一下供 webuploader 使用。\n                deferred = Base.Deferred();\n                this.placeholder = runtime = new RuntimeClient('Placeholder');\n                runtime.connectRuntime({\n                    runtimeOrder: 'html5'\n                }, function() {\n                    me._ruid = runtime.getRuid();\n                    deferred.resolve();\n                });\n                return deferred.promise();\n            },\n    \n    \n            // 为了支持外部直接添加一个原生File对象。\n            _wrapFile: function( file ) {\n                if ( !(file instanceof WUFile) ) {\n    \n                    if ( !(file instanceof File) ) {\n                        if ( !this._ruid ) {\n                            throw new Error('Can\\'t add external files.');\n                        }\n                        file = new File( this._ruid, file );\n                    }\n    \n                    file = new WUFile( file );\n                }\n    \n                return file;\n            },\n    \n            // 判断文件是否可以被加入队列\n            acceptFile: function( file ) {\n                var invalid = !file || !file.size || this.accept &&\n    \n                        // 如果名字中有后缀，才做后缀白名单处理。\n                        rExt.exec( file.name ) && !this.accept.test( file.name );\n    \n                return !invalid;\n            },\n    \n    \n            /**\n             * @event beforeFileQueued\n             * @param {File} file File对象\n             * @description 当文件被加入队列之前触发，此事件的handler返回值为`false`，则此文件不会被添加进入队列。\n             * @for  Uploader\n             */\n    \n            /**\n             * @event fileQueued\n             * @param {File} file File对象\n             * @description 当文件被加入队列以后触发。\n             * @for  Uploader\n             */\n    \n            _addFile: function( file ) {\n                var me = this;\n    \n                file = me._wrapFile( file );\n    \n                // 不过类型判断允许不允许，先派送 `beforeFileQueued`\n                if ( !me.owner.trigger( 'beforeFileQueued', file ) ) {\n                    return;\n                }\n    \n                // 类型不匹配，则派送错误事件，并返回。\n                if ( !me.acceptFile( file ) ) {\n                    me.owner.trigger( 'error', 'Q_TYPE_DENIED', file );\n                    return;\n                }\n    \n                me.queue.append( file );\n                me.owner.trigger( 'fileQueued', file );\n                return file;\n            },\n    \n            getFile: function( fileId ) {\n                return this.queue.getFile( fileId );\n            },\n    \n            /**\n             * @event filesQueued\n             * @param {File} files 数组，内容为原始File(lib/File）对象。\n             * @description 当一批文件添加进队列以后触发。\n             * @for  Uploader\n             */\n            \n            /**\n             * @property {Boolean} [auto=false]\n             * @namespace options\n             * @for Uploader\n             * @description 设置为 true 后，不需要手动调用上传，有文件选择即开始上传。\n             * \n             */\n    \n            /**\n             * @method addFiles\n             * @grammar addFiles( file ) => undefined\n             * @grammar addFiles( [file1, file2 ...] ) => undefined\n             * @param {Array of File or File} [files] Files 对象 数组\n             * @description 添加文件到队列\n             * @for  Uploader\n             */\n            addFile: function( files ) {\n                var me = this;\n    \n                if ( !files.length ) {\n                    files = [ files ];\n                }\n    \n                files = $.map( files, function( file ) {\n                    return me._addFile( file );\n                });\n    \n                me.owner.trigger( 'filesQueued', files );\n    \n                if ( me.options.auto ) {\n                    setTimeout(function() {\n                        me.request('start-upload');\n                    }, 20 );\n                }\n            },\n    \n            getStats: function() {\n                return this.stats;\n            },\n    \n            /**\n             * @event fileDequeued\n             * @param {File} file File对象\n             * @description 当文件被移除队列后触发。\n             * @for  Uploader\n             */\n    \n             /**\n             * @method removeFile\n             * @grammar removeFile( file ) => undefined\n             * @grammar removeFile( id ) => undefined\n             * @grammar removeFile( file, true ) => undefined\n             * @grammar removeFile( id, true ) => undefined\n             * @param {File|id} file File对象或这File对象的id\n             * @description 移除某一文件, 默认只会标记文件状态为已取消，如果第二个参数为 `true` 则会从 queue 中移除。\n             * @for  Uploader\n             * @example\n             *\n             * $li.on('click', '.remove-this', function() {\n             *     uploader.removeFile( file );\n             * })\n             */\n            removeFile: function( file, remove ) {\n                var me = this;\n    \n                file = file.id ? file : me.queue.getFile( file );\n    \n                this.request( 'cancel-file', file );\n    \n                if ( remove ) {\n                    this.queue.removeFile( file );\n                }\n            },\n    \n            /**\n             * @method getFiles\n             * @grammar getFiles() => Array\n             * @grammar getFiles( status1, status2, status... ) => Array\n             * @description 返回指定状态的文件集合，不传参数将返回所有状态的文件。\n             * @for  Uploader\n             * @example\n             * console.log( uploader.getFiles() );    // => all files\n             * console.log( uploader.getFiles('error') )    // => all error files.\n             */\n            getFiles: function() {\n                return this.queue.getFiles.apply( this.queue, arguments );\n            },\n    \n            fetchFile: function() {\n                return this.queue.fetch.apply( this.queue, arguments );\n            },\n    \n            /**\n             * @method retry\n             * @grammar retry() => undefined\n             * @grammar retry( file ) => undefined\n             * @description 重试上传，重试指定文件，或者从出错的文件开始重新上传。\n             * @for  Uploader\n             * @example\n             * function retry() {\n             *     uploader.retry();\n             * }\n             */\n            retry: function( file, noForceStart ) {\n                var me = this,\n                    files, i, len;\n    \n                if ( file ) {\n                    file = file.id ? file : me.queue.getFile( file );\n                    file.setStatus( Status.QUEUED );\n                    noForceStart || me.request('start-upload');\n                    return;\n                }\n    \n                files = me.queue.getFiles( Status.ERROR );\n                i = 0;\n                len = files.length;\n    \n                for ( ; i < len; i++ ) {\n                    file = files[ i ];\n                    file.setStatus( Status.QUEUED );\n                }\n    \n                me.request('start-upload');\n            },\n    \n            /**\n             * @method sort\n             * @grammar sort( fn ) => undefined\n             * @description 排序队列中的文件，在上传之前调整可以控制上传顺序。\n             * @for  Uploader\n             */\n            sortFiles: function() {\n                return this.queue.sort.apply( this.queue, arguments );\n            },\n    \n            /**\n             * @event reset\n             * @description 当 uploader 被重置的时候触发。\n             * @for  Uploader\n             */\n    \n            /**\n             * @method reset\n             * @grammar reset() => undefined\n             * @description 重置uploader。目前只重置了队列。\n             * @for  Uploader\n             * @example\n             * uploader.reset();\n             */\n            reset: function() {\n                this.owner.trigger('reset');\n                this.queue = new Queue();\n                this.stats = this.queue.stats;\n            },\n    \n            destroy: function() {\n                this.reset();\n                this.placeholder && this.placeholder.destroy();\n            }\n        });\n    \n    });\n    /**\n     * @fileOverview 添加获取Runtime相关信息的方法。\n     */\n    define('widgets/runtime',[\n        'uploader',\n        'runtime/runtime',\n        'widgets/widget'\n    ], function( Uploader, Runtime ) {\n    \n        Uploader.support = function() {\n            return Runtime.hasRuntime.apply( Runtime, arguments );\n        };\n    \n        /**\n         * @property {Object} [runtimeOrder=html5,flash]\n         * @namespace options\n         * @for Uploader\n         * @description 指定运行时启动顺序。默认会想尝试 html5 是否支持，如果支持则使用 html5, 否则则使用 flash.\n         *\n         * 可以将此值设置成 `flash`，来强制使用 flash 运行时。\n         */\n    \n        return Uploader.register({\n            name: 'runtime',\n    \n            init: function() {\n                if ( !this.predictRuntimeType() ) {\n                    throw Error('Runtime Error');\n                }\n            },\n    \n            /**\n             * 预测Uploader将采用哪个`Runtime`\n             * @grammar predictRuntimeType() => String\n             * @method predictRuntimeType\n             * @for  Uploader\n             */\n            predictRuntimeType: function() {\n                var orders = this.options.runtimeOrder || Runtime.orders,\n                    type = this.type,\n                    i, len;\n    \n                if ( !type ) {\n                    orders = orders.split( /\\s*,\\s*/g );\n    \n                    for ( i = 0, len = orders.length; i < len; i++ ) {\n                        if ( Runtime.hasRuntime( orders[ i ] ) ) {\n                            this.type = type = orders[ i ];\n                            break;\n                        }\n                    }\n                }\n    \n                return type;\n            }\n        });\n    });\n    /**\n     * @fileOverview Transport\n     */\n    define('lib/transport',[\n        'base',\n        'runtime/client',\n        'mediator'\n    ], function( Base, RuntimeClient, Mediator ) {\n    \n        var $ = Base.$;\n    \n        function Transport( opts ) {\n            var me = this;\n    \n            opts = me.options = $.extend( true, {}, Transport.options, opts || {} );\n            RuntimeClient.call( this, 'Transport' );\n    \n            this._blob = null;\n            this._formData = opts.formData || {};\n            this._headers = opts.headers || {};\n    \n            this.on( 'progress', this._timeout );\n            this.on( 'load error', function() {\n                me.trigger( 'progress', 1 );\n                clearTimeout( me._timer );\n            });\n        }\n    \n        Transport.options = {\n            server: '',\n            method: 'POST',\n    \n            // 跨域时，是否允许携带cookie, 只有html5 runtime才有效\n            withCredentials: false,\n            fileVal: 'file',\n            timeout: 2 * 60 * 1000,    // 2分钟\n            formData: {},\n            headers: {},\n            sendAsBinary: false\n        };\n    \n        $.extend( Transport.prototype, {\n    \n            // 添加Blob, 只能添加一次，最后一次有效。\n            appendBlob: function( key, blob, filename ) {\n                var me = this,\n                    opts = me.options;\n    \n                if ( me.getRuid() ) {\n                    me.disconnectRuntime();\n                }\n    \n                // 连接到blob归属的同一个runtime.\n                me.connectRuntime( blob.ruid, function() {\n                    me.exec('init');\n                });\n    \n                me._blob = blob;\n                opts.fileVal = key || opts.fileVal;\n                opts.filename = filename || opts.filename;\n            },\n    \n            // 添加其他字段\n            append: function( key, value ) {\n                if ( typeof key === 'object' ) {\n                    $.extend( this._formData, key );\n                } else {\n                    this._formData[ key ] = value;\n                }\n            },\n    \n            setRequestHeader: function( key, value ) {\n                if ( typeof key === 'object' ) {\n                    $.extend( this._headers, key );\n                } else {\n                    this._headers[ key ] = value;\n                }\n            },\n    \n            send: function( method ) {\n                this.exec( 'send', method );\n                this._timeout();\n            },\n    \n            abort: function() {\n                clearTimeout( this._timer );\n                return this.exec('abort');\n            },\n    \n            destroy: function() {\n                this.trigger('destroy');\n                this.off();\n                this.exec('destroy');\n                this.disconnectRuntime();\n            },\n    \n            getResponse: function() {\n                return this.exec('getResponse');\n            },\n    \n            getResponseAsJson: function() {\n                return this.exec('getResponseAsJson');\n            },\n    \n            getStatus: function() {\n                return this.exec('getStatus');\n            },\n    \n            _timeout: function() {\n                var me = this,\n                    duration = me.options.timeout;\n    \n                if ( !duration ) {\n                    return;\n                }\n    \n                clearTimeout( me._timer );\n                me._timer = setTimeout(function() {\n                    me.abort();\n                    me.trigger( 'error', 'timeout' );\n                }, duration );\n            }\n    \n        });\n    \n        // 让Transport具备事件功能。\n        Mediator.installTo( Transport.prototype );\n    \n        return Transport;\n    });\n    /**\n     * @fileOverview 负责文件上传相关。\n     */\n    define('widgets/upload',[\n        'base',\n        'uploader',\n        'file',\n        'lib/transport',\n        'widgets/widget'\n    ], function( Base, Uploader, WUFile, Transport ) {\n    \n        var $ = Base.$,\n            isPromise = Base.isPromise,\n            Status = WUFile.Status;\n    \n        // 添加默认配置项\n        $.extend( Uploader.options, {\n    \n    \n            /**\n             * @property {Boolean} [prepareNextFile=false]\n             * @namespace options\n             * @for Uploader\n             * @description 是否允许在文件传输时提前把下一个文件准备好。\n             * 对于一个文件的准备工作比较耗时，比如图片压缩，md5序列化。\n             * 如果能提前在当前文件传输期处理，可以节省总体耗时。\n             */\n            prepareNextFile: false,\n    \n            /**\n             * @property {Boolean} [chunked=false]\n             * @namespace options\n             * @for Uploader\n             * @description 是否要分片处理大文件上传。\n             */\n            chunked: false,\n    \n            /**\n             * @property {Boolean} [chunkSize=5242880]\n             * @namespace options\n             * @for Uploader\n             * @description 如果要分片，分多大一片？ 默认大小为5M.\n             */\n            chunkSize: 5 * 1024 * 1024,\n    \n            /**\n             * @property {Boolean} [chunkRetry=2]\n             * @namespace options\n             * @for Uploader\n             * @description 如果某个分片由于网络问题出错，允许自动重传多少次？\n             */\n            chunkRetry: 2,\n    \n            /**\n             * @property {Boolean} [threads=3]\n             * @namespace options\n             * @for Uploader\n             * @description 上传并发数。允许同时最大上传进程数。\n             */\n            threads: 3,\n    \n    \n            /**\n             * @property {Object} [formData={}]\n             * @namespace options\n             * @for Uploader\n             * @description 文件上传请求的参数表，每次发送都会发送此对象中的参数。\n             */\n            formData: {}\n    \n            /**\n             * @property {Object} [fileVal='file']\n             * @namespace options\n             * @for Uploader\n             * @description 设置文件上传域的name。\n             */\n    \n            /**\n             * @property {Object} [method='POST']\n             * @namespace options\n             * @for Uploader\n             * @description 文件上传方式，`POST`或者`GET`。\n             */\n    \n            /**\n             * @property {Object} [sendAsBinary=false]\n             * @namespace options\n             * @for Uploader\n             * @description 是否已二进制的流的方式发送文件，这样整个上传内容`php://input`都为文件内容，\n             * 其他参数在$_GET数组中。\n             */\n        });\n    \n        // 负责将文件切片。\n        function CuteFile( file, chunkSize ) {\n            var pending = [],\n                blob = file.source,\n                total = blob.size,\n                chunks = chunkSize ? Math.ceil( total / chunkSize ) : 1,\n                start = 0,\n                index = 0,\n                len, api;\n    \n            api = {\n                file: file,\n    \n                has: function() {\n                    return !!pending.length;\n                },\n    \n                shift: function() {\n                    return pending.shift();\n                },\n    \n                unshift: function( block ) {\n                    pending.unshift( block );\n                }\n            };\n    \n            while ( index < chunks ) {\n                len = Math.min( chunkSize, total - start );\n    \n                pending.push({\n                    file: file,\n                    start: start,\n                    end: chunkSize ? (start + len) : total,\n                    total: total,\n                    chunks: chunks,\n                    chunk: index++,\n                    cuted: api\n                });\n                start += len;\n            }\n    \n            file.blocks = pending.concat();\n            file.remaning = pending.length;\n    \n            return api;\n        }\n    \n        Uploader.register({\n            name: 'upload',\n    \n            init: function() {\n                var owner = this.owner,\n                    me = this;\n    \n                this.runing = false;\n                this.progress = false;\n    \n                owner\n                    .on( 'startUpload', function() {\n                        me.progress = true;\n                    })\n                    .on( 'uploadFinished', function() {\n                        me.progress = false;\n                    });\n    \n                // 记录当前正在传的数据，跟threads相关\n                this.pool = [];\n    \n                // 缓存分好片的文件。\n                this.stack = [];\n    \n                // 缓存即将上传的文件。\n                this.pending = [];\n    \n                // 跟踪还有多少分片在上传中但是没有完成上传。\n                this.remaning = 0;\n                this.__tick = Base.bindFn( this._tick, this );\n    \n                owner.on( 'uploadComplete', function( file ) {\n    \n                    // 把其他块取消了。\n                    file.blocks && $.each( file.blocks, function( _, v ) {\n                        v.transport && (v.transport.abort(), v.transport.destroy());\n                        delete v.transport;\n                    });\n    \n                    delete file.blocks;\n                    delete file.remaning;\n                });\n            },\n    \n            reset: function() {\n                this.request( 'stop-upload', true );\n                this.runing = false;\n                this.pool = [];\n                this.stack = [];\n                this.pending = [];\n                this.remaning = 0;\n                this._trigged = false;\n                this._promise = null;\n            },\n    \n            /**\n             * @event startUpload\n             * @description 当开始上传流程时触发。\n             * @for  Uploader\n             */\n    \n            /**\n             * 开始上传。此方法可以从初始状态调用开始上传流程，也可以从暂停状态调用，继续上传流程。\n             *\n             * 可以指定开始某一个文件。\n             * @grammar upload() => undefined\n             * @grammar upload( file | fileId) => undefined\n             * @method upload\n             * @for  Uploader\n             */\n            startUpload: function(file) {\n                var me = this;\n    \n                // 移出invalid的文件\n                $.each( me.request( 'get-files', Status.INVALID ), function() {\n                    me.request( 'remove-file', this );\n                });\n    \n                // 如果指定了开始某个文件，则只开始指定文件。\n                if ( file ) {\n                    file = file.id ? file : me.request( 'get-file', file );\n    \n                    if (file.getStatus() === Status.INTERRUPT) {\n                        $.each( me.pool, function( _, v ) {\n    \n                            // 之前暂停过。\n                            if (v.file !== file) {\n                                return;\n                            }\n    \n                            v.transport && v.transport.send();\n                        });\n    \n                        file.setStatus( Status.QUEUED );\n                    } else if (file.getStatus() === Status.PROGRESS) {\n                        return;\n                    } else {\n                        file.setStatus( Status.QUEUED );\n                    }\n                } else {\n                    $.each( me.request( 'get-files', [ Status.INITED ] ), function() {\n                        this.setStatus( Status.QUEUED );\n                    });\n                }\n    \n                if ( me.runing ) {\n                    return;\n                }\n    \n                me.runing = true;\n    \n                var files = [];\n    \n                // 如果有暂停的，则续传\n                $.each( me.pool, function( _, v ) {\n                    var file = v.file;\n    \n                    if ( file.getStatus() === Status.INTERRUPT ) {\n                        files.push(file);\n                        me._trigged = false;\n                        v.transport && v.transport.send();\n                    }\n                });\n    \n                var file;\n                while ( (file = files.shift()) ) {\n                    file.setStatus( Status.PROGRESS );\n                }\n    \n                file || $.each( me.request( 'get-files',\n                        Status.INTERRUPT ), function() {\n                    this.setStatus( Status.PROGRESS );\n                });\n    \n                me._trigged = false;\n                Base.nextTick( me.__tick );\n                me.owner.trigger('startUpload');\n            },\n    \n            /**\n             * @event stopUpload\n             * @description 当开始上传流程暂停时触发。\n             * @for  Uploader\n             */\n    \n            /**\n             * 暂停上传。第一个参数为是否中断上传当前正在上传的文件。\n             *\n             * 如果第一个参数是文件，则只暂停指定文件。\n             * @grammar stop() => undefined\n             * @grammar stop( true ) => undefined\n             * @grammar stop( file ) => undefined\n             * @method stop\n             * @for  Uploader\n             */\n            stopUpload: function( file, interrupt ) {\n                var me = this;\n    \n                if (file === true) {\n                    interrupt = file;\n                    file = null;\n                }\n    \n                if ( me.runing === false ) {\n                    return;\n                }\n    \n                // 如果只是暂停某个文件。\n                if ( file ) {\n                    file = file.id ? file : me.request( 'get-file', file );\n    \n                    if ( file.getStatus() !== Status.PROGRESS &&\n                            file.getStatus() !== Status.QUEUED ) {\n                        return;\n                    }\n    \n                    file.setStatus( Status.INTERRUPT );\n                    $.each( me.pool, function( _, v ) {\n    \n                        // 只 abort 指定的文件。\n                        if (v.file !== file) {\n                            return;\n                        }\n    \n                        v.transport && v.transport.abort();\n                        me._putback(v);\n                        me._popBlock(v);\n                    });\n    \n                    return Base.nextTick( me.__tick );\n                }\n    \n                me.runing = false;\n    \n                if (this._promise && this._promise.file) {\n                    this._promise.file.setStatus( Status.INTERRUPT );\n                }\n    \n                interrupt && $.each( me.pool, function( _, v ) {\n                    v.transport && v.transport.abort();\n                    v.file.setStatus( Status.INTERRUPT );\n                });\n    \n                me.owner.trigger('stopUpload');\n            },\n    \n            /**\n             * @method cancelFile\n             * @grammar cancelFile( file ) => undefined\n             * @grammar cancelFile( id ) => undefined\n             * @param {File|id} file File对象或这File对象的id\n             * @description 标记文件状态为已取消, 同时将中断文件传输。\n             * @for  Uploader\n             * @example\n             *\n             * $li.on('click', '.remove-this', function() {\n             *     uploader.cancelFile( file );\n             * })\n             */\n            cancelFile: function( file ) {\n                file = file.id ? file : this.request( 'get-file', file );\n    \n                // 如果正在上传。\n                file.blocks && $.each( file.blocks, function( _, v ) {\n                    var _tr = v.transport;\n    \n                    if ( _tr ) {\n                        _tr.abort();\n                        _tr.destroy();\n                        delete v.transport;\n                    }\n                });\n    \n                file.setStatus( Status.CANCELLED );\n                this.owner.trigger( 'fileDequeued', file );\n            },\n    \n            /**\n             * 判断`Uplaode`r是否正在上传中。\n             * @grammar isInProgress() => Boolean\n             * @method isInProgress\n             * @for  Uploader\n             */\n            isInProgress: function() {\n                return !!this.progress;\n            },\n    \n            _getStats: function() {\n                return this.request('get-stats');\n            },\n    \n            /**\n             * 掉过一个文件上传，直接标记指定文件为已上传状态。\n             * @grammar skipFile( file ) => undefined\n             * @method skipFile\n             * @for  Uploader\n             */\n            skipFile: function( file, status ) {\n                file = file.id ? file : this.request( 'get-file', file );\n    \n                file.setStatus( status || Status.COMPLETE );\n                file.skipped = true;\n    \n                // 如果正在上传。\n                file.blocks && $.each( file.blocks, function( _, v ) {\n                    var _tr = v.transport;\n    \n                    if ( _tr ) {\n                        _tr.abort();\n                        _tr.destroy();\n                        delete v.transport;\n                    }\n                });\n    \n                this.owner.trigger( 'uploadSkip', file );\n            },\n    \n            /**\n             * @event uploadFinished\n             * @description 当所有文件上传结束时触发。\n             * @for  Uploader\n             */\n            _tick: function() {\n                var me = this,\n                    opts = me.options,\n                    fn, val;\n    \n                // 上一个promise还没有结束，则等待完成后再执行。\n                if ( me._promise ) {\n                    return me._promise.always( me.__tick );\n                }\n    \n                // 还有位置，且还有文件要处理的话。\n                if ( me.pool.length < opts.threads && (val = me._nextBlock()) ) {\n                    me._trigged = false;\n    \n                    fn = function( val ) {\n                        me._promise = null;\n    \n                        // 有可能是reject过来的，所以要检测val的类型。\n                        val && val.file && me._startSend( val );\n                        Base.nextTick( me.__tick );\n                    };\n    \n                    me._promise = isPromise( val ) ? val.always( fn ) : fn( val );\n    \n                // 没有要上传的了，且没有正在传输的了。\n                } else if ( !me.remaning && !me._getStats().numOfQueue &&\n                    !me._getStats().numofInterrupt ) {\n                    me.runing = false;\n    \n                    me._trigged || Base.nextTick(function() {\n                        me.owner.trigger('uploadFinished');\n                    });\n                    me._trigged = true;\n                }\n            },\n    \n            _putback: function(block) {\n                var idx;\n    \n                block.cuted.unshift(block);\n                idx = this.stack.indexOf(block.cuted);\n    \n                if (!~idx) {\n                    this.stack.unshift(block.cuted);\n                }\n            },\n    \n            _getStack: function() {\n                var i = 0,\n                    act;\n    \n                while ( (act = this.stack[ i++ ]) ) {\n                    if ( act.has() && act.file.getStatus() === Status.PROGRESS ) {\n                        return act;\n                    } else if (!act.has() ||\n                            act.file.getStatus() !== Status.PROGRESS &&\n                            act.file.getStatus() !== Status.INTERRUPT ) {\n    \n                        // 把已经处理完了的，或者，状态为非 progress（上传中）、\n                        // interupt（暂停中） 的移除。\n                        this.stack.splice( --i, 1 );\n                    }\n                }\n    \n                return null;\n            },\n    \n            _nextBlock: function() {\n                var me = this,\n                    opts = me.options,\n                    act, next, done, preparing;\n    \n                // 如果当前文件还有没有需要传输的，则直接返回剩下的。\n                if ( (act = this._getStack()) ) {\n    \n                    // 是否提前准备下一个文件\n                    if ( opts.prepareNextFile && !me.pending.length ) {\n                        me._prepareNextFile();\n                    }\n    \n                    return act.shift();\n    \n                // 否则，如果正在运行，则准备下一个文件，并等待完成后返回下个分片。\n                } else if ( me.runing ) {\n    \n                    // 如果缓存中有，则直接在缓存中取，没有则去queue中取。\n                    if ( !me.pending.length && me._getStats().numOfQueue ) {\n                        me._prepareNextFile();\n                    }\n    \n                    next = me.pending.shift();\n                    done = function( file ) {\n                        if ( !file ) {\n                            return null;\n                        }\n    \n                        act = CuteFile( file, opts.chunked ? opts.chunkSize : 0 );\n                        me.stack.push(act);\n                        return act.shift();\n                    };\n    \n                    // 文件可能还在prepare中，也有可能已经完全准备好了。\n                    if ( isPromise( next) ) {\n                        preparing = next.file;\n                        next = next[ next.pipe ? 'pipe' : 'then' ]( done );\n                        next.file = preparing;\n                        return next;\n                    }\n    \n                    return done( next );\n                }\n            },\n    \n    \n            /**\n             * @event uploadStart\n             * @param {File} file File对象\n             * @description 某个文件开始上传前触发，一个文件只会触发一次。\n             * @for  Uploader\n             */\n            _prepareNextFile: function() {\n                var me = this,\n                    file = me.request('fetch-file'),\n                    pending = me.pending,\n                    promise;\n    \n                if ( file ) {\n                    promise = me.request( 'before-send-file', file, function() {\n    \n                        // 有可能文件被skip掉了。文件被skip掉后，状态坑定不是Queued.\n                        if ( file.getStatus() === Status.PROGRESS ||\n                            file.getStatus() === Status.INTERRUPT ) {\n                            return file;\n                        }\n    \n                        return me._finishFile( file );\n                    });\n    \n                    me.owner.trigger( 'uploadStart', file );\n                    file.setStatus( Status.PROGRESS );\n    \n                    promise.file = file;\n    \n                    // 如果还在pending中，则替换成文件本身。\n                    promise.done(function() {\n                        var idx = $.inArray( promise, pending );\n    \n                        ~idx && pending.splice( idx, 1, file );\n                    });\n    \n                    // befeore-send-file的钩子就有错误发生。\n                    promise.fail(function( reason ) {\n                        file.setStatus( Status.ERROR, reason );\n                        me.owner.trigger( 'uploadError', file, reason );\n                        me.owner.trigger( 'uploadComplete', file );\n                    });\n    \n                    pending.push( promise );\n                }\n            },\n    \n            // 让出位置了，可以让其他分片开始上传\n            _popBlock: function( block ) {\n                var idx = $.inArray( block, this.pool );\n    \n                this.pool.splice( idx, 1 );\n                block.file.remaning--;\n                this.remaning--;\n            },\n    \n            // 开始上传，可以被掉过。如果promise被reject了，则表示跳过此分片。\n            _startSend: function( block ) {\n                var me = this,\n                    file = block.file,\n                    promise;\n    \n                // 有可能在 before-send-file 的 promise 期间改变了文件状态。\n                // 如：暂停，取消\n                // 我们不能中断 promise, 但是可以在 promise 完后，不做上传操作。\n                if ( file.getStatus() !== Status.PROGRESS ) {\n    \n                    // 如果是中断，则还需要放回去。\n                    if (file.getStatus() === Status.INTERRUPT) {\n                        me._putback(block);\n                    }\n    \n                    return;\n                }\n    \n                me.pool.push( block );\n                me.remaning++;\n    \n                // 如果没有分片，则直接使用原始的。\n                // 不会丢失content-type信息。\n                block.blob = block.chunks === 1 ? file.source :\n                        file.source.slice( block.start, block.end );\n    \n                // hook, 每个分片发送之前可能要做些异步的事情。\n                promise = me.request( 'before-send', block, function() {\n    \n                    // 有可能文件已经上传出错了，所以不需要再传输了。\n                    if ( file.getStatus() === Status.PROGRESS ) {\n                        me._doSend( block );\n                    } else {\n                        me._popBlock( block );\n                        Base.nextTick( me.__tick );\n                    }\n                });\n    \n                // 如果为fail了，则跳过此分片。\n                promise.fail(function() {\n                    if ( file.remaning === 1 ) {\n                        me._finishFile( file ).always(function() {\n                            block.percentage = 1;\n                            me._popBlock( block );\n                            me.owner.trigger( 'uploadComplete', file );\n                            Base.nextTick( me.__tick );\n                        });\n                    } else {\n                        block.percentage = 1;\n                        me.updateFileProgress( file );\n                        me._popBlock( block );\n                        Base.nextTick( me.__tick );\n                    }\n                });\n            },\n    \n    \n            /**\n             * @event uploadBeforeSend\n             * @param {Object} object\n             * @param {Object} data 默认的上传参数，可以扩展此对象来控制上传参数。\n             * @param {Object} headers 可以扩展此对象来控制上传头部。\n             * @description 当某个文件的分块在发送前触发，主要用来询问是否要添加附带参数，大文件在开起分片上传的前提下此事件可能会触发多次。\n             * @for  Uploader\n             */\n    \n            /**\n             * @event uploadAccept\n             * @param {Object} object\n             * @param {Object} ret 服务端的返回数据，json格式，如果服务端不是json格式，从ret._raw中取数据，自行解析。\n             * @description 当某个文件上传到服务端响应后，会派送此事件来询问服务端响应是否有效。如果此事件handler返回值为`false`, 则此文件将派送`server`类型的`uploadError`事件。\n             * @for  Uploader\n             */\n    \n            /**\n             * @event uploadProgress\n             * @param {File} file File对象\n             * @param {Number} percentage 上传进度\n             * @description 上传过程中触发，携带上传进度。\n             * @for  Uploader\n             */\n    \n    \n            /**\n             * @event uploadError\n             * @param {File} file File对象\n             * @param {String} reason 出错的code\n             * @description 当文件上传出错时触发。\n             * @for  Uploader\n             */\n    \n            /**\n             * @event uploadSuccess\n             * @param {File} file File对象\n             * @param {Object} response 服务端返回的数据\n             * @description 当文件上传成功时触发。\n             * @for  Uploader\n             */\n    \n            /**\n             * @event uploadComplete\n             * @param {File} [file] File对象\n             * @description 不管成功或者失败，文件上传完成时触发。\n             * @for  Uploader\n             */\n    \n            // 做上传操作。\n            _doSend: function( block ) {\n                var me = this,\n                    owner = me.owner,\n                    opts = me.options,\n                    file = block.file,\n                    tr = new Transport( opts ),\n                    data = $.extend({}, opts.formData ),\n                    headers = $.extend({}, opts.headers ),\n                    requestAccept, ret;\n    \n                block.transport = tr;\n    \n                tr.on( 'destroy', function() {\n                    delete block.transport;\n                    me._popBlock( block );\n                    Base.nextTick( me.__tick );\n                });\n    \n                // 广播上传进度。以文件为单位。\n                tr.on( 'progress', function( percentage ) {\n                    block.percentage = percentage;\n                    me.updateFileProgress( file );\n                });\n    \n                // 用来询问，是否返回的结果是有错误的。\n                requestAccept = function( reject ) {\n                    var fn;\n    \n                    ret = tr.getResponseAsJson() || {};\n                    ret._raw = tr.getResponse();\n                    fn = function( value ) {\n                        reject = value;\n                    };\n    \n                    // 服务端响应了，不代表成功了，询问是否响应正确。\n                    if ( !owner.trigger( 'uploadAccept', block, ret, fn ) ) {\n                        reject = reject || 'server';\n                    }\n    \n                    return reject;\n                };\n    \n                // 尝试重试，然后广播文件上传出错。\n                tr.on( 'error', function( type, flag ) {\n                    block.retried = block.retried || 0;\n    \n                    // 自动重试\n                    if ( block.chunks > 1 && ~'http,abort'.indexOf( type ) &&\n                            block.retried < opts.chunkRetry ) {\n    \n                        block.retried++;\n                        tr.send();\n    \n                    } else {\n    \n                        // http status 500 ~ 600\n                        if ( !flag && type === 'server' ) {\n                            type = requestAccept( type );\n                        }\n    \n                        file.setStatus( Status.ERROR, type );\n                        owner.trigger( 'uploadError', file, type );\n                        owner.trigger( 'uploadComplete', file );\n                    }\n                });\n    \n                // 上传成功\n                tr.on( 'load', function() {\n                    var reason;\n    \n                    // 如果非预期，转向上传出错。\n                    if ( (reason = requestAccept()) ) {\n                        tr.trigger( 'error', reason, true );\n                        return;\n                    }\n    \n                    // 全部上传完成。\n                    if ( file.remaning === 1 ) {\n                        me._finishFile( file, ret );\n                    } else {\n                        tr.destroy();\n                    }\n                });\n    \n                // 配置默认的上传字段。\n                data = $.extend( data, {\n                    id: file.id,\n                    name: file.name,\n                    type: file.type,\n                    lastModifiedDate: file.lastModifiedDate,\n                    size: file.size\n                });\n    \n                block.chunks > 1 && $.extend( data, {\n                    chunks: block.chunks,\n                    chunk: block.chunk\n                });\n    \n                // 在发送之间可以添加字段什么的。。。\n                // 如果默认的字段不够使用，可以通过监听此事件来扩展\n                owner.trigger( 'uploadBeforeSend', block, data, headers );\n    \n                // 开始发送。\n                tr.appendBlob( opts.fileVal, block.blob, file.name );\n                tr.append( data );\n                tr.setRequestHeader( headers );\n                tr.send();\n            },\n    \n            // 完成上传。\n            _finishFile: function( file, ret, hds ) {\n                var owner = this.owner;\n    \n                return owner\n                        .request( 'after-send-file', arguments, function() {\n                            file.setStatus( Status.COMPLETE );\n                            owner.trigger( 'uploadSuccess', file, ret, hds );\n                        })\n                        .fail(function( reason ) {\n    \n                            // 如果外部已经标记为invalid什么的，不再改状态。\n                            if ( file.getStatus() === Status.PROGRESS ) {\n                                file.setStatus( Status.ERROR, reason );\n                            }\n    \n                            owner.trigger( 'uploadError', file, reason );\n                        })\n                        .always(function() {\n                            owner.trigger( 'uploadComplete', file );\n                        });\n            },\n    \n            updateFileProgress: function(file) {\n                var totalPercent = 0,\n                    uploaded = 0;\n    \n                if (!file.blocks) {\n                    return;\n                }\n    \n                $.each( file.blocks, function( _, v ) {\n                    uploaded += (v.percentage || 0) * (v.end - v.start);\n                });\n    \n                totalPercent = uploaded / file.size;\n                this.owner.trigger( 'uploadProgress', file, totalPercent || 0 );\n            }\n    \n        });\n    });\n    /**\n     * @fileOverview 各种验证，包括文件总大小是否超出、单文件是否超出和文件是否重复。\n     */\n    \n    define('widgets/validator',[\n        'base',\n        'uploader',\n        'file',\n        'widgets/widget'\n    ], function( Base, Uploader, WUFile ) {\n    \n        var $ = Base.$,\n            validators = {},\n            api;\n    \n        /**\n         * @event error\n         * @param {String} type 错误类型。\n         * @description 当validate不通过时，会以派送错误事件的形式通知调用者。通过`upload.on('error', handler)`可以捕获到此类错误，目前有以下错误会在特定的情况下派送错来。\n         *\n         * * `Q_EXCEED_NUM_LIMIT` 在设置了`fileNumLimit`且尝试给`uploader`添加的文件数量超出这个值时派送。\n         * * `Q_EXCEED_SIZE_LIMIT` 在设置了`Q_EXCEED_SIZE_LIMIT`且尝试给`uploader`添加的文件总大小超出这个值时派送。\n         * * `Q_TYPE_DENIED` 当文件类型不满足时触发。。\n         * @for  Uploader\n         */\n    \n        // 暴露给外面的api\n        api = {\n    \n            // 添加验证器\n            addValidator: function( type, cb ) {\n                validators[ type ] = cb;\n            },\n    \n            // 移除验证器\n            removeValidator: function( type ) {\n                delete validators[ type ];\n            }\n        };\n    \n        // 在Uploader初始化的时候启动Validators的初始化\n        Uploader.register({\n            name: 'validator',\n    \n            init: function() {\n                var me = this;\n                Base.nextTick(function() {\n                    $.each( validators, function() {\n                        this.call( me.owner );\n                    });\n                });\n            }\n        });\n    \n        /**\n         * @property {int} [fileNumLimit=undefined]\n         * @namespace options\n         * @for Uploader\n         * @description 验证文件总数量, 超出则不允许加入队列。\n         */\n        api.addValidator( 'fileNumLimit', function() {\n            var uploader = this,\n                opts = uploader.options,\n                count = 0,\n                max = parseInt( opts.fileNumLimit, 10 ),\n                flag = true;\n    \n            if ( !max ) {\n                return;\n            }\n    \n            uploader.on( 'beforeFileQueued', function( file ) {\n    \n                if ( count >= max && flag ) {\n                    flag = false;\n                    this.trigger( 'error', 'Q_EXCEED_NUM_LIMIT', max, file );\n                    setTimeout(function() {\n                        flag = true;\n                    }, 1 );\n                }\n    \n                return count >= max ? false : true;\n            });\n    \n            uploader.on( 'fileQueued', function() {\n                count++;\n            });\n    \n            uploader.on( 'fileDequeued', function() {\n                count--;\n            });\n    \n            uploader.on( 'reset', function() {\n                count = 0;\n            });\n        });\n    \n    \n        /**\n         * @property {int} [fileSizeLimit=undefined]\n         * @namespace options\n         * @for Uploader\n         * @description 验证文件总大小是否超出限制, 超出则不允许加入队列。\n         */\n        api.addValidator( 'fileSizeLimit', function() {\n            var uploader = this,\n                opts = uploader.options,\n                count = 0,\n                max = parseInt( opts.fileSizeLimit, 10 ),\n                flag = true;\n    \n            if ( !max ) {\n                return;\n            }\n    \n            uploader.on( 'beforeFileQueued', function( file ) {\n                var invalid = count + file.size > max;\n    \n                if ( invalid && flag ) {\n                    flag = false;\n                    this.trigger( 'error', 'Q_EXCEED_SIZE_LIMIT', max, file );\n                    setTimeout(function() {\n                        flag = true;\n                    }, 1 );\n                }\n    \n                return invalid ? false : true;\n            });\n    \n            uploader.on( 'fileQueued', function( file ) {\n                count += file.size;\n            });\n    \n            uploader.on( 'fileDequeued', function( file ) {\n                count -= file.size;\n            });\n    \n            uploader.on( 'reset', function() {\n                count = 0;\n            });\n        });\n    \n        /**\n         * @property {int} [fileSingleSizeLimit=undefined]\n         * @namespace options\n         * @for Uploader\n         * @description 验证单个文件大小是否超出限制, 超出则不允许加入队列。\n         */\n        api.addValidator( 'fileSingleSizeLimit', function() {\n            var uploader = this,\n                opts = uploader.options,\n                max = opts.fileSingleSizeLimit;\n    \n            if ( !max ) {\n                return;\n            }\n    \n            uploader.on( 'beforeFileQueued', function( file ) {\n    \n                if ( file.size > max ) {\n                    file.setStatus( WUFile.Status.INVALID, 'exceed_size' );\n                    this.trigger( 'error', 'F_EXCEED_SIZE', max, file );\n                    return false;\n                }\n    \n            });\n    \n        });\n    \n        /**\n         * @property {Boolean} [duplicate=undefined]\n         * @namespace options\n         * @for Uploader\n         * @description 去重， 根据文件名字、文件大小和最后修改时间来生成hash Key.\n         */\n        api.addValidator( 'duplicate', function() {\n            var uploader = this,\n                opts = uploader.options,\n                mapping = {};\n    \n            if ( opts.duplicate ) {\n                return;\n            }\n    \n            function hashString( str ) {\n                var hash = 0,\n                    i = 0,\n                    len = str.length,\n                    _char;\n    \n                for ( ; i < len; i++ ) {\n                    _char = str.charCodeAt( i );\n                    hash = _char + (hash << 6) + (hash << 16) - hash;\n                }\n    \n                return hash;\n            }\n    \n            uploader.on( 'beforeFileQueued', function( file ) {\n                var hash = file.__hash || (file.__hash = hashString( file.name +\n                        file.size + file.lastModifiedDate ));\n    \n                // 已经重复了\n                if ( mapping[ hash ] ) {\n                    this.trigger( 'error', 'F_DUPLICATE', file );\n                    return false;\n                }\n            });\n    \n            uploader.on( 'fileQueued', function( file ) {\n                var hash = file.__hash;\n    \n                hash && (mapping[ hash ] = true);\n            });\n    \n            uploader.on( 'fileDequeued', function( file ) {\n                var hash = file.__hash;\n    \n                hash && (delete mapping[ hash ]);\n            });\n    \n            uploader.on( 'reset', function() {\n                mapping = {};\n            });\n        });\n    \n        return api;\n    });\n    \n    /**\n     * @fileOverview Md5\n     */\n    define('lib/md5',[\n        'runtime/client',\n        'mediator'\n    ], function( RuntimeClient, Mediator ) {\n    \n        function Md5() {\n            RuntimeClient.call( this, 'Md5' );\n        }\n    \n        // 让 Md5 具备事件功能。\n        Mediator.installTo( Md5.prototype );\n    \n        Md5.prototype.loadFromBlob = function( blob ) {\n            var me = this;\n    \n            if ( me.getRuid() ) {\n                me.disconnectRuntime();\n            }\n    \n            // 连接到blob归属的同一个runtime.\n            me.connectRuntime( blob.ruid, function() {\n                me.exec('init');\n                me.exec( 'loadFromBlob', blob );\n            });\n        };\n    \n        Md5.prototype.getResult = function() {\n            return this.exec('getResult');\n        };\n    \n        return Md5;\n    });\n    /**\n     * @fileOverview 图片操作, 负责预览图片和上传前压缩图片\n     */\n    define('widgets/md5',[\n        'base',\n        'uploader',\n        'lib/md5',\n        'lib/blob',\n        'widgets/widget'\n    ], function( Base, Uploader, Md5, Blob ) {\n    \n        return Uploader.register({\n            name: 'md5',\n    \n    \n            /**\n             * 计算文件 md5 值，返回一个 promise 对象，可以监听 progress 进度。\n             *\n             *\n             * @method md5File\n             * @grammar md5File( file[, start[, end]] ) => promise\n             * @for Uploader\n             * @example\n             *\n             * uploader.on( 'fileQueued', function( file ) {\n             *     var $li = ...;\n             *\n             *     uploader.md5File( file )\n             *\n             *         // 及时显示进度\n             *         .progress(function(percentage) {\n             *             console.log('Percentage:', percentage);\n             *         })\n             *\n             *         // 完成\n             *         .then(function(val) {\n             *             console.log('md5 result:', val);\n             *         });\n             *\n             * });\n             */\n            md5File: function( file, start, end ) {\n                var md5 = new Md5(),\n                    deferred = Base.Deferred(),\n                    blob = (file instanceof Blob) ? file :\n                        this.request( 'get-file', file ).source;\n    \n                md5.on( 'progress load', function( e ) {\n                    e = e || {};\n                    deferred.notify( e.total ? e.loaded / e.total : 1 );\n                });\n    \n                md5.on( 'complete', function() {\n                    deferred.resolve( md5.getResult() );\n                });\n    \n                md5.on( 'error', function( reason ) {\n                    deferred.reject( reason );\n                });\n    \n                if ( arguments.length > 1 ) {\n                    start = start || 0;\n                    end = end || 0;\n                    start < 0 && (start = blob.size + start);\n                    end < 0 && (end = blob.size + end);\n                    end = Math.min( end, blob.size );\n                    blob = blob.slice( start, end );\n                }\n    \n                md5.loadFromBlob( blob );\n    \n                return deferred.promise();\n            }\n        });\n    });\n    /**\n     * @fileOverview Runtime管理器，负责Runtime的选择, 连接\n     */\n    define('runtime/compbase',[],function() {\n    \n        function CompBase( owner, runtime ) {\n    \n            this.owner = owner;\n            this.options = owner.options;\n    \n            this.getRuntime = function() {\n                return runtime;\n            };\n    \n            this.getRuid = function() {\n                return runtime.uid;\n            };\n    \n            this.trigger = function() {\n                return owner.trigger.apply( owner, arguments );\n            };\n        }\n    \n        return CompBase;\n    });\n    /**\n     * @fileOverview Html5Runtime\n     */\n    define('runtime/html5/runtime',[\n        'base',\n        'runtime/runtime',\n        'runtime/compbase'\n    ], function( Base, Runtime, CompBase ) {\n    \n        var type = 'html5',\n            components = {};\n    \n        function Html5Runtime() {\n            var pool = {},\n                me = this,\n                destroy = this.destroy;\n    \n            Runtime.apply( me, arguments );\n            me.type = type;\n    \n    \n            // 这个方法的调用者，实际上是RuntimeClient\n            me.exec = function( comp, fn/*, args...*/) {\n                var client = this,\n                    uid = client.uid,\n                    args = Base.slice( arguments, 2 ),\n                    instance;\n    \n                if ( components[ comp ] ) {\n                    instance = pool[ uid ] = pool[ uid ] ||\n                            new components[ comp ]( client, me );\n    \n                    if ( instance[ fn ] ) {\n                        return instance[ fn ].apply( instance, args );\n                    }\n                }\n            };\n    \n            me.destroy = function() {\n                // @todo 删除池子中的所有实例\n                return destroy && destroy.apply( this, arguments );\n            };\n        }\n    \n        Base.inherits( Runtime, {\n            constructor: Html5Runtime,\n    \n            // 不需要连接其他程序，直接执行callback\n            init: function() {\n                var me = this;\n                setTimeout(function() {\n                    me.trigger('ready');\n                }, 1 );\n            }\n    \n        });\n    \n        // 注册Components\n        Html5Runtime.register = function( name, component ) {\n            var klass = components[ name ] = Base.inherits( CompBase, component );\n            return klass;\n        };\n    \n        // 注册html5运行时。\n        // 只有在支持的前提下注册。\n        if ( window.Blob && window.FileReader && window.DataView ) {\n            Runtime.addRuntime( type, Html5Runtime );\n        }\n    \n        return Html5Runtime;\n    });\n    /**\n     * @fileOverview Blob Html实现\n     */\n    define('runtime/html5/blob',[\n        'runtime/html5/runtime',\n        'lib/blob'\n    ], function( Html5Runtime, Blob ) {\n    \n        return Html5Runtime.register( 'Blob', {\n            slice: function( start, end ) {\n                var blob = this.owner.source,\n                    slice = blob.slice || blob.webkitSlice || blob.mozSlice;\n    \n                blob = slice.call( blob, start, end );\n    \n                return new Blob( this.getRuid(), blob );\n            }\n        });\n    });\n    /**\n     * @fileOverview FilePaste\n     */\n    define('runtime/html5/dnd',[\n        'base',\n        'runtime/html5/runtime',\n        'lib/file'\n    ], function( Base, Html5Runtime, File ) {\n    \n        var $ = Base.$,\n            prefix = 'webuploader-dnd-';\n    \n        return Html5Runtime.register( 'DragAndDrop', {\n            init: function() {\n                var elem = this.elem = this.options.container;\n    \n                this.dragEnterHandler = Base.bindFn( this._dragEnterHandler, this );\n                this.dragOverHandler = Base.bindFn( this._dragOverHandler, this );\n                this.dragLeaveHandler = Base.bindFn( this._dragLeaveHandler, this );\n                this.dropHandler = Base.bindFn( this._dropHandler, this );\n                this.dndOver = false;\n    \n                elem.on( 'dragenter', this.dragEnterHandler );\n                elem.on( 'dragover', this.dragOverHandler );\n                elem.on( 'dragleave', this.dragLeaveHandler );\n                elem.on( 'drop', this.dropHandler );\n    \n                if ( this.options.disableGlobalDnd ) {\n                    $( document ).on( 'dragover', this.dragOverHandler );\n                    $( document ).on( 'drop', this.dropHandler );\n                }\n            },\n    \n            _dragEnterHandler: function( e ) {\n                var me = this,\n                    denied = me._denied || false,\n                    items;\n    \n                e = e.originalEvent || e;\n    \n                if ( !me.dndOver ) {\n                    me.dndOver = true;\n    \n                    // 注意只有 chrome 支持。\n                    items = e.dataTransfer.items;\n    \n                    if ( items && items.length ) {\n                        me._denied = denied = !me.trigger( 'accept', items );\n                    }\n    \n                    me.elem.addClass( prefix + 'over' );\n                    me.elem[ denied ? 'addClass' :\n                            'removeClass' ]( prefix + 'denied' );\n                }\n    \n                e.dataTransfer.dropEffect = denied ? 'none' : 'copy';\n    \n                return false;\n            },\n    \n            _dragOverHandler: function( e ) {\n                // 只处理框内的。\n                var parentElem = this.elem.parent().get( 0 );\n                if ( parentElem && !$.contains( parentElem, e.currentTarget ) ) {\n                    return false;\n                }\n    \n                clearTimeout( this._leaveTimer );\n                this._dragEnterHandler.call( this, e );\n    \n                return false;\n            },\n    \n            _dragLeaveHandler: function() {\n                var me = this,\n                    handler;\n    \n                handler = function() {\n                    me.dndOver = false;\n                    me.elem.removeClass( prefix + 'over ' + prefix + 'denied' );\n                };\n    \n                clearTimeout( me._leaveTimer );\n                me._leaveTimer = setTimeout( handler, 100 );\n                return false;\n            },\n    \n            _dropHandler: function( e ) {\n                var me = this,\n                    ruid = me.getRuid(),\n                    parentElem = me.elem.parent().get( 0 ),\n                    dataTransfer, data;\n    \n                // 只处理框内的。\n                if ( parentElem && !$.contains( parentElem, e.currentTarget ) ) {\n                    return false;\n                }\n    \n                e = e.originalEvent || e;\n                dataTransfer = e.dataTransfer;\n    \n                // 如果是页面内拖拽，还不能处理，不阻止事件。\n                // 此处 ie11 下会报参数错误，\n                try {\n                    data = dataTransfer.getData('text/html');\n                } catch( err ) {\n                }\n    \n                me.dndOver = false;\n                me.elem.removeClass( prefix + 'over' );\n    \n                if ( data || !dataTransfer ) {\n                    return;\n                }\n    \n                me._getTansferFiles( dataTransfer, function( results ) {\n                    me.trigger( 'drop', $.map( results, function( file ) {\n                        return new File( ruid, file );\n                    }) );\n                });\n    \n                return false;\n            },\n    \n            // 如果传入 callback 则去查看文件夹，否则只管当前文件夹。\n            _getTansferFiles: function( dataTransfer, callback ) {\n                var results  = [],\n                    promises = [],\n                    items, files, file, item, i, len, canAccessFolder;\n    \n                items = dataTransfer.items;\n                files = dataTransfer.files;\n    \n                canAccessFolder = !!(items && items[ 0 ].webkitGetAsEntry);\n    \n                for ( i = 0, len = files.length; i < len; i++ ) {\n                    file = files[ i ];\n                    item = items && items[ i ];\n    \n                    if ( canAccessFolder && item.webkitGetAsEntry().isDirectory ) {\n    \n                        promises.push( this._traverseDirectoryTree(\n                                item.webkitGetAsEntry(), results ) );\n                    } else {\n                        results.push( file );\n                    }\n                }\n    \n                Base.when.apply( Base, promises ).done(function() {\n    \n                    if ( !results.length ) {\n                        return;\n                    }\n    \n                    callback( results );\n                });\n            },\n    \n            _traverseDirectoryTree: function( entry, results ) {\n                var deferred = Base.Deferred(),\n                    me = this;\n    \n                if ( entry.isFile ) {\n                    entry.file(function( file ) {\n                        results.push( file );\n                        deferred.resolve();\n                    });\n                } else if ( entry.isDirectory ) {\n                    entry.createReader().readEntries(function( entries ) {\n                        var len = entries.length,\n                            promises = [],\n                            arr = [],    // 为了保证顺序。\n                            i;\n    \n                        for ( i = 0; i < len; i++ ) {\n                            promises.push( me._traverseDirectoryTree(\n                                    entries[ i ], arr ) );\n                        }\n    \n                        Base.when.apply( Base, promises ).then(function() {\n                            results.push.apply( results, arr );\n                            deferred.resolve();\n                        }, deferred.reject );\n                    });\n                }\n    \n                return deferred.promise();\n            },\n    \n            destroy: function() {\n                var elem = this.elem;\n    \n                // 还没 init 就调用 destroy\n                if (!elem) {\n                    return;\n                }\n    \n                elem.off( 'dragenter', this.dragEnterHandler );\n                elem.off( 'dragover', this.dragOverHandler );\n                elem.off( 'dragleave', this.dragLeaveHandler );\n                elem.off( 'drop', this.dropHandler );\n    \n                if ( this.options.disableGlobalDnd ) {\n                    $( document ).off( 'dragover', this.dragOverHandler );\n                    $( document ).off( 'drop', this.dropHandler );\n                }\n            }\n        });\n    });\n    \n    /**\n     * @fileOverview FilePaste\n     */\n    define('runtime/html5/filepaste',[\n        'base',\n        'runtime/html5/runtime',\n        'lib/file'\n    ], function( Base, Html5Runtime, File ) {\n    \n        return Html5Runtime.register( 'FilePaste', {\n            init: function() {\n                var opts = this.options,\n                    elem = this.elem = opts.container,\n                    accept = '.*',\n                    arr, i, len, item;\n    \n                // accetp的mimeTypes中生成匹配正则。\n                if ( opts.accept ) {\n                    arr = [];\n    \n                    for ( i = 0, len = opts.accept.length; i < len; i++ ) {\n                        item = opts.accept[ i ].mimeTypes;\n                        item && arr.push( item );\n                    }\n    \n                    if ( arr.length ) {\n                        accept = arr.join(',');\n                        accept = accept.replace( /,/g, '|' ).replace( /\\*/g, '.*' );\n                    }\n                }\n                this.accept = accept = new RegExp( accept, 'i' );\n                this.hander = Base.bindFn( this._pasteHander, this );\n                elem.on( 'paste', this.hander );\n            },\n    \n            _pasteHander: function( e ) {\n                var allowed = [],\n                    ruid = this.getRuid(),\n                    items, item, blob, i, len;\n    \n                e = e.originalEvent || e;\n                items = e.clipboardData.items;\n    \n                for ( i = 0, len = items.length; i < len; i++ ) {\n                    item = items[ i ];\n    \n                    if ( item.kind !== 'file' || !(blob = item.getAsFile()) ) {\n                        continue;\n                    }\n    \n                    allowed.push( new File( ruid, blob ) );\n                }\n    \n                if ( allowed.length ) {\n                    // 不阻止非文件粘贴（文字粘贴）的事件冒泡\n                    e.preventDefault();\n                    e.stopPropagation();\n                    this.trigger( 'paste', allowed );\n                }\n            },\n    \n            destroy: function() {\n                this.elem.off( 'paste', this.hander );\n            }\n        });\n    });\n    \n    /**\n     * @fileOverview FilePicker\n     */\n    define('runtime/html5/filepicker',[\n        'base',\n        'runtime/html5/runtime'\n    ], function( Base, Html5Runtime ) {\n    \n        var $ = Base.$;\n    \n        return Html5Runtime.register( 'FilePicker', {\n            init: function() {\n                var container = this.getRuntime().getContainer(),\n                    me = this,\n                    owner = me.owner,\n                    opts = me.options,\n                    label = this.label = $( document.createElement('label') ),\n                    input =  this.input = $( document.createElement('input') ),\n                    arr, i, len, mouseHandler, inputChange;\n    \n                input.attr( 'type', 'file' );\n                input.attr( 'name', opts.name );\n                input.addClass('webuploader-element-invisible');\n    \n                label.on( 'click', function() {\n                    input.trigger('click');\n                });\n    \n                label.css({\n                    opacity: 0,\n                    width: '100%',\n                    height: '100%',\n                    display: 'block',\n                    cursor: 'pointer',\n                    background: '#ffffff'\n                });\n    \n                if ( opts.multiple ) {\n                    input.attr( 'multiple', 'multiple' );\n                }\n    \n                // @todo Firefox不支持单独指定后缀\n                if ( opts.accept && opts.accept.length > 0 ) {\n                    arr = [];\n    \n                    for ( i = 0, len = opts.accept.length; i < len; i++ ) {\n                        arr.push( opts.accept[ i ].mimeTypes );\n                    }\n    \n                    input.attr( 'accept', arr.join(',') );\n                }\n    \n                container.append( input );\n                container.append( label );\n    \n                mouseHandler = function( e ) {\n                    owner.trigger( e.type );\n                };\n\n                inputChange = function( e ) {\n                \tvar clone;\n                \tme.files = e.target.files;\n    \n                    // reset input\n                    clone = this.cloneNode( true );\n                    clone.value = null;\n                    this.parentNode.replaceChild( clone, this );\n    \n                    input.off();\n                    input = $( clone ).on( 'change', inputChange )\n                            .on( 'mouseenter mouseleave', mouseHandler );\n    \n                    owner.trigger('change');\n                };\n    \n                input.on( 'change', inputChange);\n    \n                label.on( 'mouseenter mouseleave', mouseHandler );\n    \n            },\n    \n    \n            getFiles: function() {\n                return this.files;\n            },\n    \n            destroy: function() {\n                this.input.off();\n                this.label.off();\n            }\n        });\n    });\n    \n    /**\n     * Terms:\n     *\n     * Uint8Array, FileReader, BlobBuilder, atob, ArrayBuffer\n     * @fileOverview Image控件\n     */\n    define('runtime/html5/util',[\n        'base'\n    ], function( Base ) {\n    \n        var urlAPI = window.createObjectURL && window ||\n                window.URL && URL.revokeObjectURL && URL ||\n                window.webkitURL,\n            createObjectURL = Base.noop,\n            revokeObjectURL = createObjectURL;\n    \n        if ( urlAPI ) {\n    \n            // 更安全的方式调用，比如android里面就能把context改成其他的对象。\n            createObjectURL = function() {\n                return urlAPI.createObjectURL.apply( urlAPI, arguments );\n            };\n    \n            revokeObjectURL = function() {\n                return urlAPI.revokeObjectURL.apply( urlAPI, arguments );\n            };\n        }\n    \n        return {\n            createObjectURL: createObjectURL,\n            revokeObjectURL: revokeObjectURL,\n    \n            dataURL2Blob: function( dataURI ) {\n                var byteStr, intArray, ab, i, mimetype, parts;\n    \n                parts = dataURI.split(',');\n    \n                if ( ~parts[ 0 ].indexOf('base64') ) {\n                    byteStr = atob( parts[ 1 ] );\n                } else {\n                    byteStr = decodeURIComponent( parts[ 1 ] );\n                }\n    \n                ab = new ArrayBuffer( byteStr.length );\n                intArray = new Uint8Array( ab );\n    \n                for ( i = 0; i < byteStr.length; i++ ) {\n                    intArray[ i ] = byteStr.charCodeAt( i );\n                }\n    \n                mimetype = parts[ 0 ].split(':')[ 1 ].split(';')[ 0 ];\n    \n                return this.arrayBufferToBlob( ab, mimetype );\n            },\n    \n            dataURL2ArrayBuffer: function( dataURI ) {\n                var byteStr, intArray, i, parts;\n    \n                parts = dataURI.split(',');\n    \n                if ( ~parts[ 0 ].indexOf('base64') ) {\n                    byteStr = atob( parts[ 1 ] );\n                } else {\n                    byteStr = decodeURIComponent( parts[ 1 ] );\n                }\n    \n                intArray = new Uint8Array( byteStr.length );\n    \n                for ( i = 0; i < byteStr.length; i++ ) {\n                    intArray[ i ] = byteStr.charCodeAt( i );\n                }\n    \n                return intArray.buffer;\n            },\n    \n            arrayBufferToBlob: function( buffer, type ) {\n                var builder = window.BlobBuilder || window.WebKitBlobBuilder,\n                    bb;\n    \n                // android不支持直接new Blob, 只能借助blobbuilder.\n                if ( builder ) {\n                    bb = new builder();\n                    bb.append( buffer );\n                    return bb.getBlob( type );\n                }\n    \n                return new Blob([ buffer ], type ? { type: type } : {} );\n            },\n    \n            // 抽出来主要是为了解决android下面canvas.toDataUrl不支持jpeg.\n            // 你得到的结果是png.\n            canvasToDataUrl: function( canvas, type, quality ) {\n                return canvas.toDataURL( type, quality / 100 );\n            },\n    \n            // imagemeat会复写这个方法，如果用户选择加载那个文件了的话。\n            parseMeta: function( blob, callback ) {\n                callback( false, {});\n            },\n    \n            // imagemeat会复写这个方法，如果用户选择加载那个文件了的话。\n            updateImageHead: function( data ) {\n                return data;\n            }\n        };\n    });\n    \n    /**\n     * Terms:\n     *\n     * Uint8Array, FileReader, BlobBuilder, atob, ArrayBuffer\n     * @fileOverview Image控件\n     */\n    define('runtime/html5/imagemeta',[\n        'runtime/html5/util'\n    ], function( Util ) {\n    \n        var api;\n    \n        api = {\n            parsers: {\n                0xffe1: []\n            },\n    \n            maxMetaDataSize: 262144,\n    \n            parse: function( blob, cb ) {\n                var me = this,\n                    fr = new FileReader();\n    \n                fr.onload = function() {\n                    cb( false, me._parse( this.result ) );\n                    fr = fr.onload = fr.onerror = null;\n                };\n    \n                fr.onerror = function( e ) {\n                    cb( e.message );\n                    fr = fr.onload = fr.onerror = null;\n                };\n    \n                blob = blob.slice( 0, me.maxMetaDataSize );\n                fr.readAsArrayBuffer( blob.getSource() );\n            },\n    \n            _parse: function( buffer, noParse ) {\n                if ( buffer.byteLength < 6 ) {\n                    return;\n                }\n    \n                var dataview = new DataView( buffer ),\n                    offset = 2,\n                    maxOffset = dataview.byteLength - 4,\n                    headLength = offset,\n                    ret = {},\n                    markerBytes, markerLength, parsers, i;\n    \n                if ( dataview.getUint16( 0 ) === 0xffd8 ) {\n    \n                    while ( offset < maxOffset ) {\n                        markerBytes = dataview.getUint16( offset );\n    \n                        if ( markerBytes >= 0xffe0 && markerBytes <= 0xffef ||\n                                markerBytes === 0xfffe ) {\n    \n                            markerLength = dataview.getUint16( offset + 2 ) + 2;\n    \n                            if ( offset + markerLength > dataview.byteLength ) {\n                                break;\n                            }\n    \n                            parsers = api.parsers[ markerBytes ];\n    \n                            if ( !noParse && parsers ) {\n                                for ( i = 0; i < parsers.length; i += 1 ) {\n                                    parsers[ i ].call( api, dataview, offset,\n                                            markerLength, ret );\n                                }\n                            }\n    \n                            offset += markerLength;\n                            headLength = offset;\n                        } else {\n                            break;\n                        }\n                    }\n    \n                    if ( headLength > 6 ) {\n                        if ( buffer.slice ) {\n                            ret.imageHead = buffer.slice( 2, headLength );\n                        } else {\n                            // Workaround for IE10, which does not yet\n                            // support ArrayBuffer.slice:\n                            ret.imageHead = new Uint8Array( buffer )\n                                    .subarray( 2, headLength );\n                        }\n                    }\n                }\n    \n                return ret;\n            },\n    \n            updateImageHead: function( buffer, head ) {\n                var data = this._parse( buffer, true ),\n                    buf1, buf2, bodyoffset;\n    \n    \n                bodyoffset = 2;\n                if ( data.imageHead ) {\n                    bodyoffset = 2 + data.imageHead.byteLength;\n                }\n    \n                if ( buffer.slice ) {\n                    buf2 = buffer.slice( bodyoffset );\n                } else {\n                    buf2 = new Uint8Array( buffer ).subarray( bodyoffset );\n                }\n    \n                buf1 = new Uint8Array( head.byteLength + 2 + buf2.byteLength );\n    \n                buf1[ 0 ] = 0xFF;\n                buf1[ 1 ] = 0xD8;\n                buf1.set( new Uint8Array( head ), 2 );\n                buf1.set( new Uint8Array( buf2 ), head.byteLength + 2 );\n    \n                return buf1.buffer;\n            }\n        };\n    \n        Util.parseMeta = function() {\n            return api.parse.apply( api, arguments );\n        };\n    \n        Util.updateImageHead = function() {\n            return api.updateImageHead.apply( api, arguments );\n        };\n    \n        return api;\n    });\n    /**\n     * 代码来自于：https://github.com/blueimp/JavaScript-Load-Image\n     * 暂时项目中只用了orientation.\n     *\n     * 去除了 Exif Sub IFD Pointer, GPS Info IFD Pointer, Exif Thumbnail.\n     * @fileOverview EXIF解析\n     */\n    \n    // Sample\n    // ====================================\n    // Make : Apple\n    // Model : iPhone 4S\n    // Orientation : 1\n    // XResolution : 72 [72/1]\n    // YResolution : 72 [72/1]\n    // ResolutionUnit : 2\n    // Software : QuickTime 7.7.1\n    // DateTime : 2013:09:01 22:53:55\n    // ExifIFDPointer : 190\n    // ExposureTime : 0.058823529411764705 [1/17]\n    // FNumber : 2.4 [12/5]\n    // ExposureProgram : Normal program\n    // ISOSpeedRatings : 800\n    // ExifVersion : 0220\n    // DateTimeOriginal : 2013:09:01 22:52:51\n    // DateTimeDigitized : 2013:09:01 22:52:51\n    // ComponentsConfiguration : YCbCr\n    // ShutterSpeedValue : 4.058893515764426\n    // ApertureValue : 2.5260688216892597 [4845/1918]\n    // BrightnessValue : -0.3126686601998395\n    // MeteringMode : Pattern\n    // Flash : Flash did not fire, compulsory flash mode\n    // FocalLength : 4.28 [107/25]\n    // SubjectArea : [4 values]\n    // FlashpixVersion : 0100\n    // ColorSpace : 1\n    // PixelXDimension : 2448\n    // PixelYDimension : 3264\n    // SensingMethod : One-chip color area sensor\n    // ExposureMode : 0\n    // WhiteBalance : Auto white balance\n    // FocalLengthIn35mmFilm : 35\n    // SceneCaptureType : Standard\n    define('runtime/html5/imagemeta/exif',[\n        'base',\n        'runtime/html5/imagemeta'\n    ], function( Base, ImageMeta ) {\n    \n        var EXIF = {};\n    \n        EXIF.ExifMap = function() {\n            return this;\n        };\n    \n        EXIF.ExifMap.prototype.map = {\n            'Orientation': 0x0112\n        };\n    \n        EXIF.ExifMap.prototype.get = function( id ) {\n            return this[ id ] || this[ this.map[ id ] ];\n        };\n    \n        EXIF.exifTagTypes = {\n            // byte, 8-bit unsigned int:\n            1: {\n                getValue: function( dataView, dataOffset ) {\n                    return dataView.getUint8( dataOffset );\n                },\n                size: 1\n            },\n    \n            // ascii, 8-bit byte:\n            2: {\n                getValue: function( dataView, dataOffset ) {\n                    return String.fromCharCode( dataView.getUint8( dataOffset ) );\n                },\n                size: 1,\n                ascii: true\n            },\n    \n            // short, 16 bit int:\n            3: {\n                getValue: function( dataView, dataOffset, littleEndian ) {\n                    return dataView.getUint16( dataOffset, littleEndian );\n                },\n                size: 2\n            },\n    \n            // long, 32 bit int:\n            4: {\n                getValue: function( dataView, dataOffset, littleEndian ) {\n                    return dataView.getUint32( dataOffset, littleEndian );\n                },\n                size: 4\n            },\n    \n            // rational = two long values,\n            // first is numerator, second is denominator:\n            5: {\n                getValue: function( dataView, dataOffset, littleEndian ) {\n                    return dataView.getUint32( dataOffset, littleEndian ) /\n                        dataView.getUint32( dataOffset + 4, littleEndian );\n                },\n                size: 8\n            },\n    \n            // slong, 32 bit signed int:\n            9: {\n                getValue: function( dataView, dataOffset, littleEndian ) {\n                    return dataView.getInt32( dataOffset, littleEndian );\n                },\n                size: 4\n            },\n    \n            // srational, two slongs, first is numerator, second is denominator:\n            10: {\n                getValue: function( dataView, dataOffset, littleEndian ) {\n                    return dataView.getInt32( dataOffset, littleEndian ) /\n                        dataView.getInt32( dataOffset + 4, littleEndian );\n                },\n                size: 8\n            }\n        };\n    \n        // undefined, 8-bit byte, value depending on field:\n        EXIF.exifTagTypes[ 7 ] = EXIF.exifTagTypes[ 1 ];\n    \n        EXIF.getExifValue = function( dataView, tiffOffset, offset, type, length,\n                littleEndian ) {\n    \n            var tagType = EXIF.exifTagTypes[ type ],\n                tagSize, dataOffset, values, i, str, c;\n    \n            if ( !tagType ) {\n                Base.log('Invalid Exif data: Invalid tag type.');\n                return;\n            }\n    \n            tagSize = tagType.size * length;\n    \n            // Determine if the value is contained in the dataOffset bytes,\n            // or if the value at the dataOffset is a pointer to the actual data:\n            dataOffset = tagSize > 4 ? tiffOffset + dataView.getUint32( offset + 8,\n                    littleEndian ) : (offset + 8);\n    \n            if ( dataOffset + tagSize > dataView.byteLength ) {\n                Base.log('Invalid Exif data: Invalid data offset.');\n                return;\n            }\n    \n            if ( length === 1 ) {\n                return tagType.getValue( dataView, dataOffset, littleEndian );\n            }\n    \n            values = [];\n    \n            for ( i = 0; i < length; i += 1 ) {\n                values[ i ] = tagType.getValue( dataView,\n                        dataOffset + i * tagType.size, littleEndian );\n            }\n    \n            if ( tagType.ascii ) {\n                str = '';\n    \n                // Concatenate the chars:\n                for ( i = 0; i < values.length; i += 1 ) {\n                    c = values[ i ];\n    \n                    // Ignore the terminating NULL byte(s):\n                    if ( c === '\\u0000' ) {\n                        break;\n                    }\n                    str += c;\n                }\n    \n                return str;\n            }\n            return values;\n        };\n    \n        EXIF.parseExifTag = function( dataView, tiffOffset, offset, littleEndian,\n                data ) {\n    \n            var tag = dataView.getUint16( offset, littleEndian );\n            data.exif[ tag ] = EXIF.getExifValue( dataView, tiffOffset, offset,\n                    dataView.getUint16( offset + 2, littleEndian ),    // tag type\n                    dataView.getUint32( offset + 4, littleEndian ),    // tag length\n                    littleEndian );\n        };\n    \n        EXIF.parseExifTags = function( dataView, tiffOffset, dirOffset,\n                littleEndian, data ) {\n    \n            var tagsNumber, dirEndOffset, i;\n    \n            if ( dirOffset + 6 > dataView.byteLength ) {\n                Base.log('Invalid Exif data: Invalid directory offset.');\n                return;\n            }\n    \n            tagsNumber = dataView.getUint16( dirOffset, littleEndian );\n            dirEndOffset = dirOffset + 2 + 12 * tagsNumber;\n    \n            if ( dirEndOffset + 4 > dataView.byteLength ) {\n                Base.log('Invalid Exif data: Invalid directory size.');\n                return;\n            }\n    \n            for ( i = 0; i < tagsNumber; i += 1 ) {\n                this.parseExifTag( dataView, tiffOffset,\n                        dirOffset + 2 + 12 * i,    // tag offset\n                        littleEndian, data );\n            }\n    \n            // Return the offset to the next directory:\n            return dataView.getUint32( dirEndOffset, littleEndian );\n        };\n    \n        // EXIF.getExifThumbnail = function(dataView, offset, length) {\n        //     var hexData,\n        //         i,\n        //         b;\n        //     if (!length || offset + length > dataView.byteLength) {\n        //         Base.log('Invalid Exif data: Invalid thumbnail data.');\n        //         return;\n        //     }\n        //     hexData = [];\n        //     for (i = 0; i < length; i += 1) {\n        //         b = dataView.getUint8(offset + i);\n        //         hexData.push((b < 16 ? '0' : '') + b.toString(16));\n        //     }\n        //     return 'data:image/jpeg,%' + hexData.join('%');\n        // };\n    \n        EXIF.parseExifData = function( dataView, offset, length, data ) {\n    \n            var tiffOffset = offset + 10,\n                littleEndian, dirOffset;\n    \n            // Check for the ASCII code for \"Exif\" (0x45786966):\n            if ( dataView.getUint32( offset + 4 ) !== 0x45786966 ) {\n                // No Exif data, might be XMP data instead\n                return;\n            }\n            if ( tiffOffset + 8 > dataView.byteLength ) {\n                Base.log('Invalid Exif data: Invalid segment size.');\n                return;\n            }\n    \n            // Check for the two null bytes:\n            if ( dataView.getUint16( offset + 8 ) !== 0x0000 ) {\n                Base.log('Invalid Exif data: Missing byte alignment offset.');\n                return;\n            }\n    \n            // Check the byte alignment:\n            switch ( dataView.getUint16( tiffOffset ) ) {\n                case 0x4949:\n                    littleEndian = true;\n                    break;\n    \n                case 0x4D4D:\n                    littleEndian = false;\n                    break;\n    \n                default:\n                    Base.log('Invalid Exif data: Invalid byte alignment marker.');\n                    return;\n            }\n    \n            // Check for the TIFF tag marker (0x002A):\n            if ( dataView.getUint16( tiffOffset + 2, littleEndian ) !== 0x002A ) {\n                Base.log('Invalid Exif data: Missing TIFF marker.');\n                return;\n            }\n    \n            // Retrieve the directory offset bytes, usually 0x00000008 or 8 decimal:\n            dirOffset = dataView.getUint32( tiffOffset + 4, littleEndian );\n            // Create the exif object to store the tags:\n            data.exif = new EXIF.ExifMap();\n            // Parse the tags of the main image directory and retrieve the\n            // offset to the next directory, usually the thumbnail directory:\n            dirOffset = EXIF.parseExifTags( dataView, tiffOffset,\n                    tiffOffset + dirOffset, littleEndian, data );\n    \n            // 尝试读取缩略图\n            // if ( dirOffset ) {\n            //     thumbnailData = {exif: {}};\n            //     dirOffset = EXIF.parseExifTags(\n            //         dataView,\n            //         tiffOffset,\n            //         tiffOffset + dirOffset,\n            //         littleEndian,\n            //         thumbnailData\n            //     );\n    \n            //     // Check for JPEG Thumbnail offset:\n            //     if (thumbnailData.exif[0x0201]) {\n            //         data.exif.Thumbnail = EXIF.getExifThumbnail(\n            //             dataView,\n            //             tiffOffset + thumbnailData.exif[0x0201],\n            //             thumbnailData.exif[0x0202] // Thumbnail data length\n            //         );\n            //     }\n            // }\n        };\n    \n        ImageMeta.parsers[ 0xffe1 ].push( EXIF.parseExifData );\n        return EXIF;\n    });\n    /**\n     * 这个方式性能不行，但是可以解决android里面的toDataUrl的bug\n     * android里面toDataUrl('image/jpege')得到的结果却是png.\n     *\n     * 所以这里没辙，只能借助这个工具\n     * @fileOverview jpeg encoder\n     */\n    define('runtime/html5/jpegencoder',[], function( require, exports, module ) {\n    \n        /*\n          Copyright (c) 2008, Adobe Systems Incorporated\n          All rights reserved.\n    \n          Redistribution and use in source and binary forms, with or without\n          modification, are permitted provided that the following conditions are\n          met:\n    \n          * Redistributions of source code must retain the above copyright notice,\n            this list of conditions and the following disclaimer.\n    \n          * Redistributions in binary form must reproduce the above copyright\n            notice, this list of conditions and the following disclaimer in the\n            documentation and/or other materials provided with the distribution.\n    \n          * Neither the name of Adobe Systems Incorporated nor the names of its\n            contributors may be used to endorse or promote products derived from\n            this software without specific prior written permission.\n    \n          THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS\n          IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO,\n          THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR\n          PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR\n          CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,\n          EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,\n          PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR\n          PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF\n          LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING\n          NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS\n          SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n        */\n        /*\n        JPEG encoder ported to JavaScript and optimized by Andreas Ritter, www.bytestrom.eu, 11/2009\n    \n        Basic GUI blocking jpeg encoder\n        */\n    \n        function JPEGEncoder(quality) {\n          var self = this;\n            var fround = Math.round;\n            var ffloor = Math.floor;\n            var YTable = new Array(64);\n            var UVTable = new Array(64);\n            var fdtbl_Y = new Array(64);\n            var fdtbl_UV = new Array(64);\n            var YDC_HT;\n            var UVDC_HT;\n            var YAC_HT;\n            var UVAC_HT;\n    \n            var bitcode = new Array(65535);\n            var category = new Array(65535);\n            var outputfDCTQuant = new Array(64);\n            var DU = new Array(64);\n            var byteout = [];\n            var bytenew = 0;\n            var bytepos = 7;\n    \n            var YDU = new Array(64);\n            var UDU = new Array(64);\n            var VDU = new Array(64);\n            var clt = new Array(256);\n            var RGB_YUV_TABLE = new Array(2048);\n            var currentQuality;\n    \n            var ZigZag = [\n                     0, 1, 5, 6,14,15,27,28,\n                     2, 4, 7,13,16,26,29,42,\n                     3, 8,12,17,25,30,41,43,\n                     9,11,18,24,31,40,44,53,\n                    10,19,23,32,39,45,52,54,\n                    20,22,33,38,46,51,55,60,\n                    21,34,37,47,50,56,59,61,\n                    35,36,48,49,57,58,62,63\n                ];\n    \n            var std_dc_luminance_nrcodes = [0,0,1,5,1,1,1,1,1,1,0,0,0,0,0,0,0];\n            var std_dc_luminance_values = [0,1,2,3,4,5,6,7,8,9,10,11];\n            var std_ac_luminance_nrcodes = [0,0,2,1,3,3,2,4,3,5,5,4,4,0,0,1,0x7d];\n            var std_ac_luminance_values = [\n                    0x01,0x02,0x03,0x00,0x04,0x11,0x05,0x12,\n                    0x21,0x31,0x41,0x06,0x13,0x51,0x61,0x07,\n                    0x22,0x71,0x14,0x32,0x81,0x91,0xa1,0x08,\n                    0x23,0x42,0xb1,0xc1,0x15,0x52,0xd1,0xf0,\n                    0x24,0x33,0x62,0x72,0x82,0x09,0x0a,0x16,\n                    0x17,0x18,0x19,0x1a,0x25,0x26,0x27,0x28,\n                    0x29,0x2a,0x34,0x35,0x36,0x37,0x38,0x39,\n                    0x3a,0x43,0x44,0x45,0x46,0x47,0x48,0x49,\n                    0x4a,0x53,0x54,0x55,0x56,0x57,0x58,0x59,\n                    0x5a,0x63,0x64,0x65,0x66,0x67,0x68,0x69,\n                    0x6a,0x73,0x74,0x75,0x76,0x77,0x78,0x79,\n                    0x7a,0x83,0x84,0x85,0x86,0x87,0x88,0x89,\n                    0x8a,0x92,0x93,0x94,0x95,0x96,0x97,0x98,\n                    0x99,0x9a,0xa2,0xa3,0xa4,0xa5,0xa6,0xa7,\n                    0xa8,0xa9,0xaa,0xb2,0xb3,0xb4,0xb5,0xb6,\n                    0xb7,0xb8,0xb9,0xba,0xc2,0xc3,0xc4,0xc5,\n                    0xc6,0xc7,0xc8,0xc9,0xca,0xd2,0xd3,0xd4,\n                    0xd5,0xd6,0xd7,0xd8,0xd9,0xda,0xe1,0xe2,\n                    0xe3,0xe4,0xe5,0xe6,0xe7,0xe8,0xe9,0xea,\n                    0xf1,0xf2,0xf3,0xf4,0xf5,0xf6,0xf7,0xf8,\n                    0xf9,0xfa\n                ];\n    \n            var std_dc_chrominance_nrcodes = [0,0,3,1,1,1,1,1,1,1,1,1,0,0,0,0,0];\n            var std_dc_chrominance_values = [0,1,2,3,4,5,6,7,8,9,10,11];\n            var std_ac_chrominance_nrcodes = [0,0,2,1,2,4,4,3,4,7,5,4,4,0,1,2,0x77];\n            var std_ac_chrominance_values = [\n                    0x00,0x01,0x02,0x03,0x11,0x04,0x05,0x21,\n                    0x31,0x06,0x12,0x41,0x51,0x07,0x61,0x71,\n                    0x13,0x22,0x32,0x81,0x08,0x14,0x42,0x91,\n                    0xa1,0xb1,0xc1,0x09,0x23,0x33,0x52,0xf0,\n                    0x15,0x62,0x72,0xd1,0x0a,0x16,0x24,0x34,\n                    0xe1,0x25,0xf1,0x17,0x18,0x19,0x1a,0x26,\n                    0x27,0x28,0x29,0x2a,0x35,0x36,0x37,0x38,\n                    0x39,0x3a,0x43,0x44,0x45,0x46,0x47,0x48,\n                    0x49,0x4a,0x53,0x54,0x55,0x56,0x57,0x58,\n                    0x59,0x5a,0x63,0x64,0x65,0x66,0x67,0x68,\n                    0x69,0x6a,0x73,0x74,0x75,0x76,0x77,0x78,\n                    0x79,0x7a,0x82,0x83,0x84,0x85,0x86,0x87,\n                    0x88,0x89,0x8a,0x92,0x93,0x94,0x95,0x96,\n                    0x97,0x98,0x99,0x9a,0xa2,0xa3,0xa4,0xa5,\n                    0xa6,0xa7,0xa8,0xa9,0xaa,0xb2,0xb3,0xb4,\n                    0xb5,0xb6,0xb7,0xb8,0xb9,0xba,0xc2,0xc3,\n                    0xc4,0xc5,0xc6,0xc7,0xc8,0xc9,0xca,0xd2,\n                    0xd3,0xd4,0xd5,0xd6,0xd7,0xd8,0xd9,0xda,\n                    0xe2,0xe3,0xe4,0xe5,0xe6,0xe7,0xe8,0xe9,\n                    0xea,0xf2,0xf3,0xf4,0xf5,0xf6,0xf7,0xf8,\n                    0xf9,0xfa\n                ];\n    \n            function initQuantTables(sf){\n                    var YQT = [\n                        16, 11, 10, 16, 24, 40, 51, 61,\n                        12, 12, 14, 19, 26, 58, 60, 55,\n                        14, 13, 16, 24, 40, 57, 69, 56,\n                        14, 17, 22, 29, 51, 87, 80, 62,\n                        18, 22, 37, 56, 68,109,103, 77,\n                        24, 35, 55, 64, 81,104,113, 92,\n                        49, 64, 78, 87,103,121,120,101,\n                        72, 92, 95, 98,112,100,103, 99\n                    ];\n    \n                    for (var i = 0; i < 64; i++) {\n                        var t = ffloor((YQT[i]*sf+50)/100);\n                        if (t < 1) {\n                            t = 1;\n                        } else if (t > 255) {\n                            t = 255;\n                        }\n                        YTable[ZigZag[i]] = t;\n                    }\n                    var UVQT = [\n                        17, 18, 24, 47, 99, 99, 99, 99,\n                        18, 21, 26, 66, 99, 99, 99, 99,\n                        24, 26, 56, 99, 99, 99, 99, 99,\n                        47, 66, 99, 99, 99, 99, 99, 99,\n                        99, 99, 99, 99, 99, 99, 99, 99,\n                        99, 99, 99, 99, 99, 99, 99, 99,\n                        99, 99, 99, 99, 99, 99, 99, 99,\n                        99, 99, 99, 99, 99, 99, 99, 99\n                    ];\n                    for (var j = 0; j < 64; j++) {\n                        var u = ffloor((UVQT[j]*sf+50)/100);\n                        if (u < 1) {\n                            u = 1;\n                        } else if (u > 255) {\n                            u = 255;\n                        }\n                        UVTable[ZigZag[j]] = u;\n                    }\n                    var aasf = [\n                        1.0, 1.387039845, 1.306562965, 1.175875602,\n                        1.0, 0.785694958, 0.541196100, 0.275899379\n                    ];\n                    var k = 0;\n                    for (var row = 0; row < 8; row++)\n                    {\n                        for (var col = 0; col < 8; col++)\n                        {\n                            fdtbl_Y[k]  = (1.0 / (YTable [ZigZag[k]] * aasf[row] * aasf[col] * 8.0));\n                            fdtbl_UV[k] = (1.0 / (UVTable[ZigZag[k]] * aasf[row] * aasf[col] * 8.0));\n                            k++;\n                        }\n                    }\n                }\n    \n                function computeHuffmanTbl(nrcodes, std_table){\n                    var codevalue = 0;\n                    var pos_in_table = 0;\n                    var HT = new Array();\n                    for (var k = 1; k <= 16; k++) {\n                        for (var j = 1; j <= nrcodes[k]; j++) {\n                            HT[std_table[pos_in_table]] = [];\n                            HT[std_table[pos_in_table]][0] = codevalue;\n                            HT[std_table[pos_in_table]][1] = k;\n                            pos_in_table++;\n                            codevalue++;\n                        }\n                        codevalue*=2;\n                    }\n                    return HT;\n                }\n    \n                function initHuffmanTbl()\n                {\n                    YDC_HT = computeHuffmanTbl(std_dc_luminance_nrcodes,std_dc_luminance_values);\n                    UVDC_HT = computeHuffmanTbl(std_dc_chrominance_nrcodes,std_dc_chrominance_values);\n                    YAC_HT = computeHuffmanTbl(std_ac_luminance_nrcodes,std_ac_luminance_values);\n                    UVAC_HT = computeHuffmanTbl(std_ac_chrominance_nrcodes,std_ac_chrominance_values);\n                }\n    \n                function initCategoryNumber()\n                {\n                    var nrlower = 1;\n                    var nrupper = 2;\n                    for (var cat = 1; cat <= 15; cat++) {\n                        //Positive numbers\n                        for (var nr = nrlower; nr<nrupper; nr++) {\n                            category[32767+nr] = cat;\n                            bitcode[32767+nr] = [];\n                            bitcode[32767+nr][1] = cat;\n                            bitcode[32767+nr][0] = nr;\n                        }\n                        //Negative numbers\n                        for (var nrneg =-(nrupper-1); nrneg<=-nrlower; nrneg++) {\n                            category[32767+nrneg] = cat;\n                            bitcode[32767+nrneg] = [];\n                            bitcode[32767+nrneg][1] = cat;\n                            bitcode[32767+nrneg][0] = nrupper-1+nrneg;\n                        }\n                        nrlower <<= 1;\n                        nrupper <<= 1;\n                    }\n                }\n    \n                function initRGBYUVTable() {\n                    for(var i = 0; i < 256;i++) {\n                        RGB_YUV_TABLE[i]            =  19595 * i;\n                        RGB_YUV_TABLE[(i+ 256)>>0]  =  38470 * i;\n                        RGB_YUV_TABLE[(i+ 512)>>0]  =   7471 * i + 0x8000;\n                        RGB_YUV_TABLE[(i+ 768)>>0]  = -11059 * i;\n                        RGB_YUV_TABLE[(i+1024)>>0]  = -21709 * i;\n                        RGB_YUV_TABLE[(i+1280)>>0]  =  32768 * i + 0x807FFF;\n                        RGB_YUV_TABLE[(i+1536)>>0]  = -27439 * i;\n                        RGB_YUV_TABLE[(i+1792)>>0]  = - 5329 * i;\n                    }\n                }\n    \n                // IO functions\n                function writeBits(bs)\n                {\n                    var value = bs[0];\n                    var posval = bs[1]-1;\n                    while ( posval >= 0 ) {\n                        if (value & (1 << posval) ) {\n                            bytenew |= (1 << bytepos);\n                        }\n                        posval--;\n                        bytepos--;\n                        if (bytepos < 0) {\n                            if (bytenew == 0xFF) {\n                                writeByte(0xFF);\n                                writeByte(0);\n                            }\n                            else {\n                                writeByte(bytenew);\n                            }\n                            bytepos=7;\n                            bytenew=0;\n                        }\n                    }\n                }\n    \n                function writeByte(value)\n                {\n                    byteout.push(clt[value]); // write char directly instead of converting later\n                }\n    \n                function writeWord(value)\n                {\n                    writeByte((value>>8)&0xFF);\n                    writeByte((value   )&0xFF);\n                }\n    \n                // DCT & quantization core\n                function fDCTQuant(data, fdtbl)\n                {\n                    var d0, d1, d2, d3, d4, d5, d6, d7;\n                    /* Pass 1: process rows. */\n                    var dataOff=0;\n                    var i;\n                    var I8 = 8;\n                    var I64 = 64;\n                    for (i=0; i<I8; ++i)\n                    {\n                        d0 = data[dataOff];\n                        d1 = data[dataOff+1];\n                        d2 = data[dataOff+2];\n                        d3 = data[dataOff+3];\n                        d4 = data[dataOff+4];\n                        d5 = data[dataOff+5];\n                        d6 = data[dataOff+6];\n                        d7 = data[dataOff+7];\n    \n                        var tmp0 = d0 + d7;\n                        var tmp7 = d0 - d7;\n                        var tmp1 = d1 + d6;\n                        var tmp6 = d1 - d6;\n                        var tmp2 = d2 + d5;\n                        var tmp5 = d2 - d5;\n                        var tmp3 = d3 + d4;\n                        var tmp4 = d3 - d4;\n    \n                        /* Even part */\n                        var tmp10 = tmp0 + tmp3;    /* phase 2 */\n                        var tmp13 = tmp0 - tmp3;\n                        var tmp11 = tmp1 + tmp2;\n                        var tmp12 = tmp1 - tmp2;\n    \n                        data[dataOff] = tmp10 + tmp11; /* phase 3 */\n                        data[dataOff+4] = tmp10 - tmp11;\n    \n                        var z1 = (tmp12 + tmp13) * 0.707106781; /* c4 */\n                        data[dataOff+2] = tmp13 + z1; /* phase 5 */\n                        data[dataOff+6] = tmp13 - z1;\n    \n                        /* Odd part */\n                        tmp10 = tmp4 + tmp5; /* phase 2 */\n                        tmp11 = tmp5 + tmp6;\n                        tmp12 = tmp6 + tmp7;\n    \n                        /* The rotator is modified from fig 4-8 to avoid extra negations. */\n                        var z5 = (tmp10 - tmp12) * 0.382683433; /* c6 */\n                        var z2 = 0.541196100 * tmp10 + z5; /* c2-c6 */\n                        var z4 = 1.306562965 * tmp12 + z5; /* c2+c6 */\n                        var z3 = tmp11 * 0.707106781; /* c4 */\n    \n                        var z11 = tmp7 + z3;    /* phase 5 */\n                        var z13 = tmp7 - z3;\n    \n                        data[dataOff+5] = z13 + z2; /* phase 6 */\n                        data[dataOff+3] = z13 - z2;\n                        data[dataOff+1] = z11 + z4;\n                        data[dataOff+7] = z11 - z4;\n    \n                        dataOff += 8; /* advance pointer to next row */\n                    }\n    \n                    /* Pass 2: process columns. */\n                    dataOff = 0;\n                    for (i=0; i<I8; ++i)\n                    {\n                        d0 = data[dataOff];\n                        d1 = data[dataOff + 8];\n                        d2 = data[dataOff + 16];\n                        d3 = data[dataOff + 24];\n                        d4 = data[dataOff + 32];\n                        d5 = data[dataOff + 40];\n                        d6 = data[dataOff + 48];\n                        d7 = data[dataOff + 56];\n    \n                        var tmp0p2 = d0 + d7;\n                        var tmp7p2 = d0 - d7;\n                        var tmp1p2 = d1 + d6;\n                        var tmp6p2 = d1 - d6;\n                        var tmp2p2 = d2 + d5;\n                        var tmp5p2 = d2 - d5;\n                        var tmp3p2 = d3 + d4;\n                        var tmp4p2 = d3 - d4;\n    \n                        /* Even part */\n                        var tmp10p2 = tmp0p2 + tmp3p2;  /* phase 2 */\n                        var tmp13p2 = tmp0p2 - tmp3p2;\n                        var tmp11p2 = tmp1p2 + tmp2p2;\n                        var tmp12p2 = tmp1p2 - tmp2p2;\n    \n                        data[dataOff] = tmp10p2 + tmp11p2; /* phase 3 */\n                        data[dataOff+32] = tmp10p2 - tmp11p2;\n    \n                        var z1p2 = (tmp12p2 + tmp13p2) * 0.707106781; /* c4 */\n                        data[dataOff+16] = tmp13p2 + z1p2; /* phase 5 */\n                        data[dataOff+48] = tmp13p2 - z1p2;\n    \n                        /* Odd part */\n                        tmp10p2 = tmp4p2 + tmp5p2; /* phase 2 */\n                        tmp11p2 = tmp5p2 + tmp6p2;\n                        tmp12p2 = tmp6p2 + tmp7p2;\n    \n                        /* The rotator is modified from fig 4-8 to avoid extra negations. */\n                        var z5p2 = (tmp10p2 - tmp12p2) * 0.382683433; /* c6 */\n                        var z2p2 = 0.541196100 * tmp10p2 + z5p2; /* c2-c6 */\n                        var z4p2 = 1.306562965 * tmp12p2 + z5p2; /* c2+c6 */\n                        var z3p2 = tmp11p2 * 0.707106781; /* c4 */\n    \n                        var z11p2 = tmp7p2 + z3p2;  /* phase 5 */\n                        var z13p2 = tmp7p2 - z3p2;\n    \n                        data[dataOff+40] = z13p2 + z2p2; /* phase 6 */\n                        data[dataOff+24] = z13p2 - z2p2;\n                        data[dataOff+ 8] = z11p2 + z4p2;\n                        data[dataOff+56] = z11p2 - z4p2;\n    \n                        dataOff++; /* advance pointer to next column */\n                    }\n    \n                    // Quantize/descale the coefficients\n                    var fDCTQuant;\n                    for (i=0; i<I64; ++i)\n                    {\n                        // Apply the quantization and scaling factor & Round to nearest integer\n                        fDCTQuant = data[i]*fdtbl[i];\n                        outputfDCTQuant[i] = (fDCTQuant > 0.0) ? ((fDCTQuant + 0.5)|0) : ((fDCTQuant - 0.5)|0);\n                        //outputfDCTQuant[i] = fround(fDCTQuant);\n    \n                    }\n                    return outputfDCTQuant;\n                }\n    \n                function writeAPP0()\n                {\n                    writeWord(0xFFE0); // marker\n                    writeWord(16); // length\n                    writeByte(0x4A); // J\n                    writeByte(0x46); // F\n                    writeByte(0x49); // I\n                    writeByte(0x46); // F\n                    writeByte(0); // = \"JFIF\",'\\0'\n                    writeByte(1); // versionhi\n                    writeByte(1); // versionlo\n                    writeByte(0); // xyunits\n                    writeWord(1); // xdensity\n                    writeWord(1); // ydensity\n                    writeByte(0); // thumbnwidth\n                    writeByte(0); // thumbnheight\n                }\n    \n                function writeSOF0(width, height)\n                {\n                    writeWord(0xFFC0); // marker\n                    writeWord(17);   // length, truecolor YUV JPG\n                    writeByte(8);    // precision\n                    writeWord(height);\n                    writeWord(width);\n                    writeByte(3);    // nrofcomponents\n                    writeByte(1);    // IdY\n                    writeByte(0x11); // HVY\n                    writeByte(0);    // QTY\n                    writeByte(2);    // IdU\n                    writeByte(0x11); // HVU\n                    writeByte(1);    // QTU\n                    writeByte(3);    // IdV\n                    writeByte(0x11); // HVV\n                    writeByte(1);    // QTV\n                }\n    \n                function writeDQT()\n                {\n                    writeWord(0xFFDB); // marker\n                    writeWord(132);    // length\n                    writeByte(0);\n                    for (var i=0; i<64; i++) {\n                        writeByte(YTable[i]);\n                    }\n                    writeByte(1);\n                    for (var j=0; j<64; j++) {\n                        writeByte(UVTable[j]);\n                    }\n                }\n    \n                function writeDHT()\n                {\n                    writeWord(0xFFC4); // marker\n                    writeWord(0x01A2); // length\n    \n                    writeByte(0); // HTYDCinfo\n                    for (var i=0; i<16; i++) {\n                        writeByte(std_dc_luminance_nrcodes[i+1]);\n                    }\n                    for (var j=0; j<=11; j++) {\n                        writeByte(std_dc_luminance_values[j]);\n                    }\n    \n                    writeByte(0x10); // HTYACinfo\n                    for (var k=0; k<16; k++) {\n                        writeByte(std_ac_luminance_nrcodes[k+1]);\n                    }\n                    for (var l=0; l<=161; l++) {\n                        writeByte(std_ac_luminance_values[l]);\n                    }\n    \n                    writeByte(1); // HTUDCinfo\n                    for (var m=0; m<16; m++) {\n                        writeByte(std_dc_chrominance_nrcodes[m+1]);\n                    }\n                    for (var n=0; n<=11; n++) {\n                        writeByte(std_dc_chrominance_values[n]);\n                    }\n    \n                    writeByte(0x11); // HTUACinfo\n                    for (var o=0; o<16; o++) {\n                        writeByte(std_ac_chrominance_nrcodes[o+1]);\n                    }\n                    for (var p=0; p<=161; p++) {\n                        writeByte(std_ac_chrominance_values[p]);\n                    }\n                }\n    \n                function writeSOS()\n                {\n                    writeWord(0xFFDA); // marker\n                    writeWord(12); // length\n                    writeByte(3); // nrofcomponents\n                    writeByte(1); // IdY\n                    writeByte(0); // HTY\n                    writeByte(2); // IdU\n                    writeByte(0x11); // HTU\n                    writeByte(3); // IdV\n                    writeByte(0x11); // HTV\n                    writeByte(0); // Ss\n                    writeByte(0x3f); // Se\n                    writeByte(0); // Bf\n                }\n    \n                function processDU(CDU, fdtbl, DC, HTDC, HTAC){\n                    var EOB = HTAC[0x00];\n                    var M16zeroes = HTAC[0xF0];\n                    var pos;\n                    var I16 = 16;\n                    var I63 = 63;\n                    var I64 = 64;\n                    var DU_DCT = fDCTQuant(CDU, fdtbl);\n                    //ZigZag reorder\n                    for (var j=0;j<I64;++j) {\n                        DU[ZigZag[j]]=DU_DCT[j];\n                    }\n                    var Diff = DU[0] - DC; DC = DU[0];\n                    //Encode DC\n                    if (Diff==0) {\n                        writeBits(HTDC[0]); // Diff might be 0\n                    } else {\n                        pos = 32767+Diff;\n                        writeBits(HTDC[category[pos]]);\n                        writeBits(bitcode[pos]);\n                    }\n                    //Encode ACs\n                    var end0pos = 63; // was const... which is crazy\n                    for (; (end0pos>0)&&(DU[end0pos]==0); end0pos--) {};\n                    //end0pos = first element in reverse order !=0\n                    if ( end0pos == 0) {\n                        writeBits(EOB);\n                        return DC;\n                    }\n                    var i = 1;\n                    var lng;\n                    while ( i <= end0pos ) {\n                        var startpos = i;\n                        for (; (DU[i]==0) && (i<=end0pos); ++i) {}\n                        var nrzeroes = i-startpos;\n                        if ( nrzeroes >= I16 ) {\n                            lng = nrzeroes>>4;\n                            for (var nrmarker=1; nrmarker <= lng; ++nrmarker)\n                                writeBits(M16zeroes);\n                            nrzeroes = nrzeroes&0xF;\n                        }\n                        pos = 32767+DU[i];\n                        writeBits(HTAC[(nrzeroes<<4)+category[pos]]);\n                        writeBits(bitcode[pos]);\n                        i++;\n                    }\n                    if ( end0pos != I63 ) {\n                        writeBits(EOB);\n                    }\n                    return DC;\n                }\n    \n                function initCharLookupTable(){\n                    var sfcc = String.fromCharCode;\n                    for(var i=0; i < 256; i++){ ///// ACHTUNG // 255\n                        clt[i] = sfcc(i);\n                    }\n                }\n    \n                this.encode = function(image,quality) // image data object\n                {\n                    // var time_start = new Date().getTime();\n    \n                    if(quality) setQuality(quality);\n    \n                    // Initialize bit writer\n                    byteout = new Array();\n                    bytenew=0;\n                    bytepos=7;\n    \n                    // Add JPEG headers\n                    writeWord(0xFFD8); // SOI\n                    writeAPP0();\n                    writeDQT();\n                    writeSOF0(image.width,image.height);\n                    writeDHT();\n                    writeSOS();\n    \n    \n                    // Encode 8x8 macroblocks\n                    var DCY=0;\n                    var DCU=0;\n                    var DCV=0;\n    \n                    bytenew=0;\n                    bytepos=7;\n    \n    \n                    this.encode.displayName = \"_encode_\";\n    \n                    var imageData = image.data;\n                    var width = image.width;\n                    var height = image.height;\n    \n                    var quadWidth = width*4;\n                    var tripleWidth = width*3;\n    \n                    var x, y = 0;\n                    var r, g, b;\n                    var start,p, col,row,pos;\n                    while(y < height){\n                        x = 0;\n                        while(x < quadWidth){\n                        start = quadWidth * y + x;\n                        p = start;\n                        col = -1;\n                        row = 0;\n    \n                        for(pos=0; pos < 64; pos++){\n                            row = pos >> 3;// /8\n                            col = ( pos & 7 ) * 4; // %8\n                            p = start + ( row * quadWidth ) + col;\n    \n                            if(y+row >= height){ // padding bottom\n                                p-= (quadWidth*(y+1+row-height));\n                            }\n    \n                            if(x+col >= quadWidth){ // padding right\n                                p-= ((x+col) - quadWidth +4)\n                            }\n    \n                            r = imageData[ p++ ];\n                            g = imageData[ p++ ];\n                            b = imageData[ p++ ];\n    \n    \n                            /* // calculate YUV values dynamically\n                            YDU[pos]=((( 0.29900)*r+( 0.58700)*g+( 0.11400)*b))-128; //-0x80\n                            UDU[pos]=(((-0.16874)*r+(-0.33126)*g+( 0.50000)*b));\n                            VDU[pos]=((( 0.50000)*r+(-0.41869)*g+(-0.08131)*b));\n                            */\n    \n                            // use lookup table (slightly faster)\n                            YDU[pos] = ((RGB_YUV_TABLE[r]             + RGB_YUV_TABLE[(g +  256)>>0] + RGB_YUV_TABLE[(b +  512)>>0]) >> 16)-128;\n                            UDU[pos] = ((RGB_YUV_TABLE[(r +  768)>>0] + RGB_YUV_TABLE[(g + 1024)>>0] + RGB_YUV_TABLE[(b + 1280)>>0]) >> 16)-128;\n                            VDU[pos] = ((RGB_YUV_TABLE[(r + 1280)>>0] + RGB_YUV_TABLE[(g + 1536)>>0] + RGB_YUV_TABLE[(b + 1792)>>0]) >> 16)-128;\n    \n                        }\n    \n                        DCY = processDU(YDU, fdtbl_Y, DCY, YDC_HT, YAC_HT);\n                        DCU = processDU(UDU, fdtbl_UV, DCU, UVDC_HT, UVAC_HT);\n                        DCV = processDU(VDU, fdtbl_UV, DCV, UVDC_HT, UVAC_HT);\n                        x+=32;\n                        }\n                        y+=8;\n                    }\n    \n    \n                    ////////////////////////////////////////////////////////////////\n    \n                    // Do the bit alignment of the EOI marker\n                    if ( bytepos >= 0 ) {\n                        var fillbits = [];\n                        fillbits[1] = bytepos+1;\n                        fillbits[0] = (1<<(bytepos+1))-1;\n                        writeBits(fillbits);\n                    }\n    \n                    writeWord(0xFFD9); //EOI\n    \n                    var jpegDataUri = 'data:image/jpeg;base64,' + btoa(byteout.join(''));\n    \n                    byteout = [];\n    \n                    // benchmarking\n                    // var duration = new Date().getTime() - time_start;\n                    // console.log('Encoding time: '+ currentQuality + 'ms');\n                    //\n    \n                    return jpegDataUri\n            }\n    \n            function setQuality(quality){\n                if (quality <= 0) {\n                    quality = 1;\n                }\n                if (quality > 100) {\n                    quality = 100;\n                }\n    \n                if(currentQuality == quality) return // don't recalc if unchanged\n    \n                var sf = 0;\n                if (quality < 50) {\n                    sf = Math.floor(5000 / quality);\n                } else {\n                    sf = Math.floor(200 - quality*2);\n                }\n    \n                initQuantTables(sf);\n                currentQuality = quality;\n                // console.log('Quality set to: '+quality +'%');\n            }\n    \n            function init(){\n                // var time_start = new Date().getTime();\n                if(!quality) quality = 50;\n                // Create tables\n                initCharLookupTable()\n                initHuffmanTbl();\n                initCategoryNumber();\n                initRGBYUVTable();\n    \n                setQuality(quality);\n                // var duration = new Date().getTime() - time_start;\n                // console.log('Initialization '+ duration + 'ms');\n            }\n    \n            init();\n    \n        };\n    \n        JPEGEncoder.encode = function( data, quality ) {\n            var encoder = new JPEGEncoder( quality );\n    \n            return encoder.encode( data );\n        }\n    \n        return JPEGEncoder;\n    });\n    /**\n     * @fileOverview Fix android canvas.toDataUrl bug.\n     */\n    define('runtime/html5/androidpatch',[\n        'runtime/html5/util',\n        'runtime/html5/jpegencoder',\n        'base'\n    ], function( Util, encoder, Base ) {\n        var origin = Util.canvasToDataUrl,\n            supportJpeg;\n    \n        Util.canvasToDataUrl = function( canvas, type, quality ) {\n            var ctx, w, h, fragement, parts;\n    \n            // 非android手机直接跳过。\n            if ( !Base.os.android ) {\n                return origin.apply( null, arguments );\n            }\n    \n            // 检测是否canvas支持jpeg导出，根据数据格式来判断。\n            // JPEG 前两位分别是：255, 216\n            if ( type === 'image/jpeg' && typeof supportJpeg === 'undefined' ) {\n                fragement = origin.apply( null, arguments );\n    \n                parts = fragement.split(',');\n    \n                if ( ~parts[ 0 ].indexOf('base64') ) {\n                    fragement = atob( parts[ 1 ] );\n                } else {\n                    fragement = decodeURIComponent( parts[ 1 ] );\n                }\n    \n                fragement = fragement.substring( 0, 2 );\n    \n                supportJpeg = fragement.charCodeAt( 0 ) === 255 &&\n                        fragement.charCodeAt( 1 ) === 216;\n            }\n    \n            // 只有在android环境下才修复\n            if ( type === 'image/jpeg' && !supportJpeg ) {\n                w = canvas.width;\n                h = canvas.height;\n                ctx = canvas.getContext('2d');\n    \n                return encoder.encode( ctx.getImageData( 0, 0, w, h ), quality );\n            }\n    \n            return origin.apply( null, arguments );\n        };\n    });\n    /**\n     * @fileOverview Image\n     */\n    define('runtime/html5/image',[\n        'base',\n        'runtime/html5/runtime',\n        'runtime/html5/util'\n    ], function( Base, Html5Runtime, Util ) {\n    \n        var BLANK = 'data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs%3D';\n    \n        return Html5Runtime.register( 'Image', {\n    \n            // flag: 标记是否被修改过。\n            modified: false,\n    \n            init: function() {\n                var me = this,\n                    img = new Image();\n    \n                img.onload = function() {\n    \n                    me._info = {\n                        type: me.type,\n                        width: this.width,\n                        height: this.height\n                    };\n    \n                    // 读取meta信息。\n                    if ( !me._metas && 'image/jpeg' === me.type ) {\n                        Util.parseMeta( me._blob, function( error, ret ) {\n                            me._metas = ret;\n                            me.owner.trigger('load');\n                        });\n                    } else {\n                        me.owner.trigger('load');\n                    }\n                };\n    \n                img.onerror = function() {\n                    me.owner.trigger('error');\n                };\n    \n                me._img = img;\n            },\n    \n            loadFromBlob: function( blob ) {\n                var me = this,\n                    img = me._img;\n    \n                me._blob = blob;\n                me.type = blob.type;\n                img.src = Util.createObjectURL( blob.getSource() );\n                me.owner.once( 'load', function() {\n                    Util.revokeObjectURL( img.src );\n                });\n            },\n    \n            resize: function( width, height ) {\n                var canvas = this._canvas ||\n                        (this._canvas = document.createElement('canvas'));\n    \n                this._resize( this._img, canvas, width, height );\n                this._blob = null;    // 没用了，可以删掉了。\n                this.modified = true;\n                this.owner.trigger( 'complete', 'resize' );\n            },\n    \n            crop: function( x, y, w, h, s ) {\n                var cvs = this._canvas ||\n                        (this._canvas = document.createElement('canvas')),\n                    opts = this.options,\n                    img = this._img,\n                    iw = img.naturalWidth,\n                    ih = img.naturalHeight,\n                    orientation = this.getOrientation();\n    \n                s = s || 1;\n    \n                // todo 解决 orientation 的问题。\n                // values that require 90 degree rotation\n                // if ( ~[ 5, 6, 7, 8 ].indexOf( orientation ) ) {\n    \n                //     switch ( orientation ) {\n                //         case 6:\n                //             tmp = x;\n                //             x = y;\n                //             y = iw * s - tmp - w;\n                //             console.log(ih * s, tmp, w)\n                //             break;\n                //     }\n    \n                //     (w ^= h, h ^= w, w ^= h);\n                // }\n    \n                cvs.width = w;\n                cvs.height = h;\n    \n                opts.preserveHeaders || this._rotate2Orientaion( cvs, orientation );\n                this._renderImageToCanvas( cvs, img, -x, -y, iw * s, ih * s );\n    \n                this._blob = null;    // 没用了，可以删掉了。\n                this.modified = true;\n                this.owner.trigger( 'complete', 'crop' );\n            },\n    \n            getAsBlob: function( type ) {\n                var blob = this._blob,\n                    opts = this.options,\n                    canvas;\n    \n                type = type || this.type;\n    \n                // blob需要重新生成。\n                if ( this.modified || this.type !== type ) {\n                    canvas = this._canvas;\n    \n                    if ( type === 'image/jpeg' ) {\n    \n                        blob = Util.canvasToDataUrl( canvas, type, opts.quality );\n    \n                        if ( opts.preserveHeaders && this._metas &&\n                                this._metas.imageHead ) {\n    \n                            blob = Util.dataURL2ArrayBuffer( blob );\n                            blob = Util.updateImageHead( blob,\n                                    this._metas.imageHead );\n                            blob = Util.arrayBufferToBlob( blob, type );\n                            return blob;\n                        }\n                    } else {\n                        blob = Util.canvasToDataUrl( canvas, type );\n                    }\n    \n                    blob = Util.dataURL2Blob( blob );\n                }\n    \n                return blob;\n            },\n    \n            getAsDataUrl: function( type ) {\n                var opts = this.options;\n    \n                type = type || this.type;\n    \n                if ( type === 'image/jpeg' ) {\n                    return Util.canvasToDataUrl( this._canvas, type, opts.quality );\n                } else {\n                    return this._canvas.toDataURL( type );\n                }\n            },\n    \n            getOrientation: function() {\n                return this._metas && this._metas.exif &&\n                        this._metas.exif.get('Orientation') || 1;\n            },\n    \n            info: function( val ) {\n    \n                // setter\n                if ( val ) {\n                    this._info = val;\n                    return this;\n                }\n    \n                // getter\n                return this._info;\n            },\n    \n            meta: function( val ) {\n    \n                // setter\n                if ( val ) {\n                    this._meta = val;\n                    return this;\n                }\n    \n                // getter\n                return this._meta;\n            },\n    \n            destroy: function() {\n                var canvas = this._canvas;\n                this._img.onload = null;\n    \n                if ( canvas ) {\n                    canvas.getContext('2d')\n                            .clearRect( 0, 0, canvas.width, canvas.height );\n                    canvas.width = canvas.height = 0;\n                    this._canvas = null;\n                }\n    \n                // 释放内存。非常重要，否则释放不了image的内存。\n                this._img.src = BLANK;\n                this._img = this._blob = null;\n            },\n    \n            _resize: function( img, cvs, width, height ) {\n                var opts = this.options,\n                    naturalWidth = img.width,\n                    naturalHeight = img.height,\n                    orientation = this.getOrientation(),\n                    scale, w, h, x, y;\n    \n                // values that require 90 degree rotation\n                if ( ~[ 5, 6, 7, 8 ].indexOf( orientation ) ) {\n    \n                    // 交换width, height的值。\n                    width ^= height;\n                    height ^= width;\n                    width ^= height;\n                }\n    \n                scale = Math[ opts.crop ? 'max' : 'min' ]( width / naturalWidth,\n                        height / naturalHeight );\n    \n                // 不允许放大。\n                opts.allowMagnify || (scale = Math.min( 1, scale ));\n    \n                w = naturalWidth * scale;\n                h = naturalHeight * scale;\n    \n                if ( opts.crop ) {\n                    cvs.width = width;\n                    cvs.height = height;\n                } else {\n                    cvs.width = w;\n                    cvs.height = h;\n                }\n    \n                x = (cvs.width - w) / 2;\n                y = (cvs.height - h) / 2;\n    \n                opts.preserveHeaders || this._rotate2Orientaion( cvs, orientation );\n    \n                this._renderImageToCanvas( cvs, img, x, y, w, h );\n            },\n    \n            _rotate2Orientaion: function( canvas, orientation ) {\n                var width = canvas.width,\n                    height = canvas.height,\n                    ctx = canvas.getContext('2d');\n    \n                switch ( orientation ) {\n                    case 5:\n                    case 6:\n                    case 7:\n                    case 8:\n                        canvas.width = height;\n                        canvas.height = width;\n                        break;\n                }\n    \n                switch ( orientation ) {\n                    case 2:    // horizontal flip\n                        ctx.translate( width, 0 );\n                        ctx.scale( -1, 1 );\n                        break;\n    \n                    case 3:    // 180 rotate left\n                        ctx.translate( width, height );\n                        ctx.rotate( Math.PI );\n                        break;\n    \n                    case 4:    // vertical flip\n                        ctx.translate( 0, height );\n                        ctx.scale( 1, -1 );\n                        break;\n    \n                    case 5:    // vertical flip + 90 rotate right\n                        ctx.rotate( 0.5 * Math.PI );\n                        ctx.scale( 1, -1 );\n                        break;\n    \n                    case 6:    // 90 rotate right\n                        ctx.rotate( 0.5 * Math.PI );\n                        ctx.translate( 0, -height );\n                        break;\n    \n                    case 7:    // horizontal flip + 90 rotate right\n                        ctx.rotate( 0.5 * Math.PI );\n                        ctx.translate( width, -height );\n                        ctx.scale( -1, 1 );\n                        break;\n    \n                    case 8:    // 90 rotate left\n                        ctx.rotate( -0.5 * Math.PI );\n                        ctx.translate( -width, 0 );\n                        break;\n                }\n            },\n    \n            // https://github.com/stomita/ios-imagefile-megapixel/\n            // blob/master/src/megapix-image.js\n            _renderImageToCanvas: (function() {\n    \n                // 如果不是ios, 不需要这么复杂！\n                if ( !Base.os.ios ) {\n                    return function( canvas ) {\n                        var args = Base.slice( arguments, 1 ),\n                            ctx = canvas.getContext('2d');\n    \n                        ctx.drawImage.apply( ctx, args );\n                    };\n                }\n    \n                /**\n                 * Detecting vertical squash in loaded image.\n                 * Fixes a bug which squash image vertically while drawing into\n                 * canvas for some images.\n                 */\n                function detectVerticalSquash( img, iw, ih ) {\n                    var canvas = document.createElement('canvas'),\n                        ctx = canvas.getContext('2d'),\n                        sy = 0,\n                        ey = ih,\n                        py = ih,\n                        data, alpha, ratio;\n    \n    \n                    canvas.width = 1;\n                    canvas.height = ih;\n                    ctx.drawImage( img, 0, 0 );\n                    data = ctx.getImageData( 0, 0, 1, ih ).data;\n    \n                    // search image edge pixel position in case\n                    // it is squashed vertically.\n                    while ( py > sy ) {\n                        alpha = data[ (py - 1) * 4 + 3 ];\n    \n                        if ( alpha === 0 ) {\n                            ey = py;\n                        } else {\n                            sy = py;\n                        }\n    \n                        py = (ey + sy) >> 1;\n                    }\n    \n                    ratio = (py / ih);\n                    return (ratio === 0) ? 1 : ratio;\n                }\n    \n                // fix ie7 bug\n                // http://stackoverflow.com/questions/11929099/\n                // html5-canvas-drawimage-ratio-bug-ios\n                if ( Base.os.ios >= 7 ) {\n                    return function( canvas, img, x, y, w, h ) {\n                        var iw = img.naturalWidth,\n                            ih = img.naturalHeight,\n                            vertSquashRatio = detectVerticalSquash( img, iw, ih );\n    \n                        return canvas.getContext('2d').drawImage( img, 0, 0,\n                                iw * vertSquashRatio, ih * vertSquashRatio,\n                                x, y, w, h );\n                    };\n                }\n    \n                /**\n                 * Detect subsampling in loaded image.\n                 * In iOS, larger images than 2M pixels may be\n                 * subsampled in rendering.\n                 */\n                function detectSubsampling( img ) {\n                    var iw = img.naturalWidth,\n                        ih = img.naturalHeight,\n                        canvas, ctx;\n    \n                    // subsampling may happen overmegapixel image\n                    if ( iw * ih > 1024 * 1024 ) {\n                        canvas = document.createElement('canvas');\n                        canvas.width = canvas.height = 1;\n                        ctx = canvas.getContext('2d');\n                        ctx.drawImage( img, -iw + 1, 0 );\n    \n                        // subsampled image becomes half smaller in rendering size.\n                        // check alpha channel value to confirm image is covering\n                        // edge pixel or not. if alpha value is 0\n                        // image is not covering, hence subsampled.\n                        return ctx.getImageData( 0, 0, 1, 1 ).data[ 3 ] === 0;\n                    } else {\n                        return false;\n                    }\n                }\n    \n    \n                return function( canvas, img, x, y, width, height ) {\n                    var iw = img.naturalWidth,\n                        ih = img.naturalHeight,\n                        ctx = canvas.getContext('2d'),\n                        subsampled = detectSubsampling( img ),\n                        doSquash = this.type === 'image/jpeg',\n                        d = 1024,\n                        sy = 0,\n                        dy = 0,\n                        tmpCanvas, tmpCtx, vertSquashRatio, dw, dh, sx, dx;\n    \n                    if ( subsampled ) {\n                        iw /= 2;\n                        ih /= 2;\n                    }\n    \n                    ctx.save();\n                    tmpCanvas = document.createElement('canvas');\n                    tmpCanvas.width = tmpCanvas.height = d;\n    \n                    tmpCtx = tmpCanvas.getContext('2d');\n                    vertSquashRatio = doSquash ?\n                            detectVerticalSquash( img, iw, ih ) : 1;\n    \n                    dw = Math.ceil( d * width / iw );\n                    dh = Math.ceil( d * height / ih / vertSquashRatio );\n    \n                    while ( sy < ih ) {\n                        sx = 0;\n                        dx = 0;\n                        while ( sx < iw ) {\n                            tmpCtx.clearRect( 0, 0, d, d );\n                            tmpCtx.drawImage( img, -sx, -sy );\n                            ctx.drawImage( tmpCanvas, 0, 0, d, d,\n                                    x + dx, y + dy, dw, dh );\n                            sx += d;\n                            dx += dw;\n                        }\n                        sy += d;\n                        dy += dh;\n                    }\n                    ctx.restore();\n                    tmpCanvas = tmpCtx = null;\n                };\n            })()\n        });\n    });\n    /**\n     * @fileOverview Transport\n     * @todo 支持chunked传输，优势：\n     * 可以将大文件分成小块，挨个传输，可以提高大文件成功率，当失败的时候，也只需要重传那小部分，\n     * 而不需要重头再传一次。另外断点续传也需要用chunked方式。\n     */\n    define('runtime/html5/transport',[\n        'base',\n        'runtime/html5/runtime'\n    ], function( Base, Html5Runtime ) {\n    \n        var noop = Base.noop,\n            $ = Base.$;\n    \n        return Html5Runtime.register( 'Transport', {\n            init: function() {\n                this._status = 0;\n                this._response = null;\n            },\n    \n            send: function() {\n                var owner = this.owner,\n                    opts = this.options,\n                    xhr = this._initAjax(),\n                    blob = owner._blob,\n                    server = opts.server,\n                    formData, binary, fr;\n    \n                if ( opts.sendAsBinary ) {\n                    server += (/\\?/.test( server ) ? '&' : '?') +\n                            $.param( owner._formData );\n    \n                    binary = blob.getSource();\n                } else {\n                    formData = new FormData();\n                    $.each( owner._formData, function( k, v ) {\n                        formData.append( k, v );\n                    });\n    \n                    formData.append( opts.fileVal, blob.getSource(),\n                            opts.filename || owner._formData.name || '' );\n                }\n    \n                if ( opts.withCredentials && 'withCredentials' in xhr ) {\n                    xhr.open( opts.method, server, true );\n                    xhr.withCredentials = true;\n                } else {\n                    xhr.open( opts.method, server );\n                }\n    \n                this._setRequestHeader( xhr, opts.headers );\n    \n                if ( binary ) {\n                    // 强制设置成 content-type 为文件流。\n                    xhr.overrideMimeType &&\n                            xhr.overrideMimeType('application/octet-stream');\n    \n                    // android直接发送blob会导致服务端接收到的是空文件。\n                    // bug详情。\n                    // https://code.google.com/p/android/issues/detail?id=39882\n                    // 所以先用fileReader读取出来再通过arraybuffer的方式发送。\n                    if ( Base.os.android ) {\n                        fr = new FileReader();\n    \n                        fr.onload = function() {\n                            xhr.send( this.result );\n                            fr = fr.onload = null;\n                        };\n    \n                        fr.readAsArrayBuffer( binary );\n                    } else {\n                        xhr.send( binary );\n                    }\n                } else {\n                    xhr.send( formData );\n                }\n            },\n    \n            getResponse: function() {\n                return this._response;\n            },\n    \n            getResponseAsJson: function() {\n                return this._parseJson( this._response );\n            },\n    \n            getStatus: function() {\n                return this._status;\n            },\n    \n            abort: function() {\n                var xhr = this._xhr;\n    \n                if ( xhr ) {\n                    xhr.upload.onprogress = noop;\n                    xhr.onreadystatechange = noop;\n                    xhr.abort();\n    \n                    this._xhr = xhr = null;\n                }\n            },\n    \n            destroy: function() {\n                this.abort();\n            },\n    \n            _initAjax: function() {\n                var me = this,\n                    xhr = new XMLHttpRequest(),\n                    opts = this.options;\n    \n                if ( opts.withCredentials && !('withCredentials' in xhr) &&\n                        typeof XDomainRequest !== 'undefined' ) {\n                    xhr = new XDomainRequest();\n                }\n    \n                xhr.upload.onprogress = function( e ) {\n                    var percentage = 0;\n    \n                    if ( e.lengthComputable ) {\n                        percentage = e.loaded / e.total;\n                    }\n    \n                    return me.trigger( 'progress', percentage );\n                };\n    \n                xhr.onreadystatechange = function() {\n    \n                    if ( xhr.readyState !== 4 ) {\n                        return;\n                    }\n    \n                    xhr.upload.onprogress = noop;\n                    xhr.onreadystatechange = noop;\n                    me._xhr = null;\n                    me._status = xhr.status;\n    \n                    if ( xhr.status >= 200 && xhr.status < 300 ) {\n                        me._response = xhr.responseText;\n                        return me.trigger('load');\n                    } else if ( xhr.status >= 500 && xhr.status < 600 ) {\n                        me._response = xhr.responseText;\n                        return me.trigger( 'error', 'server' );\n                    }\n    \n    \n                    return me.trigger( 'error', me._status ? 'http' : 'abort' );\n                };\n    \n                me._xhr = xhr;\n                return xhr;\n            },\n    \n            _setRequestHeader: function( xhr, headers ) {\n                $.each( headers, function( key, val ) {\n                    xhr.setRequestHeader( key, val );\n                });\n            },\n    \n            _parseJson: function( str ) {\n                var json;\n    \n                try {\n                    json = JSON.parse( str );\n                } catch ( ex ) {\n                    json = {};\n                }\n    \n                return json;\n            }\n        });\n    });\n    /**\n     * @fileOverview  Transport flash实现\n     */\n    define('runtime/html5/md5',[\n        'runtime/html5/runtime'\n    ], function( FlashRuntime ) {\n    \n        /*\n         * Fastest md5 implementation around (JKM md5)\n         * Credits: Joseph Myers\n         *\n         * @see http://www.myersdaily.org/joseph/javascript/md5-text.html\n         * @see http://jsperf.com/md5-shootout/7\n         */\n    \n        /* this function is much faster,\n          so if possible we use it. Some IEs\n          are the only ones I know of that\n          need the idiotic second function,\n          generated by an if clause.  */\n        var add32 = function (a, b) {\n            return (a + b) & 0xFFFFFFFF;\n        },\n    \n        cmn = function (q, a, b, x, s, t) {\n            a = add32(add32(a, q), add32(x, t));\n            return add32((a << s) | (a >>> (32 - s)), b);\n        },\n    \n        ff = function (a, b, c, d, x, s, t) {\n            return cmn((b & c) | ((~b) & d), a, b, x, s, t);\n        },\n    \n        gg = function (a, b, c, d, x, s, t) {\n            return cmn((b & d) | (c & (~d)), a, b, x, s, t);\n        },\n    \n        hh = function (a, b, c, d, x, s, t) {\n            return cmn(b ^ c ^ d, a, b, x, s, t);\n        },\n    \n        ii = function (a, b, c, d, x, s, t) {\n            return cmn(c ^ (b | (~d)), a, b, x, s, t);\n        },\n    \n        md5cycle = function (x, k) {\n            var a = x[0],\n                b = x[1],\n                c = x[2],\n                d = x[3];\n    \n            a = ff(a, b, c, d, k[0], 7, -680876936);\n            d = ff(d, a, b, c, k[1], 12, -389564586);\n            c = ff(c, d, a, b, k[2], 17, 606105819);\n            b = ff(b, c, d, a, k[3], 22, -1044525330);\n            a = ff(a, b, c, d, k[4], 7, -176418897);\n            d = ff(d, a, b, c, k[5], 12, 1200080426);\n            c = ff(c, d, a, b, k[6], 17, -1473231341);\n            b = ff(b, c, d, a, k[7], 22, -45705983);\n            a = ff(a, b, c, d, k[8], 7, 1770035416);\n            d = ff(d, a, b, c, k[9], 12, -1958414417);\n            c = ff(c, d, a, b, k[10], 17, -42063);\n            b = ff(b, c, d, a, k[11], 22, -1990404162);\n            a = ff(a, b, c, d, k[12], 7, 1804603682);\n            d = ff(d, a, b, c, k[13], 12, -40341101);\n            c = ff(c, d, a, b, k[14], 17, -1502002290);\n            b = ff(b, c, d, a, k[15], 22, 1236535329);\n    \n            a = gg(a, b, c, d, k[1], 5, -165796510);\n            d = gg(d, a, b, c, k[6], 9, -1069501632);\n            c = gg(c, d, a, b, k[11], 14, 643717713);\n            b = gg(b, c, d, a, k[0], 20, -373897302);\n            a = gg(a, b, c, d, k[5], 5, -701558691);\n            d = gg(d, a, b, c, k[10], 9, 38016083);\n            c = gg(c, d, a, b, k[15], 14, -660478335);\n            b = gg(b, c, d, a, k[4], 20, -405537848);\n            a = gg(a, b, c, d, k[9], 5, 568446438);\n            d = gg(d, a, b, c, k[14], 9, -1019803690);\n            c = gg(c, d, a, b, k[3], 14, -187363961);\n            b = gg(b, c, d, a, k[8], 20, 1163531501);\n            a = gg(a, b, c, d, k[13], 5, -1444681467);\n            d = gg(d, a, b, c, k[2], 9, -51403784);\n            c = gg(c, d, a, b, k[7], 14, 1735328473);\n            b = gg(b, c, d, a, k[12], 20, -1926607734);\n    \n            a = hh(a, b, c, d, k[5], 4, -378558);\n            d = hh(d, a, b, c, k[8], 11, -2022574463);\n            c = hh(c, d, a, b, k[11], 16, 1839030562);\n            b = hh(b, c, d, a, k[14], 23, -35309556);\n            a = hh(a, b, c, d, k[1], 4, -1530992060);\n            d = hh(d, a, b, c, k[4], 11, 1272893353);\n            c = hh(c, d, a, b, k[7], 16, -155497632);\n            b = hh(b, c, d, a, k[10], 23, -1094730640);\n            a = hh(a, b, c, d, k[13], 4, 681279174);\n            d = hh(d, a, b, c, k[0], 11, -358537222);\n            c = hh(c, d, a, b, k[3], 16, -722521979);\n            b = hh(b, c, d, a, k[6], 23, 76029189);\n            a = hh(a, b, c, d, k[9], 4, -640364487);\n            d = hh(d, a, b, c, k[12], 11, -421815835);\n            c = hh(c, d, a, b, k[15], 16, 530742520);\n            b = hh(b, c, d, a, k[2], 23, -995338651);\n    \n            a = ii(a, b, c, d, k[0], 6, -198630844);\n            d = ii(d, a, b, c, k[7], 10, 1126891415);\n            c = ii(c, d, a, b, k[14], 15, -1416354905);\n            b = ii(b, c, d, a, k[5], 21, -57434055);\n            a = ii(a, b, c, d, k[12], 6, 1700485571);\n            d = ii(d, a, b, c, k[3], 10, -1894986606);\n            c = ii(c, d, a, b, k[10], 15, -1051523);\n            b = ii(b, c, d, a, k[1], 21, -2054922799);\n            a = ii(a, b, c, d, k[8], 6, 1873313359);\n            d = ii(d, a, b, c, k[15], 10, -30611744);\n            c = ii(c, d, a, b, k[6], 15, -1560198380);\n            b = ii(b, c, d, a, k[13], 21, 1309151649);\n            a = ii(a, b, c, d, k[4], 6, -145523070);\n            d = ii(d, a, b, c, k[11], 10, -1120210379);\n            c = ii(c, d, a, b, k[2], 15, 718787259);\n            b = ii(b, c, d, a, k[9], 21, -343485551);\n    \n            x[0] = add32(a, x[0]);\n            x[1] = add32(b, x[1]);\n            x[2] = add32(c, x[2]);\n            x[3] = add32(d, x[3]);\n        },\n    \n        /* there needs to be support for Unicode here,\n           * unless we pretend that we can redefine the MD-5\n           * algorithm for multi-byte characters (perhaps\n           * by adding every four 16-bit characters and\n           * shortening the sum to 32 bits). Otherwise\n           * I suggest performing MD-5 as if every character\n           * was two bytes--e.g., 0040 0025 = @%--but then\n           * how will an ordinary MD-5 sum be matched?\n           * There is no way to standardize text to something\n           * like UTF-8 before transformation; speed cost is\n           * utterly prohibitive. The JavaScript standard\n           * itself needs to look at this: it should start\n           * providing access to strings as preformed UTF-8\n           * 8-bit unsigned value arrays.\n           */\n        md5blk = function (s) {\n            var md5blks = [],\n                i; /* Andy King said do it this way. */\n    \n            for (i = 0; i < 64; i += 4) {\n                md5blks[i >> 2] = s.charCodeAt(i) + (s.charCodeAt(i + 1) << 8) + (s.charCodeAt(i + 2) << 16) + (s.charCodeAt(i + 3) << 24);\n            }\n            return md5blks;\n        },\n    \n        md5blk_array = function (a) {\n            var md5blks = [],\n                i; /* Andy King said do it this way. */\n    \n            for (i = 0; i < 64; i += 4) {\n                md5blks[i >> 2] = a[i] + (a[i + 1] << 8) + (a[i + 2] << 16) + (a[i + 3] << 24);\n            }\n            return md5blks;\n        },\n    \n        md51 = function (s) {\n            var n = s.length,\n                state = [1732584193, -271733879, -1732584194, 271733878],\n                i,\n                length,\n                tail,\n                tmp,\n                lo,\n                hi;\n    \n            for (i = 64; i <= n; i += 64) {\n                md5cycle(state, md5blk(s.substring(i - 64, i)));\n            }\n            s = s.substring(i - 64);\n            length = s.length;\n            tail = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];\n            for (i = 0; i < length; i += 1) {\n                tail[i >> 2] |= s.charCodeAt(i) << ((i % 4) << 3);\n            }\n            tail[i >> 2] |= 0x80 << ((i % 4) << 3);\n            if (i > 55) {\n                md5cycle(state, tail);\n                for (i = 0; i < 16; i += 1) {\n                    tail[i] = 0;\n                }\n            }\n    \n            // Beware that the final length might not fit in 32 bits so we take care of that\n            tmp = n * 8;\n            tmp = tmp.toString(16).match(/(.*?)(.{0,8})$/);\n            lo = parseInt(tmp[2], 16);\n            hi = parseInt(tmp[1], 16) || 0;\n    \n            tail[14] = lo;\n            tail[15] = hi;\n    \n            md5cycle(state, tail);\n            return state;\n        },\n    \n        md51_array = function (a) {\n            var n = a.length,\n                state = [1732584193, -271733879, -1732584194, 271733878],\n                i,\n                length,\n                tail,\n                tmp,\n                lo,\n                hi;\n    \n            for (i = 64; i <= n; i += 64) {\n                md5cycle(state, md5blk_array(a.subarray(i - 64, i)));\n            }\n    \n            // Not sure if it is a bug, however IE10 will always produce a sub array of length 1\n            // containing the last element of the parent array if the sub array specified starts\n            // beyond the length of the parent array - weird.\n            // https://connect.microsoft.com/IE/feedback/details/771452/typed-array-subarray-issue\n            a = (i - 64) < n ? a.subarray(i - 64) : new Uint8Array(0);\n    \n            length = a.length;\n            tail = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];\n            for (i = 0; i < length; i += 1) {\n                tail[i >> 2] |= a[i] << ((i % 4) << 3);\n            }\n    \n            tail[i >> 2] |= 0x80 << ((i % 4) << 3);\n            if (i > 55) {\n                md5cycle(state, tail);\n                for (i = 0; i < 16; i += 1) {\n                    tail[i] = 0;\n                }\n            }\n    \n            // Beware that the final length might not fit in 32 bits so we take care of that\n            tmp = n * 8;\n            tmp = tmp.toString(16).match(/(.*?)(.{0,8})$/);\n            lo = parseInt(tmp[2], 16);\n            hi = parseInt(tmp[1], 16) || 0;\n    \n            tail[14] = lo;\n            tail[15] = hi;\n    \n            md5cycle(state, tail);\n    \n            return state;\n        },\n    \n        hex_chr = ['0', '1', '2', '3', '4', '5', '6', '7', '8', '9', 'a', 'b', 'c', 'd', 'e', 'f'],\n    \n        rhex = function (n) {\n            var s = '',\n                j;\n            for (j = 0; j < 4; j += 1) {\n                s += hex_chr[(n >> (j * 8 + 4)) & 0x0F] + hex_chr[(n >> (j * 8)) & 0x0F];\n            }\n            return s;\n        },\n    \n        hex = function (x) {\n            var i;\n            for (i = 0; i < x.length; i += 1) {\n                x[i] = rhex(x[i]);\n            }\n            return x.join('');\n        },\n    \n        md5 = function (s) {\n            return hex(md51(s));\n        },\n    \n    \n    \n        ////////////////////////////////////////////////////////////////////////////\n    \n        /**\n         * SparkMD5 OOP implementation.\n         *\n         * Use this class to perform an incremental md5, otherwise use the\n         * static methods instead.\n         */\n        SparkMD5 = function () {\n            // call reset to init the instance\n            this.reset();\n        };\n    \n    \n        // In some cases the fast add32 function cannot be used..\n        if (md5('hello') !== '5d41402abc4b2a76b9719d911017c592') {\n            add32 = function (x, y) {\n                var lsw = (x & 0xFFFF) + (y & 0xFFFF),\n                    msw = (x >> 16) + (y >> 16) + (lsw >> 16);\n                return (msw << 16) | (lsw & 0xFFFF);\n            };\n        }\n    \n    \n        /**\n         * Appends a string.\n         * A conversion will be applied if an utf8 string is detected.\n         *\n         * @param {String} str The string to be appended\n         *\n         * @return {SparkMD5} The instance itself\n         */\n        SparkMD5.prototype.append = function (str) {\n            // converts the string to utf8 bytes if necessary\n            if (/[\\u0080-\\uFFFF]/.test(str)) {\n                str = unescape(encodeURIComponent(str));\n            }\n    \n            // then append as binary\n            this.appendBinary(str);\n    \n            return this;\n        };\n    \n        /**\n         * Appends a binary string.\n         *\n         * @param {String} contents The binary string to be appended\n         *\n         * @return {SparkMD5} The instance itself\n         */\n        SparkMD5.prototype.appendBinary = function (contents) {\n            this._buff += contents;\n            this._length += contents.length;\n    \n            var length = this._buff.length,\n                i;\n    \n            for (i = 64; i <= length; i += 64) {\n                md5cycle(this._state, md5blk(this._buff.substring(i - 64, i)));\n            }\n    \n            this._buff = this._buff.substr(i - 64);\n    \n            return this;\n        };\n    \n        /**\n         * Finishes the incremental computation, reseting the internal state and\n         * returning the result.\n         * Use the raw parameter to obtain the raw result instead of the hex one.\n         *\n         * @param {Boolean} raw True to get the raw result, false to get the hex result\n         *\n         * @return {String|Array} The result\n         */\n        SparkMD5.prototype.end = function (raw) {\n            var buff = this._buff,\n                length = buff.length,\n                i,\n                tail = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n                ret;\n    \n            for (i = 0; i < length; i += 1) {\n                tail[i >> 2] |= buff.charCodeAt(i) << ((i % 4) << 3);\n            }\n    \n            this._finish(tail, length);\n            ret = !!raw ? this._state : hex(this._state);\n    \n            this.reset();\n    \n            return ret;\n        };\n    \n        /**\n         * Finish the final calculation based on the tail.\n         *\n         * @param {Array}  tail   The tail (will be modified)\n         * @param {Number} length The length of the remaining buffer\n         */\n        SparkMD5.prototype._finish = function (tail, length) {\n            var i = length,\n                tmp,\n                lo,\n                hi;\n    \n            tail[i >> 2] |= 0x80 << ((i % 4) << 3);\n            if (i > 55) {\n                md5cycle(this._state, tail);\n                for (i = 0; i < 16; i += 1) {\n                    tail[i] = 0;\n                }\n            }\n    \n            // Do the final computation based on the tail and length\n            // Beware that the final length may not fit in 32 bits so we take care of that\n            tmp = this._length * 8;\n            tmp = tmp.toString(16).match(/(.*?)(.{0,8})$/);\n            lo = parseInt(tmp[2], 16);\n            hi = parseInt(tmp[1], 16) || 0;\n    \n            tail[14] = lo;\n            tail[15] = hi;\n            md5cycle(this._state, tail);\n        };\n    \n        /**\n         * Resets the internal state of the computation.\n         *\n         * @return {SparkMD5} The instance itself\n         */\n        SparkMD5.prototype.reset = function () {\n            this._buff = \"\";\n            this._length = 0;\n            this._state = [1732584193, -271733879, -1732584194, 271733878];\n    \n            return this;\n        };\n    \n        /**\n         * Releases memory used by the incremental buffer and other aditional\n         * resources. If you plan to use the instance again, use reset instead.\n         */\n        SparkMD5.prototype.destroy = function () {\n            delete this._state;\n            delete this._buff;\n            delete this._length;\n        };\n    \n    \n        /**\n         * Performs the md5 hash on a string.\n         * A conversion will be applied if utf8 string is detected.\n         *\n         * @param {String}  str The string\n         * @param {Boolean} raw True to get the raw result, false to get the hex result\n         *\n         * @return {String|Array} The result\n         */\n        SparkMD5.hash = function (str, raw) {\n            // converts the string to utf8 bytes if necessary\n            if (/[\\u0080-\\uFFFF]/.test(str)) {\n                str = unescape(encodeURIComponent(str));\n            }\n    \n            var hash = md51(str);\n    \n            return !!raw ? hash : hex(hash);\n        };\n    \n        /**\n         * Performs the md5 hash on a binary string.\n         *\n         * @param {String}  content The binary string\n         * @param {Boolean} raw     True to get the raw result, false to get the hex result\n         *\n         * @return {String|Array} The result\n         */\n        SparkMD5.hashBinary = function (content, raw) {\n            var hash = md51(content);\n    \n            return !!raw ? hash : hex(hash);\n        };\n    \n        /**\n         * SparkMD5 OOP implementation for array buffers.\n         *\n         * Use this class to perform an incremental md5 ONLY for array buffers.\n         */\n        SparkMD5.ArrayBuffer = function () {\n            // call reset to init the instance\n            this.reset();\n        };\n    \n        ////////////////////////////////////////////////////////////////////////////\n    \n        /**\n         * Appends an array buffer.\n         *\n         * @param {ArrayBuffer} arr The array to be appended\n         *\n         * @return {SparkMD5.ArrayBuffer} The instance itself\n         */\n        SparkMD5.ArrayBuffer.prototype.append = function (arr) {\n            // TODO: we could avoid the concatenation here but the algorithm would be more complex\n            //       if you find yourself needing extra performance, please make a PR.\n            var buff = this._concatArrayBuffer(this._buff, arr),\n                length = buff.length,\n                i;\n    \n            this._length += arr.byteLength;\n    \n            for (i = 64; i <= length; i += 64) {\n                md5cycle(this._state, md5blk_array(buff.subarray(i - 64, i)));\n            }\n    \n            // Avoids IE10 weirdness (documented above)\n            this._buff = (i - 64) < length ? buff.subarray(i - 64) : new Uint8Array(0);\n    \n            return this;\n        };\n    \n        /**\n         * Finishes the incremental computation, reseting the internal state and\n         * returning the result.\n         * Use the raw parameter to obtain the raw result instead of the hex one.\n         *\n         * @param {Boolean} raw True to get the raw result, false to get the hex result\n         *\n         * @return {String|Array} The result\n         */\n        SparkMD5.ArrayBuffer.prototype.end = function (raw) {\n            var buff = this._buff,\n                length = buff.length,\n                tail = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n                i,\n                ret;\n    \n            for (i = 0; i < length; i += 1) {\n                tail[i >> 2] |= buff[i] << ((i % 4) << 3);\n            }\n    \n            this._finish(tail, length);\n            ret = !!raw ? this._state : hex(this._state);\n    \n            this.reset();\n    \n            return ret;\n        };\n    \n        SparkMD5.ArrayBuffer.prototype._finish = SparkMD5.prototype._finish;\n    \n        /**\n         * Resets the internal state of the computation.\n         *\n         * @return {SparkMD5.ArrayBuffer} The instance itself\n         */\n        SparkMD5.ArrayBuffer.prototype.reset = function () {\n            this._buff = new Uint8Array(0);\n            this._length = 0;\n            this._state = [1732584193, -271733879, -1732584194, 271733878];\n    \n            return this;\n        };\n    \n        /**\n         * Releases memory used by the incremental buffer and other aditional\n         * resources. If you plan to use the instance again, use reset instead.\n         */\n        SparkMD5.ArrayBuffer.prototype.destroy = SparkMD5.prototype.destroy;\n    \n        /**\n         * Concats two array buffers, returning a new one.\n         *\n         * @param  {ArrayBuffer} first  The first array buffer\n         * @param  {ArrayBuffer} second The second array buffer\n         *\n         * @return {ArrayBuffer} The new array buffer\n         */\n        SparkMD5.ArrayBuffer.prototype._concatArrayBuffer = function (first, second) {\n            var firstLength = first.length,\n                result = new Uint8Array(firstLength + second.byteLength);\n    \n            result.set(first);\n            result.set(new Uint8Array(second), firstLength);\n    \n            return result;\n        };\n    \n        /**\n         * Performs the md5 hash on an array buffer.\n         *\n         * @param {ArrayBuffer} arr The array buffer\n         * @param {Boolean}     raw True to get the raw result, false to get the hex result\n         *\n         * @return {String|Array} The result\n         */\n        SparkMD5.ArrayBuffer.hash = function (arr, raw) {\n            var hash = md51_array(new Uint8Array(arr));\n    \n            return !!raw ? hash : hex(hash);\n        };\n        \n        return FlashRuntime.register( 'Md5', {\n            init: function() {\n                // do nothing.\n            },\n    \n            loadFromBlob: function( file ) {\n                var blob = file.getSource(),\n                    chunkSize = 2 * 1024 * 1024,\n                    chunks = Math.ceil( blob.size / chunkSize ),\n                    chunk = 0,\n                    owner = this.owner,\n                    spark = new SparkMD5.ArrayBuffer(),\n                    me = this,\n                    blobSlice = blob.mozSlice || blob.webkitSlice || blob.slice,\n                    loadNext, fr;\n    \n                fr = new FileReader();\n    \n                loadNext = function() {\n                    var start, end;\n    \n                    start = chunk * chunkSize;\n                    end = Math.min( start + chunkSize, blob.size );\n    \n                    fr.onload = function( e ) {\n                        spark.append( e.target.result );\n                        owner.trigger( 'progress', {\n                            total: file.size,\n                            loaded: end\n                        });\n                    };\n    \n                    fr.onloadend = function() {\n                        fr.onloadend = fr.onload = null;\n    \n                        if ( ++chunk < chunks ) {\n                            setTimeout( loadNext, 1 );\n                        } else {\n                            setTimeout(function(){\n                                owner.trigger('load');\n                                me.result = spark.end();\n                                loadNext = file = blob = spark = null;\n                                owner.trigger('complete');\n                            }, 50 );\n                        }\n                    };\n    \n                    fr.readAsArrayBuffer( blobSlice.call( blob, start, end ) );\n                };\n    \n                loadNext();\n            },\n    \n            getResult: function() {\n                return this.result;\n            }\n        });\n    });\n    /**\n     * @fileOverview FlashRuntime\n     */\n    define('runtime/flash/runtime',[\n        'base',\n        'runtime/runtime',\n        'runtime/compbase'\n    ], function( Base, Runtime, CompBase ) {\n    \n        var $ = Base.$,\n            type = 'flash',\n            components = {};\n    \n    \n        function getFlashVersion() {\n            var version;\n    \n            try {\n                version = navigator.plugins[ 'Shockwave Flash' ];\n                version = version.description;\n            } catch ( ex ) {\n                try {\n                    version = new ActiveXObject('ShockwaveFlash.ShockwaveFlash')\n                            .GetVariable('$version');\n                } catch ( ex2 ) {\n                    version = '0.0';\n                }\n            }\n            version = version.match( /\\d+/g );\n            return parseFloat( version[ 0 ] + '.' + version[ 1 ], 10 );\n        }\n    \n        function FlashRuntime() {\n            var pool = {},\n                clients = {},\n                destroy = this.destroy,\n                me = this,\n                jsreciver = Base.guid('webuploader_');\n    \n            Runtime.apply( me, arguments );\n            me.type = type;\n    \n    \n            // 这个方法的调用者，实际上是RuntimeClient\n            me.exec = function( comp, fn/*, args...*/ ) {\n                var client = this,\n                    uid = client.uid,\n                    args = Base.slice( arguments, 2 ),\n                    instance;\n    \n                clients[ uid ] = client;\n    \n                if ( components[ comp ] ) {\n                    if ( !pool[ uid ] ) {\n                        pool[ uid ] = new components[ comp ]( client, me );\n                    }\n    \n                    instance = pool[ uid ];\n    \n                    if ( instance[ fn ] ) {\n                        return instance[ fn ].apply( instance, args );\n                    }\n                }\n    \n                return me.flashExec.apply( client, arguments );\n            };\n    \n            function handler( evt, obj ) {\n                var type = evt.type || evt,\n                    parts, uid;\n    \n                parts = type.split('::');\n                uid = parts[ 0 ];\n                type = parts[ 1 ];\n    \n                // console.log.apply( console, arguments );\n    \n                if ( type === 'Ready' && uid === me.uid ) {\n                    me.trigger('ready');\n                } else if ( clients[ uid ] ) {\n                    clients[ uid ].trigger( type.toLowerCase(), evt, obj );\n                }\n    \n                // Base.log( evt, obj );\n            }\n    \n            // flash的接受器。\n            window[ jsreciver ] = function() {\n                var args = arguments;\n    \n                // 为了能捕获得到。\n                setTimeout(function() {\n                    handler.apply( null, args );\n                }, 1 );\n            };\n    \n            this.jsreciver = jsreciver;\n    \n            this.destroy = function() {\n                // @todo 删除池子中的所有实例\n                return destroy && destroy.apply( this, arguments );\n            };\n    \n            this.flashExec = function( comp, fn ) {\n                var flash = me.getFlash(),\n                    args = Base.slice( arguments, 2 );\n    \n                return flash.exec( this.uid, comp, fn, args );\n            };\n    \n            // @todo\n        }\n    \n        Base.inherits( Runtime, {\n            constructor: FlashRuntime,\n    \n            init: function() {\n                var container = this.getContainer(),\n                    opts = this.options,\n                    html;\n    \n                // if not the minimal height, shims are not initialized\n                // in older browsers (e.g FF3.6, IE6,7,8, Safari 4.0,5.0, etc)\n                container.css({\n                    position: 'absolute',\n                    top: '-8px',\n                    left: '-8px',\n                    width: '9px',\n                    height: '9px',\n                    overflow: 'hidden'\n                });\n    \n                // insert flash object\n                html = '<object id=\"' + this.uid + '\" type=\"application/' +\n                        'x-shockwave-flash\" data=\"' +  opts.swf + '\" ';\n    \n                if ( Base.browser.ie ) {\n                    html += 'classid=\"clsid:d27cdb6e-ae6d-11cf-96b8-444553540000\" ';\n                }\n    \n                html += 'width=\"100%\" height=\"100%\" style=\"outline:0\">'  +\n                    '<param name=\"movie\" value=\"' + opts.swf + '\" />' +\n                    '<param name=\"flashvars\" value=\"uid=' + this.uid +\n                    '&jsreciver=' + this.jsreciver + '\" />' +\n                    '<param name=\"wmode\" value=\"transparent\" />' +\n                    '<param name=\"allowscriptaccess\" value=\"always\" />' +\n                '</object>';\n    \n                container.html( html );\n            },\n    \n            getFlash: function() {\n                if ( this._flash ) {\n                    return this._flash;\n                }\n    \n                this._flash = $( '#' + this.uid ).get( 0 );\n                return this._flash;\n            }\n    \n        });\n    \n        FlashRuntime.register = function( name, component ) {\n            component = components[ name ] = Base.inherits( CompBase, $.extend({\n    \n                // @todo fix this later\n                flashExec: function() {\n                    var owner = this.owner,\n                        runtime = this.getRuntime();\n    \n                    return runtime.flashExec.apply( owner, arguments );\n                }\n            }, component ) );\n    \n            return component;\n        };\n    \n        if ( getFlashVersion() >= 11.4 ) {\n            Runtime.addRuntime( type, FlashRuntime );\n        }\n    \n        return FlashRuntime;\n    });\n    /**\n     * @fileOverview FilePicker\n     */\n    define('runtime/flash/filepicker',[\n        'base',\n        'runtime/flash/runtime'\n    ], function( Base, FlashRuntime ) {\n        var $ = Base.$;\n    \n        return FlashRuntime.register( 'FilePicker', {\n            init: function( opts ) {\n                var copy = $.extend({}, opts ),\n                    len, i;\n    \n                // 修复Flash再没有设置title的情况下无法弹出flash文件选择框的bug.\n                len = copy.accept && copy.accept.length;\n                for (  i = 0; i < len; i++ ) {\n                    if ( !copy.accept[ i ].title ) {\n                        copy.accept[ i ].title = 'Files';\n                    }\n                }\n    \n                delete copy.button;\n                delete copy.id;\n                delete copy.container;\n    \n                this.flashExec( 'FilePicker', 'init', copy );\n            },\n    \n            destroy: function() {\n                this.flashExec( 'FilePicker', 'destroy' );\n            }\n        });\n    });\n    /**\n     * @fileOverview 图片压缩\n     */\n    define('runtime/flash/image',[\n        'runtime/flash/runtime'\n    ], function( FlashRuntime ) {\n    \n        return FlashRuntime.register( 'Image', {\n            // init: function( options ) {\n            //     var owner = this.owner;\n    \n            //     this.flashExec( 'Image', 'init', options );\n            //     owner.on( 'load', function() {\n            //         debugger;\n            //     });\n            // },\n    \n            loadFromBlob: function( blob ) {\n                var owner = this.owner;\n    \n                owner.info() && this.flashExec( 'Image', 'info', owner.info() );\n                owner.meta() && this.flashExec( 'Image', 'meta', owner.meta() );\n    \n                this.flashExec( 'Image', 'loadFromBlob', blob.uid );\n            }\n        });\n    });\n    /**\n     * @fileOverview  Transport flash实现\n     */\n    define('runtime/flash/transport',[\n        'base',\n        'runtime/flash/runtime',\n        'runtime/client'\n    ], function( Base, FlashRuntime, RuntimeClient ) {\n        var $ = Base.$;\n    \n        return FlashRuntime.register( 'Transport', {\n            init: function() {\n                this._status = 0;\n                this._response = null;\n                this._responseJson = null;\n            },\n    \n            send: function() {\n                var owner = this.owner,\n                    opts = this.options,\n                    xhr = this._initAjax(),\n                    blob = owner._blob,\n                    server = opts.server,\n                    binary;\n    \n                xhr.connectRuntime( blob.ruid );\n    \n                if ( opts.sendAsBinary ) {\n                    server += (/\\?/.test( server ) ? '&' : '?') +\n                            $.param( owner._formData );\n    \n                    binary = blob.uid;\n                } else {\n                    $.each( owner._formData, function( k, v ) {\n                        xhr.exec( 'append', k, v );\n                    });\n    \n                    xhr.exec( 'appendBlob', opts.fileVal, blob.uid,\n                            opts.filename || owner._formData.name || '' );\n                }\n    \n                this._setRequestHeader( xhr, opts.headers );\n                xhr.exec( 'send', {\n                    method: opts.method,\n                    url: server,\n                    forceURLStream: opts.forceURLStream,\n                    mimeType: 'application/octet-stream'\n                }, binary );\n            },\n    \n            getStatus: function() {\n                return this._status;\n            },\n    \n            getResponse: function() {\n                return this._response || '';\n            },\n    \n            getResponseAsJson: function() {\n                return this._responseJson;\n            },\n    \n            abort: function() {\n                var xhr = this._xhr;\n    \n                if ( xhr ) {\n                    xhr.exec('abort');\n                    xhr.destroy();\n                    this._xhr = xhr = null;\n                }\n            },\n    \n            destroy: function() {\n                this.abort();\n            },\n    \n            _initAjax: function() {\n                var me = this,\n                    xhr = new RuntimeClient('XMLHttpRequest');\n    \n                xhr.on( 'uploadprogress progress', function( e ) {\n                    var percent = e.loaded / e.total;\n                    percent = Math.min( 1, Math.max( 0, percent ) );\n                    return me.trigger( 'progress', percent );\n                });\n    \n                xhr.on( 'load', function() {\n                    var status = xhr.exec('getStatus'),\n                        readBody = false,\n                        err = '',\n                        p;\n    \n                    xhr.off();\n                    me._xhr = null;\n    \n                    if ( status >= 200 && status < 300 ) {\n                        readBody = true;\n                    } else if ( status >= 500 && status < 600 ) {\n                        readBody = true;\n                        err = 'server';\n                    } else {\n                        err = 'http';\n                    }\n    \n                    if ( readBody ) {\n                        me._response = xhr.exec('getResponse');\n                        me._response = decodeURIComponent( me._response );\n    \n                        // flash 处理可能存在 bug, 没辙只能靠 js 了\n                        // try {\n                        //     me._responseJson = xhr.exec('getResponseAsJson');\n                        // } catch ( error ) {\n                            \n                        p = window.JSON && window.JSON.parse || function( s ) {\n                            try {\n                                return new Function('return ' + s).call();\n                            } catch ( err ) {\n                                return {};\n                            }\n                        };\n                        me._responseJson  = me._response ? p(me._response) : {};\n                            \n                        // }\n                    }\n                    \n                    xhr.destroy();\n                    xhr = null;\n    \n                    return err ? me.trigger( 'error', err ) : me.trigger('load');\n                });\n    \n                xhr.on( 'error', function() {\n                    xhr.off();\n                    me._xhr = null;\n                    me.trigger( 'error', 'http' );\n                });\n    \n                me._xhr = xhr;\n                return xhr;\n            },\n    \n            _setRequestHeader: function( xhr, headers ) {\n                $.each( headers, function( key, val ) {\n                    xhr.exec( 'setRequestHeader', key, val );\n                });\n            }\n        });\n    });\n    /**\n     * @fileOverview Blob Html实现\n     */\n    define('runtime/flash/blob',[\n        'runtime/flash/runtime',\n        'lib/blob'\n    ], function( FlashRuntime, Blob ) {\n    \n        return FlashRuntime.register( 'Blob', {\n            slice: function( start, end ) {\n                var blob = this.flashExec( 'Blob', 'slice', start, end );\n    \n                return new Blob( blob.uid, blob );\n            }\n        });\n    });\n    /**\n     * @fileOverview  Md5 flash实现\n     */\n    define('runtime/flash/md5',[\n        'runtime/flash/runtime'\n    ], function( FlashRuntime ) {\n        \n        return FlashRuntime.register( 'Md5', {\n            init: function() {\n                // do nothing.\n            },\n    \n            loadFromBlob: function( blob ) {\n                return this.flashExec( 'Md5', 'loadFromBlob', blob.uid );\n            }\n        });\n    });\n    /**\n     * @fileOverview 完全版本。\n     */\n    define('preset/all',[\n        'base',\n    \n        // widgets\n        'widgets/filednd',\n        'widgets/filepaste',\n        'widgets/filepicker',\n        'widgets/image',\n        'widgets/queue',\n        'widgets/runtime',\n        'widgets/upload',\n        'widgets/validator',\n        'widgets/md5',\n    \n        // runtimes\n        // html5\n        'runtime/html5/blob',\n        'runtime/html5/dnd',\n        'runtime/html5/filepaste',\n        'runtime/html5/filepicker',\n        'runtime/html5/imagemeta/exif',\n        'runtime/html5/androidpatch',\n        'runtime/html5/image',\n        'runtime/html5/transport',\n        'runtime/html5/md5',\n    \n        // flash\n        'runtime/flash/filepicker',\n        'runtime/flash/image',\n        'runtime/flash/transport',\n        'runtime/flash/blob',\n        'runtime/flash/md5'\n    ], function( Base ) {\n        return Base;\n    });\n    /**\n     * @fileOverview 日志组件，主要用来收集错误信息，可以帮助 webuploader 更好的定位问题和发展。\n     *\n     * 如果您不想要启用此功能，请在打包的时候去掉 log 模块。\n     *\n     * 或者可以在初始化的时候通过 options.disableWidgets 属性禁用。\n     *\n     * 如：\n     * WebUploader.create({\n     *     ...\n     *\n     *     disableWidgets: 'log',\n     *\n     *     ...\n     * })\n     */\n    define('widgets/log',[\n        'base',\n        'uploader',\n        'widgets/widget'\n    ], function( Base, Uploader ) {\n        var $ = Base.$,\n            logUrl = ' http://static.tieba.baidu.com/tb/pms/img/st.gif??',\n            product = (location.hostname || location.host || 'protected').toLowerCase(),\n    \n            // 只针对 baidu 内部产品用户做统计功能。\n            enable = product && /baidu/i.exec(product),\n            base;\n    \n        if (!enable) {\n            return;\n        }\n    \n        base = {\n            dv: 3,\n            master: 'webuploader',\n            online: /test/.exec(product) ? 0 : 1,\n            module: '',\n            product: product,\n            type: 0\n        };\n    \n        function send(data) {\n            var obj = $.extend({}, base, data),\n                url = logUrl.replace(/^(.*)\\?/, '$1' + $.param( obj )),\n                image = new Image();\n    \n            image.src = url;\n        }\n    \n        return Uploader.register({\n            name: 'log',\n    \n            init: function() {\n                var owner = this.owner,\n                    count = 0,\n                    size = 0;\n    \n                owner\n                    .on('error', function(code) {\n                        send({\n                            type: 2,\n                            c_error_code: code\n                        });\n                    })\n                    .on('uploadError', function(file, reason) {\n                        send({\n                            type: 2,\n                            c_error_code: 'UPLOAD_ERROR',\n                            c_reason: '' + reason\n                        });\n                    })\n                    .on('uploadComplete', function(file) {\n                        count++;\n                        size += file.size;\n                    }).\n                    on('uploadFinished', function() {\n                        send({\n                            c_count: count,\n                            c_size: size\n                        });\n                        count = size = 0;\n                    });\n    \n                send({\n                    c_usage: 1\n                });\n            }\n        });\n    });\n    /**\n     * @fileOverview Uploader上传类\n     */\n    define('webuploader',[\n        'preset/all',\n        'widgets/log'\n    ], function( preset ) {\n        return preset;\n    });\n    return require('webuploader');\n});\n"]}