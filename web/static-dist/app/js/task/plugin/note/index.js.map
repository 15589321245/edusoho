{"version":3,"sources":["webpack:///./app/Resources/static-src/app/js/task/plugin/note/index.js","webpack:///./app/Resources/static-src/app/js/task/plugin/save-redmine.js"],"names":["heigth","$","height","$content","lastNoteContent","editor","CKEDITOR","replace","toolbar","filebrowserImageUploadUrl","data","allowedContent","on","val","getData","click","event","$btn","preventDefault","saveNote","setInterval","trim","$form","serializeArray","value","attr","post","then","response","removeAttr","$savedMessage","saveRedmineLoading","html","Translator","trans","show","saveRedmineSuccess","date","Date","Format","setTimeout","hide"],"mappings":";;;;;;;AAAA;;;;AACA;;;;AACA,KAAIA,SAAUC,EAAE,kBAAF,EAAsBC,MAAtB,KAAiC,GAA/C;AACA,KAAIC,WAAWF,EAAE,qBAAF,CAAf;AACA,KAAIG,wBAAJ;AACA,KAAIC,SAASC,SAASC,OAAT,CAAiB,oBAAjB,EAAuC;AAClDC,YAAS,QADyC;AAElDC,8BAA2BN,SAASO,IAAT,CAAc,gBAAd,CAFuB;AAGlDC,mBAAgB,IAHkC;AAIlDT,WAAQF,SAAS,GAAT,GAAe,GAAf,GAAqBA;AAJqB,EAAvC,CAAb;;AAOAK,QAAOO,EAAP,CAAU,QAAV,EAAoB,YAAM;AACxBT,YAASU,GAAT,CAAaR,OAAOS,OAAP,EAAb;AACD,EAFD;;AAIAb,GAAE,gBAAF,EAAoBc,KAApB,CAA0B,UAAUC,KAAV,EAAiB;AACzC,OAAIC,OAAOhB,EAAE,IAAF,CAAX;AACAe,SAAME,cAAN;AACAC,YAASF,IAAT;AACD,EAJD;;AAMAG,aAAYD,QAAZ,EAAqB,KAArB;;AAEA,UAASA,QAAT,GAA+B;AAAA,OAAbF,IAAa,uEAAN,IAAM;;AAC7B,OAAG,CAAChB,EAAEoB,IAAF,CAAOlB,SAASU,GAAT,EAAP,CAAJ,EAA4B;AAC1BI,YAAO,sBAAO,QAAP,EAAiB,UAAjB,CAAP,GAAsC,EAAtC;AACA;AACD;AACD,OAAIK,QAAQrB,EAAE,wBAAF,CAAZ;AACA,OAAIS,OAAOY,MAAMC,cAAN,EAAX;AACA,OAAGnB,oBAAoBM,KAAK,CAAL,EAAQc,KAA/B,EAAsC;AACpC;AACD;AACD;AACAP,UAAOA,KAAKQ,IAAL,CAAU,UAAV,EAAsB,UAAtB,CAAP,GAA0C,EAA1C;AACAxB,KAAEyB,IAAF,CAAOJ,MAAMG,IAAN,CAAW,QAAX,CAAP,EAA6Bf,IAA7B,EACGiB,IADH,CACQ,UAACC,QAAD,EAAc;AAClB;AACA,SAAGX,IAAH,EAAS;AACPA,YAAKY,UAAL,CAAgB,UAAhB;AACD;AACDzB,uBAAkBM,KAAK,CAAL,EAAQc,KAA1B;AACD,IAPH;AAQD,E;;;;;;;;;;;;;;AC5CD;;AACA,KAAIM,gBAAgB7B,EAAE,2BAAF,CAApB;AACA;AACA,KAAM8B,qBAAqB,SAArBA,kBAAqB,GAAM;AAC/BD,iBAAcE,IAAd,CAAmBC,WAAWC,KAAX,CAAiB,+BAAjB,CAAnB,EAAsEC,IAAtE;AACD,EAFD;;AAIA,KAAMC,qBAAqB,SAArBA,kBAAqB,GAAM;AAC/B,OAAIC,OAAO,IAAIC,IAAJ,GAAWC,MAAX,CAAkB,qBAAlB,CAAX;AACAT,iBAAcE,IAAd,CAAmBC,WAAWC,KAAX,CAAiB,uCAAjB,EAA0D,EAACG,MAAMA,IAAP,EAA1D,CAAnB,EAA4FF,IAA5F;AACAK,cAAW,YAAM;AACfV,mBAAcW,IAAd;AACD,IAFD,EAEG,IAFH;AAGD,EAND;;SASEV,kB,GAAAA,kB;SACAK,kB,GAAAA,kB","file":"app/js/task/plugin/note/index.js","sourcesContent":["import notify from 'common/notify';\nimport { saveRedmineLoading, saveRedmineSuccess } from '../save-redmine';\nlet heigth = ($('.js-sidebar-pane').height() - 175);\nlet $content = $('#note-content-field');\nlet lastNoteContent;\nlet editor = CKEDITOR.replace('note-content-field', {\n  toolbar: 'Simple',\n  filebrowserImageUploadUrl: $content.data('imageUploadUrl'),\n  allowedContent: true,\n  height: heigth < 300 ? 200 : heigth,\n});\n\neditor.on('change', () => {\n  $content.val(editor.getData());\n});\n\n$('#note-save-btn').click(function (event) {\n  let $btn = $(this);\n  event.preventDefault();\n  saveNote($btn);\n});\n\nsetInterval(saveNote,30000);\n\nfunction saveNote($btn = null) {\n  if(!$.trim($content.val())) {\n    $btn ? notify('danger', '请输入笔记内容！') : '';\n    return;\n  }\n  let $form = $('#task-note-plugin-form');\n  let data = $form.serializeArray();\n  if(lastNoteContent === data[0].value) {\n    return;\n  }\n  saveRedmineLoading();\n  $btn ? $btn.attr('disabled', 'disabled'): \"\";\n  $.post($form.attr('action'), data)\n    .then((response) => {\n      saveRedmineSuccess();\n      if($btn) {\n        $btn.removeAttr('disabled');\n      }\n      lastNoteContent = data[0].value;\n    });\n}\n\n\n\n// WEBPACK FOOTER //\n// ./app/Resources/static-src/app/js/task/plugin/note/index.js","import { dateFormat } from 'app/common/unit';\nlet $savedMessage = $('[data-role=saved-message]');\ndateFormat();\nconst saveRedmineLoading = () => {\n  $savedMessage.html(Translator.trans('task.plugin_redmine_save_hint')).show();\n}\n\nconst saveRedmineSuccess = () => {\n  let date = new Date().Format('yyyy-MM-dd hh:mm:ss');\n  $savedMessage.html(Translator.trans('task.plugin_redmine_save_success_hint', {date: date})).show();\n  setTimeout(() => {\n    $savedMessage.hide();\n  }, 3000);\n}\n\nexport {\n  saveRedmineLoading,\n  saveRedmineSuccess,\n}\n\n\n// WEBPACK FOOTER //\n// ./app/Resources/static-src/app/js/task/plugin/save-redmine.js"],"sourceRoot":""}