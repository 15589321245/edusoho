{"version":3,"sources":["app/Resources/static-src/app/common/ppt-player.js"],"names":["PPT","element","slides","watermark","$","_KEY_ACTION_MAP","_onPrev","_onNext","_onLast","_onFirst","total","length","_page","placeholder","_init","html","find","text","slidesHTML","reduce","src","index","append","_render","_bindEvents","page","currentPage","$slide","_getSlide","attr","data","eq","document","on","event","keyCode","call","_onFullScreen","_onChangePage","self","current","before","trigger","enabled","isFullscreen","toggle","request","e","target","val","newPage","beforePage","removeClass","$currentSlide","addClass","load","_lazyLoad"],"mappings":"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","file":"ppt-player.js","sourceRoot":"/Users/kz/projects/edusoho","sourcesContent":["import Emitter from \"common/es-event-emitter\";\nimport screenfull from \"screenfull\";\n\nexport default class PPT extends Emitter {\n  constructor({element, slides, watermark}) {\n    super();\n    this.element = $(element);\n    this.slides = slides || [];\n    this.watermark = watermark || '';\n    this._KEY_ACTION_MAP = {\n      37: this._onPrev,  // ←\n      39: this._onNext,  // →\n      38: this._onLast,  // ↑\n      40: this._onFirst  // ↓\n    };\n    this.total = this.slides.length;\n    this._page = 0;\n    this.placeholder = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC\";\n    this._init();\n  }\n\n  get page() {\n    return this._page;\n  }\n\n  set page(newPage) {\n    let beforePage = this.page;\n    let currentPage = newPage;\n\n    if (currentPage > this.total) {\n      this.element.find('.goto-page').val(currentPage);\n      this._page = currentPage;\n    }\n\n    if (currentPage < 1) {\n      this.element.find('.goto-page').val(beforePage);\n      this._page = beforePage;\n    }\n\n    if (beforePage) {\n      this.element.find('.slide-player-body .slide').eq(beforePage - 1).removeClass('active');\n    }\n\n    let $currentSlide = this._getSlide(currentPage);\n\n    if ($currentSlide.attr('src')) {\n      $currentSlide.addClass('active');\n    } else {\n      $currentSlide.load(() => {\n        if (this._page != $currentSlide.data('page')) {\n          return;\n        }\n        $currentSlide.addClass('active');\n      });\n      $currentSlide.attr('src', $currentSlide.data('src'));\n    }\n\n    this._lazyLoad(currentPage);\n\n    this.element.find('.goto-page').val(currentPage);\n\n    this._page = currentPage;\n\n    this.trigger('change', {\n      current: currentPage,\n      before: beforePage\n    });\n  }\n\n  _render() {\n    let html = `\n      <div class=\"slide-player\">\n        <div class=\"slide-player-body loading-background\"></div>\n        <div class=\"slide-notice\">\n          <div class=\"header\">{{ '已经到最后一张图片了哦'|trans }}\n            <button type=\"button\" class=\"close\">×</button>\n          </div>\n        </div>\n      \n        <div class=\"slide-player-control clearfix\">\n          <a href=\"javascript:\" class=\"goto-first\">\n            <span class=\"glyphicon glyphicon-step-backward\"></span>\n          </a>\n          <a href=\"javascript:\" class=\"goto-prev\">\n            <span class=\"glyphicon glyphicon-chevron-left\"></span>\n          </a>\n          <a href=\"javascript:\" class=\"goto-next\">\n            <span class=\"glyphicon glyphicon-chevron-right\"></span>\n          </a>\n          <a href=\"javascript:\" class=\"goto-last\">\n            <span class=\"glyphicon glyphicon-step-forward\"></span>\n          </a>\n          <a href=\"javascript:\" class=\"fullscreen\">\n            <span class=\"glyphicon glyphicon-fullscreen\"></span>\n          </a>\n          <div class=\"goto-page-input\">\n            <input type=\"text\" class=\"goto-page form-control input-sm\" value=\"1\">&nbsp;/&nbsp;\n              <span class=\"total\"></span>\n          </div>\n        </div>\n      </div>`;\n\n    this.element.html(html);\n\n    this.element.find('.total').text(this.total);\n\n    let slidesHTML = this.slides.reduce((html, src, index) => {\n      html += `<img data-src=\"${src}\" class=\"slide\" data-page=\"${index + 1}\">`;\n      return html;\n    }, '');\n\n    this.element.find('.slide-player-body').html(slidesHTML);\n    this.watermark && this.element.append(`<div class=\"slide-player-watermark\">${this.watermark}</div>`);\n  }\n\n  _init() {\n    this._render();\n    this._bindEvents();\n    this._onFirst();\n  }\n\n\n  _lazyLoad(page) {\n    for (let currentPage = page; currentPage < page + 4; currentPage++) {\n      if (currentPage > this.total) {\n        break;\n      }\n\n      let $slide = this._getSlide(currentPage);\n      $slide.attr('src') || $slide.attr('src', $slide.data('src'));\n    }\n  }\n\n  _getSlide(page) {\n    return this.element.find('.slide-player-body .slide').eq(page - 1);\n  }\n\n  _bindEvents() {\n    $(document).on('keydown', (event) => {\n      this._KEY_ACTION_MAP[event.keyCode] && this._KEY_ACTION_MAP[event.keyCode].call(this);\n    });\n\n    this.element.on('click', '.goto-next', event => this._onNext(event));\n    this.element.on('click', '.goto-prev', event => this._onPrev(event));\n    this.element.on('click', '.goto-first', event => this._onFirst(event));\n    this.element.on('click', '.goto-last', event => this._onLast(event));\n    this.element.on('click', '.fullscreen', event => this._onFullScreen(event));\n    this.element.on('change', '.goto-page', event => this._onChangePage(event));\n    let self = this;\n    this.on('change', ({current, before}) => {\n      if (current == self.total) {\n        self.trigger('end');\n      }\n    });\n  }\n\n  _onNext() {\n    if (this.page === this.total) {\n      this.trigger('end');\n      return;\n    }\n\n    this.page++;\n  }\n\n  _onPrev() {\n    if (this.page == 1) {\n      return;\n    }\n\n    this.page--;\n  }\n\n  _onFirst() {\n    this.page = 1;\n  }\n\n  _onLast() {\n    this.page = this.total\n  }\n\n  _onFullScreen() {\n    if (!screenfull.enabled) {\n      return;\n    }\n    if (screenfull.isFullscreen) {\n      screenfull.toggle();\n    } else {\n      screenfull.request();\n    }\n  }\n\n  _onChangePage(e) {\n    this.page = $(e.target).val();\n  }\n}\n"]}