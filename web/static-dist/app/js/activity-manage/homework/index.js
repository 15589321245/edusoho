webpackJsonp(["app/js/activity-manage/homework/index"],[function(t,e){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),a=function(){function t(e){n(this,t),this.$element=e,this._setValidateRule(),this._init(),this._initEvent()}return i(t,[{key:"_init",value:function(){var t=CKEDITOR.replace("homework-about-field",{toolbar:"Minimal",filebrowserImageUploadUrl:$("#homework-about-field").data("imageUploadUrl")});t.on("change",function(){$("#homework-about-field").val(t.getData())}),this._inItStep2form()}},{key:"_initEvent",value:function(){var t=this;this.$element.on("click",'[data-role="pick-item"]',function(e){return t._showPickQuestion(e)})}},{key:"_showPickQuestion",value:function(t){t.preventDefault();var e=$(t.currentTarget),n=[];$("#course-tasks-next",window.parent.document).attr("disabled",!1),$("#question-table-tbody").find('[name="questionIds[]"]').each(function(){n.push($(this).val())});var i=$("#attachment-modal",window.parent.document).modal();i.data("manager",this),$.get(e.data("url"),{excludeIds:n.join(",")},function(t){i.html(t)})}},{key:"_inItStep2form",value:function(){var t=this.$element,e=t.validate({onkeyup:!1,rules:{title:{required:!0},"questionIds[]":{required:!0}},messages:{title:"请填写标题","questionIds[]":{required:"请选择题目"}}});t.data("validator",e)}},{key:"_inItStep3form",value:function(){var t=$("#step3-form"),e=t.validate({onkeyup:!1,rules:{title:{required:!0},checkType:{required:!0},finishCondition:{required:!0}},messages:{title:"请填写标题",checkType:"考评方式",finishCondition:"请选择完成条件"}});t.data("validator",e)}},{key:"_setValidateRule",value:function(){$.validator.addMethod("arithmeticFloat",function(t,e){return this.optional(e)||/^[0-9]+(\.[0-9]?)?$/.test(t)},$.validator.format("必须为正数，保留一位小数")),$.validator.addMethod("positiveInteger",function(t,e){return this.optional(e)||/^[1-9]\d*$/.test(t)},$.validator.format("必须为正整数")),$.validator.addMethod("DateAndTime",function(t,e){var n=/^(?:(?!0000)[0-9]{4}-(?:(?:0[1-9]|1[0-2])-(?:0[1-9]|1[0-9]|2[0-8])|(?:0[13-9]|1[0-2])-(?:29|30)|(?:0[13578]|1[02])-31)|(?:[0-9]{2}(?:0[48]|[2468][048]|[13579][26])|(?:0[48]|[2468][048]|[13579][26])00)-02-29) ([0-1]{1}[0-9]{1})|(2[0-4]{1}):[0-5]{1}[0-9]{1}$/;return this.optional(e)||n.test(t)},$.validator.format("请输入正确的日期和时间,格式如XXXX-MM-DD hh:mm"))}}]),t}(),r=function(){function t(e){n(this,t),this.$form=e,this._init(),this._initEvent()}return i(t,[{key:"_init",value:function(){}},{key:"_initEvent",value:function(){var t=this;this.$form.on("click",'[data-role="preview-btn"]',function(e){return t._questionPreview(e)}),this.$form.on("click",'[data-role="item-delete-btn"]',function(e){return t._deleteItem(e)}),this.$form.on("click",'[data-role="replace-item"]',function(e){return t._replaceItem(e)})}},{key:"_deleteItem",value:function(t){var e=$(t.currentTarget),n=e.closest("tr").data("id");e.closest("tbody").find('[data-parent-id="'+n+'"]').remove(),e.closest("tr").remove()}},{key:"_replaceItem",value:function(t){var e=$(t.currentTarget),n=[];$('[data-role="question-body"]:visible').find('[name="questionId[]"]').each(function(){n.push($(this).val())});var i=$("#attachment-modal",window.parent.document).modal();i.data("manager",this),$.get(e.data("url"),{excludeIds:n.join(","),type:this.currentType},function(t){i.html(t)})}},{key:"_refreshSeqs",value:function(){var t=1;this.$form.find("tbody tr").each(function(){var e=$(this);e.find("td.seq").html(t),t++})}},{key:"_refreshPassedDivShow",value:function(){var t=!1;if(this.$form.find("tbody tr").each(function(){"essay"!=$(this).data("type")&&"material"!=$(this).data("type")||(t=!0)}),t)$(".correctPercentDiv").html("");else{var e='这是一份纯客观题的作业，正确率达到为<input type="text" name="correctPercent[]" class="form-control width-input width-input-mini correctPercent1" value="60" />％合格，<input type="text" name="correctPercent[]" class="form-control width-input width-input-mini correctPercent2" value="80" />％良好，<input type="text" name="correctPercent[]" class="form-control width-input width-input-mini correctPercent3" value="100" />％优秀';$(".correctPercentDiv").html(e)}}},{key:"_questionPreview",value:function(t){t.preventDefault(),window.open($(t.currentTarget).data("url"),"_blank","directories=0,height=580,width=820,scrollbars=1,toolbar=0,status=0,menubar=0,location=0")}}]),t}();new a($("#step2-form")),new r($("#step2-form"))}]);