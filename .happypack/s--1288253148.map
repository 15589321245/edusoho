{"version":3,"sources":["app/Resources/static-src/app/js/task-manage/create/index.js"],"names":["Editor","$modal","$element","$task_manage_content","$","$task_manage_type","$frame","$iframe_body","iframe_jQuery","iframe_name","mode","data","type","step","loaded","contentUrl","_init","_initEvent","click","_onSave","event","_onNext","_onPrev","_onSetType","_onDelete","_inItStep1form","_renderContent","_switchPage","e","_validator","$this","currentTarget","addClass","siblings","removeClass","val","isCreateOperation","isDaysMode","isNormalCourseSet","isLiveType","confirmResult","console","log","confirm","_askSave","attr","postData","serializeArray","concat","find","post","done","response","needAppend","append","html","modal","sortable","get","ids","document","location","reload","chapterId","input","name","add","$parent","value","$item","length","nextAll","each","hasClass","before","showDefaultSetting","fail","msg","errorResponse","JSON","parse","responseText","error","message","slideUp","slideDown","$btn","url","undefined","then","_renderStep","_rendStepIframe","_rendButton","_initIframe","show","iFrameResize","loadiframe","validator","contentWindow","contents","load","$step1_form","validate","rules","mediaType","required","messages","$from","form","_renderPrev","_rendSubmit","_renderNext","prev","next","removeAttr"],"mappings":"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","file":"index.js","sourceRoot":"/Users/kz/projects/edusoho","sourcesContent":["import loadAnimation from 'common/load-animation'\nimport 'jquery-sortable';\nimport notify from \"common/notify\";\nimport {} from \"app/course-manage\"\n\n\nclass Editor {\n  constructor($modal) {\n    this.$element = $modal;\n    this.$task_manage_content = $('#task-create-content');\n    this.$task_manage_type = $('#task-create-type');\n    this.$frame = null;\n    this.$iframe_body = null;\n    this.iframe_jQuery = null;\n    this.iframe_name = 'task-create-content-iframe';\n    this.mode = this.$task_manage_type.data('editorMode');\n    this.type = this.$task_manage_type.data('editorType');\n    this.step = 1;\n    this.loaded = false;\n    this.contentUrl = '';\n    this._init();\n    this._initEvent();\n  }\n\n  _initEvent() {\n    $('#course-tasks-submit').click(event => this._onSave(event));\n    $('#course-tasks-next').click(event => this._onNext(event));\n    $('#course-tasks-prev').click(event => this._onPrev(event));\n    if (this.mode != 'edit') {\n      $('.js-course-tasks-item').click(event => this._onSetType(event));\n    } else {\n      $('.delete-task').click(event => this._onDelete(event));\n    }\n  }\n\n  _init() {\n    this._inItStep1form();\n    this._renderContent(this.step);\n    if (this.mode == 'edit') {\n      this.contentUrl = this.$task_manage_type.data('editorStep2Url');\n      this.step = 2;\n      this._switchPage();\n    }\n  }\n\n  _onNext(e) {\n    if (this.step === 3 || !this._validator(this.step)) {\n      return;\n    }\n    this.step += 1;\n    this._switchPage();\n  }\n\n  _onPrev() {\n    // 第二页可以上一步\n    if (this.step === 1 || (this.step == 3 && !this._validator(this.step))) {\n      return;\n    }\n\n    this.step -= 1;\n    this._switchPage();\n  }\n\n  _onSetType(event) {\n    let $this = $(event.currentTarget).addClass('active');\n    $this.siblings().removeClass('active');\n    let type = $this.data('type');\n    $('[name=\"mediaType\"]').val(type);\n    this.contentUrl = $this.data('contentUrl');\n    this.loaded = this.type === type;\n    this.type = type;\n    this._onNext(event);\n  }\n\n  _askSave(){\n    const isCreateOperation = $('#task-create-type').data('editor-mode') == 'create';\n    const isDaysMode = $('#courseExpiryMode').val() == 'days';\n    const isNormalCourseSet = $('#courseSetType').val() == 'normal';\n    const isLiveType = this.type == 'live';\n    let confirmResult = true;\n    console.log($('#courseExpiryMode').val());\n    if(isCreateOperation && isDaysMode && isNormalCourseSet && isLiveType){\n      confirmResult = confirm('本计划的学习加入方式为“随到随学”，加入直播活动可能会导致后来的学员无法参加，只能观看回放。确定要添加吗？');\n    }\n\n    return confirmResult;\n  }\n\n  _onSave(event) {\n    if (!this._validator(this.step)) {\n      return;\n    }\n\n    if(!this._askSave()){\n      return;\n    }\n\n    $(event.currentTarget).attr('disabled', 'disabled');\n    let postData = $('#step1-form').serializeArray()\n      .concat(this.$iframe_body.find('#step2-form').serializeArray())\n      .concat(this.$iframe_body.find(\"#step3-form\").serializeArray());\n    $.post(this.$task_manage_type.data('saveUrl'), postData)\n      .done((response) => {\n        const needAppend = response.append;\n        const html = response.html;\n        this.$element.modal('hide');\n        if (needAppend === false) {\n          let data = $('#sortable-list').sortable(\"serialize\").get();\n          $.post($('#sortable-list').data('sortUrl'), {ids: data}, (response) => {\n            if (response) {\n              document.location.reload();\n            }\n          });\n        }\n\n        let chapterId = postData.find(function (input) {\n          return input.name == 'chapterId';\n        });\n\n        let add = 0;\n        let $parent = $('#' + chapterId.value);\n        let $item = null;\n\n        if ($parent.length) {\n          $parent.nextAll().each(function () {\n            if ($(this).hasClass('task-manage-chapter')) {\n              $(this).before(html);\n              add = 1;\n              return false;\n            }\n            if ($parent.hasClass('task-manage-unit') && $(this).hasClass('task-manage-unit')) {\n              $(this).before(html);\n              add = 1;\n              return false;\n            }\n          });\n          if (add != 1) {\n            $item = $(html);\n            $(\"#sortable-list\").append($item);\n            add = 1;\n          }\n        } else {\n          $item = $(html);\n          $(\"#sortable-list\").append($item);\n        }\n        // 最后一个\n        this.showDefaultSetting($item);\n        let data = $('#sortable-list').sortable(\"serialize\").get();\n        $.post($('#sortable-list').data('sortUrl'), {ids: data});\n      })\n      .fail((response) => {\n        let msg = '';\n        let errorResponse = JSON.parse(response.responseText);\n        if (errorResponse.error && errorResponse.error.message) {\n          msg = errorResponse.error.message;\n        }\n        notify('warning', '保存出错: ' + msg);\n        $(\"#course-tasks-submit\").attr('disabled', null);\n      });\n  }\n\n  showDefaultSetting($item=null) {\n    if($item && $item.hasClass('js-task-manage-item')) {\n      $('.js-task-manage-item').removeClass('active').find('.js-settings-list').slideUp();;\n      $item.addClass('active').find('.js-settings-list').slideDown();\n    }\n  }\n\n  _onDelete(event) {\n    let $btn = $(event.currentTarget);\n    let url = $btn.data('url');\n    if (url === undefined) {\n      return;\n    }\n\n    $.post(url)\n      .then((response) => {\n        notify('success', '删除成功');\n        this.$element.modal('hide');\n        document.location.reload();\n      })\n      .fail(error => {\n        notify('warning', '删除失败~~');\n      })\n  }\n\n  _switchPage() {\n    this._renderStep(this.step);\n    this._renderContent(this.step);\n    this._rendStepIframe(this.step);\n    this._rendButton(this.step);\n    if (this.step == 2 && !this.loaded) {\n      this._initIframe();\n    }\n  }\n\n  _initIframe() {\n    let html = '<iframe class=\"' + this.iframe_name + '\" id=\"' + this.iframe_name + '\" name=\"' + this.iframe_name + '\" scrolling=\"no\" src=\"' + this.contentUrl + '\"></iframe>';\n    this.$task_manage_content.html(html).show();\n    this.$frame = $('#' + this.iframe_name).iFrameResize();\n    let loadiframe = () => {\n      this.loaded = true;\n      let validator = {};\n      this.iframe_jQuery = this.$frame[0].contentWindow.$;\n      this.$iframe_body = this.$frame.contents().find('body').addClass('task-iframe-body');\n      this._rendButton(2);\n      this.$iframe_body.find(\"#step2-form\").data('validator', validator);\n      this.$iframe_body.find(\"#step3-form\").data('validator', validator);\n\n    };\n    this.$frame.load(loadAnimation(loadiframe, this.$task_manage_content));\n  }\n\n  _inItStep1form() {\n    let $step1_form = $(\"#step1-form\");\n    let validator = $step1_form.validate({\n      rules: {\n        mediaType: {\n          required: true,\n        },\n      },\n      messages: {\n        mediaType: \"请选择%display%\",\n      }\n    });\n    $step1_form.data('validator', validator);\n  }\n\n  _validator(step) {\n    let validator = null;\n    if (step === 1) {\n      validator = $(\"#step1-form\").data('validator');\n    } else if (this.loaded) {\n      var $from = this.$iframe_body.find(\"#step\" + step + \"-form\");\n      validator = this.iframe_jQuery.data($from[0], 'validator');\n    }\n\n    if (validator && !validator.form()) {\n      return false;\n    }\n    return true;\n  }\n\n  _rendButton(step) {\n    if (step === 1) {\n      this._renderPrev(false);\n      this._rendSubmit(false);\n      this._renderNext(true);\n    } else if (step === 2) {\n      this._renderPrev(true);\n      if (this.mode === 'edit') {\n        this._renderPrev(false);\n      }\n      if (!this.loaded) {\n        this._rendSubmit(false);\n        this._renderNext(false);\n        return;\n      }\n      this._rendSubmit(true);\n      this._renderNext(true);\n    } else if (step === 3) {\n      this._renderNext(false);\n      this._renderPrev(true);\n    }\n  }\n\n  _rendStepIframe(step) {\n    if (!this.loaded || !this.$iframe_body) {\n      return;\n    }\n    (step === 2) ? this.$iframe_body.find(\".js-step2-view\").addClass('active') : this.$iframe_body.find(\".js-step2-view\").removeClass('active');\n    (step === 3) ? this.$iframe_body.find(\".js-step3-view\").addClass('active') : this.$iframe_body.find(\".js-step3-view\").removeClass('active');\n  }\n\n  _renderStep(step) {\n    $('#task-create-step').find('li:eq(' + (step - 1) + ')').addClass('doing').prev().addClass('done').removeClass('doing');\n    $('#task-create-step').find('li:eq(' + (step - 1) + ')').next().removeClass('doing').removeClass('done');\n  }\n\n  _renderContent(step) {\n    (step === 1) ? this.$task_manage_type.removeClass('hidden') : this.$task_manage_type.addClass('hidden');\n    (step !== 1) ? this.$task_manage_content.removeClass('hidden') : this.$task_manage_content.addClass('hidden');\n  }\n\n  _renderNext(show) {\n    show ? $(\"#course-tasks-next\").removeClass('hidden').removeAttr(\"disabled\") : $(\"#course-tasks-next\").addClass('hidden');\n  }\n\n  _renderPrev(show) {\n    show ? $(\"#course-tasks-prev\").removeClass('hidden') : $(\"#course-tasks-prev\").addClass('hidden');\n  }\n\n  _rendSubmit(show) {\n    show ? $(\"#course-tasks-submit\").removeClass('hidden') : $(\"#course-tasks-submit\").addClass('hidden');\n  }\n\n}\n\nnew Editor($('#modal'));\n"]}