webpackJsonp(["app/js/oauth2/create/index"],{0:function(e,t){e.exports=jQuery},"04e12e97a64b943320e3":function(e,t,a){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var a=0;a<t.length;a++){var s=t[a];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,a,s){return a&&e(t.prototype,a),s&&e(t,s),t}}(),i=a("e104a65d9efb9ac573bc"),o=a("b334fd7e4c5a19234db2"),c=s(o),u=a("0fcd3a355c9fe74234e3"),d=a("5eb223de522186da1dd9"),l=s(d),h=function(){function e(){n(this,e),this.$form=$("#third-party-create-account-form"),this.$btn=$(".js-submit-btn"),this.validator=null,this.captchaToken=null,this.smsToken=null,this.init()}return r(e,[{key:"init",value:function(){this.initCaptchaCode(),this.initValidator(),this.changeCaptchaCode(),this.sendMessage(),this.submitForm(),this.removeSmsErrorTip(),this.initDragCaptchaCodeRule()}},{key:"initValidator",value:function(){var e=this;$(".js-sms-send");this.rules={username:{required:!0,byte_minlength:4,byte_maxlength:18,nickname:!0,chinese_alphanumeric:!0,es_remote:{type:"get"}},password:{required:!0,minlength:5,maxlength:20},confirmPassword:{required:!0,equalTo:"#password"},sms_code:{required:!0,unsigned_integer:!0,rangelength:[6,6]}},$(".js-captcha").hasClass("hidden")||(this.rules.captcha_code=this.getCaptchaCodeRule()),this.validator=this.$form.validate({rules:this.rules,messages:{sms_code:{required:Translator.trans("site.captcha_code.required"),rangelength:Translator.trans("validate.sms_code.message")}}}),$.validator.addMethod("captcha_checkout",function(t,a,s){$(a);if(t.length<5)return void($.validator.messages.captcha_checkout=Translator.trans("oauth.captcha_code_length_tip"));var n=s.data?s.data:{phrase:t},r=s.callback?s.callback:null,i=0,o={captchaToken:e.captchaToken};return l.default.captcha.validate({data:n,params:o,async:!1,promise:!1}).done(function(e){"success"===e.status?i=!0:"expired"===e.status?(i=!1,$.validator.messages.captcha_checkout=Translator.trans("oauth.captcha_code_expired_tip")):(i=!1,$.validator.messages.captcha_checkout=Translator.trans("oauth.captcha_code_error_tip")),r&&r(i)}).error(function(e){}),this.optional(a)||i},Translator.trans("validate.captcha_checkout.message"))}},{key:"initCaptchaCode",value:function(){var e=this,t=$("#getcode_num");if(t.length)return l.default.captcha.get({async:!1,promise:!1}).done(function(a){t.attr("src",a.image),e.captchaToken=a.captchaToken}).error(function(e){}),this.captchaToken}},{key:"initDragCaptchaCodeRule",value:function(){var e=$(".js-drag-jigsaw").hasClass("hidden");$(".js-drag-img").length&&!e&&$('[name="drag_captcha_token"]').rules("add",{required:!0,messages:{required:Translator.trans("auth.register.drag_captcha_tips")}})}},{key:"sendMessage",value:function(){var e=this,t=$(".js-sms-send"),a=$("#captcha_code");t.length&&t.click(function(t){var s=$(t.target),n={type:"register",mobile:$(".js-account").html(),captchaToken:e.captchaToken,phrase:a.val()};l.default.sms.send({data:n}).then(function(t){e.smsToken=t.smsToken,(0,u.countDown)(120)}).catch(function(t){switch(t.responseJSON.error.code){case 5000601:$(".js-captcha").hasClass("hidden")?($(".js-captcha").removeClass("hidden"),$("[name='captcha_code']").rules("add",e.getCaptchaCodeRule())):(a.val(""),e.initCaptchaCode()),s.attr("disabled",!0)}})})}},{key:"changeCaptchaCode",value:function(){var e=this,t=$("#getcode_num");t.length&&t.click(function(){e.initCaptchaCode()})}},{key:"submitForm",value:function(){var e=this;this.$btn.click(function(t){var a=$(t.target);if(e.validator.form()){a.button("loading");var s={nickname:$("#username").val(),password:$("#password").val(),mobile:$(".js-account").html(),smsToken:e.smsToken,smsCode:$("#sms-code").val(),captchaToken:e.captchaToken,phrase:$("#captcha_code").val(),drag_captcha_token:$('[name="drag_captcha_token"]').val()},n=Translator.trans("oauth.send.sms_code_error_tip");$.post(a.data("url"),s,function(e){a.button("reset"),1===e.success?window.location.href=e.url:$(".js-password-error").length||a.prev().addClass("has-error").append('<p id="password-error" class="form-error-message js-password-error">'+n+"</p>")}).error(function(e){a.button("reset"),429===e.status?(0,c.default)("danger",Translator.trans("oauth.register.time_limit")):(0,c.default)("danger",Translator.trans("oauth.register.error_message"))})}}),(0,i.enterSubmit)(this.$form,this.$btn)}},{key:"removeSmsErrorTip",value:function(){$("#sms-code").focus(function(){var e=$(".js-password-error");e.length&&e.remove()})}},{key:"getCaptchaCodeRule",value:function(){var e=this;return{required:!0,alphanumeric:!0,captcha_checkout:{callback:function(t){if(!t){$(".js-sms-send").attr("disabled",!0);var a=e.initCaptchaCode();return e.captchaToken=a,e.captchaToken}$(".js-sms-send").removeAttr("disabled")}}}}}]),e}();t.default=h},"0fcd3a355c9fe74234e3":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.countDown=void 0;var s=a("b334fd7e4c5a19234db2"),n=function(e){return e&&e.__esModule?e:{default:e}}(s),r=$(".js-time-left"),i=$(".js-sms-send"),o=$(".js-fetch-btn-text"),c=(t.countDown=function(e){r.html(e),o.html(Translator.trans("site.data.get_sms_code_again_btn")),(0,n.default)("success",Translator.trans("site.data.get_sms_code_success_hint")),c()},function e(){var t=r.text();r.html(t-1),t-1>0?(i.attr("disabled",!0),setTimeout(e,1e3)):(r.html(""),o.html(Translator.trans("oauth.send.validate_message")),i.removeAttr("disabled"))})},"1d43a4025aadc22df310":function(e,t,a){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}var n=a("04e12e97a64b943320e3"),r=s(n);new(s(a("bbc0ef257199acca9fed")).default)($("#drag-btn"),$(".js-jigsaw")),new r.default},bbc0ef257199acca9fed:function(e,t,a){"use strict";function s(e){if(Array.isArray(e)){for(var t=0,a=Array(e.length);t<e.length;t++)a[t]=e[t];return a}return Array.from(e)}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var a=0;a<t.length;a++){var s=t[a];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,a,s){return a&&e(t.prototype,a),s&&e(t,s),t}}(),i=a("5eb223de522186da1dd9"),o=function(e){return e&&e.__esModule?e:{default:e}}(i),c=function(){function e(t,a){n(this,e),this.$element=t,this.$target=a,this.params={top:0,left:0,currentX:0,currentY:0,flag:!1,currentLeft:0,currentTop:0},this.dragCaptchaToken=null,this.init()}return r(e,[{key:"init",value:function(){this.initDragCaptcha(),this.getLocation(this.$element[0]),this.initEvent()}},{key:"initDragCaptcha",value:function(){var e=this;o.default.dragCaptcha.get({before:function(){$(".js-jigsaw-placeholder,.js-drag-img-mask").removeClass("hidden"),$(".js-jigsaw-bg").remove(),$(".js-jigsaw").attr("src","")}}).then(function(t){e.loadingImg(t.url,t.jigsaw),e.dragCaptchaToken=t.token})}},{key:"loadingImg",value:function(e,t){var a=new Image;a.src=e,a.className="js-jigsaw-bg drag-img__bg",a.onload=function(){$(a).prependTo(".js-drag-img"),$(".js-drag-img-mask,.js-jigsaw-placeholder").addClass("hidden"),$(".js-jigsaw").attr("src",t)}}},{key:"initEvent",value:function(){var e=this;this.$element.on("mousedown touchstart",function(t){e.startDrag(t)}),$(document).on("mouseup touchend",function(t){e.stopDrag(t)}),$(document).on("mousemove touchmove",function(t){e.dragMove(t)})}},{key:"startDrag",value:function(e){e.preventDefault();var t=this.params;t.flag=!0;var a=e.clientX?e.clientX.toFixed(2):e.originalEvent.targetTouches[0].pageX.toFixed(2);t.currentX=a}},{key:"stopDrag",value:function(e){var t=this,a=this.$element,s=this.$target,n=this.params;if(n.flag&&(this.setCss(a[0],"cursor","pointer"),n.flag=!1,this.getLocation(a[0]),n.currentLeft)){var r=$(".js-jigsaw-bg"),i=this.calPositionX(r),c=this._getToken(this.dragCaptchaToken,i),u={token:c};o.default.dragCaptcha.validate({params:u}).then(function(e){t.validateSuccess(a[0],c)}).catch(function(){t.resetLocation(a[0],s[0]),t.initDragCaptcha()})}}},{key:"dragMove",value:function(e){var t=this.$element,a=this.$target,s=this.params;if(s.flag){e.preventDefault();var n=e.clientX?e.clientX.toFixed(2):e.originalEvent.targetTouches[0].pageX.toFixed(2),r=n-s.currentX,i=t.parent().width()-t.width(),o=parseInt(s.left)+r;o<=0&&(o=0),o>=i&&(o=i),s.currentLeft=o;var c=o+"px";this.setCss(t[0],"left",c),this.setCss(a[0],"left",c),this.setCss(t[0],"cursor","move"),$(".js-drag-bar-tip").addClass("hidden");var u=o+20+"px";$(".js-drag-bar-mask").css("width",u)}}},{key:"calPositionX",value:function(e){var t=(e[0].naturalWidth/e.width()).toFixed(2);return(this.params.currentLeft.toFixed(2)*t).toFixed(2)}},{key:"validateSuccess",value:function(e,t){cd.message({type:"success",message:Translator.trans("validate.success")});var a=$('[name="drag_captcha_token"]');a.val(t);var s=a.closest(".form-group");s.removeClass("has-error"),s.find(".jq-validate-error").remove(),$(document).unbind("mousemove touchmove"),$(document).unbind("mouseup touchend"),this.setCss(e,"cursor","not-allowed")}},{key:"getLocation",value:function(e){"auto"!==this.getCss(e,"left")&&(this.params.left=this.getCss(e,"left"))}},{key:"resetLocation",value:function(e,t){this.setCss(e,"left","0px"),this.setCss(t,"left","0px"),this.getLocation(e),$(".js-drag-bar-mask").css("width","0px"),$(".js-drag-bar-tip").toggleClass("hidden")}},{key:"getCss",value:function(e,t){return e.currentStyle?e.currentStyle[t]:document.defaultView.getComputedStyle(e,!1)[t]}},{key:"setCss",value:function(e,t,a){e.style[t]=a}},{key:"_getToken",value:function(e,t){var a={token:e,captcha:t};return e=JSON.stringify(a),[].concat(s(btoa(e))).reverse().join("")}}]),e}();t.default=c},e104a65d9efb9ac573bc:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=function(e,t){e.keypress(function(e){13==e.which&&(t.trigger("click"),e.preventDefault())})};t.enterSubmit=s}},["1d43a4025aadc22df310"]);