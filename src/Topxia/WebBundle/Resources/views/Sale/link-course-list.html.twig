{% extends 'TopxiaWebBundle:Sale:layout.html.twig' %}

{% block title %}课程链接推广 - {{ parent() }}{% endblock %}
{% set side_nav = 'link-course-list' %}

{% block main %}
<div class="panel panel-default panel-col">
  <div class="panel-heading">
     可推广课程列表（ <a class="text-color-red" href="/page/linksalecourse" target="_blank"> 
                 课程链接推广须知
               </a>）

  </div>
  <div class="panel-body">

  <table class="table table-striped table-hover" id="course-table">
    <thead>
    <tr>
      <th width="30%">课程名称</th>
      
      <th>单价(元)</th>

      <th>佣金比率</th>
      <th>佣金(元)</th>
      <th>链接有效期</th>
     
      <th>操作</th>
    </tr>
    </thead>
    <tbody>
      {% for course in courses %}

      {% set adCommissionType = course.adCommissionType %}

      {% set adCommission = course.adCommission %}

      {% set adCommissionDay = course.adCommissionDay %}
     
      {% if  course.id  in  linksales|keys  %}

          {%  set linksale =  linksales[course.id]  %}

            {% set adCommissionType = linksale.adCommissionType %}

            {% set adCommission = linksale.adCommission %}

            {% set adCommissionDay = linksale.adCommissionDay %}

      {% endif %}

        <tr>
          <td>

          <a class="pull-left" href="{{ path('course_show', {id:course.id}) }}" target="_blank">
            <img class="course-picture mrm" src="{{ file_path(course.middlePicture, 'course-large.png') }}" alt="{{ course.title }}" width="70">
          </a>

          <a href="{{ path('course_show', {id:course.id}) }}"  target="_blank">{{ course.title }}</a>

          </td>
         
          <td>￥{{ course.price|number_format(2, '.', ',')  }}</td>
          
          <td>
            {% if (adCommissionType=='quota') %}

                {{adCommission/course.price*100|number_format(2, '.', ',') }}%
           
            {% else %}

                 {{ adCommission|number_format(2, '.', ',')  }}%

            {% endif %}
          </td>

          <td>￥
             {% if (adCommissionType=='quota') %}

                {{adCommission|number_format(2, '.', ',') }}

            {% else  %}

                {{ course.price*(adCommission/100)|number_format(2, '.', ',')   }}
            
            {% endif %}

          </td>
           <td>{{ adCommissionDay }}天</td>
          <td>
                    
          <a  class="btn btn-default btn-sm"  href="#modal" data-toggle="modal"  data-url="{{ path('mysale_link_course_link', {id:course.id}) }}"> 获取推广链接 </a>

             
          </td>
        </tr>
      {% else %}
        <tr><td colspan="20">暂无可推广的课程</td></tr>
      {% endfor %}
    </tbody>
  </table>

  {{ web_macro.paginator(paginator) }} 

  </div>
</div>

{% endblock %}