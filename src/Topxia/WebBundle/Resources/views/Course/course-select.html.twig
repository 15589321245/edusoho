{% extends 'TopxiaWebBundle::bootstrap-modal-layout.html.twig' %}

{% set modal_class= "modal-lg" %}

{% block title %}选择课程{% endblock %}
{% block body %}
<style>
.course-item:hover {
    cursor: pointer;
}
.course-wide-list .course-item .select{

    
}
</style>
<form action="/admin/course/search" class="form-inline" role="search-form">
      <div class="form-group ">
        <input type="text" class="form-control" name="key" value="" placeholder="课程名称">
      </div>
      <button type="button" class="btn btn-primary">搜索</button>
</form>

<div class="row mtl">
    <div class="col-md-12">
    <ul class="course-wide-list">
  {% for course in courses %}
  <li class="course-item clearfix" data-id="{{course.id}}">
    <a class="course-picture-link" href="{{ path('course_show', {id:course.id}) }}" target="_blank">
      <img class="course-picture" src="{{ default_path('coursePicture',course.middlePicture, 'large') }}" alt="{{ course.title }}">
    </a>
    <div class="course-body">
     <div style="float:right;" class="text-muted mrm mls">
         {% if setting('course.coursesPrice') == 0 %}
              {% if setting('coin.coin_enabled') and setting('coin.price_type') == 'Coin' %}
                {% if course.coinPrice > 0 and free_limit_type(course) == 'free_now' %}
                  <span class="free-money-text"><del>{{ course.coinPrice }}</del></span>
                {% endif %}
              {% else %}
                {% if course.price > 0 and free_limit_type(course) == 'free_now' %}
                  <span class="free-money-text"><del>{{ course.price }}</del></span>
                {% endif %}
              {% endif %}

              {% if setting('coin.coin_enabled') and setting('coin.price_type') == 'Coin' %}
                  <span class="course-price" style="display:inline">
                    {% if course.coinPrice > 0 %}
                      {% if free_limit_type(course) == 'free_now' %}
                        0.00 元
                      {% else %}
                       价格： {{ course.coinPrice }}{{setting('coin.coin_name')}}
                      {% endif %}  
                    {% else %}免费{% endif %}
                  </span>

              {% else %}
                <span class="course-price">
                  {% if course.price > 0 %}
                    {% if free_limit_type(course) == 'free_now' %}
                      0.00 元
                    {% else %}
                     价格： {{ course.price }}元
                    {% endif %}  
                  {% else %}免费{% endif %}
                  
                </span>
            {% endif %}
          {% endif %}          
    
          <span class="divider"></span>
          {% if course.showStudentNumType == 'opened' %}
          <span class="text-muted mrm mls"><strong>{{ course.studentNum }}</strong>{% if setting('default.user_name') %}{{setting('default.user_name')|default('学员')}}{% else %}学员{% endif %}</span>
          {% endif %}

          <div class="countdown-list">
            {% include 'TopxiaWebBundle:Course:countdown.html.twig' with {'course':course} %}
          </div>
          {% if free_limit_type(course) == 'free_now' %}
           <span class="text-muted text-sm">
            到期时间
            <span>{{course.freeEndTime|date('n')}}</span>月
            <span>{{course.freeEndTime|date('d')}}</span>日
            <span>{{course.freeEndTime|date('H')}}</span>时
          </span>
           {% endif %}

        </div>

      <h4 class="course-title"><a href="{{ path('course_show', {id:course.id}) }}" target="_blank">{{ course.title }}</a>
      {% if course.serializeMode=='serialize' %}
        <span class="label label-success ">更新中</span>
      {% elseif course.serializeMode=='finished' %}
        <span class="label label-warning ">已完结</span>
      {% endif %}
      {% if course.type == 'live' %}
          {% set lesson = course['lesson']|default(null) %}
          {% if lesson and "now"|date("U") >= lesson.startTime and "now"|date("U") <= lesson.endTime %}
            <span class="label label-warning series-mode-label">正在直播中</span>
          {% else %}
            <span class="label label-success series-mode-label">直播</span>
          {% endif %}
      {% endif %}
      </h4>

      {% if course.type == 'live' %}
        {% set lesson = course.lesson|default(null) %}
        {% if lesson %}
          <div class="live-course-lesson mbm">
            <span class="text-success fsm mrm">{{ lesson.startTime|date('n月j日 H:i') }} ~ {{ lesson.endTime|date('H:i') }}</span>
            <span class="text-muted fsm mrm">第{{ lesson.number }}课时</span>
          </div>
        {% endif %}
      {% else %}
        <div class="course-about ellipsis">{{ course.subtitle }}</div>
      {% endif %}

      <div class="course-footer clearfix">
        {% set teacher = users[course.teacherIds|first]|default(null) %}
        {% if teacher %}
          <div class="teacher">
            <a href="{{ path('user_show', {id:teacher.id}) }}" target="_blank"><img src="{{ default_path('avatar',teacher.smallAvatar, '') }}" class="teacher-avatar"></a>
            <a class="teacher-nickname ellipsis" target="_blank"  href="{{ path('user_show', {id:teacher.id}) }}">{{ teacher.nickname }}</a>
            <span class="teacher-title ellipsis">{{ teacher.title }}</span>
          </div>
        {% endif %}

        <div class="course-metas-{{course.id}}" style="display:none;">        
          <span class="glyphicon glyphicon-ok pull-right" style="z-index:100;color:#02b980;font-size:30px;"></sapn>
        </div>
      </div>
    </div>
  </li>
  {% endfor %}
</ul>
    {{ web_macro.paginator(paginator) }}
    </div>
</div>

{% endblock %}

{% block footer %}
  <button id="sure" class="btn btn-primary pull-right" data-url="{{url}}" >确定</button>
  <button type="button" class="btn btn-link pull-right" data-dismiss="modal">取消</button>

    <script>app.load('course/select')</script>
{% endblock %}