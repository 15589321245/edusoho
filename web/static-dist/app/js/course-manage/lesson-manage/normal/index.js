webpackJsonp(["app/js/course-manage/lesson-manage/normal/index"],{0:function(e,t){e.exports=jQuery},"37f7b53294952a0a83bb":function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var o=a("48ab030c3f7abbdb66f7"),l=n(o),u=a("397a3febc3cd42b42453"),c=n(u);new(function(e){function t(e){return s(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return r(t,e),t}(c.default))("#sortable-list"),new l.default('input[name="isShowPublish"]')},"397a3febc3cd42b42453":function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}(),r=a("8f840897d9471c8c1fbd"),o=n(r),l=a("b334fd7e4c5a19234db2"),u=n(l),c=function(){function e(t){s(this,e),this.$element=$(t),this._sort(),this._event()}return i(e,[{key:"_event",value:function(){var e=this;this.$element.on("addItem",function(t,a){e.addItem(a),e.sortList()}),this.$element.on("click","[data-toggle]",function(t){var a=$(this);e.position=a.data("position"),e.type=a.data("type")}),this._deleteChapter(),this._collapse(),this._publish()}},{key:"_collapse",value:function(){var e=['<i class="es-icon es-icon-keyboardarrowup mr5"></i>'+Translator.trans("site.data.expand"),'<i class="es-icon es-icon-keyboardarrowdown mr5"></i>'+Translator.trans("site.data.collapse")];this.$element.on("click",".js-toggle-show",function(t){var a=$(t.currentTarget);a.toggleClass("toogle-hide");var n=a.closest(".task-manage-item"),s=n.hasClass("js-task-manage-chapter")?".js-task-manage-chapter":".js-task-manage-chapter,.js-task-manage-unit",i=n.nextUntil(s);a.hasClass("js-toggle-unit")&&i.toggleClass("toogle-hide"),i.stop().animate({height:"toggle",opacity:"toggle"},"normal"),a.hasClass("toogle-hide")?a.html(e[0]):a.html(e[1])})}},{key:"addItem",value:function(e){switch(this.type){case"chapter":var t=this.$element.find("#chapter-"+this.position);t=t.nextUntil(".js-task-manage-chapter").last(),0==t.length?this.$element.append(e):t.after(e);break;case"task":this.$element.find("#chapter-"+this.position+" .js-lesson-box").append(e);break;case"lesson":var a=this.$element.find("#chapter-"+this.position),n=a.nextUntil(".js-task-manage-unit,.js-task-manage-chapter").last();0==n.length?a.after(e):n.after(e);break;default:this.$element.append(e)}this.handleEmptyShow(),this._clearPosition()}},{key:"_clearPosition",value:function(){this.position="",this.type=""}},{key:"_deleteChapter",value:function(){var e=this;this.$element.on("click",".js-delete",function(t){var a=$(this),n=a.closest(".task-manage-item"),s=e._getDeleteText(a);cd.confirm({title:Translator.trans("site.delete"),content:s,confirmText:Translator.trans("site.confirm"),cancelText:Translator.trans("site.close"),confirm:function(){n.remove(),e.sortList(),e.handleEmptyShow(),$.post(a.data("url"),function(e){})}})})}},{key:"_getDeleteText",value:function(e){return"task"==e.data("type")?Translator.trans("course.manage.task_delete_hint"):Translator.trans("course.manage.chapter_delete_hint",{name:e.data("name")})}},{key:"_sort",value:function(){var e=this;(0,o.default)({element:e.$element,ajax:!1,group:"nested",isValidTarget:function(e,t){return(!e.hasClass("js-task-manage-item")||t.target.closest(".task-manage-lesson").attr("id")==e.closest(".task-manage-lesson").attr("id"))&&(!((e.hasClass("js-task-manage-unit")||e.hasClass("js-task-manage-chapter"))&&!t.target.hasClass("sortable-list"))&&(!e.hasClass("js-task-manage-lesson")||!t.target.hasClass("js-lesson-box")))}},function(t){e.sortList()})}},{key:"handleEmptyShow",value:function(){0===$("#sortable-list").find("li").length?$(".js-task-empty").removeClass("hidden"):$(".js-task-empty").addClass("hidden")}},{key:"sortList",value:function(){var e=[];this.$element.find(".task-manage-item").each(function(){e.push($(this).attr("id"))}),$.post(this.$element.data("sortUrl"),{ids:e},function(e){}),this.sortablelist()}},{key:"sortablelist",value:function(){for(var e=[".js-task-manage-lesson",".js-task-manage-chapter",".js-task-manage-item"],t=0;t<e.length;t++)this._sortNumberByClassName(e[t]);this._sortUnitNumber()}},{key:"_sortNumberByClassName",value:function(e){var t=1;this.$element.find(e).each(function(){$(this).find(".number").text(t++)})}},{key:"_sortUnitNumber",value:function(){var e=1;this.$element.find(".js-task-manage-unit").each(function(){var t=$(this);t.find(".number").text(e),e=t.next().hasClass("task-manage-chapter")?1:e+1})}},{key:"_publish",value:function(){this.$element.on("click",".unpublish-item",function(e){var t=$(e.target);$.post(t.data("url"),function(e){var a=t.closest(".task-manage-item");a.find(".publish-item, .js-delete, .publish-status").removeClass("hidden"),a.find(".unpublish-item").addClass("hidden"),(0,u.default)("success",Translator.trans("course.manage.task_unpublish_success_hint"))}).fail(function(e){(0,u.default)("danger",Translator.trans("course.manage.task_unpublish_fail_hint")+":"+e.responseJSON.error.message)})}),this.$element.on("click",".publish-item",function(e){$.post($(e.target).data("url"),function(t){var a=$(e.target).closest(".task-manage-item");(0,u.default)("success",Translator.trans("course.manage.task_publish_success_hint")),a.find(".publish-item, .js-delete, .publish-status").addClass("hidden"),a.find(".unpublish-item").removeClass("hidden")}).fail(function(e){(0,u.default)("danger",Translator.trans("course.manage.task_publish_fail_hint")+":"+e.responseJSON.error.message)})})}}]),e}();t.default=c},"48ab030c3f7abbdb66f7":function(e,t,a){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}(),i=a("b334fd7e4c5a19234db2"),r=function(e){return e&&e.__esModule?e:{default:e}}(i),o=function(){function e(t){n(this,e),this.$element=$(t),this._event()}return s(e,[{key:"_event",value:function(){this.$element.on("change",function(){var e=$(this).data("url"),t=$(this).is(":checked")?0:1;$.post(e,{status:t}).success(function(e){(0,r.default)("success",Translator.trans("site.save_success_hint"))}).error(function(e){(0,r.default)("error",e.error.message)})})}}]),e}();t.default=o}},["37f7b53294952a0a83bb"]);