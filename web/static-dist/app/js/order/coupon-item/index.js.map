{"version":3,"sources":["webpack:///./app/Resources/static-src/app/js/order/coupon-item/coupon.js","webpack:///./app/Resources/static-src/app/js/order/coupon-item/index.js"],"names":["Coupon","props","Object","assign","$form","$","form","$couponCode","find","$productType","$productId","$price","$errorMessage","$deductAmountLabel","$couponCodeLabel","$selectCouponBtn","init","initEvent","on","useCoupon","event","cancelCoupon","inputCode","selectCoupon","$this","currentTarget","val","errorMessage","code","data","button","validate","useable","message","priceType","coinRate","coinName","deductAmount","parseFloat","toFixed","useCouponAfter","text","toggleShow","trigger","Translator","trans","show","$parent","parent","hasClass","addClass","hide","removeClass","callback","ajax","url","type","done","$selectCoupon","$selectedCoupon","cd","radio","el","cb"],"mappings":"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","file":"app/js/order/coupon-item/index.js","sourcesContent":["import notify from 'common/notify';\n\nclass Coupon {\n  constructor(props) {\n    Object.assign(this, {\n      \n    }, props);\n\n    this.$form = $(this.form);\n\n    this.$couponCode = this.$form.find('input[name=\"couponCode\"]');\n    this.$productType = this.$form.find('input[name=\"targetType\"]');\n    this.$productId = this.$form.find('input[name=\"targetId\"]');\n    this.$price = this.$form.find('input[name=\"price\"]');\n\n    this.$errorMessage = this.$form.find('#coupon-error-message');\n\n    this.$deductAmountLabel = this.$form.find('#deduct-amount-label');\n    this.$couponCodeLabel = this.$form.find('#coupon-code-label');\n\n    this.$selectCouponBtn = this.$form.find(\"#select-coupon-btn\");\n\n    this.init();\n  }\n\n  init() {\n    this.initEvent();\n  }\n\n  initEvent() {\n    const $form = this.$form;\n\n    $form.on('click', '#use-coupon-btn', event => this.useCoupon(event));\n    $form.on('click', '#cancel-use-coupon-btn', event => this.cancelCoupon(event));\n    $form.on('change', 'input[name=\"couponCode\"]', event => this.inputCode(event));\n\n    this.selectCoupon();\n  }\n\n  inputCode(event) {\n    const $this = $(event.currentTarget);\n\n    if ($this.val()) {\n      this.errorMessage();\n    }\n  }\n\n  useCoupon(event) {\n    const $this = $(event.currentTarget);\n    const code = this.$couponCode.val();\n    if (!code) {\n      this.errorMessage(this.$couponCode.data('display'));\n      return;\n    }\n\n    $this.button('loading');\n\n    this.validate(event, (data) => {\n      $this.button('reset');\n      if (data.useable == 'no') {\n        this.errorMessage(data.message);\n      } else {\n        const priceType = this.$form.data('price-type');\n        const coinRate = this.$form.data('coin-rate');\n        const coinName = this.$form.data('coin-name');\n\n        let deductAmount = (data['type'] == 'discount') ? this.$price.val() * data['rate'] : data['rate'];\n        \n        if (priceType === 'coin') {\n          deductAmount = parseFloat(parseFloat(deductAmount) * parseFloat(coinRate)).toFixed(2) + ' ' + coinName;\n        } else {\n          deductAmount = 'ï¿¥' + deductAmount;\n        }\n\n        this.useCouponAfter(deductAmount, code);\n      }\n    })\n  }\n\n  useCouponAfter(deductAmount, code) {\n    this.$deductAmountLabel.text(deductAmount);\n    this.$couponCodeLabel.text(code);\n\n    this.toggleShow('use');\n\n    this.$form.trigger('calculatePrice');\n    this.$form.trigger('addPriceItem', ['coupon-price', Translator.trans('order.create.coupon_deduction'), deductAmount]);\n  }\n\n  cancelCoupon(event) {\n    this.$couponCode.val('');\n    this.$form.trigger('calculatePrice');\n    this.$form.trigger('removePriceItem', ['coupon-price']);\n    this.toggleShow('cancel');\n  }\n\n  errorMessage(text) {\n    if (text) {\n      this.$errorMessage.text(text).show();\n      let $parent = this.$errorMessage.parent('.cd-form-group');\n      if (!$parent.hasClass('has-error')) {\n        $parent.addClass('has-error');\n      }\n    } else {\n      this.$errorMessage.text('').hide().parent('.cd-form-group.has-error').removeClass('has-error');\n    }\n  }\n\n  validate(event, callback) {\n    const $this = $(event.currentTarget);\n\n    const data = {\n      'code': this.$couponCode.val(),\n      'targetType': this.$productType.val(),\n      'targetId': this.$productId.val(),\n      'price': this.$price.val()\n    };\n\n    $.ajax({\n      url: $this.data('url'),\n      type: 'POST',\n      data,\n    }).done((data) => {\n      if (typeof callback === 'function') {\n        callback(data);\n      }\n    });\n  }\n\n  toggleShow(type) {\n    const $selectCoupon = this.$form.find('#order-center-coupon__select');\n    const $selectedCoupon = this.$form.find('#order-center-coupon__selected');\n\n    if (type === 'use') {\n      $selectCoupon.hide();\n      $selectedCoupon.show();\n    } else if (type === 'cancel') {\n      $selectCoupon.show();\n      $selectedCoupon.hide();\n    }\n  }\n\n  selectCoupon() {\n    cd.radio({\n      el: '.js-existing-coupon',\n      cb: (event) => {\n        const $this = $(event.currentTarget);\n        const code = $this.data('code');\n        const deductAmount = $this.data('deductAmount');\n        this.$couponCode.val(code);\n\n        this.$selectCouponBtn.trigger('click');\n\n        this.useCouponAfter(deductAmount, code);\n      }\n    });\n  }\n\n}\n\nexport default Coupon;\n\n\n// WEBPACK FOOTER //\n// ./app/Resources/static-src/app/js/order/coupon-item/coupon.js","import Coupon from './coupon';\n\nnew Coupon({\n  form: '#order-create-form'\n});\n\n\n// WEBPACK FOOTER //\n// ./app/Resources/static-src/app/js/order/coupon-item/index.js"],"sourceRoot":""}