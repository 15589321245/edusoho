{"version":3,"sources":["app/Resources/static-src/app/js/question-manage/type/question-choice.js"],"names":["Choice","$form","isSubmit","$submit","$questionOptions","$","dataSource","data","dataAnswer","JSON","parse","imageUploadUrl","imageDownloadUrl","initTitleEditor","validator","initAnalysisEditor","initOptions","subscriptionMessage","on","submitForm","event","currentTarget","submitType","find","val","form","submit","publishMessage","button","render","document","getElementById","console","log","publish","channel","topic","isValidator","subscribe","callback","envelope"],"mappings":"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","file":"question-choice.js","sourceRoot":"/Users/kz/projects/edusoho","sourcesContent":["import QuestionFormBase from './form-base';\nimport ReactDOM from 'react-dom';\nimport React from 'react';\nimport QuestionOptions from 'app/common/component/question-options';\nimport postal from 'postal';\n\nclass Choice extends QuestionFormBase {\n  constructor($form) {\n    super($form);\n    this.isSubmit =  false;\n    this.$submit = null;\n    this.$questionOptions = $('#question-options');\n    this.dataSource = this.$questionOptions.data('choices');\n    this.dataAnswer = this.$questionOptions.data('answer');\n    if(this.dataSource) {\n      this.dataSource = JSON.parse(this.dataSource);\n      this.dataAnswer = JSON.parse(this.dataAnswer);\n    }else {\n      this.dataSource = [];\n      this.dataAnswer =[];\n    }\n    this.imageUploadUrl = this.$questionOptions.data('imageUploadUrl');\n    this.imageDownloadUrl = this.$questionOptions.data('imageDownloadUrl');\n    this.initTitleEditor(this.validator);\n    this.initAnalysisEditor();\n    this.initOptions();\n    this.subscriptionMessage();\n  }\n\n  _initEvent() {\n    this.$form.on('click','[data-role=submit]',event=>this.submitForm(event));\n  }\n\n  submitForm(event) {\n    this.$submit = $(event.currentTarget);\n    let submitType = this.$submit.data('submission');\n    this.$form.find('[name=submission]').val(submitType);\n    \n    if(this.validator.form() && this.isSubmit ) {\n      this.submit();\n    }\n    if(!this.isSubmit ) {\n      this.publishMessage();\n    }\n  }\n\n  submit() {\n    this.$submit.button('loading');\n    this.$form.submit();\n  }\n\n  initOptions() {\n    ReactDOM.render( <QuestionOptions imageUploadUrl={this.imageUploadUrl} imageDownloadUrl={this.imageDownloadUrl} dataSource={this.dataSource} dataAnswer={this.dataAnswer}  minCheckedNum={ 2 } />,\n      document.getElementById('question-options')\n    );\n  }\n\n  publishMessage() {\n    console.log('publishMessage');\n    postal.publish({\n      channel : \"manage-question\",\n      topic : \"question-create-form-validator-start\",\n      data : {\n        isValidator: true,\n      }\n    });\n  }\n\n  subscriptionMessage() {\n    console.log('subscriptionMessage');\n    postal.subscribe({\n      channel  : \"manage-question\",\n      topic    : \"question-create-form-validator-end\",\n      callback : (data, envelope) =>{\n        this.isSubmit = data.isValidator;\n        console.log({\n          'subscriptionMessage':this.isSubmit\n        });\n        if(this.isSubmit &&  this.validator.form()) {\n          console.log('submit by subscriptionMessage');\n          this.submit();\n        }\n      }\n    });\n  }\n}\n\nexport default Choice;"]}