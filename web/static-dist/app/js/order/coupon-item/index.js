webpackJsonp(["app/js/order/coupon-item/index"],[function(e,o){"use strict";function t(e,o){if(!(e instanceof o))throw new TypeError("Cannot call a class as a function")}var n=function(){function e(e,o){for(var t=0;t<o.length;t++){var n=o[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(o,t,n){return t&&e(o.prototype,t),n&&e(o,n),o}}(),u=function(){function e(o){t(this,e),this.$element=o.element,this.$showDeductAmount=this.$element.find("#show-deduct-amount"),this.$noUseCouponCode=this.$element.find("#no-use-coupon-code"),this.$couponCode=this.$element.find("input[name='couponCode']"),this.$selectCoupon=this.$element.find("#coupon-select"),this.$couponNotify=this.$element.find("#code-notify"),this.initEvent(),this.init()}return n(e,[{key:"initEvent",value:function(){var e=this,o=this.$element;o.on("change","#coupon-select",function(o){return e.couponSelect(o)}),o.on("click","#change-coupon-code",function(o){return e.showChangeCoupon(o)}),o.on("click","#cancel-coupon",function(o){return e.cancelCoupon(o)}),o.on("click","#use-coupon",function(o){return e.useCoupon(o)})}},{key:"init",value:function(){this.$selectCoupon.length>0&&this._setCoupon(this.$selectCoupon.val(),!1)}},{key:"couponSelect",value:function(e){var o=$(e.currentTarget),t=(o.find("option:selected"),o.val());return t?void this._setCoupon(t):void this._selectEmptyCoupon()}},{key:"showChangeCoupon",value:function(e){$(e.currentTarget);this._showCouponCode(),this._setCoupon().focus()}},{key:"useCoupon",value:function(){this._checkCoupon()}},{key:"_checkCoupon",value:function(){var e=this,o=this.$couponCode.val();if(this.$productType||(this.$productType=$("input[name='targetType']")),this.$productId||(this.$productId=$("input[name='targetId']")),!o)return void e.$couponNotify.css("display","none");var t={code:o,targetType:this.$productType.val(),targetId:this.$productId.val(),price:$("input[name='price']").val()};$.post($("#use-coupon").data("url"),t,function(o){if("no"==o.useable)e.$couponNotify.addClass("alert-danger").text(o.message).css("display","inline-block");else{var t="discount"==o.type?Translator.trans("order.create.use_discount_coupon_hint",{rate:o.rate}):Translator.trans("order.create.use_price_coupon_hint",{rate:o.rate});e.$couponNotify.removeClass("alert-danger").addClass("alert-success").text(t).css("display","inline-block"),e._showDeductAmount(o.deduct_amount_format)}})}},{key:"cancelCoupon",value:function(e){this._hideCouponCode(),this.$selectCoupon.trigger("change")}},{key:"_showDeductAmount",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.$showDeductAmount.data("placeholder");this.$showDeductAmount.text(e)}},{key:"_showCouponCode",value:function(){$("#coupon-code").show(),$("#select-coupon-box").hide(),this._showDeductAmount()}},{key:"_hideCouponCode",value:function(){$("#coupon-code").hide(),$("#select-coupon-box").show()}},{key:"_selectEmptyCoupon",value:function(){this._setCoupon(),this._showDeductAmount()}},{key:"_setCoupon",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",o=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this.$couponCode.val(e),e?this.$noUseCouponCode.hide():this.$noUseCouponCode.show(),this._checkCoupon(),o&&$("#order-create-form").trigger("calculatePrice"),this.$couponCode}}]),e}();new u({element:$("#coupon-deducts")})}]);