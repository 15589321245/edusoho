{"version":3,"sources":["plugins/QuestionPlusPlugin/Resources/static-src/js/import/index.js"],"names":["QuestionImport","$form","validator","showBoard","$","step","init","_initValidate","on","_readBtn","event","_getMore","_importSubmit","validate","rules","importFile","required","target","messages","self","btn","currentTarget","form","button","ajaxSubmit","success","html","data","removeClass","replaceWith","clearFields","hide","find","error","response","JSON","parse","addClass","text","show","length","remove","attr","questions","post","message"],"mappings":"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","file":"index.js","sourceRoot":"/Users/kz/projects/edusoho","sourcesContent":["import 'common/jquery-form';\n\nclass QuestionImport\n{\n  constructor($form) {\n    this.$form = $form;\n    this.validator = null;\n    this.showBoard = $('#questions-show-board');\n    this.step = 10;\n    this.init();\n  }\n\n  init() {\n    this._initValidate();\n    this.$form.on('click','#question-import-btn',event=>this._readBtn(event));\n    this.showBoard.on('click', '#show-more-btn',event=>this._getMore(event));\n    this.showBoard.on('click', '#import-btn',event=>this._importSubmit(event));\n  }\n\n  _initValidate() {\n    this.validator = this.$form.validate({\n      rules:{\n        importFile: {\n          required:true\n        },\n        target: {\n          required:true\n        }\n      },\n      messages:{\n        importFile:'请选择文件',\n        target:'请选择导入范围'\n      }\n    });\n  }\n\n  _readBtn(event) {\n    let self = this;\n    let btn = $(event.currentTarget);\n\n    if(self.validator.form()){\n      btn.button('loading');\n\n      self.$form.ajaxSubmit({\n        success: function(html){\n          if ($(html).data('error') == true) {\n            btn.removeClass('disabled').button('reset');\n            self.showBoard.replaceWith($(html));\n          } else {\n            $('#import-file').clearFields();\n            self.$form.hide();\n            self.showBoard.html(html);\n            self.showBoard.find('.question-step:gt(9)').hide();\n          }\n        },\n        error: function(response){\n          let error = JSON.parse(response);\n          btn.button('error');\n          self.showBoard.addClass('well').text(error).show();\n        }\n      });\n    }\n  }\n\n  _getMore(event) {\n    this.step += 10;\n\n    this.showBoard.find('.question-step:lt('+this.step+')').show();\n\n    if (this.showBoard.find('.question-step').length <= this.step) {\n      $('#show-more-btn').remove();\n    }\n  }\n\n  _importSubmit(event) {\n    let btn = $(event.currentTarget);\n\n    btn.attr('disabled','disabled').button('reading');\n\n    let questions = $('#questions').html();\n    $.post(btn.data('url'), {questions:questions}, (response) => {\n      if (response > 0) {\n        this.$form.show();\n        this.showBoard.show();\n        let message = '成功导入' + response + '道题';\n        this.showBoard.addClass('well color-success').html(message);\n        $('#question-import-btn').removeClass('disabled').button('reset');\n      } else {\n        btn.button('error');\n      }\n    });\n  }\n\n}\n\nnew QuestionImport($('#question-import-form'));"]}