{"version":3,"sources":["app/Resources/static-src/app/js/task/widget/sidebar.js"],"names":["TaskSidebar","element","url","$","init","fixIconInChrome","fetchPlugins","then","plugins","renderToolbar","renderPane","bindEvent","fail","post","html","reduce","plugin","code","icon","name","append","find","on","event","$btn","currentTarget","pluginCode","data","$pane","$paneBody","undefined","operationContent","get","perfectScrollbar","hasClass","foldContent","removeClass","addClass","hide","show","popupContent","time","side_right","content_right","emit","animate","right","width","$currentPane","undelegate","children","click"],"mappings":"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","file":"sidebar.js","sourceRoot":"/Users/kz/projects/edusoho","sourcesContent":["// import Emitter from 'es6-event-emitter';\nimport Emitter from \"component-emitter\";\n\nexport default class TaskSidebar extends Emitter{\n  constructor({element, url}){\n    super();\n    this.url = url;\n    this.element = $(element);\n    this.init();\n  }\n\n  init() {\n    this.fixIconInChrome();\n    this.fetchPlugins()\n    .then((plugins) => {\n      this.plugins = plugins;\n      this.renderToolbar();\n      this.renderPane();\n      this.bindEvent();\n    })\n    .fail(error => {\n    });\n  }\n\n  fetchPlugins() {\n    return $.post(this.url);\n  }\n\n  // 修复字体图标在chrome下，加载两次从而不能显示的问题\n  fixIconInChrome() {\n    let html = `<i class=\"es-icon es-icon-chevronleft\"></i>`;\n    this.element.html(html);\n  }\n\n  renderToolbar() {\n    let html = `\n    <div class=\"dashboard-toolbar\">\n      <ul class=\"dashboard-toolbar-nav\" id=\"dashboard-toolbar-nav\">\n        ${this.plugins.reduce((html, plugin) => {\n          return html += `<li data-plugin=\"${plugin.code}\" data-url=\"${plugin.url}\"><a href=\"#\"><div class=\"mbs es-icon ${plugin.icon}\"></div>${plugin.name}</a></li>`;\n        }, '')}\n      </ul>\n    </div>`;\n    this.element.html(html);\n  }\n\n  renderPane() {\n    let html = this.plugins.reduce((html, plugin) => {\n      return html += `<div data-pane=\"${plugin.code}\" class=\" ${plugin.code}-pane\"><div class=\"${plugin.code}-pane-body js-sidebar-pane-body\"></div></div>`;\n    }, '');\n    this.element.append(html);\n  }\n\n  bindEvent(){\n    this.element.find('#dashboard-toolbar-nav').on('click', 'li', (event) => {\n      let $btn = $(event.currentTarget);\n      let pluginCode = $btn.data('plugin');\n      let url = $btn.data('url');\n      let $pane = this.element.find(`[data-pane=\"${pluginCode}\"]`)\n      let $paneBody = $pane.find('.js-sidebar-pane-body');\n      if(pluginCode === undefined || url === undefined){\n        return;\n      }\n\n      if($btn.data('loaded')){\n        this.operationContent($btn);\n        return;\n      }\n\n      $.get(url)\n          .then(html => {\n            $paneBody.html(html);\n            $pane.perfectScrollbar();\n            $btn.data('loaded', true);\n            this.operationContent($btn);\n          });\n    });\n  }\n\n  operationContent($btn){\n    if($btn.hasClass('active')){\n      this.foldContent();\n      $btn.removeClass('active');\n    }else {\n      this.element.find('#dashboard-toolbar-nav li').removeClass('active');\n      $btn.addClass('active');\n      this.element.find('[data-pane]').hide();\n      this.element.find(`[data-pane=\"${$btn.data('plugin')}\"]`).show();\n      this.popupContent();\n    }\n  }\n\n  popupContent(time=1) {\n    let side_right = '0px';\n    let content_right = '379px';\n\n    this.emit('popup', content_right, time);\n    this.element.animate({\n      right: side_right\n    }, time);\n  }\n\n  foldContent(time=1){\n    let side_right = '-' + this.element.width() + 'px';\n    let content_right = '26px';\n\n    // this.emit('fold', content_right, time);\n    this.element.animate({\n      right: side_right\n    }, time);\n  }\n\n  reload(){\n    const $currentPane = this.element.find('.js-sidebar-pane:visible');\n    const pluginCode = $currentPane.data('pane');\n    $currentPane.undelegate();\n    this.element.find('#dashboard-toolbar-nav').children(`[data-plugin=\"${pluginCode}\"]`)\n        .data('loaded', false)\n        .click();\n  }\n}\n"]}