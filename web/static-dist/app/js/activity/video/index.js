webpackJsonp(["app/js/activity/video/index"],[function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_esSwfobject=__webpack_require__("10a04670192737fb9c0f"),_esSwfobject2=_interopRequireDefault(_esSwfobject),_messenger=__webpack_require__("06597b47670159844043"),_messenger2=_interopRequireDefault(_messenger),_activityEmitter=__webpack_require__("da32dea28c2b82c7aab1"),_activityEmitter2=_interopRequireDefault(_activityEmitter);__webpack_require__("98fcd491acac0f6e3e07");var VideoPlay=function(){function VideoPlay(recorder){_classCallCheck(this,VideoPlay),this.player={},this.intervalId=null,this.recorder=recorder,this.emitter=new _activityEmitter2["default"]}return _createClass(VideoPlay,[{key:"play",value:function(){$("#swf-player").length?this._playerSwf():this._playVideo(),this.record()}},{key:"record",value:function(){var _this=this;this.intervalId=setInterval(function(){_this.recorder.addVideoPlayerCounter(_this.emitter,_this.player)},1e3)}},{key:"getPlay",value:function(){return this.player}},{key:"_playerSwf",value:function(){var swf_dom="swf-player";_esSwfobject2["default"].embedSWF($("#"+swf_dom).data("url"),swf_dom,"100%","100%","9.0.0",null,null,{wmode:"opaque",allowFullScreen:"true"})}},{key:"_playVideo",value:function(){var _this2=this,messenger=new _messenger2["default"]({name:"partner",project:"PlayerProject",children:[],type:"parent"});messenger.on("ended",function(msg){_this2.player.playing=!1,_this2._onFinishLearnTask(msg)}),messenger.on("playing",function(msg){_this2.player.playing=!0}),messenger.on("paused",function(msg){_this2.player.playing=!1}),messenger.on("timechange",function(msg){_this2.player.currentTime=msg.currentTime})}},{key:"_onFinishLearnTask",value:function(msg){var _this3=this;this.emitter.emit("finish",{data:msg}).then(function(){clearInterval(_this3.intervalId)})["catch"](function(error){console.error(error)})}}]),VideoPlay}(),VideoRecorder=function(){function VideoRecorder(container){_classCallCheck(this,VideoRecorder),this.container=container,this.interval=120}return _createClass(VideoRecorder,[{key:"addVideoPlayerCounter",value:function(emitter,player){var $container=$(this.container),activityId=$container.data("id"),playerCounter=store.get("activity_id_"+activityId+"_playing_counter");return playerCounter||(playerCounter=0),!(!player||!player.playing)&&(playerCounter>=this.interval?(emitter.emit("watching",{watchTime:this.interval}).then(function(){var url=$("#video-content").data("watchUrl");$.post(url,function(response){response&&"error"==response.status&&window.location.reload()})})["catch"](function(error){console.error(error)}),playerCounter=0):player.playing&&playerCounter++,void store.set("activity_id_"+activityId+"_playing_counter",playerCounter))}}]),VideoRecorder}(),recorder=new VideoRecorder("#video-content"),videoplay=new VideoPlay(recorder);videoplay.play()}]);