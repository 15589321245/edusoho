{% import "common/data-dict-macro.html.twig" as dict_macro %}
{% import "macro.html.twig" as web_macro %}
{% set mode = mode|default(['my']) %}

<thead>
  <tr>
    <th width="25%">{{'order.name'|trans}}</th>
    <th>{{'order.id'|trans}}</th>
    <th class="text-right">{{'order.price_amount'|trans }}/{{'order.real_pay'|trans}}</th>
    <th>{{'order.createdTime'|trans}}</th>
    <th>{{'order.status'|trans}}</th>
    <th style="min-width:100px">{{'user.orders.operation'|trans}}</th>
  </tr>
</thead>

<tbody>
  {% for order in orders %}
    <tr id="order-table-{{order.id}}">
      <td>
        {% if order.item.target_type == 'course' %}
          <a class="cd-link-gray-dark" href="{{ path('course_show', {id:order.item.target_id}) }}" target="_blank">{{order.title}}</a>
        {% elseif order.item.target_type == 'vip' %}
          <a class="cd-link-gray-dark" href="{{ path('vip', {id:order.item.target_id}) }}" target="_blank">{{order.title}}</a>
        {% elseif order.item.target_type == 'classroom' %}
          <a class="cd-link-gray-dark" href="{{ path('classroom_show', {id:order.item.target_id}) }}" target="_blank">{{order.title}}</a>
        {% else %}
          {{order.title}}
        {% endif %}
      </td>
      <td>{{order.sn}}</td>
      <td class="text-right">{{ order.price_amount  }}/{{ order.pay_amount }}</td>
      <td>{{ order.created_time|date('Y-n-d H:i:s') }}</td>
      <td>
        {{ dict_macro.orderStatusV2(order.display_status) }}
        {% if order.display_status in ['paid'] %}
          {% if order.refund_deadline == 0 or order.refund_deadline > date().timestamp  %}
            <div class="table-action__item">
              <a href="javascript:;" class="cd-link-primary" data-toggle="modal" data-target="#modal" data-url="{{ path('web_user_order_detail', {id:order.id}) }}">{{'申请退款'|trans}}</a>
            </div>
          {% endif %}
        {% endif %}
        {% if order.display_status in ['refunding'] %}
          <div class="table-action__item">
            <a href="javascript:;" class="cd-link-primary" data-toggle="modal" data-target="#modal" data-url="{{ path('web_user_order_detail', {id:order.id}) }}">{{'退款详情'|trans}}</a>
          </div>
        {% endif %}

      </td>
      <td>
        <div class="table-action">
          {% if order.status in ['created', 'paying'] %}
            <div class="table-action__item">
              <a href="{{path('cashier_show', {sn:order.sn})}}" class="cd-link-primary">{{'支付订单'|trans}}</a>
            </div>
            <div class="table-action__item dropdown">
              <a href="javascript:;" class="cd-link-primary" data-toggle="dropdown">
                更多<i class="cd-text-xs cd-icon cd-icon-arrow-down"></i>
              </a>
              <ul class="dropdown-menu cd-dropdown-menu">
                <li>
                  <a href="javascript:;" class="cd-link-primary" data-toggle="modal" data-target="#modal" data-url="{{ path('web_user_order_detail', {id:order.id}) }}">{{'订单详情'|trans}}</a>
                </li>
                <li>
                  <a href="javascript:;" class="js-cancel" data-url="{{ path('my_order_cancel', {id:order.id}) }}">{{'user.orders.cancel_order'|trans}}</a>
                </li>
              </ul>
            </div>
          {% endif %}
          {% if order.status in ['paid', 'refunding', 'refunded'] %}
            <div class="table-action__item">
              <a href="javascript:;" class="cd-link-primary" data-toggle="modal" data-target="#modal" data-url="{{ path('web_user_order_detail', {id:order.id}) }}">{{'订单详情'|trans}}</a>
            </div>
            <br>
            <div class="table-action__item">
              <a href="javascript:;" class="cd-link-gray" data-toggle="modal" data-target="#modal" data-url="{{ path('web_user_order_detail', {id:order.id}) }}">{{'申请退款'|trans}}</a>
            </div>
          {% endif %}
          {% if order.status in  %}
        </div>
        {#<div class="table-action">#}
          {#{% if order.status not in ['created'] %}#}
            {#<div class="table-action__item">#}
              {#<a href="javascript:;" class="cd-link-primary" data-toggle="modal" data-target="#modal" data-url="{{ path('web_user_order_detail', {id:order.id}) }}">{{'form.btn.detail'|trans}}</a>#}
            {#</div>#}
          {#{% else %}#}
            {#<div class="table-action__item dropdown">#}
              {#<a href="javascript:;" class="cd-link-primary" data-toggle="modal" data-target="#modal" data-url="{{ path('web_user_order_detail', {id:order.id}) }}">{{'form.btn.detail'|trans}}</a>#}
              {#<a href="javascript:;" class="cd-link-primary" data-toggle="dropdown">#}
                {#<i class="cd-text-xs cd-icon cd-icon-arrow-down"></i>#}
              {#</a>#}

              {#<ul class="dropdown-menu cd-dropdown-menu">#}
                {#{% if order.status == 'refunding' %}#}
                  {#<li><a href="javascript:;" class="js-cancel-refund" data-url="{{ path('my_order_cancel_refund', {id:order.id}) }}">{{'user.orders.cancel_refund'|trans}}</a></li>#}
                {#{% endif %}#}
                {#{% if order.status in ['created', 'paying'] %}#}
                  {#<li>#}
                    {#<a href="{{path('cashier_show', {sn:order.sn})}}">{{'user.orders.pay'|trans}}</a>#}
                  {#</li>#}
                  {#<li><a href="javascript:;" class="js-cancel" data-url="{{ path('my_order_cancel', {id:order.id}) }}">{{'user.orders.cancel_order'|trans}}</a></li>#}
                {#{% endif %}#}
              {#</ul>#}
            {#</div>#}
          {#{% endif %}#}
        {#</div>#}
      </td>
    </tr>
  {% else %}
    <tr><td colspan="20"><div class="cd-empty">{{'site.datagrid.empty'|trans}}</div></td></tr>
  {% endfor %}
</tbody>