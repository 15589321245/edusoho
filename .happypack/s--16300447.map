{"version":3,"sources":["app/Resources/static-src/app/js/task/index.js"],"names":["TaskShow","element","courseId","taskId","mode","$","eventEmitter","find","ui","init","initPlugin","initSidebar","bindEvent","tooltip","popover","html","trigger","learnedTime","minute","timeStep","alert","delay","parseInt","eventData","emit","then","undefined","receiveFinish","response","on","post","data","modal","val","learned","receive","result","status","get","attr","learnedWeakPrompt","sidebar","reload","url","px","time","animate","right"],"mappings":"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","file":"index.js","sourceRoot":"/Users/kz/projects/edusoho","sourcesContent":["import TaskSidebar from \"./widget/sidebar\";\nimport TaskUi from \"./widget/task-ui\";\nimport TaskEventEmitter from \"./widget/task-event-emitter\";\nimport Emitter from \"common/es-event-emitter\";\n\nclass TaskShow extends Emitter {\n  constructor({element, courseId, taskId, mode}) {\n    super();\n    this.element = $(element);\n    this.courseId = courseId;\n    this.taskId = taskId;\n    this.mode = mode;\n    this.eventEmitter = new TaskEventEmitter(this.element.find('#task-content-iframe'));\n    this.ui = new TaskUi({\n      element: '.js-task-dashboard-page'\n    });\n\n    this.init();\n  }\n\n  init() {\n    this.initPlugin();\n    this.initSidebar();\n\n    if (this.mode != 'preview') {\n      this.bindEvent();\n    }\n  }\n\n  initPlugin() {\n    $('[data-toggle=\"tooltip\"]').tooltip();\n    $('[data-toggle=\"popover\"]').popover({\n      html: true,\n      trigger: 'hover'\n    });\n  }\n\n  bindEvent() {\n    let learnedTime = 0;\n    let minute = 60 * 1000;\n    let timeStep = 1; // 分钟\n    //注册doing延时监听\n   alert('bindEvent');\n    this.delay('doing', (timeStep) => {\n     alert('delay doing');\n      learnedTime = parseInt(timeStep) + parseInt(learnedTime);\n      let eventData = {\n        timeStep: timeStep,\n        learnedTime: learnedTime,\n        taskId: this.taskId\n      };\n      this.eventEmitter.emit('doing', eventData)\n          .then(undefined, response => {\n           alert('emit doing');\n            this.receiveFinish(response);\n          })\n          ['catch'](() => {\n           alert('emit catch');\n          })\n          .then(undefined, () => { //always\n           alert('emit timeStep');\n            this.emit('doing', timeStep);\n          });\n    }, timeStep * minute);\n\n    this.emit('doing', timeStep);\n\n    this.element.on('click', '#learn-btn', event => {\n      $.post($('#learn-btn').data('url'), response => {\n        $('#modal').modal('show');\n        $('#modal').html(response);\n        $('input[name=\"task-result-status\"]', $('#js-hidden-data')).val('finish');\n        this.ui.learned();\n      });\n    });\n\n    // 接收活动的finish事件\n    this.eventEmitter.receive('finish', response => {\n      this.receiveFinish(response);\n    });\n\n  }\n\n  receiveFinish(response) {\n    if (response.result.status == 'finish'\n        && $('input[name=\"task-result-status\"]', $('#js-hidden-data')).val() != 'finish') {\n        $.get($(\".js-learned-prompt\").data('url'), html => {\n        $(\".js-learned-prompt\").attr('data-content', html);\n        this.ui.learnedWeakPrompt();\n        this.ui.learned();\n        this.sidebar.reload();\n        $('input[name=\"task-result-status\"]', $('#js-hidden-data')).val('finish');\n      });\n    }\n  }\n\n  initSidebar() {\n    this.sidebar = new TaskSidebar({\n      element: this.element.find('#dashboard-sidebar'),\n      url: this.element.find('#js-hidden-data [name=\"plugins_url\"]').val()\n    });\n    this.sidebar\n        .on('popup', (px, time) => {\n          this.element.find('#dashboard-content').animate({\n            right: px\n          }, time);\n        })\n        .on('fold', (px, time) => {\n          this.element.find('#dashboard-content').animate({\n            right: px\n          }, time);\n        });\n  }\n}\n\nnew TaskShow({\n  element: $('body'),\n  courseId: $('body').find('#js-hidden-data [name=\"course-id\"]').val(),\n  taskId: $('body').find('#js-hidden-data [name=\"task-id\"]').val(),\n  mode: $('body').find('#js-hidden-data [name=\"mode\"]').val()\n});\n"]}