{"version":3,"sources":["app/Resources/static-src/app/js/activity-manage/homework/create.js"],"names":["Homework","$iframeContent","$homeworkModal","$","window","parent","document","$questionPickedModal","$element","$step2_form","find","$step3_form","init","initEvent","setValidateRule","inItStep2form","on","showPickQuestion","event","hide","show","html","validator","editor","CKEDITOR","replace","toolbar","filebrowserImageUploadUrl","data","val","getData","form","preventDefault","$btn","currentTarget","excludeIds","each","push","modal","get","join","validate","onkeyup","rules","title","required","maxlength","trim","description","content","messages","initCkeditor","addMethod","value","element","optional","test","format","reg"],"mappings":"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","file":"create.js","sourceRoot":"/Users/kz/projects/edusoho","sourcesContent":["export default class Homework {\n  constructor($iframeContent) {\n    this.$homeworkModal = $('#modal',window.parent.document);\n    this.$questionPickedModal = $('#attachment-modal',window.parent.document);\n    this.$element = $iframeContent;\n    this.$step2_form = this.$element.find('#step2-form');\n    this.$step3_form = this.$element.find('#step3-form');\n    this.init();\n  }\n\n  init() {\n    this.initEvent();  \n    this.setValidateRule();\n    this.inItStep2form();\n  }\n\n  initEvent() {\n    this.$element.on('click', '[data-role=\"pick-item\"]',event=>this.showPickQuestion(event));\n    this.$questionPickedModal.on('shown.bs.modal',()=>{\n      this.$homeworkModal.hide();\n    });\n    this.$questionPickedModal.on('hidden.bs.modal',()=>{\n      this.$homeworkModal.show();\n      this.$questionPickedModal.html('');\n    });\n  }\n\n  initCkeditor(validator) {\n    let editor = CKEDITOR.replace('homework-about-field', {\n      toolbar: 'Minimal',\n      filebrowserImageUploadUrl: $('#homework-about-field').data('imageUploadUrl'),\n    });\n    editor.on( 'change', () => {    \n      $('#homework-about-field').val(editor.getData());\n    });\n    editor.on('blur', function() {\n      validator.form();\n    });\n  }\n\n  showPickQuestion(event) {\n    event.preventDefault();\n    let $btn = $(event.currentTarget);\n    let excludeIds = [];\n    $(\"#question-table-tbody\").find('[name=\"questionIds[]\"]').each(function() {\n      excludeIds.push($(this).val());\n    });\n    this.$questionPickedModal.modal().data('manager', this);\n    $.get($btn.data('url'), {\n      excludeIds: excludeIds.join(',')\n    }, html =>  {\n      this.$questionPickedModal.html(html);\n    });\n  }\n\n  inItStep2form() {\n    var validator = this.$step2_form.validate({\n      onkeyup: false,\n      rules: {\n        title:{\n          required:true,\n          maxlength: 50,\n           trim: true,\n        },\n        description: {\n          required:true\n        },\n        content: 'required',\n        'questionLength':{\n          required:true\n        },\n      },\n      messages: {\n        'questionLength':\"请选择题目\",\n      },\n    });\n    this.initCkeditor(validator);\n    this.$step2_form.data('validator',validator);\n  }\n\n  setValidateRule() {\n    $.validator.addMethod(\"arithmeticFloat\",function(value,element){  \n      return this.optional( element ) || /^[0-9]+(\\.[0-9]?)?$/.test(value);\n    }, $.validator.format(\"必须为正数，保留一位小数\"));\n\n    $.validator.addMethod(\"positiveInteger\",function(value,element){  \n      return this.optional( element ) || /^[1-9]\\d*$/.test(value);\n    }, $.validator.format(\"必须为正整数\"));\n\n    $.validator.addMethod(\"DateAndTime\",function(value,element){  \n      let reg = /^(?:(?!0000)[0-9]{4}-(?:(?:0[1-9]|1[0-2])-(?:0[1-9]|1[0-9]|2[0-8])|(?:0[13-9]|1[0-2])-(?:29|30)|(?:0[13578]|1[02])-31)|(?:[0-9]{2}(?:0[48]|[2468][048]|[13579][26])|(?:0[48]|[2468][048]|[13579][26])00)-02-29) ([0-1]{1}[0-9]{1})|(2[0-4]{1}):[0-5]{1}[0-9]{1}$/;\n      return this.optional( element ) || reg.test(value);\n    }, $.validator.format(\"请输入正确的日期和时间,格式如XXXX-MM-DD hh:mm\"));\n  }\n}\n"]}