{"version":3,"sources":["app/Resources/static-src/app/common/component/question-options/index.js"],"names":["InitOptionData","dataSource","inputValue","validatorDatas","seq","checked","obj","optionId","Math","random","toString","replace","optionLabel","Options","length","checkedNum","push","deleteOption","i","splice","console","log","changeOptionChecked","id","isRadio","map","item","index","updateOption","value","QuestionOptions","props","state","isValidator","dataAnswer","defaultNum","subscriptionMessage","validatorOptions","subscribe","channel","topic","callback","data","envelope","publish","validNum","setState","option","minCheckedNum","publishMessage","maxNum","minNum","imageUploadUrl","imageDownloadUrl","updateInputValue","addOption","defaultProps"],"mappings":"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","file":"index.js","sourceRoot":"/Users/kz/projects/edusoho","sourcesContent":["import React, { Component } from 'react';\nimport Option from './option';\nimport notify from 'common/notify';\nimport postal from 'postal';\nimport { numberConvertLetter } from '../../unit';\n\nfunction InitOptionData(dataSource,inputValue,validatorDatas,seq,checked) {\n  var obj = {\n    optionId:Math.random().toString().replace('.',''),\n    optionLabel: '选项'+ numberConvertLetter(seq),\n    inputValue: inputValue,\n    checked: checked,\n  }\n  validatorDatas.Options[obj.optionId] = inputValue.length > 0 ? 1 : 0;\n  if(checked) {\n    validatorDatas.checkedNum += 1;\n  }\n  dataSource.push(obj);\n}\n\nfunction deleteOption(dataSource,validatorDatas,optionId) {\n  for(let i = 0; i< dataSource.length ;i++) {\n    if(dataSource[i].optionId==optionId) {\n      if(dataSource[i].checked) {\n        validatorDatas.checkedNum = 0;\n      }\n      dataSource.splice(i, 1);\n      console.log(validatorDatas.Options[optionId]);\n      console.log(dataSource);\n      delete validatorDatas.Options[optionId];\n      i--;\n    }else {\n      dataSource[i].optionLabel = '选项'+ numberConvertLetter(i+1);\n    }\n  }\n}\n\nfunction changeOptionChecked(dataSource,validatorDatas,id,checked,isRadio) {\n  let checkedNum = 0;\n  dataSource.map((item,index)=> {\n    if(!isRadio) {\n      if(item.optionId == id ) {\n        dataSource[index].checked= !checked;\n      }\n    }else {\n      //单选\n      if(item.optionId == id && !checked ) { \n        dataSource[index].checked  = true;\n      }else if(!checked){\n        dataSource[index].checked = false;\n      }\n    }\n    //计算选择的答案\n    console.log(dataSource[index].checked);\n    if(dataSource[index].checked) {\n      checkedNum++;\n    }\n  });\n  console.log(checkedNum);\n  validatorDatas.checkedNum = checkedNum;\n}\n\nfunction updateOption(dataSource,validatorDatas,id,value) {\n  dataSource.map((item,index)=>{\n    if(item.optionId == id) {\n      dataSource[index].inputValue = value;\n    }\n  })\n}\n\nexport default class QuestionOptions extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      dataSource:[],\n      isValidator: false,\n    }\n    //验证的数据\n    this.validatorDatas = {\n      checkedNum: 0,\n      Options: {}\n    };\n    const dataSource = this.props.dataSource;\n    const dataAnswer = this.props.dataAnswer;\n    if(dataSource.length > 0) {\n      dataSource.map((item,index)=>{\n        let checked = false;\n        for( let i = 0 ;i< dataAnswer.length;i++) {\n          if(index == dataAnswer[i]) {\n            checked = true;\n          }\n        }\n        InitOptionData(this.state.dataSource,item,this.validatorDatas,index+1,checked);\n      })\n    }else {\n      for(let i = 1; i <= this.props.defaultNum;i++) {\n        InitOptionData(this.state.dataSource,'',this.validatorDatas,i,false);\n      }\n    }\n    this.subscriptionMessage();\n    console.log(this.validatorOptions);\n  }\n\n  subscriptionMessage() {\n    postal.subscribe({\n      channel  : \"manage-question\",\n      topic    : \"question-create-form-validator-start\",\n      callback : (data, envelope) =>{\n        this.validatorOptions(data);\n      }\n    });\n  }\n\n  publishMessage(isValidator) {\n    postal.publish({\n      channel : \"manage-question\",\n      topic : \"question-create-form-validator-end\",\n      data : {\n        isValidator: isValidator,\n      }\n    });\n  }\n\n  validatorOptions(data) {\n    let validNum = 0;\n\n    //触发视觉\n    this.setState({\n      isValidator: data.isValidator,\n    })\n\n    for(let option in this.validatorDatas.Options){\n      validNum += this.validatorDatas.Options[option];\n    }\n\n    if(validNum < this.state.dataSource.length ) {\n      console.log(' validNum is error ');\n      return;\n    }\n\n    if(this.validatorDatas.checkedNum < this.props.minCheckedNum ) {\n      notify('danger',`至少选择${this.props.minCheckedNum}个答案!`);\n    }else {\n      console.log('publishMessage');\n      this.publishMessage(true);\n    }\n  }\n\n  addOption() {\n    if(this.state.dataSource.length >= this.props.maxNum) {\n      notify('danger', `选项最多${this.props.maxNum}个!`);\n      return;\n    }\n    InitOptionData(this.state.dataSource,'',this.validatorDatas,this.state.dataSource.length+1,false);\n    this.setState({\n      dataSource:this.state.dataSource,\n    });\n    console.log({'dataSource':this.state.dataSource});\n    console.log({'validatorDatas':this.validatorDatas});\n  }\n\n  changeOptionChecked(id,checked) {\n    changeOptionChecked(this.state.dataSource,this.validatorDatas,id,checked,this.props.isRadio);\n    this.setState({\n      dataSource:this.state.dataSource,\n    });\n    if(this.validatorDatas.checkedNum <= 0) {\n      this.publishMessage(false);\n    }\n  }\n\n  deleteOption(id) {\n    if(this.state.dataSource.length <= this.props.minNum) {\n      notify('danger', `选项最少${this.props.minNum}个!`);\n      return;\n    }\n    deleteOption(this.state.dataSource,this.validatorDatas,id);\n    this.setState({\n      dataSource:this.state.dataSource,\n    });\n    console.log({'validatorDatas':this.validatorDatas});\n  }\n\n  updateInputValue(id,value) {\n    updateOption(this.state.dataSource,this.validatorDatas,id,value);\n    this.validatorDatas.Options[id] = value.length > 0 ? 1:0;\n    if(value.length <=0 ) {\n      this.publishMessage(false);\n    }\n    this.setState({\n      dataSource: this.state.dataSource,\n    })\n  }\n\n  render() {\n    return(\n      <div className=\"question-options-group\">\n        {\n          this.state.dataSource.map((item,index)=>{\n            return (\n              <Option imageUploadUrl= {this.props.imageUploadUrl} imageDownloadUrl={this.props.imageDownloadUrl}  isRadio = {this.props.isRadio} publishMessage= {(isValidator)=>this.publishMessage(isValidator)} validatorDatas = {this.validatorDatas} isValidator= {this.state.isValidator} datas = {item} key = {index} index = {index} deleteOption ={(id)=>this.deleteOption(id)} changeOptionChecked= {(id,checked)=>this.changeOptionChecked(id,checked)} updateInputValue={ (id,value)=>this.updateInputValue(id,value)}></Option>\n            )\n          })\n        }\n        <div className=\"form-group\">\n          <div className=\"col-md-8 col-md-offset-2\">\n            <a className=\"btn btn-success btn-sm pull-right\" onClick={()=>this.addOption()}>新增选项</a>\n          </div>\n        </div>\n      </div>\n    )\n  }\n}\n\nQuestionOptions.defaultProps = {\n  defaultNum: 4, //默认选项个数\n  maxNum: 10,//最多选项的个数\n  minNum: 2,//最少选项的个数\n  isRadio: false,//是否为单选\n  minCheckedNum:1,//至少选择几个答案\n}"]}