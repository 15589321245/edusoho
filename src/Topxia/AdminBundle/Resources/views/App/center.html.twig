{% extends 'TopxiaAdminBundle:App:layout.html.twig' %}

{% block title %}应用中心 - {{ parent() }}{% endblock %}

{% set menu = 'center' %}
{% set tab_menus = permissions('admin_app_center_show',"tab") %}
{% set submenu = 'center' %}
{% set script_controller = 'app/center' %}

{% block main %}

  <div class="mbl">
    {% include 'TopxiaAdminBundle::tab.html.twig' with {menus : tab_menus , type : submenu} %}
  </div >

  <div class="mbl">

      <a href="{{ url('admin_app_center', {postStatus: 'all'}) }}" type="button" class="btn btn-default btn-sm {% if type == 'all'%} btn-info{% endif %}">全部</a>

      <a href=" {{ url('admin_app_center', {postStatus: 'theme'}) }}" type="button" class="btn btn-default btn-sm {% if type == 'theme'%}btn-info{% endif %}">主题</a>

      <a href=" {{ url('admin_app_center', {postStatus: 'app'}) }}" type="button" class="btn btn-default btn-sm {% if type == 'app'%}btn-info{% endif %}">应用</a>
  </div>

  {% if status|default(null) == 'error' %}
    <div class="alert alert-danger">AccessKey或者SecretKey设置不正确，会影响到系统正常的运行，<a href="{{path('admin_setting_cloud')}}">请修改设置。</a></div>
  {% elseif  status|default(null) == 'unlink' %}
    <div class="alert alert-danger">您的服务器无法连接到更新服务器，请检查网络连接状况。</div>
  {% else %}
  <table class="table table-striped table-hover" id="app-table-container">
    <thead>

    </thead>
    <tbody>

      {% if type == 'all' %}
      {% set apps = apps %}
      {% elseif type == 'theme'%}
      {% set apps = theme %}
      {% elseif type == 'app' %}
      {% set apps = allApp %}
      {% endif  %}

      {% for app in apps %}
        {% set installedApp = installedApps[app.code]|default(null) %}
      <tr>
        <td>
          <img src="http://115.29.78.158:99/files/product/{{ app.icon }}" class="app-img pull-left mrl mtm"/>
          <div class="mtm">
            <a target="_blank" href="http://open.edusoho.com/app/{{ app.code }}">
              <h4><strong class="text-primary">{{ app.name }}</strong>            
              {% if app.licensed %}
              <span class="label label-success mls">商业版</span>
              {% endif %}
              </h4>
            </a>
  
          </div>
          
          <div class="info mtm mbm clearfix">
            <div class="left-info pull-left">

              <div class="text-muted">作者： {{ app.developerName }}</div>
              <div class="mts text-muted">{% if app.type == "theme" %}主题{% else %}应用{% endif %}
              </div>
<!--               <div class="class-rating mtm">
  {% if app.comment|default(null) %}
    {% set comment = app.comment%}
    <span class="stars-{{ comment.rating|number_format }}">&nbsp;</span>
    <span class="text-muted">{{ comment.commenters }}个评价</span>
  {% else %}
    <span class="stars-0">&nbsp;</span>
    <span class="text-muted">0个评价</span>
  {% endif %}
</div> -->
            </div>

            <div class="middle-info pull-left short-long-text">
              <div class="short-text text-muted">{{ app.description|plain_text(80) }} <span class="trigger">(展开)</span></div>
              <div class="long-text">{{ app.description|raw }} <span class="trigger">(收起)</span></div>
            </div>

            <div class="right-info pull-right">

               {% if app.userAccess == 'ok' or installedApp %}
                <a href="javascript:;" class="btn btn-default disabled app-btn">已购买</a>
                {% else %}
                    <a href="http://open.edusoho.com/app/{{ app.code }}" class="btn btn-warning app-btn" target="_blank">购买</a>
               {% endif %}
               


                <p class="mtm"><span class="text-muted">价格：</sapn><span class="price"> ¥ {% if app.price > 0 %}{{ app.price}}{% else %}免费{% endif %}</sapn></p>
            </div>
          </div> 
          
         <!--  
         <div class="text-muted"><small>最后更新： {{ app.latestTime|date('Y-m-d') }}</small></div> -->
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  {% endif %}
{% endblock %}