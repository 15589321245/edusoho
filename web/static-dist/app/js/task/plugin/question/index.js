webpackJsonp(["app/js/task/plugin/question/index"],{"00e30a58f14c77ba6f94":function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_notify=__webpack_require__("b334fd7e4c5a19234db2"),_notify2=_interopRequireDefault(_notify),_postal=__webpack_require__("5d0c27d11736d24f7053"),_postal2=_interopRequireDefault(_postal),_class=function(){function _class(){_classCallCheck(this,_class),this.$element=$("#task-question-plugin-form"),this.editor=null,this.validator=null,this.initEvent()}return _createClass(_class,[{key:"initEvent",value:function(){var _this=this;this.$element.on("focusin",".expand-form-trigger",function(event){return _this.expand()}),this.$element.on("click",".btn-primary",function(event){return _this.save(event)}),this.$element.on("click",".collapse-form-btn",function(event){return _this.collapse()})}},{key:"save",value:function(event){var _this2=this;if(event.preventDefault(),this.validator&&this.validator.form()){var $btn=$(event.currentTarget);$btn.attr("disabled","disabled");var channel=_postal2["default"].channel("task.plugin.question");$.post(this.$element.attr("action"),this.$element.serialize()).done(function(html){(0,_notify2["default"])("success","提问成功"),channel.publish("form.save",{html:html}),$btn.removeAttr("disabled"),_this2.collapse()}).fail(function(error){(0,_notify2["default"])("danger",error)})}}},{key:"expand",value:function(){var _this3=this;if(!this.$element.hasClass("form-expanded")){this.$element.addClass("form-expanded");var editor=CKEDITOR.replace("question_content",{toolbar:"Simple",filebrowserImageUploadUrl:this.$element.find("#question_content").data("imageUploadUrl")});this.editor=editor,this.validator=this.$element.validate({rules:{"question[title]":"required","question[content]":"required"},messages:{"question[title]":"请输入问题标题","question[content]":"请输入提问内容"}}),editor.on("change",function(){_this3.$element.find('[name="question[content]"]').val(editor.getData())}),editor.on("blur",function(){_this3.$element.find('[name="question[content]"]').val(editor.getData())}),this.$element.find(".js-detail-form-group").removeClass("hide")}}},{key:"collapse",value:function(){this.$element.removeClass("form-expanded"),this.editor&&this.editor.destroy(),this.$element.removeData("validator"),this.clear(),this.$element.find(".js-detail-form-group").addClass("hide")}},{key:"clear",value:function(){this.$element.find("input[type=text],textarea").each(function(){$(this).val("")})}}]),_class}();exports["default"]=_class},0:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_postal=__webpack_require__("5d0c27d11736d24f7053"),_postal2=_interopRequireDefault(_postal),_form=__webpack_require__("00e30a58f14c77ba6f94"),_form2=_interopRequireDefault(_form),_question=__webpack_require__("d8c8273d605150f97e6e"),_question2=_interopRequireDefault(_question),QuestionPlugin=function(){function QuestionPlugin(){_classCallCheck(this,QuestionPlugin),this.$element=$(".question-pane"),this.$list=this.$element.find(".question-list-block"),this.$detail=this.$element.find(".question-detail-block"),this.form=new _form2["default"],this.question=null,this.initEvent()}return _createClass(QuestionPlugin,[{key:"initEvent",value:function(){var _this=this;this.$element.on("click",".js-redirect-question-detail",function(event){return _this.onRedirectQuestion(event)});var channel=_postal2["default"].channel("task.plugin.question");channel.subscribe("form.save",function(data,envelope){_this.$element.find('[data-role="list"]').prepend(data.html),_this.$element.find(".empty-item").remove()}),channel.subscribe("back-to-list",function(){return _this.onBackList()})}},{key:"onRedirectQuestion",value:function(event){var $target=$(event.currentTarget),url=$target.data("url");this.question=new _question2["default"](url),this.$list.hide(),this.$detail.show()}},{key:"onBackList",value:function(){this.question&&this.question.destroy(),this.$list.show(),this.$detail.hide()}}]),QuestionPlugin}();new QuestionPlugin},d8c8273d605150f97e6e:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_notify=__webpack_require__("b334fd7e4c5a19234db2"),_notify2=_interopRequireDefault(_notify),_postal=__webpack_require__("5d0c27d11736d24f7053"),_postal2=_interopRequireDefault(_postal),_class=function(){function _class(url){_classCallCheck(this,_class),this.url=url,this.$element=$(".question-detail-block"),this.$form=null,this.validator=null,this.channel=_postal2["default"].channel("task.plugin.question"),this.render()}return _createClass(_class,[{key:"initEvent",value:function(){var _this=this;this.$element.on("click",".back-to-list",function(){_this.channel.publish("back-to-list")}),this.$form.on("click",".btn-primary",function(event){return _this.onSavePost(event)})}},{key:"onSavePost",value:function(event){var _this2=this;event.preventDefault(),this.validator&&this.validator.form()&&$.post(this.$form.attr("action"),this.$form.serialize()).done(function(html){_this2.$element.find("[data-role=post-list]").append(html);var number=parseInt(_this2.$element.find("[data-role=post-number]").text());_this2.$element.find("[data-role=post-number]").text(number+1),_this2.$form.find("textarea").val("")}).error(function(response){Notify.danger(response.error.message)})}},{key:"render",value:function(){var _this3=this;$.get(this.url).done(function(html){_this3.$element.html(html),_this3.$form=_this3.$element.find(".post-form"),_this3.validator=_this3.$form.validate({rules:{"post[content]":"required"},messages:{"post[content]":"请输入回复内容"}}),_this3.initEvent()}).fail(function(error){(0,_notify2["default"])("danger","error")})}},{key:"destroy",value:function(){this.$element.html(""),this.$element.undelegate()}}]),_class}();exports["default"]=_class}});