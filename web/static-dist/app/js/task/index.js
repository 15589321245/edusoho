webpackJsonp(["app/js/task/index"],{0:function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),l=n("5f0af4efa4df981e1cb2"),u=i(l),d=n("8564292a81bb30f6618a"),f=i(d),c=n("ee4a357784724c191c9e"),h=i(c),p=n("63fff8fb24f3bd1f61cd"),v=i(p),m=function(e){function t(e){var n=e.element,i=e.courseId,o=e.taskId,s=e.mode;a(this,t);var l=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return l.element=$(n),l.courseId=i,l.taskId=o,l.mode=s,l.eventEmitter=new h.default(l.element.find("#task-content-iframe")),l.ui=new f.default({element:".js-task-dashboard-page"}),l.init(),l}return o(t,e),s(t,[{key:"init",value:function(){this.initPlugin(),this.initSidebar(),"preview"!=this.mode&&this.bindEvent()}},{key:"initPlugin",value:function(){$('[data-toggle="tooltip"]').tooltip(),$('[data-toggle="popover"]').popover({html:!0,trigger:"hover"})}},{key:"bindEvent",value:function(){var e=this,t=0,n=6e4,i=2;this.delay("doing",function(n){t=parseInt(n)+parseInt(t),e.eventEmitter.emit("doing",{timeStep:n,learnedTime:t,taskId:e.taskId}).then(function(t){e.trigger("doing",n),"finish"==t.result.status&&"finish"!=$('input[name="task-result-status"]',$("#js-hidden-data")).val()&&(e.ui.learnedWeakPrompt(),e.ui.learned(),$('input[name="task-result-status"]',$("#js-hidden-data")).val("finish"))})},i*n),this.trigger("doing",i),this.element.on("click","#learn-btn",function(t){$.post($("#learn-btn").data("url"),function(t){$("#modal").modal("show"),$("#modal").html(t),$('input[name="task-result-status"]',$("#js-hidden-data")).val("finish"),e.ui.learned()})}),this.eventEmitter.receive("finish",function(t){"finish"==t.result.status&&"finish"!=$('input[name="task-result-status"]',$("#js-hidden-data")).val()&&(e.ui.learnedWeakPrompt(),e.ui.learned(),$('input[name="task-result-status"]',$("#js-hidden-data")).val("finish"))})}},{key:"initSidebar",value:function(){var e=this;this.sidebar=new u.default({element:this.element.find("#dashboard-sidebar"),url:this.element.find('#js-hidden-data [name="plugins_url"]').val()}),this.sidebar.on("popup",function(t,n){e.element.find("#dashboard-content").animate({right:t},n)}).on("fold",function(t,n){e.element.find("#dashboard-content").animate({right:t},n)})}}]),t}(v.default);new m({element:$("body"),courseId:$("body").find('#js-hidden-data [name="course-id"]').val(),taskId:$("body").find('#js-hidden-data [name="task-id"]').val(),mode:$("body").find('#js-hidden-data [name="mode"]').val()})},"5f0af4efa4df981e1cb2":function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),l=n("f3404f3e29d10cb74973"),u=i(l),d=function(e){function t(e){var n=e.element,i=e.url;a(this,t);var o=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return o.url=i,o.element=$(n),o.init(),o}return o(t,e),s(t,[{key:"init",value:function(){var e=this;this.fetchPlugins().then(function(t){e.plugins=t,e.renderToolbar(),e.renderPane(),e.bindEvent()}).fail(function(e){})}},{key:"fetchPlugins",value:function(){return $.post(this.url)}},{key:"renderToolbar",value:function(){var e='\n    <div class="dashboard-toolbar">\n      <ul class="dashboard-toolbar-nav" id="dashboard-toolbar-nav">\n        '+this.plugins.reduce(function(e,t){return e+='<li data-plugin="'+t.code+'" data-url="'+t.url+'"><a href="#"><div class="mbs es-icon '+t.icon+'"></div>'+t.name+"</a></li>"},"")+"\n      </ul>\n    </div>";this.element.html(e)}},{key:"renderPane",value:function(){var e=this.plugins.reduce(function(e,t){return e+='<div data-pane="'+t.code+'" class="task-pane"></div>'},"");this.element.append(e)}},{key:"bindEvent",value:function(){var e=this;this.element.find("#dashboard-toolbar-nav").on("click","li",function(t){var n=$(t.currentTarget),i=n.data("plugin"),a=n.data("url"),r=e.element.find('[data-pane="'+i+'"]');if(void 0!==i&&void 0!==a)return n.data("loaded")?void e.operationContent(n):void $.get(a).then(function(t){r.html(t),n.data("loaded",!0),e.operationContent(n)})})}},{key:"operationContent",value:function(e){e.hasClass("active")?(this.foldContent(),e.removeClass("active")):(this.element.find("#dashboard-toolbar-nav li").removeClass("active"),e.addClass("active"),this.element.find("[data-pane]").hide(),this.element.find('[data-pane="'+e.data("plugin")+'"]').show(),this.popupContent())}},{key:"popupContent",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t="0px",n="379px";this.trigger("popup",n,e),this.element.animate({right:t},e)}},{key:"foldContent",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t="-"+this.element.width()+"px",n="26px";this.trigger("fold",n,e),this.element.animate({right:t},e)}}]),t}(u.default);t.default=d},ee4a357784724c191c9e:function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),o=n("b704ce0ef0c1bec36938"),s=i(o),l=function(){function e(t){var n=this;if(a(this,e),this.element=$(t),this.eventUrl=this.element.data("eventUrl"),void 0===this.eventUrl)throw Error("task event url is undefined");this.eventMap={receives:{}},this.receiveMessenger=new s.default("TaskMessenger","ActivityEvent"),this.receiveMessenger.addTarget(this.element.get(0).contentWindow,"task-content-iframe"),this.receiveMessenger.listen(function(e){var t=JSON.parse(e),i=t.event,a=t.data,r=n.eventMap.receives[i];$.post(n.element.data("eventUrl"),{eventName:i,data:a}).done(function(e){"undefined"!=typeof r&&r.forEach(function(t){return t(e)}),n.receiveMessenger.send(JSON.stringify(e))}).fail(function(e){n.receiveMessenger.send(JSON.stringify({event:i,error:e}))})}),this.emitMessenger=new s.default("TaskMessenger","TaskEvent"),this.emitMessenger.addTarget(this.element.get(0).contentWindow,"task-content-iframe")}return r(e,[{key:"emit",value:function(e,t){var n=this;return new Promise(function(i,a){$.post(n.eventUrl,{eventName:e,data:t}).done(function(e){n.emitMessenger.send(JSON.stringify({event:e.event,data:e.data})),i(e)}).fail(function(e){a(e)})})}},{key:"receive",value:function(e,t){this.eventMap.receives[e]=this.eventMap.receives[e]||[],this.eventMap.receives[e].push(t)}}]),e}();t.default=l},"8564292a81bb30f6618a":function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),a=function(){function e(t){n(this,e),this.element=$(t.element),this.learningPrompt=this.element.find(".js-learning-prompt"),this.learnedPrompt=this.element.find(".js-learned-prompt"),this.learnprompt=this.element.find(".js-learn-prompt"),this.btnLearn=this.element.find(".js-btn-learn")}return i(e,[{key:"learnedWeakPrompt",value:function(){var e=this;this.learnprompt.removeClass("open"),this.learningPrompt.addClass("moveup"),window.setTimeout(function(){e.learningPrompt.removeClass("moveup"),e.learnedPrompt.addClass("moveup")},2e3)}},{key:"learned",value:function(){this.btnLearn.addClass("active")}}]),e}();t.default=a}});