{"version":3,"sources":["app/Resources/static-src/app/js/file-chooser/base/materiallib-choose.js"],"names":["MaterialLibChoose","$container","container","loadShareingContacts","_init","_initEvent","_loadList","$","on","_switchFileSource","bind","_filterByFileOwner","_filterByFileName","_paginationList","_onSelectFile","url","data","get","_getParams","find","html","params","each","input","attr","val","event","stopImmediatePropagation","preventDefault","page","_getUrlParameter","currentTarget","that","type","addClass","siblings","removeClass","_loadSharingContacts","call","console","error","teachers","Object","keys","length","Translator","trans","i","teacher","id","nickname","self","element","currentUserId","$that","file","name","emit","param","sPageParams","split","sPageURL","decodeURIComponent","sURLVariables","sParameterName","undefined"],"mappings":"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","file":"materiallib-choose.js","sourceRoot":"/Users/kz/projects/edusoho","sourcesContent":["import Chooser from './chooser';\n\nclass MaterialLibChoose extends Chooser {\n\n  constructor($container) {\n    super();\n    this.container = $container;\n    this.loadShareingContacts = false;\n    this._init();\n    this._initEvent();\n  }\n\n  _init() {\n    this._loadList();\n  }\n\n  _initEvent() {\n    $(this.container).on('click', '.js-material-type', this._switchFileSource.bind(this));\n    $(this.container).on('change', '.js-file-owner', this._filterByFileOwner)\n    $(this.container).on('click', '.js-browser-search', this._filterByFileName.bind(this));\n    $(this.container).on('click', '.pagination a', this._paginationList.bind(this));\n    $(this.container).on('click', '.file-browser-item', this._onSelectFile.bind(this));\n    // $('.js-choose-trigger').on('click', this._open.bind(this))\n  }\n\n  _loadList() {\n    let url = $('.js-browser-search').data('url');\n    $.get(url, this._getParams(), html => {\n      this.container.find('.js-material-list').html(html);\n    });\n  }\n\n  _getParams() {\n    let params = {};\n    $('.js-material-lib-search-form input[type=hidden]').each(function(input) {\n      params[$(this).attr('name')] = $(this).val();\n    });\n    return params;\n  }\n\n  _paginationList(event) {\n    event.stopImmediatePropagation();\n    event.preventDefault();\n\n    let page = this._getUrlParameter($(event.currentTarget).attr('href'), 'page');\n    $('input[name=page]').val(page);\n    this._loadList();\n  }\n\n  _switchFileSource(event) {\n    let that = event.currentTarget;\n    var type = $(that).data('type');\n    $(that).addClass('active').siblings().removeClass('active');\n    $('input[name=sourceFrom]').val(type);\n    $('input[name=page]').val(1);\n    switch (type) {\n      case 'my':\n        $('.js-file-name-group').removeClass('hidden');\n        $('.js-file-owner-group').addClass('hidden');\n        break;\n      case 'sharing':\n        this._loadSharingContacts.call(this, $(that).data('sharingContactsUrl'));\n        $('.js-file-name-group').removeClass('hidden');\n        $('.js-file-owner-group').removeClass('hidden');\n        break;\n      default:\n        $('.js-file-name-group').addClass('hidden');\n        $('.js-file-owner-group').addClass('hidden');\n        break;\n    }\n    this._loadList();\n  }\n\n  _loadSharingContacts(url) {\n    if (this.loadShareingContacts == true) {\n      console.error('teacher list has been loaded');\n      return;\n    }\n    $.get(url, function(teachers) {\n      if (Object.keys(teachers).length > 0) {\n        var html = `<option value=''>${Translator.trans('请选择老师')}</option>`;\n        $.each(teachers, function(i, teacher) {\n          html += `<option value='${teacher.id}'>${teacher.nickname} </option>`\n        });\n\n        $(\".js-file-owner\", self.element).html(html);\n      }\n\n    }, 'json');\n    this.loadShareingContacts = true;\n  }\n\n\n  _filterByFileName() {\n    $('input[name=keyword]').val($('.js-file-name').val());\n    this._loadList();\n  }\n\n  _filterByFileOwner() {\n    params.currentUserId = $('.js-file-owner option:selected').val();\n    $('input[name=currentUserId]').val(currentUserId);\n    this._loadList();\n  }\n\n  _onSelectFile(event) {\n    $('.file-browser-item').removeClass('active');\n    var $that = $(event.currentTarget).addClass('active');\n    var file = $that.data();\n    $('[data-role=\"placeholder\"]').html(file.name);\n    this.emit('select', file);\n  }\n\n  _getUrlParameter(url, param) {\n    var sPageParams = url.split('?');\n    if (sPageParams && sPageParams.length == 2) {\n      var sPageURL = decodeURIComponent(sPageParams[1]);\n      var sURLVariables = sPageURL.split('&');\n      for (let i = 0; i < sURLVariables.length; i++) {\n        var sParameterName = sURLVariables[i].split('=');\n\n        if (sParameterName[0] === param) {\n          return sParameterName[1] === undefined ? null : sParameterName[1];\n        }\n      }\n    }\n    return null;\n\n  }\n\n}\n\nexport default MaterialLibChoose;\n"]}