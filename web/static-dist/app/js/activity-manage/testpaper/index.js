webpackJsonp(["app/js/activity-manage/testpaper/index"],[function(module,exports,__webpack_require__){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_unit=__webpack_require__("3c398f87808202f19beb"),Testpaper=function(){function Testpaper($element){_classCallCheck(this,Testpaper),this.$element=$element,this.$step2_form=this.$element.find("#step2-form"),this.$step3_form=this.$element.find("#step3-form"),this.$parentiframe=$(window.parent.document).find("#task-create-content-iframe"),this._init()}return _createClass(Testpaper,[{key:"_init",value:function(){(0,_unit.dateFormat)(),this.setValidateRule(),this.initEvent(),this.initStepForm2(),this.initSelectTestpaper($("#testpaper-media").find("option:selected"),$('[name="finishScore"]').val())}},{key:"initEvent",value:function(){var _this=this;this.$element.find("#testpaper-media").on("change",function(event){return _this.changeTestpaper(event)}),this.$element.find("input[name=doTimes]").on("change",function(event){return _this.showRedoInterval(event)}),this.$element.find('input[name="testMode"]').on("change",function(event){return _this.startTimeCheck(event)}),this.$element.find('input[name="limitedTime"]').on("blur",function(event){return _this.changeEndTime(event)}),this.$element.find("#condition-select").on("change",function(event){return _this.changeCondition(event)})}},{key:"setValidateRule",value:function(){$.validator.addMethod("arithmeticFloat",function(value,element){return this.optional(element)||/^[0-9]+(\.[0-9]?)?$/.test(value)},$.validator.format("必须为正数，保留一位小数")),$.validator.addMethod("positiveInteger",function(value,element){return this.optional(element)||/^[1-9]\d*$/.test(value)},$.validator.format("必须为正整数")),$.validator.addMethod("DateAndTime",function(value,element){var reg=/^(?:(?!0000)[0-9]{4}-(?:(?:0[1-9]|1[0-2])-(?:0[1-9]|1[0-9]|2[0-8])|(?:0[13-9]|1[0-2])-(?:29|30)|(?:0[13578]|1[02])-31)|(?:[0-9]{2}(?:0[48]|[2468][048]|[13579][26])|(?:0[48]|[2468][048]|[13579][26])00)-02-29) ([0-1]{1}[0-9]{1})|(2[0-4]{1}):[0-5]{1}[0-9]{1}$/;return this.optional(element)||reg.test(value)},$.validator.format("请输入正确的日期和时间,格式如XXXX-MM-DD hh:mm"))}},{key:"initStepForm2",value:function(){var validator=this.$step2_form.validate({onkeyup:!1,rules:{title:{required:!0},mediaId:{required:!0,digits:!0},limitedTime:{required:!0,digits:!0},startTime:{required:function(){return 1==$('[name="doTimes"]:checked').val()&&"realTime"==$('[name="testMode"]:checked').val()},DateAndTime:function(){return 1==$('[name="doTimes"]:checked').val()&&"realTime"==$('[name="testMode"]:checked').val()}},redoInterval:{required:function(){return 1==$('[name="doTimes"]:checked').val()},arithmeticFloat:!0,max:1e9}},messages:{title:{required:"请填写标题"},mediaId:{required:"请选择试卷"},startTime:{required:"请选择考试的开始时间"},redoInterval:{max:"最大值不能超过1000000000"}}});this.$step2_form.data("validator",validator)}},{key:"initSelectTestpaper",value:function($option){var passScore=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",mediaId=$option.val();if(""!=mediaId){this.getItemsTable($option.closest("select").data("getTestpaperItems"),mediaId);var score=$option.data("score");""==passScore&&(passScore=Math.ceil(.6*score)),console.log(passScore),$("#score-single-input").val(passScore),$(".js-score-total").text(score),this.initSlider(passScore,score)}else $("#questionItemShowDiv").hide()}},{key:"changeTestpaper",value:function(event){var $target=$(event.currentTarget),$option=$target.find("option:selected");this.initSelectTestpaper($option)}},{key:"showRedoInterval",value:function(event){var $this=$(event.currentTarget);1==$this.val()?($("#lesson-redo-interval-field").closest(".form-group").hide(),$(".starttime-check-div").show()):($("#lesson-redo-interval-field").closest(".form-group").show(),$(".starttime-check-div").hide())}},{key:"startTimeCheck",value:function(event){var $this=$(event.currentTarget);"realTime"==$this.val()?($(".starttime-input").removeClass("hidden"),this.dateTimePicker()):$(".starttime-input").addClass("hidden")}},{key:"changeEndTime",value:function(){var $this=$(event.currentTarget),limitedTime=$this.val(),startTime=$('input[name="startTime"]:visible').val();if(console.log(startTime),startTime){var endTime=new Date(Date.parse(startTime)+60*limitedTime*1e3),endDate=endTime.Format("yyyy-MM-dd hh:mm");$('input[name="endTime"]').val(endDate)}}},{key:"changeCondition",value:function(event){var $this=$(event.currentTarget),value=$this.find("option:selected").val();"score"!=value?$(".js-score-form-group").addClass("hidden"):$(".js-score-form-group").removeClass("hidden")}},{key:"initSlider",value:function(passScore,score){console.log(passScore),console.log(score);var $sliderRemask=null,silder=($("#score-single-input").data("score-total"),null);console.log($(".single-slider")),$(""),silder=$(".single-slider").jRange({from:0,to:score,step:1,format:function(value,type){var v=100*(parseInt(value)/parseInt(score)).toFixed(2);return v+"%"},width:300,showLabels:!0,showScale:!1,onstatechange:function(argument,data){$sliderRemask.text(argument)}}),console.log(silder),console.log($.fn),$sliderRemask=$(".js-slider-remask").text(passScore)}},{key:"getItemsTable",value:function(url,testpaperId){$.post(url,{testpaperId:testpaperId},function(html){$("#questionItemShowTable").html(html),$("#questionItemShowDiv").show()})}},{key:"dateTimePicker",value:function(){var _this2=this,data=new Date,$starttime=$('input[name="startTime"]').val(data.Format("yyyy-MM-dd hh:mm"));$starttime.datetimepicker({autoclose:!0,format:"yyyy-mm-dd hh:ii",language:"zh",minView:"hour"}).on("show",function(event){_this2.$parentiframe.height($("body").height()+240)}).on("hide",function(event){_this2.$step2_form.data("validator").form(),_this2.$parentiframe.height($("body").height())}).on("changeDate",function(ev){var date=ev.date.valueOf(),limitedTime=$('input[name="limitedTime"]').val();if(0!=limitedTime){var endTime=new Date(date+60*limitedTime*1e3),endDate=endTime.Format("yyyy-MM-dd hh:mm");$("#starttime-show").html(endDate),$(".endtime-input").removeClass("hidden"),$('input[name="endTime"]').val(endDate)}}),$starttime.datetimepicker("setStartDate",data)}}]),Testpaper}();new Testpaper($("#iframe-content"))}]);