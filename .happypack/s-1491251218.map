{"version":3,"sources":["app/Resources/static-src/app/common/component/question-options/option.js"],"names":["Options","props","state","datas","editor","editorBody","editorHtml","console","log","initCkeditor","event","deleteOption","currentTarget","attributes","value","changeOptionChecked","checked","dataSourceUi","CKEDITOR","replace","optionId","toolbar","filebrowserImageUploadUrl","imageUploadUrl","height","self","on","$","parent","find","contents","setTimeout","updateInputValue","getData","setData","inputValue","showDanger","isValidator","length","type","isRadio","html","optionLabel","imageDownloadUrl","index","onChangeChecked"],"mappings":"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","file":"option.js","sourceRoot":"/Users/kz/projects/edusoho","sourcesContent":["import React,{ Component } from 'react';\n\nexport default class Options extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      datas: this.props.datas,\n    }\n    this.editor = null;\n    this.editorBody = null;\n    this.editorHtml = null;\n  }\n \n  componentDidMount() {\n    console.log('componentDidMount');\n    this.initCkeditor();\n  }\n\n  deleteOption(event) {\n    this.editorHtml = null;\n    this.props.deleteOption(event.currentTarget.attributes[\"data-option-id\"].value);\n  }\n\n  onChangeChecked(event) {\n    this.props.changeOptionChecked(event.currentTarget.attributes[\"data-option-id\"].value,this.props.datas.checked);\n  }\n\n  initCkeditor(dataSourceUi) {\n    if(!this.editor) {\n      this.editor = CKEDITOR.replace(this.props.datas.optionId, {\n        toolbar: 'Minimal',\n        filebrowserImageUploadUrl:this.props.imageUploadUrl,\n        height: 120\n      });\n      let self = this;\n      this.editor.on(\"instanceReady\", function () {  \n        self.editorBody = $('#' + [self.props.datas.optionId]).parent().find('iframe').contents().find('body');\n        //setData两个问题：1、引发事件失效 2、死循环触发；\n      }); \n      this.editor.on('change',function(){\n        setTimeout(function(){\n          self.updateInputValue(self.editor.getData());\n        },100)\n      });\n    }else {\n      this.editor.setData(datas.inputValue);\n    }\n  }\n\n  updateInputValue(inputValue) {\n    this.editorHtml = inputValue;\n    this.props.updateInputValue(this.props.datas.optionId,inputValue);\n  }\n\n  render() {\n    let showDanger = this.props.isValidator && this.props.datas.inputValue.length <= 0;\n    let type = 'checkbox';\n    if(this.props.isRadio) {\n      type= 'radio';\n    }\n    if(this.editorBody && this.editorHtml != this.props.datas.inputValue) {\n      this.editorBody.html(this.props.datas.inputValue);\n    }\n    return (\n      <div className=\"form-group\">\n        <div className=\"col-sm-2 control-label\">\n          <label className=\"choice-label control-label-required\">{this.props.datas.optionLabel}</label>\n        </div>\n        <div className=\"col-sm-8 controls\">\n          <textarea className=\"form-control datas-input col-md-8\" id={this.props.datas.optionId}  defaultValue={this.props.datas.inputValue} name='choices[]' value={this.props.datas.inputValue} data-image-upload-url={this.props.imageUploadUrl} data-image-download-url={this.props.imageDownloadUrl}></textarea>\n          <div className=\"mtm\">\n            <label>\n              <input type={type} name='answer[]' data-option-id={this.props.datas.optionId} value={this.props.index}  checked={this.props.datas.checked} className=\"answer-checkbox\" onChange = {(event)=>this.onChangeChecked(event)}/>正确答案 \n            </label>\n          </div>\n          <p className={showDanger ? 'color-danger' : 'hidden'}>请输入选项内容</p>\n        </div>\n        <div className=\"col-sm-2\">\n          <a className=\"btn btn-default btn-sm\" data-option-id={ this.props.datas.optionId }  onClick={(event)=>this.deleteOption(event)} href=\"javascript:;\"><i className=\"glyphicon glyphicon-trash\"></i></a>\n        </div>\n      </div>\n    )\n  }\n}"]}