webpackJsonp(["app/js/course-manage/info/index"],[function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_reactDom=__webpack_require__("9eb83941d980788d78c8"),_reactDom2=_interopRequireDefault(_reactDom),_react=__webpack_require__("c337a14feb9fb812fa40"),_react2=_interopRequireDefault(_react),_multiInput=__webpack_require__("26fa658edb0135ccf5db"),_multiInput2=_interopRequireDefault(_multiInput),_postal=__webpack_require__("5d0c27d11736d24f7053"),_postal2=_interopRequireDefault(_postal),courseInfo=function(){function courseInfo(){_classCallCheck(this,courseInfo),this.init()}return _createClass(courseInfo,[{key:"init",value:function(){$("#maxStudentNum-field").length>0&&$.get($("#maxStudentNum-field").data("liveCapacityUrl")).done(function(liveCapacity){$("#maxStudentNum-field").data("liveCapacity",liveCapacity.capacity)}),this.initCkeidtor(),this.initValidator(),this.checkBoxChange(),this.initDatePicker("#expiryStartDate"),this.initDatePicker("#expiryEndDate"),this.renderMultiGroupComponent("course-goals","goals"),this.renderMultiGroupComponent("intended-students","audiences")}},{key:"initCkeidtor",value:function(){CKEDITOR.replace("summary",{allowedContent:!0,toolbar:"Detail",filebrowserImageUploadUrl:$("#summary").data("imageUploadUrl")})}},{key:"renderMultiGroupComponent",value:function(elementId,name){var datas=$("#"+elementId).data("init-value");_reactDom2["default"].render(_react2["default"].createElement(_multiInput2["default"],{dataSource:datas,outputDataElement:name}),document.getElementById(elementId))}},{key:"initValidator",value:function(){var _this=this,$form=$("#course-info-form"),validator=$form.validate({currentDom:"#course-submit",groups:{date:"expiryStartDate expiryEndDate"},rules:{title:{maxlength:100,required:{depends:function(){return $(this).val($.trim($(this).val())),!0}}},maxStudentNum:{required:!0,live_capacity:!0,positive_integer:!0},expiryDays:{required:function(){return"date"!=$('input[name="expiryMode"]:checked').val()},digits:!0,max_year:!0},expiryStartDate:{required:function(){return"date"==$('input[name="expiryMode"]:checked').val()},date:!0,after_now_date:!0,before_date:"#expiryEndDate"},expiryEndDate:{required:function(){return"date"==$('input[name="expiryMode"]:checked').val()},date:!0,after_date:"#expiryStartDate"}},messages:{title:{require:Translator.trans("请输入教学计划课程标题")},maxStudentNum:{required:Translator.trans("请输入课程人数")},expiryDays:{required:Translator.trans("请输入学习有效期")},expiryStartDate:{required:Translator.trans("请输入开始日期"),before:Translator.trans("开始日期应早于结束日期")},expiryEndDate:{required:Translator.trans("请输入结束日期"),after:Translator.trans("结束日期应晚于开始日期")}}});$.validator.addMethod("before",function(value,element,params){return"date"!==$('input[name="expiryMode"]:checked').val()||(!value||$(params).val()>value)},Translator.trans("开始日期应早于结束日期")),$.validator.addMethod("after",function(value,element,params){return"date"!==$('input[name="expiryMode"]:checked').val()||(!value||$(params).val()<value)},Translator.trans("结束日期应晚于开始日期")),$("#course-submit").click(function(){validator.form()&&(_this.publishAddMessage(),$form.submit())})}},{key:"publishAddMessage",value:function(){_postal2["default"].publish({channel:"courseInfoMultiInput",topic:"addMultiInput"})}},{key:"initDatePicker",value:function($id){var $picker=$($id);$picker.datetimepicker({format:"yyyy-mm-dd",language:"zh",minView:2,autoclose:!0,endDate:new Date(Date.now()+31536e7)}),$picker.datetimepicker("setStartDate",new Date)}},{key:"checkBoxChange",value:function(){$('input[name="expiryMode"]').on("change",function(event){"date"==$('input[name="expiryMode"]:checked').val()?($("#expiry-days").removeClass("hidden").addClass("hidden"),$("#expiry-date").removeClass("hidden")):($("#expiry-date").removeClass("hidden").addClass("hidden"),$("#expiry-days").removeClass("hidden"))})}}]),courseInfo}();new courseInfo,jQuery.validator.addMethod("max_year",function(value,element){return this.optional(element)||value<1e5},"有效期最大值不能超过99,999天"),jQuery.validator.addMethod("live_capacity",function(value,element){var maxCapacity=parseInt($(element).data("liveCapacity"));if(value>maxCapacity){var message=Translator.trans("网校可支持最多%capacity%人同时参加直播，您可以设置一个更大的数值，但届时有可能会导致满额后其他学员无法进入直播。",{capacity:maxCapacity});$(element).parent().siblings(".js-course-rule").find("p").html(message)}else $(element).parent().siblings(".js-course-rule").find("p").html("");return!0})}]);