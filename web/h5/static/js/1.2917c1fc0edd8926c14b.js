webpackJsonp([1],{GQcO:function(t,a,e){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var i=e("Dd8w"),s=e.n(i),n=e("gyMJ"),r=(e("mtWM"),e("NYxO")),c={data:function(){return{detail:{}}},computed:s()({},Object(r.d)({isLoading:function(t){return t.isLoading}})),mounted:function(){var t=this.$route.query,a=t.pay_amount,e=t.title,i=t.sn,s=t.openid;this.detail={pay_amount:a,title:e,sn:i,openid:s}},methods:{handlePay:function(){var t=this;n.a.createTrade({data:{gateway:"WechatPay_JsH5",type:"purchase",orderSn:this.detail.sn,openid:this.detail.openid}}).then(function(a){WeixinJSBridge.invoke("getBrandWCPayRequest",a.platformCreatedResult,function(e){"get_brand_wcpay_request:ok"==e.err_msg?t.$router.push({path:a.paidSuccessUrlH5}):"get_brand_wcpay_request:fail"==e.err_msg?alert("支付失败"):"get_brand_wcpay_request:cancel"==e.err_msg&&alert("支付已失败")})})}}},d={render:function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"payPage"},[t.isLoading?e("e-loading"):t._e(),t._v(" "),e("div",{staticClass:"payPage__order"},[e("div",{staticClass:"order__head"},[t._v("\n      "+t._s(t.detail.title)+"\n    ")]),t._v(" "),e("div",{staticClass:"order__infomation"},[e("div",{staticClass:"sum"},[e("span",[t._v("待支付")]),t._v(" "),e("span",{staticClass:"sum__price"},[t._v("¥ "),e("span",{staticClass:"num"},[t._v(t._s(t._f("toMoney")(t.detail.pay_amount)))])])])])]),t._v(" "),e("div",{staticClass:"payPage__payBtn",on:{click:t.handlePay}},[t._v("\n    立即支付\n  ")])],1)},staticRenderFns:[]},o=e("VU/8")(c,d,!1,null,null,null);a.default=o.exports},NDEt:function(t,a,e){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var i=e("Xxa5"),s=e.n(i),n=e("woOf"),r=e.n(n),c=e("exGp"),d=e.n(c),o=e("Dd8w"),l=e.n(o),u=e("gyMJ"),_=(e("mtWM"),e("NYxO")),y={data:function(){return{detail:{},payWay:"Alipay_LegacyH5",selected:!0,paySettings:{},inWechat:this.isWeixinBrowser()}},computed:l()({},Object(_.d)({isLoading:function(t){return t.isLoading}}),{validPayWay:function(){return this.paySettings.wxpayEnabled||this.paySettings.alipayEnabled&&!this.inWechat}}),created:function(){var t=this;return d()(s.a.mark(function a(){var e,i,n,c,d;return s.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,u.a.getSettings({query:{type:"payment"}});case 2:t.paySettings=a.sent,e=t.$route.query,i=e.source,n=e.id,c=e.sn,d=e.targetId,"order"!==i?u.a.createOrder({data:{targetType:"course",targetId:n,isOrderCreate:1}}).then(function(a){t.detail=r()({},a)}):u.a.getOrderDetail({query:{sn:c}}).then(function(a){"success"===a.status&&d&&t.$router.push({path:"/course/"+d}),t.detail=r()({},a)});case 5:case"end":return a.stop()}},a,t)}))()},methods:{handlePay:function(){var t=this;this.validPayWay&&("WechatPay_H5"===this.payWay&&this.inWechat?window.location.href=window.location.origin+"/pay/center/wxpay_h5?pay_amount="+this.detail.pay_amount+"&title="+this.detail.title+"&sn="+this.detail.sn:u.a.createTrade({data:{gateway:this.payWay,type:"purchase",orderSn:this.detail.sn,app_pay:"Y"}}).then(function(a){"WechatPay_H5"!==t.payWay?window.location.href=a.payUrl:t.getTradeInfo(a.tradeSn).then(function(){window.location.href=a.mwebUrl})}))},isWeixinBrowser:function(){return/micromessenger/.test(navigator.userAgent.toLowerCase())},getTradeInfo:function(t){var a=this;return u.a.getTrade({query:{tradesSn:t}}).then(function(e){e.isPaid?window.location.href=window.location.origin+e.paidSuccessUrlH5:setTimeout(function(){a.getTradeInfo(t)},2e3)})}}},p={render:function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"payPage"},[t.isLoading?e("e-loading"):t._e(),t._v(" "),e("div",{staticClass:"payPage__order"},[e("div",{staticClass:"order__head"},[t._v("\n      支付方式\n    ")]),t._v(" "),e("div",{staticClass:"order__infomation"},[e("div",{staticClass:"title"},[t._v(t._s(t.detail.title))]),t._v(" "),e("div",{staticClass:"sum"},[e("span",[t._v("待支付")]),t._v(" "),e("span",{staticClass:"sum__price"},[t._v("¥ "),e("span",{staticClass:"num"},[t._v(t._s(t._f("toMoney")(t.detail.pay_amount)))])])]),t._v(" "),e("div",{staticClass:"payWay"},[e("div",{directives:[{name:"show",rawName:"v-show",value:t.paySettings.alipayEnabled&&!t.inWechat,expression:"paySettings.alipayEnabled && !inWechat"}],class:["payWay__item",{"payWay__item--selected":t.selected}],on:{click:function(a){t.payWay="Alipay_LegacyH5",t.selected=!0}}},[e("img",{staticClass:"correct",attrs:{src:"static/images/correct.png"}}),t._v(" "),e("div",{staticClass:"right"}),t._v(" "),e("img",{attrs:{src:"static/images/zfb.png"}})]),t._v(" "),e("div",{directives:[{name:"show",rawName:"v-show",value:t.paySettings.wxpayEnabled,expression:"paySettings.wxpayEnabled"}],class:["payWay__item",{"payWay__item--selected":!t.selected}],on:{click:function(a){t.payWay="WechatPay_H5",t.selected=!1}}},[e("img",{staticClass:"correct",attrs:{src:"static/images/correct.png"}}),t._v(" "),e("div",{staticClass:"right"}),t._v(" "),e("img",{attrs:{src:"static/images/wx.png"}})])])])]),t._v(" "),e("div",{class:["payPage__payBtn",{disabled:!t.validPayWay}],on:{click:t.handlePay}},[t._v("\n    "+t._s(t.validPayWay?"立即支付":"无可用支付方式")+"\n  ")])],1)},staticRenderFns:[]},v=e("VU/8")(y,p,!1,null,null,null);a.default=v.exports}});