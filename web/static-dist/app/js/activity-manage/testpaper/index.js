webpackJsonp(["app/js/activity-manage/testpaper/index"],[function(e,t){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),a=function(){function e(t){i(this,e),this.$element=t,this.slider=null,this._setValidateRule(),this._init(),this._initEvent()}return n(e,[{key:"_init",value:function(){this._inItStep2form(),this._dateTimePicker();var e=$('[name="finishScore"]').val();this._initSelectTestpaper($("#testpaper-media").find("option:selected"),e)}},{key:"_initEvent",value:function(){var e=this;$("#testpaper-media").on("change",function(t){return e._changeTestpaper(t)}),$("input[name=doTimes]").on("change",function(t){return e._showRedoInterval(t)}),$('input[name="testMode"]').on("change",function(t){return e._startTimeCheck(t)}),$('input[name="limitedTime"]').on("blur",function(t){return e._changeEndTime(t)}),$("#condition-select").on("change",function(t){return e._changeCondition(t)})}},{key:"_initSlider",value:function(){this.slider=$(".nstSlider").nstSlider({left_grip_selector:".leftGrip",value_changed_callback:function(e,t,i){var n=$(this).closest(".nstSlider-list"),a=$(".js-leftGrip").css("left"),r=n.find(".js-totale-text").text(),o=Math.ceil(t/r*100)+"%";n.find(".js-leftGrip-remask-text").text(t),n.find(".js-bar").css("width",o),n.find(".js-nstSlider-content").css("left",a),n.find(".js-leftGrip-text").css("left",a).text(o),$('[name="finishScore"]').val(t)}}),$(document).mousemove(function(){window.getSelection?window.getSelection().removeAllRanges():document.selection.empty()});.6*$(".js-totale-text").text()}},{key:"_changeCondition",value:function(e){var t=$(e.currentTarget),i=t.find("option:selected").val();"score"!=i?$(".js-score-slider").addClass("hidden"):$(".js-score-slider").removeClass("hidden")}},{key:"_changeTestpaper",value:function(e){var t=$(e.currentTarget),i=t.find("option:selected");this._initSelectTestpaper(i)}},{key:"_initSelectTestpaper",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i=e.val();if(""!=i){this._getItemsTable(e.closest("select").data("getTestpaperItems"),i);var n=e.data("score");$(".nstSlider").attr("data-range_max",n),$(".js-totale-text").text(n),""==t&&(t=Math.ceil(.6*n)),$(".js-leftGrip-remask-text").text(t),$(".nstSlider").attr("data-cur_min",t),this._initSlider()}else $("#questionItemShowDiv").hide()}},{key:"_getItemsTable",value:function(e,t){$.post(e,{testpaperId:t},function(e){$("#questionItemShowTable").html(e),$("#questionItemShowDiv").show()})}},{key:"_showRedoInterval",value:function(e){var t=$(e.currentTarget);1==t.val()?($("#lesson-redo-interval-field").closest(".form-group").hide(),$(".starttime-check-div").show()):($("#lesson-redo-interval-field").closest(".form-group").show(),$(".starttime-check-div").hide())}},{key:"_startTimeCheck",value:function(e){var t=$(e.currentTarget);"realTime"==t.val()?$(".starttime-input").show():$(".starttime-input").hide()}},{key:"_dateTimePicker",value:function(){var e=$('input[name="startTime"]'),t=$(window.parent.document).find("#task-manage-content-iframe");e.datetimepicker({autoclose:!0,format:"yyyy-mm-dd hh:ii",language:"zh",minView:"hour"}).on("show",function(e){t.height(t.contents().find("body").height()+260)}).on("hide",function(e){t.height(t.contents().find("body").height())}).on("changeDate",function(e){var t=e.date.valueOf(),i=$('input[name="limitedTime"]').val();if(0!=i){var n=new Date(t+60*i*1e3),a=n.getFullYear()+"-"+(n.getMonth()+1)+"-"+n.getDate()+" "+n.getHours()+":"+n.getMinutes();$("#starttime-show").html(a),$(".endtime-input").show(),$('input[name="endTime"]').val(a)}}),e.datetimepicker("setStartDate",new Date)}},{key:"_changeEndTime",value:function(){var e=$(event.currentTarget),t=e.val(),i=$('input[name="startTime"]').val();if(!i){var n=new Date(Date.parse(i)+60*t*1e3),a=n.getFullYear()+"-"+(n.getMonth()+1)+"-"+n.getDate()+" "+n.getHours()+":"+n.getMinutes();$("#starttime-show").html(a),$('input[name="endTime"]').val(a)}}},{key:"_inItStep2form",value:function(){var e=this.$element,t=e.validate({onkeyup:!1,rules:{title:{required:!0},mediaId:{required:!0,digits:!0},limitedTime:{required:!0,digits:!0},startTime:{required:function(){return 1==$('[name="doTimes"]:checked').val()&&"realTime"==$('[name="testMode"]:checked').val()},DateAndTime:function(){return 1==$('[name="doTimes"]:checked').val()&&"realTime"==$('[name="testMode"]:checked').val()}},redoInterval:{required:function(){return 1==$('[name="doTimes"]:checked').val()},arithmeticFloat:!0,max:1e9}},messages:{title:{required:"请填写标题"},mediaId:{required:"请选择试卷"},startTime:{required:"请选择考试的开始时间"},redoInterval:{max:"最大值不能超过1000000000"}}});e.data("validator",t)}},{key:"_inItStep3form",value:function(){var e=$("#step3-form"),t=e.validate({onkeyup:!1,rules:{checkType:{required:!0},finishCondition:{required:!0}},messages:{checkType:"考评方式",finishCondition:"请选择完成条件"}});e.data("validator",t)}},{key:"_setValidateRule",value:function(){$.validator.addMethod("arithmeticFloat",function(e,t){return this.optional(t)||/^[0-9]+(\.[0-9]?)?$/.test(e)},$.validator.format("必须为正数，保留一位小数")),$.validator.addMethod("positiveInteger",function(e,t){return this.optional(t)||/^[1-9]\d*$/.test(e)},$.validator.format("必须为正整数")),$.validator.addMethod("DateAndTime",function(e,t){var i=/^(?:(?!0000)[0-9]{4}-(?:(?:0[1-9]|1[0-2])-(?:0[1-9]|1[0-9]|2[0-8])|(?:0[13-9]|1[0-2])-(?:29|30)|(?:0[13578]|1[02])-31)|(?:[0-9]{2}(?:0[48]|[2468][048]|[13579][26])|(?:0[48]|[2468][048]|[13579][26])00)-02-29) ([0-1]{1}[0-9]{1})|(2[0-4]{1}):[0-5]{1}[0-9]{1}$/;return this.optional(t)||i.test(e)},$.validator.format("请输入正确的日期和时间,格式如XXXX-MM-DD hh:mm"))}}]),e}();new a($("#step2-form"))}]);