{% extends 'old-bootstrap-modal-layout.html.twig' %}

{% block title %}
  {{ 'user.orders.detail.modal_title'|trans }}
{% endblock %}

{% block body %}

  <ul class="nav nav-tabs mbl">
    <li class="active"><a href="#detail" data-toggle="tab">{{ 'order.detail'|trans }}</a></li>
    <li class=""><a href="#log" data-toggle="tab">{{ 'order.log'|trans }}</a></li>
  </ul>

  <div class="tab-content">
    <div class="tab-pane fade active in" id="detail">
      <table class="table cd-table table-striped order-detail-table">
        <tr>
          <td width="25%">{{ 'order.id'|trans }}</td>
          <td width="75%">{{ order.sn }}</td>
        </tr>
        <tr>
          <td width="25%">{{ 'order.status'|trans }}</td>
          <td width="75%">
            {{ display_order_status(order.status) }}
          </td>
        </tr>
        <tr>
          <td width="25%">{{ 'order.name'|trans }}</td>
          <td width="75%">
            {{ order.title }}
          </td>
        </tr>
        <tr>
          <td width="25%">{{ 'order.buyers'|trans }}</td>
          <td width="75%">
            <strong>
              {{ web_macro.user_link(user) }}
            </strong>
          </td>
        </tr>
        <tr>
          <td width="25%">{{ 'order.price_amount'|trans }}</td>
          <td width="75%">
            <span class="color-warning">{{ order.price_amount|fen_to_yuan(0) }}</span>
          </td>
        </tr>

        {% if orderDeducts %}
          <tr>
            <td width="25%">{{ 'order.deduct'|trans}}</td>
            <td width="75%"><span class="color-warning">-{{ (order.price_amount - order.pay_amount)|fen_to_yuan(0) }}</span></td>
          </tr>
          {% for orderDeduct in orderDeducts %}
            <tr>
              <td width="25%" class="text-muted" style="text-align: right">{{ dict_text('orderDeductType', orderDeduct.deduct_type) }}</td>
              <td width="75%"><span class="text-muted">-{{ orderDeduct.deduct_amount|fen_to_yuan(0) }}</span></td>
            </tr>
          {% endfor %}
        {% endif %}

        <tr>
          <td width="25%">{{ 'order.real_pay'|trans }}</td>
          <td width="75%">
            <span class="color-warning">{{ order.pay_amount|fen_to_yuan(0) }}</span>
          </td>
        </tr>

        {% if order.paid_cash_amount %}
          <tr>
            <td width="25%" class="text-muted" style="text-align: right">{{ dict_text('newPayment', order.payment) }}</td>
            <td width="75%">
              <span class="text-muted">{{ order.paid_cash_amount|fen_to_yuan(0) }}</span>
              <span class="text-muted text-sm pull-right">{{ 'order.platform_sn'|trans ~ order.trade_sn }}</span>
            </td>
          </tr>

        {% endif %}

        {% if order.paid_coin_amount %}
          <tr>
            <td width="25%" class="text-muted" style="text-align: right">{{ setting('coin.name', 'finance.coin'|trans) }}</td>
            <td width="75%">
              <span class="text-muted">{{ order.paid_coin_amount|fen_to_yuan(0) }}</span>
            </td>
          </tr>

        {% endif %}

        <tr>
          <td width="25%">{{'order.created_time'|trans}}</td> <td width="75%">{{ order.created_time | date('Y-n-d H:i:s') }}</td>
        </tr>

        {% if order.status == 'paid' %}
          <tr> <td width="25%">{{'order.pay_time'|trans}}</td> <td width="75%">{% if not order.pay_time == 0 %} {{ order.pay_time | date('Y-n-d H:i:s') }} {% endif %}</td> </tr>
        {% endif %}

      </table>
    </div>

    <div class="tab-pane fade" id="log">
      {% if orderLogs %}
        <table class="table cd-table">
          <thead>

          <tr>
            <td width="50%">{{'user.orders.detail.log_info'|trans}}</td>
            <td width="25%">{{'user.orders.detail.operator'|trans}}</td>
            <td width="25%">{{'user.orders.detail.log_createdTime'|trans}}</td>
          </tr>
          </thead>
          <tbody>
          {% for orderLog in orderLogs %}
            {% set logUser = users[orderLog.user_id]|default(null) %}
            <tr>
              <td>
                {{ dict_text('orderLogStatus', orderLog.status) }}
                <br>
                <span class="color-gray text-sm">{{ orderLog.status }}</span>
              </td>
              <td>
                {% if logUser %}
                  {{ web_macro.user_link(logUser) }}
                {% else %}
                  --
                {% endif %}
              </td>
              <td>
                {{ orderLog.created_time|date('Y-n-d H:i')}}
                <br>
                <span class="color-gray text-sm">{{ orderLog.deal_data.ip|default('--')}}</span>
              </td>
            </tr>
          {% endfor %}
          </tbody>
        </table>
      {% else %}
        <div class="cd-empty">{{ 'user.orders.detail.empty'|trans }}</div>
      {% endif %}
    </div>
  </div>
{% endblock %}

{% block footer %}
  <button type="button" class="btn btn-primary" data-dismiss="modal">{{ 'form.btn.close'|trans }}</button>
{% endblock %}

