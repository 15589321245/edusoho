define("chineserp/1.0.0/chineserp",["jquery/1.10.1/jquery"],function(t,n,i){var e=t("jquery/1.10.1/jquery");"indexOf"in Array.prototype||(Array.prototype.indexOf=function(t,n){void 0===n&&(n=0),0>n&&(n+=this.length),0>n&&(n=0);for(var i=this.length;i>n;n++)if(n in this&&this[n]===t)return n;return-1}),"forEach"in Array.prototype||(Array.prototype.forEach=function(t,n){for(var i=0,e=this.length;e>i;i++)i in this&&t.call(n,this[i],i,this)}),"map"in Array.prototype||(Array.prototype.map=function(t,n){for(var i=new Array(this.length),e=0,r=this.length;r>e;e++)e in this&&(i[e]=t.call(n,this[e],e,this));return i}),"filter"in Array.prototype||(Array.prototype.filter=function(t,n){for(var i,e=[],r=0,o=this.length;o>r;r++)r in this&&t.call(n,i=this[r],r,this)&&e.push(i);return e});var r=this,o=r.ChineseRegion={};o.$=e,o._caches={},o.$&&!o.$.getJSON&&r.Ajax&&(o.$.getJSON=function(){var t,n,i=arguments[0];switch(arguments.length){case 2:t=null,n=arguments[1];break;case 3:t=arguments[1],n=arguments[2]}"function"!=typeof n&&(n=function(){});var e=new r.Ajax.Request(i,{method:"get",parameters:t,evalJSON:"force",onSuccess:function(t){n(t.responseJSON)}});return e.transport}),o.getJSON=function(){return o.$.getJSON.apply(o.$,arguments)},o.ifn=function(t){return"function"==typeof t};var c=o.RegionCollection=function(t,n){return this.collection=t||[],this.name=n,this};c.prototype={constructor:c,select:function(t){return this.collection.filter(t)},map:function(t){return this.collection.map(t)},first:function(t){return this.select(t)[0]},findByNames:function(t,n,i){i=i||{},i.key=i.key||"n";var e=[];return t&&(e[0]=this.first(function(n){return n[i.key]===t})||this.collection[0]),n&&e[0]&&e[0].c&&(e[1]=e[0].c.filter(function(t){return t[i.key]===n})[0]||e[0].c[0]),e},findById:function(t){var n=[];return n[0]=this.first(function(n){return n.i===t})||this.first(function(n){return n.i===t.substr(0,4)+"00"})||this.collection[0],n[0]&&n[0].c&&(n[1]=n[0].c.filter(function(n){return n.i===t})[0]||n[0].c[0]),n}};var s=o.DataProxy=function(t,n){return this._remote=(t+"/").replace(/\/+/g,"/"),this.load("index",function(t,i){o.ifn(n)&&n(i,t)}),this};s.prototype={_index:function(t){return t.replace(/\d{4}$/,"0000")},_cacheid:function(t){return"cached_"+this._index(t)},_url:function(t){return this._remote+this._index(t)+".json"},load:function(t,n){var i=this,e=this._cacheid(t);return o.ifn(n)||(n=function(){}),o._caches[e]?void n(new c(o._caches[e],e),i):void o.getJSON(this._url(t),function(t){o._caches[e]=t,n(new c(t,e),i)})},collections:function(){var t=[];for(var n in o._caches)t.push(new c(o._caches[n],n));return t},collection:function(t){var n=this._cacheid(t);return this.collections().filter(function(t){return t.name===n})[0]},indices:function(){return this.collection("index")}};var u=o.RegionPicker=function(t){var n=this;return this.options=t,new s(t.remote||"",function(t){n.initialize(t)}),n};u.prototype={initialize:function(t){this.proxy=t,o.ifn(this.options.initialized)&&this.options.initialized(this)},pick:function(){var t,n=arguments[0],i={};switch(arguments.length){case 2:t=arguments[1];break;case 3:i=arguments[1],t=arguments[2]}o.ifn(t)||(t=function(){});var e=this.proxy;return this.proxy?((null===n||""===n)&&(n=e.indices().collection[0].i),/^\d+$/.test(n)?void this._pickById(n,t):("string"==typeof n&&(n=n.split(/[,\s]+/,3)),void this._pickByNames(n,i,t))):void t([])},_pickedCollections:function(t){if(!t||!t.map)return[];var n=[];return t[0]&&n.push(this.proxy.collection("index").collection),t[1]&&n.push(this.proxy.collection(t[1].i).collection),t[2]&&t[1].c&&n.push(t[1].c),n},_pickById:function(t,n){var i=this,e=this.proxy,r=[];r[0]=e.indices().first(function(n){return n.i===t.substr(0,2)+"0000"}),e.load(t,function(e){r=r.concat(e.findById(t)),n(r,i._pickedCollections(r))})},_pickByNames:function(t,n,i){var e=this,r=this.proxy,o=[];return o[0]=r.indices().first(function(n){return n.n===t[0]}),o[0]?void r.load(o[0].i,function(r){o=o.concat(r.findByNames(t[1],t[2],n)),i(o,e._pickedCollections(o))}):void i([])}},i.exports=o});