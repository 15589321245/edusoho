{"version":3,"sources":["app/Resources/static-src/app/common/widget/delete-action.js"],"names":["DeleteAction","$element","onSuccess","initEvent","on","_itemDelete","event","_batchDelete","$btn","$","currentTarget","name","data","message","self","confirm","post","isFunction","call","closest","remove","window","location","reload","ids","find","each","push","value","length"],"mappings":";;;;;;;;AAAA;;;;;;;;IAEMA,Y;AACJ,wBAAYC,QAAZ,EAAqBC,SAArB,EAAgC;AAAA;;AAC9B,SAAKD,QAAL,GAAgBA,QAAhB;AACA,SAAKC,SAAL,GAAiBA,SAAjB;AACA,SAAKC,SAAL;AACD;;;;gCAEW;AAAA;;AACV,WAAKF,QAAL,CAAcG,EAAd,CAAiB,OAAjB,EAAyB,2BAAzB,EAAsD;AAAA,eAAO,MAAKC,WAAL,CAAiBC,KAAjB,CAAP;AAAA,OAAtD;AACA,WAAKL,QAAL,CAAcG,EAAd,CAAiB,OAAjB,EAAyB,4BAAzB,EAAuD;AAAA,eAAO,MAAKG,YAAL,CAAkBD,KAAlB,CAAP;AAAA,OAAvD;AACD;;;gCAEWA,K,EAAO;AACjB,UAAIE,OAAOC,EAAEH,MAAMI,aAAR,CAAX;;AAEA,UAAIC,OAAOH,KAAKI,IAAL,CAAU,MAAV,CAAX;AACA,UAAIC,UAAUL,KAAKI,IAAL,CAAU,SAAV,CAAd;AACA,UAAIE,OAAO,IAAX;;AAEA,UAAI,CAACD,OAAL,EAAc;AACZA,kBAAU,WAASF,IAAT,GAAc,IAAxB;AACD;;AAED,UAAI,CAACI,QAAQF,OAAR,CAAL,EAAuB;AACrB;AACD;;AAEDJ,QAAEO,IAAF,CAAOR,KAAKI,IAAL,CAAU,KAAV,CAAP,EAAyB,YAAW;AAClC,YAAIH,EAAEQ,UAAF,CAAaH,KAAKZ,SAAlB,CAAJ,EAAkC;AAChCY,eAAKZ,SAAL,CAAegB,IAAf,CAAoBJ,KAAKb,QAAzB;AACD,SAFD,MAEO;AACLO,eAAKW,OAAL,CAAa,kBAAb,EAAiCC,MAAjC;AACA,gCAAO,SAAP,EAAkB,MAAlB;AACAC,iBAAOC,QAAP,CAAgBC,MAAhB;AACD;AACF,OARD;AASD;;;iCAEYjB,K,EAAO;AAClB,UAAIE,OAAOC,EAAEH,MAAMI,aAAR,CAAX;AACA,UAAIC,OAAOH,KAAKI,IAAL,CAAU,MAAV,CAAX;;AAEA,UAAIY,MAAM,EAAV;AACA,WAAKvB,QAAL,CAAcwB,IAAd,CAAmB,kCAAnB,EAAuDC,IAAvD,CAA4D,YAAU;AACpEF,YAAIG,IAAJ,CAAS,KAAKC,KAAd;AACD,OAFD;;AAIA,UAAIJ,IAAIK,MAAJ,IAAc,CAAlB,EAAqB;AACnB,8BAAO,QAAP,EAAiB,UAAQlB,IAAzB;AACA;AACD;;AAED,UAAI,CAACI,QAAQ,cAAYJ,IAAZ,GAAiB,IAAzB,CAAL,EAAqC;AACjC;AACH;;AAED,4BAAO,MAAP,EAAe,SAAf;;AAEAF,QAAEO,IAAF,CAAOR,KAAKI,IAAL,CAAU,KAAV,CAAP,EAAyB,EAACY,KAAIA,GAAL,EAAzB,EAAoC,YAAU;AAC5CH,eAAOC,QAAP,CAAgBC,MAAhB;AACD,OAFD;AAGD;;;;;;kBAGYvB,Y","file":"delete-action.js","sourceRoot":"/Users/kz/projects/edusoho","sourcesContent":["import notify from 'common/notify';\n\nclass DeleteAction {\n  constructor($element,onSuccess) {\n    this.$element = $element;\n    this.onSuccess = onSuccess;\n    this.initEvent();\n  }\n\n  initEvent() {\n    this.$element.on('click','[data-role=\"item-delete\"]', event=>this._itemDelete(event));\n    this.$element.on('click','[data-role=\"batch-delete\"]', event=>this._batchDelete(event));\n  }\n\n  _itemDelete(event) {\n    let $btn = $(event.currentTarget);\n\n    let name = $btn.data('name');\n    let message = $btn.data('message');\n    let self = this;\n\n    if (!message) {\n      message = '真的要删除该'+name+'吗？';\n    }\n\n    if (!confirm(message)) {\n      return ;\n    }\n\n    $.post($btn.data('url'), function() {\n      if ($.isFunction(self.onSuccess)) {\n        self.onSuccess.call(self.$element);\n      } else {\n        $btn.closest('[data-role=item]').remove();\n        notify('success', \"删除成功\");\n        window.location.reload();\n      }\n    });\n  }\n\n  _batchDelete(event) {\n    let $btn = $(event.currentTarget);\n    let name = $btn.data('name');\n\n    let ids = [];\n    this.$element.find('[data-role=\"batch-item\"]:checked').each(function(){\n      ids.push(this.value);\n    });\n\n    if (ids.length == 0) {\n      notify('danger', '未选中任何'+name);\n      return ;\n    }\n\n    if (!confirm('确定要删除选中的条'+name+'吗？')) {\n        return ;\n    }\n\n    notify('info', '正在删除...');\n\n    $.post($btn.data('url'), {ids:ids}, function(){\n      window.location.reload();\n    });\n  }\n}\n\nexport default DeleteAction;"]}