{"version":3,"sources":["app/Resources/static-src/app/common/messenger.js"],"names":["EsMessenger","options","name","project","children","type","setup","messenger","addTarget","window","parent","self","i","length","contentWindow","id","listen","msg","JSON","parse","emit","eventName","args","target","targets","send","convertToString","child","stringify"],"mappings":";;;;;;;;AAAA;;;;AACA;;;;;;;;;;;;IAEqBA,W;;;AACnB,uBAAYC,OAAZ,EAAqB;AAAA;;AAAA;;AAGnB,UAAKC,IAAL,GAAYD,QAAQC,IAApB;AACA,UAAKC,OAAL,GAAeF,QAAQE,OAAvB;AACA,UAAKC,QAAL,GAAgBH,QAAQG,QAAxB;AACA,UAAKC,IAAL,GAAYJ,QAAQI,IAApB,CANmB,CAMO;AAC1B,UAAKC,KAAL;AAPmB;AAQpB;;;;4BAEO;AAAA;;AACN,UAAIC,YAAY,0BAAc,KAAKL,IAAnB,EAAyB,KAAKC,OAA9B,CAAhB;AACA,UAAI,KAAKE,IAAL,IAAa,OAAjB,EAA0B;AAAE;AAC1BE,kBAAUC,SAAV,CAAoBC,OAAOC,MAA3B,EAAmC,QAAnC;AACAH,kBAAUC,SAAV,CAAoBC,OAAOE,IAA3B,EAAiC,SAAjC;AACD,OAHD,MAGO,IAAI,KAAKN,IAAL,IAAa,QAAjB,EAA2B;AAChCE,kBAAUC,SAAV,CAAoBC,OAAOE,IAA3B,EAAiC,OAAjC;AACA,YAAIP,WAAW,KAAKA,QAApB;AACA,aAAK,IAAIQ,IAAIR,SAASS,MAAT,GAAkB,CAA/B,EAAkCD,KAAK,CAAvC,EAA0CA,GAA1C,EAA+C;AAC7CL,oBAAUC,SAAV,CAAoBJ,SAASQ,CAAT,EAAYE,aAAhC,EAA+CV,SAASQ,CAAT,EAAYG,EAA3D;AACD;AACF;;AAEDR,gBAAUS,MAAV,CAAiB,UAACC,GAAD,EAAS;AACxBA,cAAMC,KAAKC,KAAL,CAAWF,GAAX,CAAN;AACA,eAAKG,IAAL,CAAUH,IAAII,SAAd,EAAyBJ,IAAIK,IAA7B;AACD,OAHD;AAIA,WAAKf,SAAL,GAAiBA,SAAjB;AAED;;;iCAEYc,S,EAAWC,I,EAAM;AAC5B,WAAK,IAAIC,MAAT,IAAmB,KAAKhB,SAAL,CAAeiB,OAAlC,EAA2C;AACzC,aAAKjB,SAAL,CAAeiB,OAAf,CAAuBD,MAAvB,EAA+BE,IAA/B,CACE,KAAKC,eAAL,CAAqBL,SAArB,EAAgCC,IAAhC,CADF;AAGD;AACF;;;gCAEWK,K,EAAON,S,EAAWC,I,EAAM;AAClC,WAAKf,SAAL,CAAeiB,OAAf,CAAuBG,MAAMZ,EAA7B,EAAiCU,IAAjC,CACE,KAAKC,eAAL,CAAqBL,SAArB,EAAgCC,IAAhC,CADF;AAGD;;;oCAEeD,S,EAAWC,I,EAAM;AAC/B,UAAIL,MAAM,EAAC,aAAaI,SAAd,EAAyB,QAAQC,IAAjC,EAAV;AACAL,YAAMC,KAAKU,SAAL,CAAeX,GAAf,CAAN;AACA,aAAOA,GAAP;AACD;;;;;;kBAlDkBjB,W","file":"messenger.js","sourceRoot":"/Users/kz/projects/edusoho","sourcesContent":["import Messenger from 'es-messenger';\nimport Emitter from \"component-emitter\";\n\nexport default class EsMessenger extends Emitter {\n  constructor(options) {\n    super();\n\n    this.name = options.name;\n    this.project = options.project;\n    this.children = options.children;\n    this.type = options.type; //enum: parent,child\n    this.setup();\n  }\n\n  setup() {\n    var messenger = new Messenger(this.name, this.project);\n    if (this.type == 'child') { //同时广播同域和者跨域\n      messenger.addTarget(window.parent, 'parent');\n      messenger.addTarget(window.self, 'partner');\n    } else if (this.type == 'parent') {\n      messenger.addTarget(window.self, 'child');\n      var children = this.children;\n      for (var i = children.length - 1; i >= 0; i--) {\n        messenger.addTarget(children[i].contentWindow, children[i].id);\n      }\n    }\n\n    messenger.listen((msg) => {\n      msg = JSON.parse(msg);\n      this.emit(msg.eventName, msg.args);\n    });\n    this.messenger = messenger;\n\n  }\n\n  sendToParent(eventName, args) {\n    for (var target in this.messenger.targets) {\n      this.messenger.targets[target].send(\n        this.convertToString(eventName, args)\n      );\n    }\n  }\n\n  sendToChild(child, eventName, args) {\n    this.messenger.targets[child.id].send(\n      this.convertToString(eventName, args)\n    );\n  }\n\n  convertToString(eventName, args) {\n    var msg = {\"eventName\": eventName, \"args\": args};\n    msg = JSON.stringify(msg);\n    return msg;\n  }\n\n}"]}