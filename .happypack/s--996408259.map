{"version":3,"sources":["app/Resources/static-src/app/js/activity-manage/homework/create.js"],"names":["Homework","$iframeContent","$homeworkModal","$","window","parent","document","$questionPickedModal","$element","$step2_form","find","$step3_form","init","initEvent","setValidateRule","inItStep2form","on","showPickQuestion","event","hide","show","html","validator","editor","CKEDITOR","replace","toolbar","filebrowserImageUploadUrl","data","val","getData","form","preventDefault","$btn","currentTarget","excludeIds","each","push","modal","get","join","validate","onkeyup","rules","title","required","maxlength","trim","description","content","messages","initCkeditor","addMethod","value","element","optional","test","format","reg"],"mappings":"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","file":"create.js","sourceRoot":"/Users/kz/projects/edusoho","sourcesContent":["export default class Homework {\n  constructor($iframeContent) {\n    this.$homeworkModal = $('#modal', window.parent.document);\n    this.$questionPickedModal = $('#attachment-modal', window.parent.document);\n    this.$element = $iframeContent;\n    this.$step2_form = this.$element.find('#step2-form');\n    this.$step3_form = this.$element.find('#step3-form');\n    this.init();\n  }\n\n  init() {\n    this.initEvent();\n    this.setValidateRule();\n    this.inItStep2form();\n  }\n\n  initEvent() {\n    this.$element.on('click', '[data-role=\"pick-item\"]', event => this.showPickQuestion(event));\n    this.$questionPickedModal.on('shown.bs.modal', () => {\n      this.$homeworkModal.hide();\n    });\n    this.$questionPickedModal.on('hidden.bs.modal', () => {\n      this.$homeworkModal.show();\n      this.$questionPickedModal.html('');\n    });\n  }\n\n  initCkeditor(validator) {\n    let editor = CKEDITOR.replace('homework-about-field', {\n      toolbar: 'Minimal',\n      filebrowserImageUploadUrl: $('#homework-about-field').data('imageUploadUrl'),\n    });\n    editor.on('change', () => {\n      $('#homework-about-field').val(editor.getData());\n    });\n    editor.on('blur', () =>  {\n      validator.form();\n    });\n  }\n\n  showPickQuestion(event) {\n    event.preventDefault();\n    let $btn = $(event.currentTarget);\n    let excludeIds = [];\n    $(\"#question-table-tbody\").find('[name=\"questionIds[]\"]').each(function () {\n      excludeIds.push($(this).val());\n    });\n    this.$questionPickedModal.modal().data('manager', this);\n    $.get($btn.data('url'), {\n      excludeIds: excludeIds.join(',')\n    }, html => {\n      this.$questionPickedModal.html(html);\n    });\n  }\n\n  inItStep2form() {\n    var validator = this.$step2_form.validate({\n      onkeyup: false,\n      rules: {\n        title: {\n          required: true,\n          maxlength: 50,\n          trim: true,\n        },\n        description: {\n          required: true\n        },\n        content: 'required',\n        'questionLength': {\n          required: true\n        },\n      },\n      messages: {\n        'questionLength': \"请选择题目\",\n      },\n    });\n    this.initCkeditor(validator);\n    this.$step2_form.data('validator', validator);\n  }\n\n  setValidateRule() {\n    $.validator.addMethod(\"arithmeticFloat\", function (value, element) {\n      return this.optional(element) || /^[0-9]+(\\.[0-9]?)?$/.test(value);\n    }, $.validator.format(\"必须为正数，保留一位小数\"));\n\n    $.validator.addMethod(\"positiveInteger\", function (value, element) {\n      return this.optional(element) || /^[1-9]\\d*$/.test(value);\n    }, $.validator.format(\"必须为正整数\"));\n\n    $.validator.addMethod(\"DateAndTime\", function (value, element) {\n      let reg = /^(?:(?!0000)[0-9]{4}-(?:(?:0[1-9]|1[0-2])-(?:0[1-9]|1[0-9]|2[0-8])|(?:0[13-9]|1[0-2])-(?:29|30)|(?:0[13578]|1[02])-31)|(?:[0-9]{2}(?:0[48]|[2468][048]|[13579][26])|(?:0[48]|[2468][048]|[13579][26])00)-02-29) ([0-1]{1}[0-9]{1})|(2[0-4]{1}):[0-5]{1}[0-9]{1}$/;\n      return this.optional(element) || reg.test(value);\n    }, $.validator.format(\"请输入正确的日期和时间,格式如XXXX-MM-DD hh:mm\"));\n  }\n}\n"]}