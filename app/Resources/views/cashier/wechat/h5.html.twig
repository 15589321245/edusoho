<html>
  <script type="text/javascript">
    var goto = {{ trade.successUrl }};
    var jsApiParams = {{ trade.jsApiParams }};
    if (typeof WeixinJSBridge == "undefined") {
      if (document.addEventListener) {
        document.addEventListener('WeixinJSBridgeReady', jsApiCall, false);
      } else if (document.attachEvent) {
        document.attachEvent('WeixinJSBridgeReady', jsApiCall);
        document.attachEvent('onWeixinJSBridgeReady', jsApiCall);
      }
    } else {
      jsApiCall();
    }

    //调用微信JS api 支付
    function jsApiCall() {
      WeixinJSBridge.invoke(
        'getBrandWCPayRequest',
        jsApiParams,
        function (res) {
          if (res.err_msg == 'get_brand_wcpay_request:ok') {
            window.location.href = goto;
          } else {
            if (res.err_msg == 'get_brand_wcpay_request:fail') {
              alert('error');
            } else if (res.err_msg == 'get_brand_wcpay_request:cancel') {
              // alert('取消')
            }
          }

        }
      );
    }
  </script>
</html>


