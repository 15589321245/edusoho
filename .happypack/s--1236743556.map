{"version":3,"sources":["app/Resources/static-src/app/js/testpaper/widget/do-test-base.js"],"names":["DoTestBase","$container","answers","usedTime","$form","find","_initEvent","_initUsedTimer","_isCopy","_alwaysSave","on","_showEssayInputEditor","event","_btnSubmit","_choiceList","_quick2Question","_choiceLable","_markingToggle","_favoriteToggle","_analysisToggle","fillChange","isCopy","data","$input","$","currentTarget","_renderBtnIndex","attr","val","$current","addClass","siblings","removeClass","id","closest","toggleClass","targetType","targetId","post","response","url","error","message","slideToggle","self","$usedTimer","window","setInterval","$target","$lableContent","changeInput","index","eq","prop","change","num","each","item","questionId","idNum","done","doing","$btn","$shortTextarea","hasClass","preventDefault","stopPropagation","blur","$longTextarea","$textareaBtn","hide","show","editor","CKEDITOR","replace","toolbar","filebrowserImageUploadUrl","updateElement","setTimeout","getData","e","focus","one","text","destroy","position","offset","document","scrollTop","top","button","_submitTest","toUrl","values","emitter","type","questionTypeBuilder","getTypeBuilder","answer","getAnswer","result","emit","goto","location","href","length","currentTime","Date","getHours","getMinutes","getSeconds"],"mappings":"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","file":"do-test-base.js","sourceRoot":"/Users/kz/projects/edusoho","sourcesContent":["import QuestionTypeBuilder from './question-type-builder';\nimport CopyDeny from './copy-deny';\nimport ActivityEmitter from \"../../activity/activity-emitter\";\nimport notify from \"common/notify\";\n\nclass DoTestBase\n{\n  constructor($container) {\n    this.$container = $container;\n    this.answers = {};\n    this.usedTime = 0;\n    this.$form = $container.find('form');\n    this._initEvent();\n    this._initUsedTimer();\n    this._isCopy();\n    this._alwaysSave();\n  }\n\n  _initEvent() {\n    this.$container.on('focusin','textarea',event=>this._showEssayInputEditor(event));\n    this.$container.on('click','[data-role=\"test-suspend\"],[data-role=\"paper-submit\"]',event=>this._btnSubmit(event));\n    this.$container.on('click','.js-testpaper-question-list li',event=>this._choiceList(event));\n    this.$container.on('click','*[data-anchor]',event=>this._quick2Question(event));\n    this.$container.find('.js-testpaper-question-label').on('click','input',event=>this._choiceLable(event));\n    this.$container.on('click','.js-marking',event=>this._markingToggle(event));\n    this.$container.on('click','.js-favorite',event=>this._favoriteToggle(event));\n    this.$container.on('click','.js-analysis',event=>this._analysisToggle(event));\n    this.$container.on('blur','[data-type=\"fill\"]',event=>this.fillChange(event));\n  }\n\n  _isCopy() {\n    let isCopy = this.$container.find('.js-testpaper-body').data('copy');\n    if (isCopy) {\n      new CopyDeny();\n    }\n  }\n\n  fillChange(event) {\n    let $input = $(event.currentTarget);\n    this._renderBtnIndex($input.attr('name'),$input.val()? true:false);\n  }\n\n  _markingToggle(event) {\n    let $current = $(event.currentTarget).addClass('hidden');\n    $current.siblings('.js-marking.hidden').removeClass('hidden');\n    let id = $current.closest('.js-testpaper-question').attr('id');\n    \n    $(`[data-anchor=\"#${id}\"]`).find('.js-marking-card').toggleClass(\"hidden\");\n  }\n\n  _favoriteToggle(event) {\n    let $current = $(event.currentTarget);\n    let targetType = $current.data('targetType');\n    let targetId = $current.data('targetId');\n\n    $.post($current.data('url'),{targetType:targetType, targetId:targetId},function (response) {\n      $current.addClass('hidden').siblings('.js-favorite.hidden').data('url',response.url);  \n      $current.addClass('hidden').siblings('.js-favorite.hidden').removeClass('hidden');\n    })\n    .error(function(response){\n      notify('error', response.error.message);\n    })\n  }\n\n  _analysisToggle(event) {\n    let $current = $(event.currentTarget);\n    $current.addClass('hidden');\n    $current.siblings('.js-analysis.hidden').removeClass('hidden');\n    $current.closest('.js-testpaper-question').find('.js-testpaper-question-analysis').slideToggle();\n  }\n\n  _initUsedTimer() {\n    let self = this;\n    this.$usedTimer = window.setInterval(() =>{\n      self.usedTime += 1;\n    }, 1000);\n  }\n\n  _choiceLable(event) {\n    let $target = $(event.currentTarget);\n    let $lableContent = $target.closest('.js-testpaper-question-label');\n    this.changeInput($lableContent,$target);\n  }\n \n  _choiceList(event) {\n    let $target = $(event.currentTarget);\n    let index = $target.index();\n    let $lableContent = $target.closest('.js-testpaper-question').find('.js-testpaper-question-label');\n    let $input = $lableContent.find('label').eq(index).find('input');\n    $input.prop('checked', !$input.prop('checked')).change();\n    this.changeInput($lableContent,$input);\n  }\n\n  changeInput($lableContent,$input) {\n    let num = 0;\n    $lableContent.find('label').each(function (index,item) {\n      if($(item).find('input').prop('checked')) {\n        $(item).addClass('active');\n        num ++;\n      }else {\n        $(item).removeClass('active');\n      }\n    })\n    let questionId = $input.attr('name');\n    this._renderBtnIndex(questionId,num>0?true:false)\n  }\n\n   _renderBtnIndex(idNum,done = true,doing = false) {\n    let $btn = $(`[data-anchor=\"#question${idNum}\"]`);\n    if(done) {\n      $btn.addClass('done');\n    }else {\n      $btn.removeClass('done');\n    }\n    if(doing) {\n      $btn.addClass('doing').siblings('.doing').removeClass('doing');\n    }else {\n      $btn.removeClass('doing')\n    }\n  }\n  _showEssayInputEditor(event) {\n    let $shortTextarea = $(event.currentTarget);\n\n    if ($shortTextarea.hasClass('essay-input-short')) {\n      \n      event.preventDefault();\n      event.stopPropagation();\n      $(this).blur();\n      let $longTextarea = $shortTextarea.siblings('.essay-input-long');\n      let $textareaBtn = $longTextarea.siblings('.essay-input-btn');\n\n      $shortTextarea.hide();\n      $longTextarea.show();\n      $textareaBtn.show();\n\n      let editor = CKEDITOR.replace($longTextarea.attr('id'), {\n        toolbar: 'Minimal',\n        filebrowserImageUploadUrl: $longTextarea.data('imageUploadUrl')\n      });\n\n      editor.on('blur', e => {\n        editor.updateElement();\n        setTimeout(()=>{\n          $longTextarea.val(editor.getData());\n          $longTextarea.change();\n          $longTextarea.val() ? this._renderBtnIndex($longTextarea.attr('name'),true) : this._renderBtnIndex($longTextarea.attr('name'),false);\n        }, 1);\n      });\n\n      editor.on('instanceReady', function(e) {\n        this.focus();\n\n        $textareaBtn.one('click', function() {\n          $shortTextarea.val($(editor.getData()).text());\n          editor.destroy();\n          $longTextarea.hide();\n          $textareaBtn.hide();\n          $shortTextarea.show();\n        });\n      });\n\n      editor.on('key', function(){\n        editor.updateElement();\n        setTimeout(function() {\n          $longTextarea.val(editor.getData());\n          $longTextarea.change();\n        }, 1);\n      });\n\n      editor.on('insertHtml', function(e) {\n        editor.updateElement();\n        setTimeout(function() {\n          $longTextarea.val(editor.getData());\n          $longTextarea.change();\n        }, 1);\n      });\n    }\n    \n  }\n\n  _quick2Question(event) {\n    let $target = $(event.currentTarget); \n    let position = $($target.data('anchor')).offset();\n    $(document).scrollTop(position.top - 55);\n  }\n\n  _btnSubmit(event) {\n    let $target = $(event.currentTarget);\n    $target.button('loading');\n    this._submitTest($target.data('url'), $target.data('goto'));\n  }\n\n  _submitTest(url,toUrl='') {\n    let values = {};\n    let emitter = new ActivityEmitter();\n\n    $('*[data-type]').each(function(index){\n      let questionId = $(this).attr('name');\n      let type = $(this).data('type');\n      const questionTypeBuilder = QuestionTypeBuilder.getTypeBuilder(type);\n      let answer = questionTypeBuilder.getAnswer(questionId);\n      values[questionId] = answer;\n    })\n\n    $.post(url,{data:values,usedTime:this.usedTime})\n    .done((response) => {\n      if (response.result) {\n        emitter.emit('finish');\n      }\n\n      if (toUrl != '' || response.goto != '') {\n        window.location.href = toUrl;\n      } else if (response.goto != ''){\n        window.location.href = response.goto;\n      } else if (response.message != '') {\n        notify('error', response.message);\n      }\n    })\n    .error(function (response) {\n      notify('error', response.error.message);\n    });\n  }\n\n  _alwaysSave() {\n    if ($('input[name=\"testSuspend\"]').length > 0) {\n      let self = this;\n      let url = $('input[name=\"testSuspend\"]').data('url');\n      setInterval(function(){\n        self._submitTest(url);\n        let currentTime = new Date().getHours()+ ':' + new Date().getMinutes()+ ':' +new Date().getSeconds();\n        notify('success',currentTime + ' 已保存');\n      }, 5 * 60 * 1000);\n    }\n  }\n\n}\n\n//临时方案，libs/vendor.js这个方法没有起作用\n/*$(document).ajaxSend(function(a, b, c) {\n  if (c.type == 'POST') {\n    b.setRequestHeader('X-CSRF-Token', $('meta[name=csrf-token]').attr('content'));\n  }\n});*/\n\nexport default DoTestBase;"]}