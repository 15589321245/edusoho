webpackJsonp(["app/js/activity-manage/homework/index"],[function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_batchSelect=__webpack_require__("de585ca0d3c2d0205c51"),_batchSelect2=_interopRequireDefault(_batchSelect),_deleteAction=__webpack_require__("f637e828bcb096623369"),_deleteAction2=_interopRequireDefault(_deleteAction),_questionOperate=__webpack_require__("1e0cf618bc778b8ab554"),Homework=function(){function Homework($iframeContent){_classCallCheck(this,Homework),this.$homeworkModal=$("#modal",window.parent.document),this.$questionPickedModal=$("#attachment-modal",window.parent.document),this.$element=$iframeContent,this.$step2_form=this.$element.find("#step2-form"),this.$step3_form=this.$element.find("#step3-form"),this._init()}return _createClass(Homework,[{key:"_init",value:function(){this._initEvent(),this._initCkeditor(),this._setValidateRule(),this._inItStep2form()}},{key:"_initEvent",value:function(){var _this=this;this.$element.on("click",'[data-role="pick-item"]',function(event){return _this._showPickQuestion(event)}),this.$questionPickedModal.on("shown.bs.modal",function(){_this.$homeworkModal.hide()}),this.$questionPickedModal.on("hidden.bs.modal",function(){_this.$homeworkModal.show()})}},{key:"_initCkeditor",value:function(){var editor=CKEDITOR.replace("homework-about-field",{toolbar:"Minimal",filebrowserImageUploadUrl:$("#homework-about-field").data("imageUploadUrl")});editor.on("change",function(){$("#homework-about-field").val(editor.getData())})}},{key:"_showPickQuestion",value:function(event){var _this2=this;event.preventDefault();var $btn=$(event.currentTarget),excludeIds=[];$("#question-table-tbody").find('[name="questionIds[]"]').each(function(){excludeIds.push($(this).val())}),this.$questionPickedModal.modal().data("manager",this),$.get($btn.data("url"),{excludeIds:excludeIds.join(",")},function(html){_this2.$questionPickedModal.html(html)})}},{key:"_inItStep2form",value:function(){var validator=this.$step2_form.validate({onkeyup:!1,rules:{title:{required:!0},questionLength:{required:!0}},messages:{questionLength:"请选择题目"}});this.$step2_form.data("validator",validator)}},{key:"_inItStep3form",value:function(){var validator=this.$step3_form.validate({onkeyup:!1,rules:{title:{required:!0},checkType:{required:!0},finishCondition:{required:!0}},messages:{title:"请填写标题",checkType:"考评方式",finishCondition:"请选择完成条件"}});this.$step3_form.data("validator",validator)}},{key:"_setValidateRule",value:function(){$.validator.addMethod("arithmeticFloat",function(value,element){return this.optional(element)||/^[0-9]+(\.[0-9]?)?$/.test(value)},$.validator.format("必须为正数，保留一位小数")),$.validator.addMethod("positiveInteger",function(value,element){return this.optional(element)||/^[1-9]\d*$/.test(value)},$.validator.format("必须为正整数")),$.validator.addMethod("DateAndTime",function(value,element){var reg=/^(?:(?!0000)[0-9]{4}-(?:(?:0[1-9]|1[0-2])-(?:0[1-9]|1[0-9]|2[0-8])|(?:0[13-9]|1[0-2])-(?:29|30)|(?:0[13578]|1[02])-31)|(?:[0-9]{2}(?:0[48]|[2468][048]|[13579][26])|(?:0[48]|[2468][048]|[13579][26])00)-02-29) ([0-1]{1}[0-9]{1})|(2[0-4]{1}):[0-5]{1}[0-9]{1}$/;return this.optional(element)||reg.test(value)},$.validator.format("请输入正确的日期和时间,格式如XXXX-MM-DD hh:mm"))}}]),Homework}();new Homework($("#iframe-content")),new _batchSelect2["default"]($("#step2-form")),new _deleteAction2["default"]($("#step2-form")),(0,_questionOperate.deleteQuestion)($("#step2-form")),(0,_questionOperate.replaceQuestion)($("#step2-form"),$("#attachment-modal",window.parent.document)),(0,_questionOperate.previewQuestion)($("#step2-form"))}]);