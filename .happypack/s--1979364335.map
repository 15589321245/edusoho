{"version":3,"sources":["app/Resources/static-src/app/js/activity/live/index.js"],"names":["Live","init","self","isLiveRoomOpened","intervalId","tryCount","setInterval","clearInterval","html","Translator","trans","$","ajax","url","data","success","error","roomUrl","triggerLiveEvent","eventName","eventTrigger","length","attr","type","response","live_end"],"mappings":";;;;;;IAAMA,I;AACJ,kBAAc;AAAA;;AACZ,SAAKC,IAAL;AACD;;;;2BAEM;AACL,UAAIC,OAAO,IAAX;AACA,WAAKC,gBAAL,GAAwB,KAAxB;AACA,UAAIC,aAAa,CAAjB;AACA,UAAIC,WAAW,CAAf;AACAD,mBAAaE,YAAY,YAAW;AAClC,YAAID,WAAW,EAAf,EAAmB;AACjBE,wBAAcH,UAAd;AACA,cAAII,OAAOC,WAAWC,KAAX,CAAiB,kBAAjB,IAAuC,kDAAvC,GAA4FD,WAAWC,KAAX,CAAiB,IAAjB,CAA5F,GAAqH,MAArH,GAA8HD,WAAWC,KAAX,CAAiB,GAAjB,CAA9H,GAAsJ,uCAAtJ,GAAgMD,WAAWC,KAAX,CAAiB,IAAjB,CAAhM,GAAyN,MAApO;AACAC,YAAE,QAAF,EAAYH,IAAZ,CAAiBA,IAAjB;AACA;AACD;AACDG,UAAEC,IAAF,CAAO;AACLC,eAAKF,EAAE,QAAF,EAAYG,IAAZ,CAAiB,KAAjB,CADA;AAELC,mBAAS,iBAASD,IAAT,EAAe;AACtB,gBAAIA,KAAKE,KAAT,EAAgB;AACdT,4BAAcH,UAAd;AACA,kBAAII,QAAOM,KAAKE,KAAL,GAAaP,WAAWC,KAAX,CAAiB,GAAjB,CAAb,GAAqC,kDAArC,GAA0FD,WAAWC,KAAX,CAAiB,IAAjB,CAA1F,GAAmH,4CAAnH,GAAkKD,WAAWC,KAAX,CAAiB,IAAjB,CAAlK,GAA2L,MAAtM;AACAC,gBAAE,QAAF,EAAYH,IAAZ,CAAiBA,KAAjB;AACA;AACD;;AAED,gBAAIM,KAAKG,OAAT,EAAkB;AAChBV,4BAAcH,UAAd;AACAF,mBAAKC,gBAAL,GAAwB,IAAxB;AACA,kBAAIK,SAAO,mCAAmCM,KAAKG,OAAxC,GAAkD,2GAA7D;AACAN,gBAAE,MAAF,EAAUH,IAAV,CAAeA,MAAf;AACD;AACDH;AACD,WAjBI;AAkBLW,iBAAO,iBAAW;AAChB,gBAAIR,OAAO,oHAAX;AACAG,cAAE,QAAF,EAAYH,IAAZ,CAAiBA,IAAjB;AACD;AArBI,SAAP;AAuBD,OA9BY,EA8BV,IA9BU,CAAb;;AAgCA,WAAKU,gBAAL;AACD;;;uCAEkB;AACjB,UAAIhB,OAAO,IAAX;;AAEA,UAAIiB,YAAY,IAAhB;AACA,UAAIC,eAAed,YAAY,YAAW;AACxC,YAAI,CAACJ,KAAKC,gBAAN,IAA0BQ,EAAE,0BAAF,EAA8BU,MAA9B,IAAwC,CAAtE,EAAyE;AACzEF,oBAAYA,YAAY,OAAZ,GAAsB,OAAlC;AACAR,UAAEC,IAAF,CAAO;AACLC,eAAKF,EAAE,0BAAF,EAA8BW,IAA9B,CAAmC,SAAnC,CADA;AAELC,gBAAM,KAFD;AAGLT,gBAAM,EAAEK,WAAWA,SAAb,EAHD;AAILJ,mBAAS,iBAASS,QAAT,EAAmB;AAC1B,gBAAIA,SAASC,QAAb,EAAuB;AACrBlB,4BAAca,YAAd;AACD;AACF;AARI,SAAP;AAUD,OAbkB,EAahB,KAbgB,CAAnB;AAeD;;;;;;AAGH,IAAIpB,IAAJ","file":"index.js","sourceRoot":"/Users/kz/projects/edusoho","sourcesContent":["class Live {\n  constructor() {\n    this.init();\n  }\n\n  init() {\n    let self = this;\n    this.isLiveRoomOpened = false;\n    let intervalId = 0;\n    let tryCount = 1;\n    intervalId = setInterval(function() {\n      if (tryCount > 10) {\n        clearInterval(intervalId);\n        let html = Translator.trans('进入直播教室错误，请联系管理员，') + \"<a href='javascript:document.location.reload()'>\" + Translator.trans('重试') + \"</a>\" + Translator.trans('或') + \"<a href='javascript:window.close();'>\" + Translator.trans('关闭') + \"</a>\";\n        $(\"#entry\").html(html);\n        return;\n      }\n      $.ajax({\n        url: $(\"#entry\").data(\"url\"),\n        success: function(data) {\n          if (data.error) {\n            clearInterval(intervalId);\n            let html = data.error + Translator.trans('，') + \"<a href='javascript:document.location.reload()'>\" + Translator.trans('重试') + \"</a>或<a href='javascript:window.close();'>\" + Translator.trans('关闭') + \"</a>\";\n            $(\"#entry\").html(html);\n            return;\n          }\n\n          if (data.roomUrl) {\n            clearInterval(intervalId);\n            self.isLiveRoomOpened = true;\n            let html = '<iframe name=\"classroom\" src=\"' + data.roomUrl + '\" style=\"position:absolute; left:0; top:0; height:100%; width:100%; border:0px;\" scrolling=\"no\"></iframe>';\n            $(\"body\").html(html);\n          }\n          tryCount++;\n        },\n        error: function() {\n          let html = \"进入直播教室错误，请联系管理员，<a href='javascript:document.location.reload()'>重试</a>或<a href='javascript:window.close();'>关闭</a>\"\n          $(\"#entry\").html(html);\n        }\n      })\n    }, 3000);\n\n    this.triggerLiveEvent();\n  }\n\n  triggerLiveEvent() {\n    let self = this;\n    \n    let eventName = null;\n    let eventTrigger = setInterval(function() {\n      if (!self.isLiveRoomOpened || $('meta[name=\"trigger_url\"]').length == 0) return;\n      eventName = eventName ? 'doing' : 'start';\n      $.ajax({\n        url: $('meta[name=\"trigger_url\"]').attr('content'),\n        type: 'GET',\n        data: { eventName: eventName },\n        success: function(response) {\n          if (response.live_end) {\n            clearInterval(eventTrigger);\n          }\n        }\n      });\n    }, 60000);\n\n  }\n}\n\nnew Live();\n"]}