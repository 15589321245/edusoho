{"version":3,"sources":["webpack:///./app/Resources/static-src/app/js/cashier/coin.js?8973","webpack:///./app/Resources/static-src/app/js/cashier/mobile/index.js"],"names":["Coin","props","$container","$coinContainer","cashierForm","$form","priceType","data","coinRate","maxCoinInput","initEvent","on","changeAmount","event","$this","$","currentTarget","inputCoinNum","val","parseFloat","toFixed","isNaN","removePasswordValidate","trigger","calcPayPrice","addPasswordValidate","coinName","price","originalPirce","coinPrice","Translator","trans","find","rules","CashierForm","validator","validate","initCoin","$coin","length","coin","coinAmount","self","post","text","resp","hasClass","addClass","siblings","removeClass","attr","valid","submit"],"mappings":"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","file":"app/js/cashier/mobile/index.js","sourcesContent":["export default class Coin {\n  constructor(props) {\n    this.$container = props.$coinContainer;\n    this.cashierForm = props.cashierForm;\n    this.$form = props.$form;\n    this.priceType = this.$container.data('priceType');\n    this.coinRate = this.$container.data('coinRate');\n    this.maxCoinInput = this.$container.data('maxAllowCoin') > this.$container.data('coinBalance') ? \n                        this.$container.data('coinBalance') : this.$container.data('maxAllowCoin');\n    this.initEvent();\n  }\n\n  initEvent() {\n    this.$form.on('change', '.js-coin-amount', event => this.changeAmount(event));\n  }\n\n  changeAmount(event) {\n    let $this = $(event.currentTarget);\n    let inputCoinNum = $this.val();\n    $this.val(parseFloat(inputCoinNum).toFixed(2));\n\n    if (isNaN(inputCoinNum) || inputCoinNum <= 0) {\n      inputCoinNum = 0;\n      $this.val(parseFloat(inputCoinNum).toFixed(2));\n      this.removePasswordValidate();\n      \n      this.$form.trigger('removePriceItem', ['coin-price']);\n      this.cashierForm.calcPayPrice(inputCoinNum);\n    }\n    if (inputCoinNum > this.maxCoinInput) {\n      inputCoinNum = this.maxCoinInput;\n      $this.val(parseFloat(inputCoinNum).toFixed(2));\n    }\n\n    if (inputCoinNum > 0) {\n      this.addPasswordValidate();\n      let coinName = this.$form.data('coin-name');\n      let price = 0.00;\n      if (this.priceType === 'coin') {\n        price = parseFloat(inputCoinNum).toFixed(2) + ' ' + coinName;\n\n        let originalPirce = parseFloat(this.$container.data('maxAllowCoin'));\n        let coinPrice = parseFloat(originalPirce - inputCoinNum).toFixed(2) + ' ' + coinName;;\n        this.$form.trigger('changeCoinPrice', [coinPrice]);\n      } else {\n        price = '￥' + parseFloat(inputCoinNum / this.coinRate).toFixed(2);\n      }\n      this.$form.trigger('addPriceItem', ['coin-price', coinName + Translator.trans('order.create.minus'), price]);\n      this.cashierForm.calcPayPrice(inputCoinNum);\n    }\n  }\n\n  addPasswordValidate() {\n    this.$container.find('[name=\"payPassword\"]').rules('add', 'required passwordCheck');\n  }\n\n  removePasswordValidate() {\n    this.$container.find('[name=\"payPassword\"]').rules('remove', 'required passwordCheck');\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./app/Resources/static-src/app/js/cashier/coin.js","import Coin from 'app/js/cashier/coin';\nimport notify from 'common/notify';\n\nclass CashierForm {\n  constructor($form) {\n    this.$container = $form;\n\n    this.validator = this.$container.validate();\n\n    this.initEvent();\n    this.initCoin();\n  }\n\n  initCoin() {\n    let $coin = $('#coin-use-section');\n    if ($coin.length > 0) {\n      this.coin = new Coin($coin, this);\n    }\n  }\n\n  calcPayPrice(coinAmount) {\n\n    let self = this;\n    $.post(this.$container.data('priceUrl'), {\n      coinAmount: coinAmount\n    }, resp => {\n      self.$container.find('.js-pay-price').text(resp.data);\n    });\n\n\n  }\n\n  initEvent() {\n    // 支付方式切换\n    this.$container.on('click', '.check', event => {\n      let $this = $(event.currentTarget);\n      if (!$this.hasClass('active') && !$this.hasClass('disabled')) {\n        $this.addClass('active').siblings().removeClass('active');\n        $(\"input[name='payment']\").val($this.attr(\"id\"));\n      }\n    });\n\n    let $form = this.$container;\n    $form.on('click', '.js-pay-btn', event => {\n      if ($form.valid()) {\n        $form.submit();\n      }\n\n    });\n  }\n}\n\n\nnew CashierForm($('#cashier-form'));\n\n\n\n\n\n\n\n// WEBPACK FOOTER //\n// ./app/Resources/static-src/app/js/cashier/mobile/index.js"],"sourceRoot":""}