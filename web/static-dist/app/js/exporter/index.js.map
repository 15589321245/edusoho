{"version":3,"sources":["webpack:///./app/Resources/static-src/app/js/exporter/index.js"],"names":["Export","$exprtBtns","$exportBtns","$modal","$","exportDataEvent","self","on","$exportBtn","$form","data","formData","length","serialize","preUrl","tryUrl","can","tryExport","button","urls","showProgress","exportData","ajax","type","url","async","success","response","notifyError","Translator","trans","message","parameters","find","width","parent","removeClass","$title","setTimeout","modal","progressHtml","html","backdrop","keyboard","fileName","window","location","href","start","get","console","log","status","process","count","download","finish","error","e","responseJSON"],"mappings":"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","file":"app/js/exporter/index.js","sourcesContent":["import notify from 'common/notify';\n\nclass Export {\n    constructor($exprtBtns) {\n        this.$exportBtns = $exprtBtns;\n        this.$modal = $('#modal');\n        this.exportDataEvent();\n    }\n\n    exportDataEvent()\n    {\n        let self  = this;\n        self.$exportBtns.on('click', function () {\n            self.$exportBtn = $(this);\n            let $form = $(self.$exportBtn.data('targetForm'));\n            let formData = $form.length > 0 ? $form.serialize() : '';\n            let preUrl = self.$exportBtn.data('preUrl') + '?' + formData;\n            let tryUrl = self.$exportBtn.data('tryUrl') + '?' + formData;\n            let can = self.tryExport(tryUrl);\n            if (!can) {\n                return false;\n            }\n\n            self.$exportBtn.button('loading');\n            let urls = {'preUrl':preUrl, 'url':self.$exportBtn.data('url')};\n            self.showProgress();\n\n            self.exportData(0, '', urls);\n        });\n    };\n\n    tryExport(tryUrl)\n    {\n        let can = true;\n        let self = this;\n        $.ajax({\n            type : \"get\",\n            url : tryUrl,\n            async : false,\n            success : function(response){\n                if (!response.success) {\n                    self.notifyError(Translator.trans(response.message,response.parameters));\n                    can = false;\n                }\n            }\n        });\n\n        return can;\n    }\n\n    finish() {\n        let self = this;\n        self.$modal.find('#progress-bar').width('100%').parent().removeClass('active');\n        let $title = self.$modal.find('.modal-title');\n        setTimeout(function(){\n            notify('success', $title.data('success'));\n            self.$modal.modal('hide');\n        },500)\n\n    }\n\n\n\n\n    showProgress() {\n        let progressHtml = $('#export-modal').html();\n        this.$modal.html(progressHtml);\n        this.$modal.modal({backdrop: 'static', keyboard: false});\n    }\n\n    download(urls, fileName) {\n        if (urls.url && fileName) {\n            window.location.href = urls.url + '?fileName=' + fileName;\n            return true\n        }\n\n        return false;\n    }\n\n    notifyError(message){\n        this.$modal.modal('hide');\n        notify('warning', message);\n    }\n\n    exportData(start, fileName, urls) {\n        let self = this;\n        let data = {\n            'start': start,\n            'fileName': fileName,\n        }\n\n        $.get(urls.preUrl, data, function (response) {\n            if (!response.success) {\n                console.log(response);\n\n                notify('danger', Translator.trans(response.message));\n                return;\n            }\n\n            if (response.status === 'continue') {\n                let process = response.start * 100 / response.count + '%';\n                self.$modal.find('#progress-bar').width(process);\n                self.exportData(response.start, response.fileName, urls);\n            } else {\n                self.$exportBtn.button('reset');\n                self.download(urls, response.fileName) ?  self.finish() : self.notifyError('unexpected error, try again');;\n            }\n        }).error(function(e){\n            notify('danger', e.responseJSON.error.message);\n        });\n    }\n};\n\nnew Export($('.js-export-btn'));\n\n\n// WEBPACK FOOTER //\n// ./app/Resources/static-src/app/js/exporter/index.js"],"sourceRoot":""}