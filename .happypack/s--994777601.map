{"version":3,"sources":["app/Resources/static-src/app/js/activity-manage/video/index.js"],"names":["Video","showChooseContent","initStep2form","isInitStep3from","autoValidatorLength","initfileChooser","hideSubtitleWidget","subtitleWidget","$","click","show","hide","on","event","openUI","val","$step2_form","validator","data","validate","groups","date","rules","title","required","maxlength","trim","minute","second","messages","second_range","$step3_forom","positive_integer","max","min","blur","form","parseInt","children","removeClass","initStep3from","target","value","addClass","fileChooser","subtitleDialog","onSelectFile","closeUI","file","length","Math","round","source","id","uri","render"],"mappings":"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","file":"index.js","sourceRoot":"/Users/kz/projects/edusoho","sourcesContent":["import FileChooser from '../../file-chooser/file-choose';\nimport SubtitleDialog from './subtitle/dialog';\n\nclass Video {\n  constructor() {\n    this.showChooseContent();\n    this.initStep2form();\n    this.isInitStep3from();\n    this.autoValidatorLength();\n    this.initfileChooser();\n    this.hideSubtitleWidget();\n  }\n\n  hideSubtitleWidget() {\n    var subtitleWidget = $('#video-subtitle-form-group');\n    $('[role=\"presentation\"] a[href!=\"#import-video-panel\"]').click(function () {\n      subtitleWidget.show();\n    });\n    $('a[href=\"#import-video-panel\"]').click(function () {\n      subtitleWidget.hide();\n    });\n  }\n\n  showChooseContent() {\n    $('#iframe-content').on('click', '.js-choose-trigger', (event) => {\n      FileChooser.openUI();\n      $('[name=\"ext[mediaSource]\"]').val(null);\n    });\n  }\n\n  initStep2form() {\n    var $step2_form = $('#step2-form');\n    var validator = $step2_form.data('validator');\n    $step2_form.validate({\n      groups: {\n        date: 'minute second'\n      },\n      rules: {\n        title: {\n          required: true,\n          maxlength: 50,\n          trim: true,\n        },\n        minute: 'required unsigned_integer',\n        second: 'required second_range',\n        'ext[mediaSource]': 'required',\n        'ext[finishDetail]': 'unsigned_integer'\n      },\n      messages: {\n        minute: {\n          required: '请输入时长',\n        },\n        second: {\n          required: '请输入时长',\n          second_range: '秒数只能在0-59之间',\n        },\n        'ext[mediaSource]': \"请上传或选择%display%\",\n      }\n    });\n    $step2_form.data('validator', validator);\n  }\n\n  initStep3from() {\n    var $step3_forom = $('#step3-form');\n    var validator = $step3_forom.data('validator');\n    $step3_forom.validate({\n      rules: {\n        'ext[finishDetail]': {\n          required: true,\n          positive_integer: true,\n          max: 300,\n          min: 1,\n        }\n      },\n      messages: {\n        'ext[finishDetail]': {\n          required: '请输入时长',\n        }\n      }\n    });\n    $step3_forom.data('validator', validator);\n  }\n\n  autoValidatorLength() {\n    $(\".js-length\").blur(function () {\n      let validator = $(\"#step2-form\").data('validator');\n      if (validator && validator.form()) {\n        const minute = parseInt($('#minute').val()) | 0;\n        const second = parseInt($('#second').val()) | 0;\n        $(\"#length\").val(minute * 60 + second);\n      }\n    });\n  }\n\n  isInitStep3from() {\n    // 完成条件是观看时长的情况\n    if ($(\"#finish-condition\").children('option:selected').val() === 'time') {\n      $('.viewLength').removeClass('hidden');\n      this.initStep3from();\n    }\n\n    $(\"#finish-condition\").on('change', (event)=>{\n      if (event.target.value == 'time') {\n        $('.viewLength').removeClass('hidden');\n        this.initStep3from();\n      } else {\n        $('.viewLength').addClass('hidden');\n        $('input[name=\"ext[finishDetail]\"]').rules('remove')\n      }\n    })\n  }\n\n  initfileChooser() {\n    const fileChooser = new FileChooser();\n    //字幕组件\n    const subtitleDialog = new SubtitleDialog('.js-subtitle-list');\n    const onSelectFile = file => {\n      FileChooser.closeUI();\n      if (file.length && file.length > 0) {\n        let minute = parseInt(file.length / 60);\n        let second = Math.round(file.length % 60);\n        $(\"#minute\").val(minute);\n        $(\"#second\").val(second);\n        $(\"#length\").val(minute * 60 + second);\n      }\n      $('[name=\"ext[mediaSource]\"]').val(file.source);\n      if (file.source == 'self') {\n        $(\"#ext_mediaId\").val(file.id);\n        $(\"#ext_mediaUri\").val('');\n      } else {\n        $(\"#ext_mediaUri\").val(file.uri);\n        $(\"#ext_mediaId\").val(0);\n      }\n      //渲染字幕\n      subtitleDialog.render(file);\n    };\n\n    fileChooser.on('select', onSelectFile);\n  }\n}\n\nnew Video();\n\n\n\n\n\n\n\n\n\n\n\n"]}