{"version":3,"sources":["app/Resources/static-src/app/js/question-manage/type/form-base.js"],"names":["QuestionFormBase","$form","titleFieldId","analysisFieldId","validator","titleEditorToolBarName","_init","attachmentActions","_initEvent","_initValidate","on","submitForm","event","submitType","$","currentTarget","data","find","val","self","form","button","submit","validate","onkeyup","rules","required","difficulty","stem","score","number","max","min","messages","$target","editor","CKEDITOR","replace","toolbar","filebrowserImageUploadUrl","height","getData","toolbarName","_titleEditorToolBarName"],"mappings":";;;;;;;;AAAA;;;;;;;;IAEMA,gB;AACJ,4BAAYC,KAAZ,EAAkB;AAAA;;AAChB,SAAKA,KAAL,GAAaA,KAAb;AACA,SAAKC,YAAL,GAAoB,qBAApB;AACA,SAAKC,eAAL,GAAuB,yBAAvB;AACA,SAAKC,SAAL,GAAiB,IAAjB;AACA,SAAKC,sBAAL,GAA8B,SAA9B;AACA,SAAKC,KAAL;AACA,SAAKC,iBAAL,GAAyB,gCAAsBN,KAAtB,CAAzB;AACD;;;;4BAEO;AACN,WAAKO,UAAL;AACA,WAAKC,aAAL;AACD;;;iCAEY;AAAA;;AACX,WAAKR,KAAL,CAAWS,EAAX,CAAc,OAAd,EAAsB,oBAAtB,EAA2C;AAAA,eAAO,MAAKC,UAAL,CAAgBC,KAAhB,CAAP;AAAA,OAA3C;AACD;;;+BAEUA,K,EAAO;AAChB,UAAIC,aAAaC,EAAEF,MAAMG,aAAR,EAAuBC,IAAvB,CAA4B,YAA5B,CAAjB;AACA,WAAKf,KAAL,CAAWgB,IAAX,CAAgB,mBAAhB,EAAqCC,GAArC,CAAyCL,UAAzC;AACA,UAAIM,OAAO,IAAX;;AAEA,UAAG,KAAKf,SAAL,CAAegB,IAAf,EAAH,EAAyB;AACvBN,UAAEF,MAAMG,aAAR,EAAuBM,MAAvB,CAA8B,SAA9B;AACAF,aAAKlB,KAAL,CAAWqB,MAAX;AACD;AACF;;;oCAEe;AACd,UAAIlB,YAAY,KAAKH,KAAL,CAAWsB,QAAX,CAAoB;AAChCC,iBAAS,KADuB;AAEhCC,eAAO;AACL,kCAAwB;AACtBC,sBAAU;AADY,WADnB;AAILC,sBAAY;AACVD,sBAAU;AADA,WAJP;AAOLE,gBAAM;AACJF,sBAAU;AADN,WAPD;AAULG,iBAAO;AACLH,sBAAU,IADL;AAELI,oBAAO,IAFF;AAGLC,iBAAI,GAHC;AAILC,iBAAI;AAJC;AAVF,SAFyB;AAmBhCC,kBAAU;AACR,kCAAwB,OADhB;AAERN,sBAAa;AAFL;AAnBsB,OAApB,CAAhB;AAwBA,WAAKvB,SAAL,GAAiBA,SAAjB;AACA;AACD;;;oCAEeA,S,EAAW;AACzB,UAAI8B,UAAUpB,EAAE,MAAI,KAAKZ,YAAX,CAAd;AACA,UAAIiC,SAASC,SAASC,OAAT,CAAiB,KAAKnC,YAAtB,EAAoC;AAC/CoC,iBAAS,KAAKjC,sBADiC;AAE/CkC,mCAA2BL,QAAQlB,IAAR,CAAa,gBAAb,CAFoB;AAG/CwB,gBAAQN,QAAQM,MAAR;AAHuC,OAApC,CAAb;;AAMAL,aAAOzB,EAAP,CAAW,QAAX,EAAqB,YAAM;AACzBwB,gBAAQhB,GAAR,CAAYiB,OAAOM,OAAP,EAAZ;AACD,OAFD;AAGAN,aAAOzB,EAAP,CAAU,MAAV,EAAkB,YAAW;AAC3BN,kBAAUgB,IAAV;AACD,OAFD;AAGD;;;yCAEoB;AACnB,UAAIc,UAAUpB,EAAE,MAAI,KAAKX,eAAX,CAAd;AACA,UAAIgC,SAASC,SAASC,OAAT,CAAiB,KAAKlC,eAAtB,EAAuC;AAClDmC,iBAAS,KAAKjC,sBADoC;AAElDkC,mCAA2BL,QAAQlB,IAAR,CAAa,gBAAb,CAFuB;AAGlDwB,gBAAQN,QAAQM,MAAR;AAH0C,OAAvC,CAAb;;AAMAL,aAAOzB,EAAP,CAAW,QAAX,EAAqB,YAAM;AACzBwB,gBAAQhB,GAAR,CAAYiB,OAAOM,OAAP,EAAZ;AACD,OAFD;AAGD;;;sBAE0BC,W,EAAa;AACtC,WAAKC,uBAAL,GAA+BD,WAA/B;AACD,K;wBAE4B;AAC3B,aAAO,KAAKC,uBAAZ;AACD;;;;;;kBAGY3C,gB","file":"form-base.js","sourceRoot":"/Users/kz/projects/edusoho","sourcesContent":["import AttachmentActions from '../../attachment/widget/attachment-actions';\n\nclass QuestionFormBase {\n  constructor($form){\n    this.$form = $form;\n    this.titleFieldId = 'question-stem-field';\n    this.analysisFieldId = 'question-analysis-field';\n    this.validator = null;\n    this.titleEditorToolBarName = 'Minimal';\n    this._init();\n    this.attachmentActions = new AttachmentActions($form);\n  }\n\n  _init() {\n    this._initEvent();\n    this._initValidate();\n  }\n\n  _initEvent() {\n    this.$form.on('click','[data-role=submit]',event=>this.submitForm(event));\n  }\n\n  submitForm(event) {\n    let submitType = $(event.currentTarget).data('submission');\n    this.$form.find('[name=submission]').val(submitType);\n    let self = this;\n\n    if(this.validator.form()){\n      $(event.currentTarget).button('loading');\n      self.$form.submit();\n    }\n  }\n\n  _initValidate() {\n    let validator = this.$form.validate({\n        onkeyup: false,\n        rules: {\n          '[data-role=\"target\"]': {\n            required: true,\n          },\n          difficulty: {\n            required: true,\n          },\n          stem: {\n            required: true,\n          },\n          score: {\n            required: true,\n            number:true,\n            max:999,\n            min:0\n          }\n        },\n        messages: {\n          '[data-role=\"target\"]': \"请选择从属\",\n          difficulty : \"请选择难度\"\n        }\n    });\n    this.validator = validator;\n    // this.initTitleEditor(this.validator);\n  }\n\n  initTitleEditor(validator) {\n    let $target = $('#'+this.titleFieldId);\n    let editor = CKEDITOR.replace(this.titleFieldId, {\n      toolbar: this.titleEditorToolBarName,\n      filebrowserImageUploadUrl: $target.data('imageUploadUrl'),\n      height: $target.height()\n    });\n\n    editor.on( 'change', () => {    \n      $target.val(editor.getData());\n    });\n    editor.on('blur', function() {\n      validator.form();\n    });\n  }\n\n  initAnalysisEditor() {\n    let $target = $('#'+this.analysisFieldId);\n    let editor = CKEDITOR.replace(this.analysisFieldId, {\n      toolbar: this.titleEditorToolBarName,\n      filebrowserImageUploadUrl: $target.data('imageUploadUrl'),\n      height: $target.height()\n    });\n\n    editor.on( 'change', () => {    \n      $target.val(editor.getData());\n    });\n  }\n\n  set titleEditorToolBarName(toolbarName) {\n    this._titleEditorToolBarName = toolbarName;\n  }\n \n  get titleEditorToolBarName() {\n    return this._titleEditorToolBarName;\n  }\n}\n\nexport default QuestionFormBase;"]}