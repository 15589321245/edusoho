{"version":3,"sources":["app/Resources/static-src/app/common/messenger.js"],"names":["EsMessenger","options","name","project","children","type","setup","self","messenger","addTarget","window","i","length","contentWindow","id","listen","msg","JSON","parse","emit","eventName","args","targets","send","convertToString","child","stringify"],"mappings":";;;;;;;;AAAA;;;;AACA;;;;;;;;;;;;IAEqBA,W;;;AACjB,yBAAYC,OAAZ,EAAqB;AAAA;;AAAA;;AAGjB,cAAKC,IAAL,GAAYD,QAAQC,IAApB;AACA,cAAKC,OAAL,GAAeF,QAAQE,OAAvB;AACA,cAAKC,QAAL,GAAgBH,QAAQG,QAAxB;AACA,cAAKC,IAAL,GAAYJ,QAAQI,IAApB;AACA,cAAKC,KAAL;AAPiB;AAQpB;;;;gCAEO;AACJ,gBAAIC,OAAO,IAAX;AACA,gBAAIC,YAAY,0BAAc,KAAKN,IAAnB,EAAyB,KAAKC,OAA9B,CAAhB;AACA,gBAAI,KAAKE,IAAL,IAAa,OAAjB,EAA0B;AACtBG,0BAAUC,SAAV,CAAoBC,OAAOH,IAA3B,EAAiC,QAAjC;AACH,aAFD,MAEO,IAAI,KAAKF,IAAL,IAAa,QAAjB,EAA2B;AAC9BG,0BAAUC,SAAV,CAAoBC,OAAOH,IAA3B,EAAiC,OAAjC;AACA,oBAAIH,WAAW,KAAKA,QAApB;AACA,qBAAK,IAAIO,IAAIP,SAASQ,MAAT,GAAkB,CAA/B,EAAkCD,KAAK,CAAvC,EAA0CA,GAA1C,EAA+C;AAC3CH,8BAAUC,SAAV,CAAoBL,SAASO,CAAT,EAAYE,aAAhC,EAA+CT,SAASO,CAAT,EAAYG,EAA3D;AACH;AACJ;AACDN,sBAAUO,MAAV,CAAiB,UAAUC,GAAV,EAAe;AAC5BA,sBAAMC,KAAKC,KAAL,CAAWF,GAAX,CAAN;AACAT,qBAAKY,IAAL,CAAUH,IAAII,SAAd,EAAyBJ,IAAIK,IAA7B;AACH,aAHD;AAIA,iBAAKb,SAAL,GAAiBA,SAAjB;AACH;;;qCAEYY,S,EAAWC,I,EAAM;AAC1B,iBAAKb,SAAL,CAAec,OAAf,CAAuB,QAAvB,EAAiCC,IAAjC,CACI,KAAKC,eAAL,CAAqBJ,SAArB,EAAgCC,IAAhC,CADJ;AAGH;;;oCAEWI,K,EAAOL,S,EAAWC,I,EAAM;AAChC,iBAAKb,SAAL,CAAec,OAAf,CAAuBG,MAAMX,EAA7B,EAAiCS,IAAjC,CACI,KAAKC,eAAL,CAAqBJ,SAArB,EAAgCC,IAAhC,CADJ;AAGH;;;wCAEeD,S,EAAWC,I,EAAM;AAC7B,gBAAIL,MAAM,EAAC,aAAaI,SAAd,EAAyB,QAAQC,IAAjC,EAAV;AACAL,kBAAMC,KAAKS,SAAL,CAAeV,GAAf,CAAN;AACA,mBAAOA,GAAP;AACH;;;;;;kBA9CgBhB,W","file":"messenger.js","sourceRoot":"/Users/kz/projects/edusoho","sourcesContent":["import Messenger from 'es-messenger';\nimport Emitter from \"component-emitter\";\n\nexport default class EsMessenger extends Emitter {\n    constructor(options) {\n        super();\n\n        this.name = options.name;\n        this.project = options.project;\n        this.children = options.children;\n        this.type = options.type;\n        this.setup();\n    }\n\n    setup() {\n        let self = this;\n        var messenger = new Messenger(this.name, this.project);\n        if (this.type == 'child') {\n            messenger.addTarget(window.self, 'parent');\n        } else if (this.type == 'parent') {\n            messenger.addTarget(window.self, 'child');\n            var children = this.children;\n            for (var i = children.length - 1; i >= 0; i--) {\n                messenger.addTarget(children[i].contentWindow, children[i].id);\n            }\n        }\n        messenger.listen(function (msg) {\n            msg = JSON.parse(msg);\n            self.emit(msg.eventName, msg.args);\n        });\n        this.messenger = messenger;\n    }\n\n    sendToParent(eventName, args) {\n        this.messenger.targets['parent'].send(\n            this.convertToString(eventName, args)\n        );\n    }\n\n    sendToChild(child, eventName, args) {\n        this.messenger.targets[child.id].send(\n            this.convertToString(eventName, args)\n        );\n    }\n\n    convertToString(eventName, args) {\n        var msg = {\"eventName\": eventName, \"args\": args};\n        msg = JSON.stringify(msg);\n        return msg;\n    }\n\n}"]}