webpackJsonp(["app/js/testpaper-manage/questions/index"],{0:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}var i=a("63fff8fb24f3bd1f61cd");n(i);a("a52ee3f9747e09bd43d1");var s=a("de585ca0d3c2d0205c51"),r=n(s),o=a("1e0cf618bc778b8ab554"),c=n(o),d=a("65c0e24ccad86ee24949"),l=n(d),u=$("#testpaper-items-manager");new c.default(u,$("#modal")),new l.default(u),new r.default(u)},"65c0e24ccad86ee24949":function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}(),r=a("b334fd7e4c5a19234db2"),o=n(r),c=function(){function e(t){i(this,e),this.$element=t,this.$button=this.$element.find('[data-role="pick-item"]'),this.$typeNav=this.$element.find("#testpaper-question-nav"),this.$modal=$("#testpaper-confirm-modal"),this.currentType=this.$typeNav.find(".active").children().data("type"),this.questions=[],this._initEvent()}return s(e,[{key:"_initEvent",value:function(){var e=this;this.$button.on("click",function(t){return e._showPickerModal(t)}),this.$typeNav.on("click","li",function(t){return e._changeNav(t)}),this.$element.on("click",".js-request-save",function(t){return e._confirmSave(t)}),this.$modal.on("click",".js-confirm-submit",function(t){return e._submitSave(t)})}},{key:"_showPickerModal",value:function(e){var t=[];$('[data-type="'+this.currentType+'"]').find('[name="questionIds[]"]').each(function(){t.push($(this).val())});var a=$("#modal").modal();a.data("manager",this),$.get(this.$button.data("url"),{excludeIds:t.join(","),type:this.currentType},function(e){a.html(e)})}},{key:"_changeNav",value:function(e){var t=$(e.currentTarget),a=t.children().data("type");this.currentType=a,this.$typeNav.find("li").removeClass("active"),t.addClass("active"),this.$element.find('[data-role="question-body"]').addClass("hide"),this.$element.find("#testpaper-items-"+a).removeClass("hide"),this.$element.find('[data-role="batch-select"]').prop("checked",!1),this.$element.find('[data-role="batch-item"]').prop("checked",!1)}},{key:"_confirmSave",value:function(e){var t=this._validateScore();if(t){if($('[name="passedScore"]').length>0){var a=$(".passedScoreDiv").siblings(".help-block").html();if(""!=$.trim(a))return}var n=this._calTestpaperStats(),i="";$.each(n,function(e,t){var a="<tr>";a+="<td>"+t.name+"</td>",a+="<td>"+t.count+"</td>",a+="<td>"+t.score.toFixed(1)+"</td>",a+="</tr>",i+=a}),this.$modal.find(".detail-tbody").html(i),this.$modal.modal("show")}}},{key:"_validateScore",value:function(){var e=!0;return 0==this.$element.find('[name="scores[]"]').length&&((0,o.default)("danger","请选择题目。"),e=!1),this.$element.find('input[type="text"][name="scores[]"]').each(function(){var t=$(this).val();"0"==t&&((0,o.default)("danger","题目分值不能为0。"),e=!1),/^(([1-9]{1}\d{0,2})|([0]{1}))(\.(\d){1})?$/.test(t)||((0,o.default)("danger","题目分值只能填写数字，并且在3位数以内，保留一位小数。"),$(this).focus(),e=!1)}),e}},{key:"_calTestpaperStats",value:function(){var e={},t=this;this.$typeNav.find("li").each(function(){var a=$(this).find("a").data("type"),n=$(this).find("a").data("name");e[a]={name:n,count:0,score:0,missScore:0},t.$element.find("#testpaper-items-"+a).find('[name="scores[]"]').each(function(){var n=$(this).closest("tr").data("type"),i="material"==n?0:parseFloat($(this).val()),s={};"material"!=n&&e[a].count++,e[a].score+=i,e[a].missScore=parseFloat($(this).data("miss-score"));var r=$(this).closest("tr").data("id");s.id=r,s.score=i,s.missScore=parseFloat($(this).data("miss-score")),s.type=a,t.questions.push(s)})});var a={name:Translator.trans("总计"),count:0,score:0};return $.each(e,function(e,t){a.count+=t.count,a.score+=t.score}),e.total=a,e}},{key:"_submitSave",value:function(e){var t=0,a=$(e.currentTarget);$('input[name="passedScore"]:visible').length>0&&(t=$('input[name="passedScore"]').val()),a.button("loading").addClass("disabled"),$.post(this.$element.attr("action"),{questions:this.questions,passedScore:t},function(e){e.goto&&(window.location.href=e.goto)})}}]),e}();t.default=c}});