{% extends 'TopxiaAdminBundle:Sale:layout.html.twig' %}

{% block title %}佣金管理 - {{ parent() }}{% endblock %}

{% set menu = 'admin_commission' %}

{% block main %}
<div class="page-header">

  <h1>佣金管理</h1>
</div>

<form id="message-search-form" class="form-inline well well-sm" action="" method="get" novalidate>

  
  <div class="form-group">
    <input class="form-control" type="text" placeholder="渠道" name="nickName" value="{{ app.request.get('nickName') }}"></div>

  <div class="form-group">
    <input class="form-control" type="text" placeholder="链接码或优惠码" name="saleTookeen" value="{{ app.request.get('saleTookeen') }}"></div>

  <div class="form-group">
    <input class="form-control" type="text" placeholder="订单号" name="orderSn" value="{{ app.request.get('orderSn') }}"></div>

  <div class="form-group">
    <input class="form-control" type="text" placeholder="大于等于佣金金额" name="commission" value="{{ app.request.get('commission') }}"></div>

    <div class="form-group">
    <select class="form-control" name="status">
        {{ select_options(dict('commissionStatus'), app.request.query.get('status'), '佣金状态') }}
    </select>

    </div>

  <button class="btn btn-primary">搜索</button>
</form>


<div id="offsale-table-container">

  <table class="table table-striped table-hover" id="commission-table">
    <thead>
    <tr>
     
     
      <th width="10%">日期</th>
      <th width="8%">佣金(元)</th>
      <th width="5%">状态</th>
      
      <th  width="10%">备注</th>

      <th width="10%">所属渠道</th>
      <th width="30%">所属推广</th>       
      
      <th width="30%">所属定单</th>
    </tr>
    </thead>
    <tbody>
      {% for commission in commissions %}
        {% set order = orders[commission.orderId] %}      
       
        {% set buyer = buyers[commission.buyerId] %}

        {% set saler = salers[commission.salerId] %}


        <tr>
         
         
          <td>{{commission.paidTime|date('Y-n-d') }}</td>
          <td>￥{{commission.commission }}</td>
          <td>{{ dict_text('commissionStatus:html', commission.status) }}</td>
          <td class="text-muted text-sm text-break">{{commission.note }}</td>

          <td>
            {{saler.nickname }}
          </td>

          <td class="text-muted text-sm text-break">
            {% if commission.saleType=='linksale-course' %}
              {{ dict_text('saleType:html',commission.saleType) }}:
               {% set linksale = linksales[commission.saleId] %}
                <a href = "{{ linksale.tUrl }}"> {{linksale.tUrl}} </a><br>
                佣金比例：{{ linksale.adCommission }}%
            {% elseif commission.saleType=='linksale-web' %}
              {{ dict_text('saleType:html',commission.saleType) }}:
               {% set linksale = linksales[commission.saleId] %}
                <a href = "{{ linksale.tUrl }}"> {{linksale.tUrl}} </a><br>
                 佣金比例：{{ linksale.adCommission }}%
            {% elseif commission.saleType=='offsale-course' %}
                {{ dict_text('saleType:html',commission.saleType) }}<br>
               {% set offsale = offsales[commission.saleId] %}
                课程优惠码:{{ offsale.promoCode }}<br>
                 佣金比例：{{ offsale.adCommission }}%

            {% elseif commission.saleType=='invite-course' %}
                   {{ dict_text('saleType:html',commission.saleType) }}<br>
               {% set offsale = offsales[commission.saleId] %}
                课程邀请码:{{ offsale.promoCode }}<br>
                 佣金比例：{{ offsale.adCommission }}%

            {% endif %}

          </td>
          <td class="text-muted text-sm">定单名称：{{order.title }}<br>  定单号：{{commission.orderSn }}<br>  
            价格：￥{{commission.orderPrice }} &nbsp;&nbsp;   {{dict_text('orderStatus:html', order.status) }}
          </td>
         
        </tr>
      {% else %}
        <tr><td colspan="7">无数据</td></tr>
      {% endfor %}
    </tbody>
  </table>

  {{ web_macro.paginator(paginator) }} 

</div>

{% endblock %}