{"version":3,"sources":["app/Resources/static-src/app/js/activity-manage/text/index.js"],"names":["Text","props","_init","_inItStep2form","_inItStep3form","_lanuchAutoSave","$","on","event","$btn","currentTarget","content","data","editor","setData","remove","$step2_form","validator","validate","rules","title","required","maxlength","trim","$content","_contentCache","val","$title","parent","document","_originTitle","text","setInterval","_saveDraft","getData","needSave","post","done","date","Date","now","getHours","Translator","trans","getMinutes","getSeconds","createdTime","$step3_form","finishDetail","positive_integer","max","messages"],"mappings":";;;;AAAA;;AACA;;;;IAEMA,I;AACJ,gBAAYC,KAAZ,EAAmB;AAAA;;AACjB,SAAKC,KAAL;AACD;;;;4BAEO;AAAA;;AACN,WAAKC,cAAL;AACA,WAAKC,cAAL;AACA,WAAKC,eAAL;;AAEAC,QAAE,mBAAF,EAAuBC,EAAvB,CAA0B,OAA1B,EAAmC,UAACC,KAAD,EAAW;AAC5C,YAAMC,OAAOH,EAAEE,MAAME,aAAR,CAAb;AACA,YAAMC,UAAUF,KAAKG,IAAL,CAAU,SAAV,CAAhB;AACA,cAAKC,MAAL,CAAYC,OAAZ,CAAoBH,OAApB;AACAF,aAAKM,MAAL;AACD,OALD;AAMD;;;qCAEgB;AACf,UAAMC,cAAcV,EAAE,aAAF,CAApB;AACA,UAAIW,YAAYD,YAAYJ,IAAZ,CAAiB,WAAjB,CAAhB;AACAK,kBAAYD,YAAYE,QAAZ,CAAqB;AAC/BC,eAAO;AACLC,iBAAO;AACLC,sBAAU,IADL;AAELC,uBAAW,EAFN;AAGLC,kBAAM;AAHD,WADF;AAMLZ,mBAAS;AACPU,sBAAU;AADH;AANJ;AADwB,OAArB,CAAZ;AAYA,UAAMG,WAAWlB,EAAE,kBAAF,CAAjB;AACA,WAAKO,MAAL,GAAc,wBAAWW,QAAX,EAAqBP,SAArB,CAAd;AACA,WAAKQ,aAAL,GAAqBD,SAASE,GAAT,EAArB;AACD;;;sCAEiB;AAAA;;AAChB,UAAMC,SAASrB,EAAE,qBAAF,EAAyBsB,OAAOC,QAAhC,CAAf;AACA,WAAKC,YAAL,GAAoBH,OAAOI,IAAP,EAApB;AACAC,kBAAY,YAAM;AAChB,eAAKC,UAAL;AACD,OAFD,EAEG,IAFH;AAGD;;;iCAEY;AAAA;;AACX,UAAMtB,UAAU,KAAKE,MAAL,CAAYqB,OAAZ,EAAhB;AACA,UAAMC,WAAWxB,YAAY,KAAKc,aAAlC;AACA,UAAI,CAACU,QAAL,EAAe;AACb;AACD;AACD,UAAMX,WAAWlB,EAAE,kBAAF,CAAjB;AACAA,QAAE8B,IAAF,CAAOZ,SAASZ,IAAT,CAAc,cAAd,CAAP,EAAsC,EAACD,SAASA,OAAV,EAAtC,EACG0B,IADH,CACQ,YAAM;AACV,YAAMC,OAAO,IAAIC,IAAJ,EAAb,CADU,CACe;AACzB,YAAMZ,SAASrB,EAAE,qBAAF,EAAyBsB,OAAOC,QAAhC,CAAf;AACA,YAAMW,YAASF,KAAKG,QAAL,KAAkBC,WAAWC,KAAX,CAAiB,GAAjB,CAA3B,KAAmDL,KAAKM,UAAL,KAAoBF,WAAWC,KAAX,CAAiB,GAAjB,CAAvE,KAA+FL,KAAKO,UAAL,KAAoBH,WAAWC,KAAX,CAAiB,GAAjB,CAAnH,CAAN;AACAhB,eAAOI,IAAP,CAAY,OAAKD,YAAL,GAAoBY,WAAWC,KAAX,CAAiB,uBAAjB,EAA0C,EAACG,aAAaN,GAAd,EAA1C,CAAhC;AACA,eAAKf,aAAL,GAAqBd,OAArB;AACD,OAPH;AAQD;;;qCAEgB;AACf,UAAMoC,cAAczC,EAAE,aAAF,CAApB;AACA,UAAIW,YAAY8B,YAAYnC,IAAZ,CAAiB,WAAjB,CAAhB;AACAK,kBAAY8B,YAAY7B,QAAZ,CAAqB;AAC/BC,eAAO;AACL6B,wBAAc;AACZ3B,sBAAU,IADE;AAEZ4B,8BAAkB,IAFN;AAGZC,iBAAK;AAHO;AADT,SADwB;AAQ/BC,kBAAU;AACRH,wBAAc;AACZ3B,sBAAU;AADE;AADN;AARqB,OAArB,CAAZ;AAcD;;;;;;AAGH,IAAIrB,IAAJ","file":"index.js","sourceRoot":"/Users/kz/projects/edusoho","sourcesContent":["import {initEditor} from \"../editor\";\nimport \"store\";\n\nclass Text {\n  constructor(props) {\n    this._init();\n  }\n\n  _init() {\n    this._inItStep2form();\n    this._inItStep3form();\n    this._lanuchAutoSave();\n\n    $('.js-continue-edit').on('click', (event) => {\n      const $btn = $(event.currentTarget);\n      const content = $btn.data('content');\n      this.editor.setData(content);\n      $btn.remove();\n    });\n  }\n\n  _inItStep2form() {\n    const $step2_form = $('#step2-form');\n    let validator = $step2_form.data('validator');\n    validator = $step2_form.validate({\n      rules: {\n        title: {\n          required: true,\n          maxlength: 50,\n          trim: true,\n        },\n        content: {\n          required: true,\n        },\n      },\n    });\n    const $content = $('[name=\"content\"]');\n    this.editor = initEditor($content, validator);\n    this._contentCache = $content.val();\n  }\n\n  _lanuchAutoSave() {\n    const $title = $('#modal .modal-title', parent.document);\n    this._originTitle = $title.text();\n    setInterval(() => {\n      this._saveDraft();\n    }, 5000);\n  }\n\n  _saveDraft() {\n    const content = this.editor.getData();\n    const needSave = content !== this._contentCache;\n    if (!needSave) {\n      return;\n    }\n    const $content = $('[name=\"content\"]');\n    $.post($content.data('saveDraftUrl'), {content: content})\n      .done(() => {\n        const date = new Date(); //日期对象\n        const $title = $('#modal .modal-title', parent.document);\n        const now = `${date.getHours() + Translator.trans('时')}${date.getMinutes() + Translator.trans('分')}${date.getSeconds() + Translator.trans('秒')}`;\n        $title.text(this._originTitle + Translator.trans('(草稿已于%createdTime%保存)', {createdTime: now}));\n        this._contentCache = content;\n      });\n  }\n\n  _inItStep3form() {\n    const $step3_form = $('#step3-form');\n    let validator = $step3_form.data('validator');\n    validator = $step3_form.validate({\n      rules: {\n        finishDetail: {\n          required: true,\n          positive_integer: true,\n          max: 300,\n        },\n      },\n      messages: {\n        finishDetail: {\n          required: '请输入至少观看多少分钟',\n        },\n      },\n    });\n  }\n}\n\nnew Text();\n"]}