{"version":3,"sources":["app/Resources/static-src/app/js/course-manage/create/index.js"],"names":["Creator","validator","init","$","popover","html","initValidator","initExpiryMode","checkBoxChange","$form","validate","groups","date","rules","title","required","trim","messages","Translator","trans","click","evt","form","isInitIntro","currentTarget","button","submit","initDatePicker","listLength","find","length","intro","isSetCourseListCookies","on","event","val","removeClass","addClass","prop","$id","$picker","datetimepicker","format","language","minView","autoclose","endDate","Date","now","$deadline","$expiryDays","$expiryStartDate","$expiryEndDate","expiryMode","elementRemoveRules","$deadlineType","elementAddRules","getDeadlineEndDateRules","getExpiryDaysRules","getExpiryStartDateRules","getExpiryEndDateRules","after_date","after_now_date","before_date","positive_integer","max_year","$element","options"],"mappings":"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","file":"index.js","sourceRoot":"/Users/kz/projects/edusoho","sourcesContent":["import Intro from 'app/js/courseset-manage/intro';\n\nclass Creator {\n  constructor() {\n    this.validator = null;\n    this.init();\n    // this.isInitIntro();\n  }\n\n  init() {\n    $('[data-toggle=\"popover\"]').popover({\n      html: true,\n    });\n    this.initValidator();\n    this.initExpiryMode();\n    this.checkBoxChange();\n  }\n\n  initValidator() {\n    let $form = $(\"#course-create-form\");\n    this.validator = $form.validate({\n      groups: {\n        date: 'expiryStartDate expiryEndDate'\n      },\n      rules: {\n        title: {\n          required: true,\n          trim: true\n        }\n      },\n      messages: {\n        title: Translator.trans('请输入教学计划课程标题'),\n      }\n    });\n\n    $('#course-submit').click((evt) => {\n      if (this.validator.form()) {\n        this.isInitIntro();\n        $(evt.currentTarget).button('loading');\n        $form.submit();\n      }\n    });\n    this.initDatePicker('#expiryStartDate');\n    this.initDatePicker('#expiryEndDate');\n    this.initDatePicker('#deadline');\n  }\n\n  isInitIntro() {\n    let listLength = $('#courses-list-table').find('tbody tr').length;\n    if(listLength == 1) {\n      let intro = new Intro();\n      intro.isSetCourseListCookies();\n    }\n   \n  }\n\n  checkBoxChange() {\n    $('input[name=\"deadlineType\"]').on('change', (event) => {\n      if ($('input[name=\"deadlineType\"]:checked').val() == 'end_date') {\n        $('#deadlineType-date').removeClass('hidden');\n        $('#deadlineType-days').addClass('hidden');\n      } else {\n        $('#deadlineType-date').addClass('hidden');\n        $('#deadlineType-days').removeClass('hidden');\n      }\n      this.initExpiryMode();\n    });\n\n    $('input[name=\"expiryMode\"]').on('change', (event) => {\n      if ($('input[name=\"expiryMode\"]:checked').val() == 'date') {\n        $('#expiry-days').removeClass('hidden').addClass('hidden');\n        $('#expiry-date').removeClass('hidden');\n      } else if ($('input[name=\"expiryMode\"]:checked').val() == 'days') {\n        $('#expiry-date').removeClass('hidden').addClass('hidden');\n        $('#expiry-days').removeClass('hidden');\n        $('input[name=\"deadlineType\"][value=\"days\"]').prop('checked', true);\n      } else {\n        $('#expiry-date').removeClass('hidden').addClass('hidden');\n        $('#expiry-days').removeClass('hidden').addClass('hidden');\n      }\n      this.initExpiryMode();\n    });\n\n    $('input[name=\"learnMode\"]').on('change', (event) => {\n      if ($('input[name=\"learnMode\"]:checked').val() == 'freeMode') {\n        $('#learnLockModeHelp').removeClass('hidden').addClass('hidden');\n        $('#learnFreeModeHelp').removeClass('hidden');\n      } else {\n        $('#learnFreeModeHelp').removeClass('hidden').addClass('hidden');\n        $('#learnLockModeHelp').removeClass('hidden');\n      }\n    });\n  }\n\n  initDatePicker($id) {\n    let $picker = $($id);\n    $picker.datetimepicker({\n      format: 'yyyy-mm-dd',\n      language: \"zh\",\n      minView: 2, //month\n      autoclose: true,\n      endDate: new Date(Date.now() + 86400 * 365 * 10 * 1000)\n    }).on('hide', () => {\n      this.validator.form();\n    })\n    $picker.datetimepicker('setStartDate', new Date());\n  }\n\n  initExpiryMode() {\n    let $deadline = $('[name=\"deadline\"]');\n    let $expiryDays = $('[name=\"expiryDays\"]');\n    let $expiryStartDate = $('[name=\"expiryStartDate\"]');\n    let $expiryEndDate = $('[name=\"expiryEndDate\"]');\n    let expiryMode = $('[name=\"expiryMode\"]:checked').val();\n    \n    this.elementRemoveRules($deadline);\n    this.elementRemoveRules($expiryDays);\n    this.elementRemoveRules($expiryStartDate);\n    this.elementRemoveRules($expiryEndDate);\n\n    switch (expiryMode) {\n      case 'days':\n        let $deadlineType = $('[name=\"deadlineType\"]:checked');\n        if ($deadlineType.val() === 'end_date') {\n          this.elementAddRules($deadline, this.getDeadlineEndDateRules());\n          this.validator.form();\n          return;\n        }\n        this.elementAddRules($expiryDays, this.getExpiryDaysRules());\n        this.validator.form();\n        break;\n      case 'date':\n        this.elementAddRules($expiryStartDate, this.getExpiryStartDateRules());\n        this.elementAddRules($expiryEndDate, this.getExpiryEndDateRules());\n        this.validator.form();\n        break;\n      default:\n        break;\n    }\n  }\n\n  getExpiryEndDateRules() {\n    return {\n      required: true,\n      date: true,\n      after_date: '#expiryStartDate',\n      messages: {\n        required:Translator.trans('请输入结束日期')\n      }\n    }\n  }\n\n  getExpiryStartDateRules() {\n    return {\n      required: true,\n      date: true,\n      after_now_date: true,\n      before_date: '#expiryEndDate',\n      messages: {\n        required: Translator.trans('请输入开始日期')\n      }\n    }\n  }\n\n  getExpiryDaysRules() {\n    return {\n      required: true,\n      positive_integer: true,\n      max_year: true,\n      messages: {\n        required: Translator.trans('请输入有效期天数')\n      }\n    }\n  }\n\n  getDeadlineEndDateRules() {\n    return {\n      required: true,\n      date: true,\n      after_now_date: true,\n      messages: {\n        required: Translator.trans('请输入截至日期')\n      }\n    }\n  }\n\n  elementAddRules($element, options) {\n    $element.rules(\"add\", options);\n  }\n\n  elementRemoveRules($element) {\n    $element.rules('remove');\n  }\n}\n\nnew Creator();\n"]}