{"version":3,"sources":["app/Resources/static-src/app/js/task/widget/sidebar.js"],"names":["TaskSidebar","element","url","isManualOperation","$","init","fixIconInChrome","fetchPlugins","then","plugins","renderToolbar","renderPane","bindEvent","fail","post","html","hide","reduce","plugin","code","icon","name","append","find","on","event","$btn","currentTarget","pluginCode","data","$pane","$paneBody","undefined","operationContent","get","perfectScrollbar","hasClass","foldContent","removeClass","addClass","show","popupContent","time","side_right","content_right","emit","animate","right","width","$currentPane","undelegate","children","click"],"mappings":"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","file":"sidebar.js","sourceRoot":"/Users/kz/projects/edusoho","sourcesContent":["// import Emitter from 'es6-event-emitter';\nimport Emitter from \"component-emitter\";\n\nexport default class TaskSidebar extends Emitter {\n  constructor({element, url}) {\n    super();\n    this.url = url;\n    this.isManualOperation = true;\n    this.element = $(element);\n    this.init();\n  }\n\n  init() {\n    this.fixIconInChrome();\n    this.fetchPlugins()\n      .then((plugins) => {\n        this.plugins = plugins;\n        this.renderToolbar();\n        this.renderPane();\n        this.bindEvent();\n      })\n      .fail(error => {\n      });\n  }\n\n  fetchPlugins() {\n    return $.post(this.url);\n  }\n\n  // 修复字体图标在chrome下，加载两次从而不能显示的问题\n  fixIconInChrome() {\n    let html = `<i class=\"es-icon es-icon-chevronleft\"></i>`;\n    this.element.html(html);\n    $('.es-icon').hide();\n    // $('.es-icon').show();\n  }\n\n  renderToolbar() {\n    let html = `\n    <div class=\"dashboard-toolbar\">\n      <ul class=\"dashboard-toolbar-nav\" id=\"dashboard-toolbar-nav\">\n        ${this.plugins.reduce((html, plugin) => {\n        return html += `<li data-plugin=\"${plugin.code}\" data-url=\"${plugin.url}\"><a href=\"#\"><div class=\"mbs es-icon ${plugin.icon}\"></div>${plugin.name}</a></li>`;\n      }, '')}\n      </ul>\n    </div>`;\n    this.element.html(html);\n  }\n\n  renderPane() {\n    let html = this.plugins.reduce((html, plugin) => {\n      return html += `<div data-pane=\"${plugin.code}\" class=\" ${plugin.code}-pane js-sidebar-pane\" ><div class=\"${plugin.code}-pane-body js-sidebar-pane-body\"></div></div>`;\n    }, '');\n    this.element.append(html);\n  }\n\n  bindEvent() {\n    this.element.find('#dashboard-toolbar-nav').on('click', 'li', (event) => {\n      let $btn = $(event.currentTarget);\n      let pluginCode = $btn.data('plugin');\n      let url = $btn.data('url');\n      let $pane = this.element.find(`[data-pane=\"${pluginCode}\"]`)\n      let $paneBody = $pane.find('.js-sidebar-pane-body');\n      if (pluginCode === undefined || url === undefined) {\n        return;\n      }\n\n      if ($btn.data('loaded')) {\n        this.operationContent($btn);\n        return;\n      }\n\n      $.get(url)\n        .then(html => {\n          $paneBody.html(html);\n          $pane.perfectScrollbar();\n          $btn.data('loaded', true);\n          if(this.isManualOperation){\n            this.operationContent($btn);\n          }\n          this.isManualOperation = true;\n          this.fixIconInChrome();\n        });\n    });\n  }\n\n  operationContent($btn) {\n    if ($btn.hasClass('active')) {\n      this.foldContent();\n      $btn.removeClass('active');\n    } else {\n      this.element.find('#dashboard-toolbar-nav li').removeClass('active');\n      $btn.addClass('active');\n      this.element.find('[data-pane]').hide();\n      this.element.find(`[data-pane=\"${$btn.data('plugin')}\"]`).show();\n      this.popupContent();\n    }\n  }\n\n  popupContent(time = 1) {\n    let side_right = '0px';\n    let content_right = '379px';\n\n    this.emit('popup', content_right, time);\n    this.element.animate({\n      right: side_right\n    }, time);\n  }\n\n  foldContent(time = 1) {\n    let side_right = '-' + this.element.width() + 'px';\n    let content_right = '26px';\n\n    this.emit('fold', content_right, time);\n    this.element.animate({\n      right: side_right\n    }, time);\n  }\n\n  reload() {\n    const $currentPane = this.element.find('.js-sidebar-pane:visible');\n    const pluginCode = $currentPane.data('pane');\n    $currentPane.undelegate();\n    this.element.find('#dashboard-toolbar-nav').children(`[data-plugin=\"${pluginCode}\"]`)\n      .data('loaded', false)\n      .click();\n    this.isManualOperation = false;\n  }\n}\n"]}