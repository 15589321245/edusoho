{"version":3,"sources":["webpack:///./app/Resources/static-src/app/js/activity-manage/editor.js?6763","webpack:///./app/Resources/static-src/app/js/activity-manage/live/index.js","webpack:///./app/Resources/static-src/app/js/activity-manage/live/live.js"],"names":["initEditor","$item","validator","editor","CKEDITOR","replace","toolbar","filebrowserImageUploadUrl","$","data","filebrowserFlashUploadUrl","allowedContent","height","on","console","log","val","getData","form","Live","props","$startTime","_init","initStep2Form","_timePickerHide","jQuery","addMethod","value","element","optional","$step2_form","validator2","validate","onkeyup","rules","title","required","maxlength","trim","open_live_course_title","startTime","DateAndTime","after_now","length","digits","max","min","show_overlap_time_error","remark","dateTimePicker","that","find","change","checkOverlapTime","showError","params","mediaType","ajax","url","async","type","dataType","success","resp","$starttime","datetimepicker","format","language","document","documentElement","lang","autoclose","endDate","Date","now","parent","window"],"mappings":"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","file":"app/js/activity-manage/live/index.js","sourcesContent":["export const initEditor = ($item, validator) => {\n  \n  var editor = CKEDITOR.replace('text-content-field', {\n    toolbar: 'Task',\n    filebrowserImageUploadUrl: $('#text-content-field').data('imageUploadUrl'),\n    filebrowserFlashUploadUrl: $('#text-content-field').data('flashUploadUrl'),\n    allowedContent: true,\n    height: 280,\n  });\n  \n  editor.on('change', () => {\n    console.log('change');\n    $item.val(editor.getData());\n    if (validator) {\n      validator.form();\n    }\n  });\n\n  //fix ie11 中文输入\n  editor.on('blur', () => {\n     console.log('blur');\n    $item.val(editor.getData());\n    if (validator) {\n      validator.form();\n    }\n  });\n\n  return editor;\n};\n\n\n// WEBPACK FOOTER //\n// ./app/Resources/static-src/app/js/activity-manage/editor.js","import Live from './live';\n\nnew Live();\n\n\n\n// WEBPACK FOOTER //\n// ./app/Resources/static-src/app/js/activity-manage/live/index.js","import { initEditor } from '../editor'\nexport default class Live {\n  constructor(props) {\n    this.$startTime = $('#startTime');\n    this._init();\n  }\n\n  _init() {\n    this.initStep2Form();\n    this._timePickerHide();\n  }\n\n  initStep2Form() {\n    jQuery.validator.addMethod('show_overlap_time_error', function(value, element) {\n      return this.optional( element ) || !$(element).data('showError');\n    }, '所选时间已经有直播了，请换个时间');\n    let $step2_form = $(\"#step2-form\");\n    this.validator2 = $step2_form.validate({\n      onkeyup: false,\n      rules: {\n        title: {\n          required: true,\n          maxlength: 50,\n          trim: true,\n          open_live_course_title: true,\n        },\n        startTime: {\n          required: true,\n          DateAndTime: true,\n          after_now:true,\n        },\n        length: {\n          required: true,\n          digits: true,\n          max: 300,\n          min: 1,\n          show_overlap_time_error: true\n        },\n        remark: {\n          maxlength: 1000\n        },\n      }\n    });\n    initEditor($('[name=\"remark\"]'), this.validator2);\n    $step2_form.data('validator', this.validator2);\n    this.dateTimePicker(this.validator2);\n    let that = this;\n    $step2_form.find('#startTime').change(function () {\n      that.checkOverlapTime($step2_form);\n    });\n\n    $step2_form.find('#length').change(function () {\n      that.checkOverlapTime($step2_form);\n    });\n  }\n\n  checkOverlapTime($step2_form) {\n    if ($step2_form.find('#startTime').val() && $step2_form.find('#length').val()) {\n      let showError = 1;\n      let params = {\n        startTime: $step2_form.find('#startTime').val(),\n        length: $step2_form.find('#length').val(),\n        mediaType: 'live'\n      };\n      $.ajax({\n        url: $step2_form.find('#length').data('url'),\n        async: false,\n        type: 'POST',\n        data: params,\n        dataType: 'json',\n        success: function (resp) {\n          showError = resp.success === 0;\n        }\n      });\n\n      $step2_form.find('#length').data('showError', showError);\n\n    }\n  }\n\n  dateTimePicker(validator) {\n    let $starttime = this.$startTime;\n    $starttime.datetimepicker({\n      format: 'yyyy-mm-dd hh:ii',\n      language: document.documentElement.lang,\n      autoclose: true,\n      endDate: new Date(Date.now() + 86400 * 365 * 10 * 1000)\n    }).on('hide', () => {\n      validator.form();\n    })\n    $starttime.datetimepicker('setStartDate', new Date());\n  }\n\n  _timePickerHide() {\n      let $starttime = this.$startTime;\n      parent.$('#modal', window.parent.document).on('afterNext',function(){\n          $starttime.datetimepicker('hide');\n      });\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./app/Resources/static-src/app/js/activity-manage/live/live.js"],"sourceRoot":""}