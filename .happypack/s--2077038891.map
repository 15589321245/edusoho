{"version":3,"sources":["app/Resources/static-src/app/common/component/question-picker/index.js"],"names":["QuestionPicker","$questionPickerBody","$questionAppendForm","$questionPickerModal","closest","_initEvent","find","on","searchQuestion","event","pickItem","questionPreview","pagination","$batchSelectSave","$","window","parent","document","batchSelectSave","$btn","currentTarget","get","attr","html","preventDefault","$this","$form","serialize","$target","replace","parseInt","data","questionId","questionIds","push","pickItemGet","url","replaceWith","remove","$tbody","length","append","removeClass","_refreshSeqs","modal","open","show","each","index","item","seq","$tr","hasClass","val"],"mappings":"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","file":"index.js","sourceRoot":"/Users/kz/projects/edusoho","sourcesContent":["import { questionSubjectiveRemask } from '../question-subjective';\n\nexport default class QuestionPicker {\n  constructor($questionPickerBody, $questionAppendForm) {\n    this.$questionPickerBody = $questionPickerBody;\n    this.$questionPickerModal = this.$questionPickerBody.closest('.modal');\n    this.$questionAppendForm = $questionAppendForm;\n    this._initEvent();\n  }\n\n  _initEvent() { \n    this.$questionPickerBody.find('[data-role=\"search-btn\"]').on('click', event=>this.searchQuestion(event));\n    this.$questionPickerBody.find('[data-role=\"picked-item\"]').on('click', event=>this.pickItem(event));\n    this.$questionPickerBody.find('[data-role=\"preview-btn\"]').on('click', event=>this.questionPreview(event));\n    this.$questionPickerBody.find('.pagination a').on('click', event=>this.pagination(event));\n\n    let $batchSelectSave = $('[data-role=\"batch-select-save\"]',window.parent.document);\n    $batchSelectSave.on('click',event=>this.batchSelectSave(event));\n  }\n\n\n  pagination(event) {\n    let $btn  =  $(event.currentTarget);\n    $.get($btn.attr('href'),html=> {\n      this.$questionPickerModal.html(html);\n    });\n    return false;\n  }\n\n  searchQuestion(event) {\n    event.preventDefault();\n    let $this = $(event.currentTarget);\n    let $form = $this.closest('form');\n    $.get($form.attr('action'), $form.serialize(), html => {\n      this.$questionPickerModal.html(html);\n    });\n  }\n\n  pickItem(event) {\n    let $target = $(event.currentTarget);\n    let replace = parseInt($target.data('replace'));\n    let questionId = $target.data('questionId');\n    let questionIds = [];\n    questionIds.push(questionId);\n    \n    this.pickItemGet($target.data('url'),questionIds,replace);\n  }\n\n  pickItemGet(url, questionIds, replace=null) {\n    $.get(url, {questionIds:questionIds}, html=> {\n      if (replace) {\n        this.$questionAppendForm.find('tr[data-id=\"'+replace+'\"]').replaceWith(html);\n        this.$questionAppendForm.find('tr[data-parent-id=\"'+replace+'\"]').remove();\n      } else {\n        \n        let $tbody = this.$questionAppendForm.find('tbody');\n        $tbody.length > 1 ? $tbody = this.$questionAppendForm.find('tbody:visible'): '';\n        this.$questionAppendForm.find('tbody:visible').append(html).removeClass('hide');\n      }\n      this._refreshSeqs();\n      questionSubjectiveRemask(this.$questionAppendForm);\n      this.$questionPickerModal.modal('hide');\n    });\n  }\n\n  questionPreview(event) {\n    window.open($(event.currentTarget).data('url'), '_blank',\"directories=0,height=580,width=820,scrollbars=1,toolbar=0,status=0,menubar=0,location=0\");\n  }\n\n  batchSelectSave(event) {\n    let $target = $(event.currentTarget);\n    let questionIds = [];\n    let url = $target.data('url');\n\n\n    if (this.$questionPickerBody.find('[data-role=\"batch-item\"]:checked').length == 0 ) {\n      $('.js-choice-notice',window.parent.document).show();\n      return;\n    }\n\n    this.$questionPickerBody.find('[data-role=\"batch-item\"]:checked').each(function(index,item){\n      let questionId = $(this).data('questionId');\n      questionIds.push(questionId);\n    })\n\n    this.pickItemGet(url, questionIds,null);\n  }\n\n  _refreshSeqs() {\n    let seq = 1;\n    this.$questionAppendForm.find('tbody tr').each(function(index,item) {\n      let $tr = $(item);\n      \n      if (!$tr.hasClass('have-sub-questions')) { \n        $tr.find('td.seq').html(seq);\n          seq ++;\n      }\n    });\n    this.$questionAppendForm.find('[name=\"questionLength\"]').val((seq - 1) > 0 ? (seq - 1) : null );\n  }\n}"]}