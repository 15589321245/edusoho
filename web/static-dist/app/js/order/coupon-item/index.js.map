{"version":3,"sources":["webpack:///./app/Resources/static-src/app/js/order/coupon-item/index.js"],"names":["Coupon","props","$element","element","$showDeductAmount","find","$noUseCouponCode","$couponCode","$selectCoupon","$couponNotify","$form","$","initEvent","init","on","couponSelect","event","showChangeCoupon","cancelCoupon","useCoupon","formSubmit","length","_setCoupon","val","_showDeductAmount","$this","currentTarget","coupon","_selectEmptyCoupon","_showCouponCode","focus","self","code","$productType","$productId","css","_formValidatePass","data","ajax","url","async","type","success","useable","addClass","text","message","_formValidateReject","Translator","trans","rate","removeClass","deduct_amount_format","_hideCouponCode","trigger","_checkCoupon","formValidate","button","amount","show","hide","value","triggerCaculate","_calculatePrice","attr","removeAttr"],"mappings":"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","file":"app/js/order/coupon-item/index.js","sourcesContent":["class Coupon {\n  constructor(props) {\n    this.$element = props.element;\n    this.$showDeductAmount = this.$element.find('#show-deduct-amount');\n    this.$noUseCouponCode = this.$element.find('#no-use-coupon-code');\n    this.$couponCode = this.$element.find(\"input[name='couponCode']\");\n    this.$selectCoupon = this.$element.find('#coupon-select');\n    this.$couponNotify =  this.$element.find('#code-notify');\n    this.$form = $('#order-create-form');\n    this.initEvent();\n    this.init();\n  }\n\n  initEvent() {\n    const $element = this.$element;\n    $element.on('change', '#coupon-select', event => this.couponSelect(event));\n    $element.on('click', '#change-coupon-code', event => this.showChangeCoupon(event));\n    $element.on('click', '#cancel-coupon', event => this.cancelCoupon(event));\n    $element.on('click', '#use-coupon', event => this.useCoupon(event));\n    this.$form.on('submit',event => this.formSubmit(event));\n  }\n\n  init() {\n    if (this.$selectCoupon.length > 0) {\n      this._setCoupon(this.$selectCoupon.val(), false);\n    }\n\n    this._showDeductAmount();\n  }\n\n  couponSelect(event) {\n    const $this = $(event.currentTarget);\n    const coupon = $this.find('option:selected');\n    const val = $this.val();\n\n    if (!val) {\n      this._selectEmptyCoupon();\n      return;\n    }\n\n    this._setCoupon(val);\n  }\n\n  showChangeCoupon(event) {\n    const $this = $(event.currentTarget);\n\n    this._showCouponCode();\n    this._setCoupon().focus();  \n  }\n\n  useCoupon() {\n    this._setCoupon(this.$couponCode.val());\n  }\n\n  _checkCoupon() {\n    let self = this;\n    let code = this.$couponCode.val();\n    if (!this.$productType) {\n      this.$productType = $(\"input[name='targetType']\");\n    }\n    if (!this.$productId) {\n      this.$productId = $(\"input[name='targetId']\");\n    }\n    if (!code) {\n        self.$couponNotify.css(\"display\",\"none\");\n        self._formValidatePass();\n        return;\n    }\n    let data = {\n      'code': code,\n      'targetType':this.$productType.val(),\n      'targetId': this.$productId.val(),\n      'price': $(\"input[name='price']\").val()\n    }\n\n    $.ajax({\n      url: $('#use-coupon').data('url'), \n      async: false,\n      type: 'POST',\n      data: data,\n      success: function(data){\n        if(data.useable == 'no'){\n          self.$couponNotify.addClass('alert-danger').text(data.message).css(\"display\",\"inline-block\");\n          self._showDeductAmount();\n          self._formValidateReject()\n        } else {\n          let text = data['type'] == 'discount' ? Translator.trans('order.create.use_discount_coupon_hint', {rate: data['rate']}) : Translator.trans('order.create.use_price_coupon_hint', {rate: data['rate']});\n          self.$couponNotify.removeClass('alert-danger').addClass(\"alert-success\").text(text).css(\"display\",\"inline-block\");\n          self._showDeductAmount(data.deduct_amount_format);\n          self._formValidatePass()\n        }\n      }\n    })\n  }\n\n  cancelCoupon(event) {\n    this._hideCouponCode();\n    if(this.$selectCoupon.length) {\n      this.$selectCoupon.trigger('change');\n    } else {\n      this._setCoupon();\n    }\n  }\n\n  formSubmit() {\n    this._checkCoupon();\n    if (this.formValidate === false) {\n      this.$form.find('#order-create-btn').button('reset');\n      return false;\n    }\n  }\n\n  _showDeductAmount(amount = this.$showDeductAmount.data('placeholder')) {\n    //显示优惠码优惠的金额\n    this.$showDeductAmount.text(amount);\n  }\n\n  _showCouponCode() {\n    //显示手动输入优惠码框,隐藏select，去除右侧优惠金额信息展示\n    $('#coupon-code').show();\n    $('#select-coupon-box').hide();\n    this._showDeductAmount();\n  }\n\n  _hideCouponCode() {\n    //隐藏手动输入优惠码框，显示select\n    $('#coupon-code').hide();\n    $('#select-coupon-box').show();\n  }\n\n  _selectEmptyCoupon() {\n    this._setCoupon();\n    this._showDeductAmount();\n  }\n\n  _setCoupon(value = '', triggerCaculate = true) {\n    //设置选择的优惠码code\n    this.$couponCode.val(value);\n    !value ? this.$noUseCouponCode.show() : this.$noUseCouponCode.hide();\n    this._checkCoupon();\n    if (triggerCaculate) {\n     this._calculatePrice();\n    }\n    return this.$couponCode;\n  }\n\n  _formValidatePass() {\n    this.formValidate = true;\n  }\n\n  _formValidateReject() {\n    this.formValidate = false;\n  }\n\n  _calculatePrice() {\n    if (this.formValidate === false) {\n      this.$couponCode.attr('disabled', 'disabled');\n    }\n\n    this.$form.trigger('calculatePrice');\n    this.$couponCode.removeAttr('disabled');\n  }\n}\n\n\nnew Coupon({\n  element: $('#coupon-deducts')\n});\n\n\n// WEBPACK FOOTER //\n// ./app/Resources/static-src/app/js/order/coupon-item/index.js"],"sourceRoot":""}