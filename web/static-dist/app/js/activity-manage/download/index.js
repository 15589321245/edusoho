webpackJsonp(["app/js/activity-manage/download/index"],[function(a,e,i){"use strict";function l(a){return a&&a.__esModule?a:{"default":a}}function t(){var a=$("#step2-form"),e=a.validate({rules:{title:{required:!0,maxlength:50},link:"url",materials:"required"},messages:{link:"链接地址不正确",materials:"请上传或选择%display%"}});a.data("validator",e)}function n(a){if(r($("#media").val())&&$("#step2-form").data("validator")&&$("#step2-form").data("validator").valid()&&$("#link").val().length>0){var e={source:"link",id:$("#link").val(),name:$("#link").val(),link:$("#link").val(),summary:$("#file-summary").val(),size:0};$(".js-current-file").text($("#link").val()),$("#media").val(JSON.stringify(e))}var i=r($("#media").val())?{}:JSON.parse($("#media").val()),l=r($("#materials").val())?{}:JSON.parse($("#materials").val());if(r(i))return void(0,m.default)("danger","请先选择资料");if(!r(l)&&l[i.id])return(0,m.default)("danger","选择重复"),void $("#media").val(null);if(a){if(!r(l)&&l[i.id])return(0,m.default)("danger","选择重复"),void $("#media").val(null);$(".js-current-file").text("无"),i.summary=$("#file-summary").val(),l[i.id]=i,$("#materials").val(JSON.stringify(l)),$("#media").val(null),$("#link").val(null),$("#file-summary").val(null);var t="";t=i.link?'\n    <li class="download-item " data-id="'+i.link+'">\n        <a class="gray-primary" href="'+i.link+'" target="_blank">'+i.name+'</a>\n        <a class="gray-primary phm btn-delete  js-btn-delete"  href="javascript:;"  title="{{\'删除\'|trans}}" data-url=""><i class="es-icon es-icon-cuowu"></i></a>\n        <span class="glyphicon glyphicon-new-window text-muted text-sm" title="{{\'网络链接资料\'|trans}}"></span>\n    </li>\n  ':'\n    <li class="download-item " data-id="'+i.id+'">\n      <a class="gray-primary" href="'+i.id+'">'+i.name+'</a>\n      <a class="gray-primary phm  btn-delete js-btn-delete" href="javascript:;" title="{{\'删除\'|trans}}" data-url=""><i class="es-icon es-icon-cuowu"></i></a>\n    </li>\n  ',$("#material-list").append(t),$(".jq-validate-error:visible").length>0&&$("#step2-form").data("validator").form()}}function r(a){return null==a||""==a||void 0==a||0==Object.keys(a).length}var s=i("eca7a2561fa47d3f75f6"),d=l(s),o=i("b334fd7e4c5a19234db2"),m=l(o),u=i("f324dbdea53170d5000f");jQuery.validator.addMethod("url",function(a,e){return this.optional(e)||/^(http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?$/.test(a)},"URL的格式不正确"),t(),$("#step2-form").on("click",".js-btn-delete",function(){var a=$(this).parents("li"),e=a.data("id"),i=r($("#materials").val())?{}:JSON.parse($("#materials").val());i&&i[e]&&(delete i[e],$("#materials").val(JSON.stringify(i))),a.siblings("li").length<=0&&$("#materials").val(null),a.remove()}),$("#step2-form").on("click",".js-video-import",function(){n(!1)}),$("#step2-form").on("click",".js-add-file-list",function(){n(!0)}),t();var f=function(a){$("input[name=media]").val(JSON.stringify(a)),(0,u.chooserUiOpen)(),n(!1),$(".js-current-file").text(a.name)},v=new d.default;v.on("select",f)}]);