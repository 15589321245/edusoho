{"version":3,"sources":["app/Resources/static-src/app/js/activity-manage/download/index.js"],"names":["DownLoad","$form","$","validator2","initStep2Form","validator","validate","rules","title","required","maxlength","trim","link","materials","messages","data","on","$parent","parents","mediaId","items","isEmpty","val","JSON","parse","stringify","siblings","length","remove","addFile","addToList","hide","valid","source","id","name","summary","size","text","media","Translator","trans","show","setTimeout","slideUp","item_tpl","append","tooltip","removeClass","form","_inItStep2form","obj","undefined","Object","keys","fileSelect","file","fileChooser"],"mappings":"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","file":"index.js","sourceRoot":"/Users/kz/projects/edusoho","sourcesContent":["import FileChooser from '../../file-chooser/file-choose';\nimport notify from 'common/notify';\nimport { chooserUiOpen } from '../widget/chooser-ui.js';\n\n\nclass DownLoad {\n  constructor() {\n    this.$form = $('#step2-form');\n    this.validator2 = null;\n    this.initStep2Form();\n  }\n  initStep2Form() {\n    var validator = this.$form.validate({\n      rules: {\n        title: {\n          required: true,\n          maxlength: 50,\n          trim: true,\n        },\n        link: 'url',\n        materials: 'required',\n      },\n      messages: {\n        link: \"链接地址不正确\",\n        materials: '请上传或选择%display%'\n      }\n    });\n\n    this.$form.data('validator', validator);\n  }\n\n  itemDelete() {\n\n  }\n\n}\n\n\n\n\n$('#step2-form').on('click', '.js-btn-delete', function () {\n  let $parent = $(this).parents('li');\n  let mediaId = $parent.data('id');\n  let items = isEmpty($(\"#materials\").val()) ? {} : JSON.parse($(\"#materials\").val());\n  if (items && items[mediaId]) {\n    delete items[mediaId];\n    $(\"#materials\").val(JSON.stringify(items));\n  }\n  if ($parent.siblings('li').length <= 0) {\n    $(\"#materials\").val(null);\n  }\n  $parent.remove();\n})\n\n$('#step2-form').on('click', '.js-video-import', function () {\n  addFile(false);\n})\n\n$('#step2-form').on('click', '.js-add-file-list', function () {\n  addFile(true);\n})\n\nfunction addFile(addToList) {\n  $('.js-success-redmine').hide();\n  if (isEmpty($(\"#media\").val()) && $(\"#step2-form\").data('validator') && $(\"#step2-form\").data('validator').valid() && $(\"#link\").val().length > 0) {\n    if (!addToList) {\n      $(\"#verifyLink\").val($(\"#link\").val());\n    }\n    let data = {\n      source: 'link',\n      id: $(\"#verifyLink\").val(),\n      name: $(\"#verifyLink\").val(),\n      link: $(\"#verifyLink\").val(),\n      summary: $(\"#file-summary\").val(),\n      size: 0\n    };\n    $('.js-current-file').text($(\"#verifyLink\").val());\n    $(\"#media\").val(JSON.stringify(data));\n  }\n\n\n  let media = isEmpty($(\"#media\").val()) ? {} : JSON.parse($(\"#media\").val());\n  let items = isEmpty($(\"#materials\").val()) ? {} : JSON.parse($(\"#materials\").val());\n\n  if (!isEmpty(items) && items[media.id]) {\n    $('.js-danger-redmine').text(Translator.trans('该文件已添加，请重新选择')).show();\n    setTimeout(function () {\n      $('.js-danger-redmine').slideUp();\n    }, 3000);\n    $('.js-current-file').text('');\n    $(\"#media\").val(null);\n    media = null;\n    return;\n  }\n\n  if (!addToList) {\n    return;\n  }\n\n  if (addToList && isEmpty(media)) {\n    $('.js-danger-redmine').text(Translator.trans('请上传或选择要添加的资料')).show();\n    $('.js-current-file').text('');\n    setTimeout(function () {\n      $('.js-danger-redmine').slideUp();\n    }, 3000);\n    return;\n  }\n\n\n  $('.js-current-file').text('');\n  media.summary = $(\"#file-summary\").val();\n  items[media.id] = media;\n  $(\"#materials\").val(JSON.stringify(items));\n\n  $(\"#media\").val(null);\n  $('#link').val(null);\n  $(\"#file-summary\").val(null);\n\n\n  let item_tpl = '';\n  if (media.link) {\n    item_tpl = `\n    <li class=\"download-item \" data-id=\"${media.link}\">\n        <a class=\"gray-primary\" href=\"${ media.link}\" target=\"_blank\">${media.name}</a>\n        <a class=\"gray-primary phm btn-delete  js-btn-delete\"  href=\"javascript:;\"  data-url=\"\" data-toggle=\"tooltip\" data-placement=\"top\" title=\"{{ '删除'|trans }}\"><i class=\"es-icon es-icon-delete\"></i></a>\n        <span class=\"glyphicon glyphicon-new-window text-muted text-sm\" title=\"${Translator.trans('删除')}\"></span>\n    </li>\n  `;\n  } else {\n    item_tpl = `\n    <li class=\"download-item \" data-id=\"${media.id}\">\n      <a class=\"gray-primary\" href=\"/materiallib/${ media.id}/download\">${media.name}</a>\n      <a class=\"gray-primary phm  btn-delete js-btn-delete\" href=\"javascript:;\"  data-url=\"\" data-toggle=\"tooltip\" data-placement=\"top\" title=\"${Translator.trans('删除')}\"><i class=\"es-icon es-icon-delete\"></i></a>\n    </li>\n  `;\n  }\n  $(\"#material-list\").append(item_tpl);\n  $('[data-toggle=\"tooltip\"]').tooltip();\n  $('.file-browser-item').removeClass('active');\n  $('.js-danger-redmine').hide();\n  $('.js-success-redmine').text(Translator.trans('添加成功，可继续选择资料添加或点击下一步！')).show();\n  setTimeout(function () {\n    $('.js-success-redmine').slideUp();\n  }, 3000);\n  if ($('.jq-validate-error:visible').length > 0) {\n    $(\"#step2-form\").data('validator').form();\n  }\n}\n\n_inItStep2form();\n\n\nfunction isEmpty(obj) {\n  return obj == null || obj == \"\" || obj == undefined || Object.keys(obj).length == 0;\n}\nconst fileSelect = file => {\n  $(\"input[name=media]\").val(JSON.stringify(file));\n  chooserUiOpen();\n  addFile(false);\n  $('.js-current-file').text(file.name);\n}\n\nconst fileChooser = new FileChooser();\n\nfileChooser.on('select', fileSelect);"]}