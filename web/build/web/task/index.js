webpackJsonp(["web/task/index"],{0:function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),u=n("04dc5862fcacba061f7e"),l=i(u),c=n("fe9af0dbab4f11e070d7"),f=i(c),d=n("948aef58dee032b622b9"),h=i(d),p=n("e3c46672cecffb62cb73"),v=i(p),b=function(e){function t(e){var n=e.element,i=e.courseId,o=e.taskId;r(this,t);var s=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return s.element=$(n),s.courseId=i,s.taskId=o,s.eventEmitter=new h.default(s.element.find("#task-content-iframe")),s.ui=new f.default({element:".js-task-dashboard-page"}),s.init(),s}return o(t,e),s(t,[{key:"init",value:function(){this.initPlugin(),this.sidebar(),this.bindEvent()}},{key:"initPlugin",value:function(){$('[data-toggle="tooltip"]').tooltip(),$('[data-toggle="popover"]').popover({html:!0,trigger:"hover"})}},{key:"bindEvent",value:function(){var e=this,t=0,n=6e4,i=2;this.delay("doing",function(n){t=parseInt(n)+parseInt(t),e.eventEmitter.emit("doing",{timeStep:n,learnedTime:t,taskId:e.taskId}).then(function(t){e.trigger("doing",n)})},i*n),this.trigger("doing",i),this.element.on("click",".js-btn-learn",function(t){e.eventEmitter.emit("finish",{taskId:e.taskId}).then(function(){e.ui.learned()})}),this.bindEmitterEvent()}},{key:"bindEmitterEvent",value:function(){var e=this;this.eventEmitter.receive("finish",function(t){e.onActivityFinish(t)})}},{key:"onActivityFinish",value:function(e){this.ui.learnedWeakPrompt(),this.ui.learned()}},{key:"sidebar",value:function(){this.sideBar=new l.default({element:".js-task-dashboard-page",activePlugins:["task","note","question"],courseId:this.courseId,taskId:this.taskId})}}]),t}(v.default);new b({element:$("body"),courseId:$("body").find('#js-hidden-data [name="course-id"]').val(),taskId:$("body").find('#js-hidden-data [name="task-id"]').val()})},"948aef58dee032b622b9":function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),o=n("b704ce0ef0c1bec36938"),s=i(o),u=function(){function e(t){var n=this;if(r(this,e),this.element=$(t),this.eventUrl=this.element.data("eventUrl"),void 0===this.eventUrl)throw Error("task event url is undefined");this.eventMap={receives:{}},this.receiveMessenger=new s.default("TaskMessenger","ActivityEvent"),this.receiveMessenger.addTarget(this.element.get(0).contentWindow,"task-content-iframe"),this.receiveMessenger.listen(function(e){var t=JSON.parse(e),i=t.event,r=t.data,a=n.eventMap.receives[i];$.post(n.element.data("eventUrl"),{eventName:i,data:r}).done(function(e){var t=e.event,i=e.data;"undefined"!=typeof a&&a.forEach(function(e){return e(i)}),n.receiveMessenger.send(JSON.stringify({event:t,data:i}))}).fail(function(e){n.receiveMessenger.send(JSON.stringify({event:i,error:e}))})}),this.emitMessenger=new s.default("TaskMessenger","TaskEvent"),this.emitMessenger.addTarget(this.element.get(0).contentWindow,"task-content-iframe")}return a(e,[{key:"emit",value:function(e,t){var n=this;return new Promise(function(i,r){$.post(n.eventUrl,{eventName:e,data:t}).done(function(e){n.emitMessenger.send(JSON.stringify({event:e.event,data:e.data})),i(e.data)}).fail(function(e){r(e)})})}},{key:"receive",value:function(e,t){this.eventMap.receives[e]=this.eventMap.receives[e]||[],this.eventMap.receives[e].push(t)}}]),e}();t.default=u},"4e26fe8c47973e6a2b3a":function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),u=n("3b9f35b6e5d7f3c8a19c"),l=i(u),c=n("6953fb8bcc952da6c9da"),f=i(c),d=function(e){function t(e){r(this,t);var n=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.code="note",n.name=Translator.trans("笔记"),n.iconClass="es-icon es-icon-edit",n.api={init:"../../lessonplugin/note/init",save:"../../lessonplugin/note/save"},n.pane=null,n}return o(t,e),s(t,[{key:"execute",value:function(){this.pane||(this.pane=new f.default({element:this.toolbar.createPane(this.code),code:this.code,toolbar:this.toolbar,plugin:this})),this.pane.show()}}]),t}(l.default);t.default=d},"3b9f35b6e5d7f3c8a19c":function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function e(t){n(this,e),this.toolbar=t};t.default=i},"6953fb8bcc952da6c9da":function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=function(){function e(t){n(this,e),this.$element=t.element,this.$form=this.$element.find("#lesson-note-plugin-form"),this.$saveMessage=this.$element.find("[data-role=saved-message]"),this.plugin=t.plugin,this.editor=null,this.content="",this.timer=null}return i(e,[{key:"show",value:function(){var e=this,t=this.plugin,n=t.toolbar;n.showPane(this.plugin.code),this.$element.perfectScrollbar({wheelSpeed:50}),$.get("http://www.esdev.com/lessonplugin/note/init",{courseId:n.courseId,lessonId:n.taskId},function(t){e.$element.html(t),e.editor=CKEDITOR.replace("note_content",{toolbar:"Simple",filebrowserImageUploadUrl:e.$element.find("#note_content").data("imageUploadUrl"),height:320}),e.editor.focusManager.focus(),e.$form.on("submit",function(t){return e.$saveMessage.html(Translator.trans("正在保存")).show(),e.editor.updateElement(),e.content=e.editor.getData(),$.post(e.$form.attr("action"),e.$form.serialize(),function(e){this.$saveMessage.html(Translator.trans("已保存")),setTimeout(function(){this.$saveMessage.hide()},3e3)},"json").error(function(e){}),!1}),e.autosave()})}},{key:"autosave",value:function(){var e=this;this.timer&&clearInterval(this.timer);var t=setInterval(function(){e.editor.getData()!=e.content&&e.$form.trigger("submit")},1e4);this.timer=t}}]),e}();t.default=r},"04dc5862fcacba061f7e":function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),o=n("4e26fe8c47973e6a2b3a"),s=i(o),u=n("6fae754daebe55bd2559"),l=i(u),c=n("210bdf1e482170616168"),f=i(c);n("d5e8fa5f17ac5fe79c78");var d=function(){function e(t){var n=t.element,i=t.courseId,a=t.taskId,o=t.activePlugins;r(this,e),this.$element=$(n),this.courseId=i,this.taskId=a,this.activePlugins=o,this.plugins={},this._currentPane=null,this.$dashboardsidebar=this.$element.find("#dashboard-sidebar"),this.$dashboardcontent=$("#dashboard-content"),this._init()}return a(e,[{key:"_init",value:function(){this._registerPlugin(new f.default(this)),this._registerPlugin(new s.default(this)),this._registerPlugin(new l.default(this)),this._initPlugin(),this._isRenderSiderBar()}},{key:"_registerPlugin",value:function(e){this.plugins[e.code]=e,e.onRegister&&e.onRegister()}},{key:"_initPlugin",value:function(){var e=this,t="";$.each(this.activePlugins,function(n,i){var r=e.plugins[i];t+='<li data-plugin="'+r.code+'" data-noactive="'+r.noactive+'"><a href="#"><div class="mbs '+r.iconClass+'"></div>'+r.name+"</a></li>"}),$("#dashboard-toolbar-nav").append(t).on("click","li[data-plugin]",function(t){var n=$(t.currentTarget);return n.hasClass("active")?(e._rendBar(n,!1),void e._renderSiderBar(!1)):(e._currentPane&&n.data("plugin")==e._currentPane||e.plugins[n.data("plugin")].execute(),e._rendBar(n,!0),void e._renderSiderBar(!0))})}},{key:"_renderSiderBar",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n="0px",i="379px";e||(n="-"+this.$dashboardsidebar.width()+"px",i="26px"),this.$dashboardsidebar.animate({right:n},t),this.$dashboardcontent.animate({right:i},t)}},{key:"_rendBar",value:function(e,t){t?e.addClass("active").siblings("li").removeClass("active"):e.removeClass("active")}},{key:"_getPaneContainer",value:function(){return this.$element}},{key:"_getPane",value:function(e){var t=this._getPaneContainer().find("[data-pane="+e+"]");if(0!==t.length)return t}},{key:"_isRenderSiderBar",value:function(){var e=this;store.get("USER-START-LEARN")||(store.set("USER-START-LEARN",!0),this._renderSiderBar(!0,"2000"),window.setTimeout(function(){e._renderSiderBar(!1,"2000")},2e3))}},{key:"createPane",value:function(e){var t=this._getPane(e);return t||(t=$('<div data-pane="'+e+'" class="dashboard-pane '+e+'-pane"></div>').appendTo(this.$dashboardsidebar)),t}},{key:"showPane",value:function(e){this._getPaneContainer().find("[data-pane]").hide(),this._getPaneContainer().find("[data-pane="+e+"]").show(),this._getPaneContainer().show(),this._currentPane=e,$(".hide-pane").show()}}]),e}();t.default=d},"63f04f40d1cf0454aeb5":function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=function(){function e(t){n(this,e),this.$element=t.element,this.dataInitialized=!1,this.createFormId="lesson-question-plugin-form",this.editor=null,this.createFormElement=null,this.plugin=t.plugin,this._init()}return i(e,[{key:"_init",value:function(){var e=this;this.$element.on("focusin",".expand-form-trigger",function(t){return e.expandForm(t)}),$(".collapse-form-btn").click(function(t){return e.collapseForm(t)}),$(".show-question-item").click(function(t){return e.showItem(t)}),$(".back-to-list").click(function(t){return e.backToList(t)})}},{key:"showList",value:function(){var e=this,t=this.plugin.toolbar;$.get("http://www.esdev.com/lessonplugin/question/init",{courseId:t.courseId,lessonId:t.lessonId},function(t){e._dataInitialized=!0,e.$element.html(t),e.createFormElement=$("#"+e.createFormId),e._showListPane()})}},{key:"show",value:function(){this.plugin.toolbar.showPane(this.plugin.code),this.showList()}},{key:"expandForm",value:function(){var e=this.createFormElement;if(!e.hasClass("form-expanded")){e.addClass("form-expanded");var t=CKEDITOR.replace("question_content",{toolbar:"Simple",filebrowserImageUploadUrl:$("#question_content").data("imageUploadUrl")});this.editor=t,this.createFormElement.find(".js-detail-form-group").removeClass("hide")}}},{key:"collapseForm",value:function(){this.createFormElement.removeClass("form-expanded"),this.editor&&this.editor.destroy(),this.clearForm(),this.createFormElement.find(".js-detail-form-group").addClass("hide")}},{key:"clearForm",value:function(){this.createFormElement.find("input[type=text],textarea").each(function(){$(this).val("")})}},{key:"showItem",value:function(e){var t=this,n=this.plugin.toolbar,i=$(e.currentTarget);$.get(this.plugin.api.show,{courseId:n.courseId,id:i.data("id")},function(e){t._showItemPane().html(e),t._showWidget.trigger("reload")})}},{key:"backToList",value:function(e){this.showList()}},{key:"_showListPane",value:function(){return $("[data-role=show-pane]").hide(),$("[data-role=list-pane]").show(),this.$element.perfectScrollbar({wheelSpeed:50}),$("[data-role=list-pane]")}},{key:"_showItemPane",value:function(){return $("[data-role=list-pane]").hide(),$("[data-role=show-pane]").show()}}]),e}();t.default=r},"210bdf1e482170616168":function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),u=n("3b9f35b6e5d7f3c8a19c"),l=i(u),c=n("3fba74ab5d5281b3a55d"),f=i(c),d=function(e){function t(e){r(this,t);var n=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.code="task",n.name=Translator.trans("课程"),n.iconClass="es-icon es-icon-menu",n.api={list:"../../lessonplugin/lesson/list"},n.pane=null,n}return o(t,e),s(t,[{key:"execute",value:function(){this.pane||(this.pane=new f.default({element:this.toolbar.createPane(this.code),code:this.code,toolbar:this.toolbar,plugin:this})),this.pane.show()}}]),t}(l.default);t.default=d},"3fba74ab5d5281b3a55d":function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=function(){function e(t){n(this,e),this.plugin=t.plugin,this.toolbar=this.plugin.toolbar,this.$element=t.element,this.init()}return i(e,[{key:"init",value:function(){this.$element.perfectScrollbar(),$.get("http://www.esdev.com/lessonplugin/lesson/list",{courseId:toolbar.courseId},function(e){})}},{key:"show",value:function(){this.toolbar.showPane(this.plugin.code)}}]),e}();t.default=r},fe9af0dbab4f11e070d7:function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=function(){function e(t){n(this,e),this.element=$(t),this.learningPrompt=this.element.find(".js-learning-prompt"),this.learnedPrompt=this.element.find(".js-learned-prompt"),this.learnprompt=this.element.find(".js-learn-prompt"),this.btnLearn=this.element.find(".js-btn-learn")}return i(e,[{key:"learnedWeakPrompt",value:function(){var e=this;this.learnprompt.removeClass("open"),this.learningPrompt.addClass("moveup"),window.setTimeout(function(){e.learningPrompt.removeClass("moveup"),e.learnedPrompt.addClass("moveup")},2e3)}},{key:"learned",value:function(){this.btnLearn.addClass("active")}}]),e}();t.default=r},"6fae754daebe55bd2559":function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),u=n("3b9f35b6e5d7f3c8a19c"),l=i(u),c=n("63f04f40d1cf0454aeb5"),f=i(c),d=function(e){function t(e){r(this,t);var n=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.code="question",n.name=Translator.trans("问答"),n.iconClass="es-icon es-icon-help",n.api={init:"../../lessonplugin/question/init",list:"../../lessonplugin/question/list",show:"../../lessonplugin/question/show",create:"../../lessonplugin/question/create",answer:"../../lessonplugin/question/answer"},n.pane=null,n}return o(t,e),s(t,[{key:"execute",value:function(){this.pane||(this.pane=new f.default({element:this.toolbar.createPane(this.code),code:this.code,toolbar:this.toolbar,plugin:this})),this.pane.show()}}]),t}(l.default);t.default=d}});