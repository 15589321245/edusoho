webpackJsonp(["app/js/task-manage/create/index"],{"92bf3ad15db28fd41545":function(e,t,a){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var a=0;a<t.length;a++){var s=t[a];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,a,s){return a&&e(t.prototype,a),s&&e(t,s),t}}(),r=a("b4fbf03f4f16003fe503"),d=s(r);a("a52ee3f9747e09bd43d1");var o=a("b334fd7e4c5a19234db2"),l=s(o),f=a("423d5c93d4f10f876e3b"),u=s(f),h=a("4e68e437f5b716377a9d"),c=function(){function e(t){i(this,e),this.$element=t,this.$task_manage_content=$("#task-create-content"),this.$task_manage_type=$("#task-create-type"),this.$frame=null,this.$iframe_body=null,this.iframe_jQuery=null,this.iframe_name="task-create-content-iframe",this.mode=this.$task_manage_type.data("editorMode"),this.type=this.$task_manage_type.data("editorType"),this.step=1,this.loaded=!1,this.contentUrl="",this._init(),this._initEvent()}return n(e,[{key:"_initEvent",value:function(){var e=this;$("#course-tasks-submit").click(function(t){return e._onSave(t)}),$("#course-tasks-next").click(function(t){return e._onNext(t)}),$("#course-tasks-prev").click(function(t){return e._onPrev(t)}),"edit"!=this.mode?$(".js-course-tasks-item").click(function(t){return e._onSetType(t)}):$(".delete-task").click(function(t){return e._onDelete(t)})}},{key:"_init",value:function(){this._inItStep1form(),this._renderContent(this.step),"edit"==this.mode&&(this.contentUrl=this.$task_manage_type.data("editorStep2Url"),this.step=2,this._switchPage())}},{key:"_onNext",value:function(e){3!==this.step&&this._validator(this.step)&&(this.step+=1,this._switchPage())}},{key:"_onPrev",value:function(){1===this.step||3==this.step&&!this._validator(this.step)||(this.step-=1,this._switchPage())}},{key:"_onSetType",value:function(e){var t=$(e.currentTarget).addClass("active");t.siblings().removeClass("active");var a=t.data("type");$('[name="mediaType"]').val(a),this.contentUrl=t.data("contentUrl"),this.loaded=this.type===a,this.type=a,this._onNext(e)}},{key:"_onSave",value:function(e){var t=this;if(this._validator(this.step)){$(e.currentTarget).attr("disabled","disabled");var a=$("#step1-form").serializeArray().concat(this.$iframe_body.find("#step2-form").serializeArray()).concat(this.$iframe_body.find("#step3-form").serializeArray());$.post(this.$task_manage_type.data("saveUrl"),a).done(function(e){var s=e.append,i=e.html;t.$element.modal("hide"),$(".js-task-empty").hasClass("hidden")||$(".js-task-empty").addClass("hidden"),s===!1&&document.location.reload();var n=a.find(function(e){return"chapterId"==e.name}),r=0,d=$("#"+n.value),o=null;d.length?(d.nextAll().each(function(){return $(this).hasClass("task-manage-chapter")?($(this).before(i),r=1,(0,h.sortablelist)("#sortable-list"),!1):d.hasClass("task-manage-unit")&&$(this).hasClass("task-manage-unit")?($(this).before(i),r=1,(0,h.sortablelist)("#sortable-list"),!1):void 0}),1!=r&&(o=$(i),$("#sortable-list").append(o),r=1)):(o=$(i),$("#sortable-list").append(o)),t.showDefaultSetting(o),t.initIntro(),(0,h.sortablelist)("#sortable-list")}).fail(function(e){var t="",a=JSON.parse(e.responseText);a.error&&a.error.message&&(t=a.error.message),(0,l.default)("warning","保存出错: "+t),$("#course-tasks-submit").attr("disabled",null)})}}},{key:"initIntro",value:function(){setTimeout(function(){if(1===$(".js-settings-list").length){var e=new u.default;e.initTaskDetailIntro(".js-settings-list")}},500)}},{key:"showDefaultSetting",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;e&&e.hasClass("js-task-manage-item")&&($(".js-task-manage-item").removeClass("active").find(".js-settings-list").slideUp(),e.addClass("active").find(".js-settings-list").slideDown())}},{key:"_onDelete",value:function(e){var t=this,a=$(e.currentTarget),s=a.data("url");void 0!==s&&confirm(Translator.trans("是否确定删除该任务吗？"))&&$.post(s).then(function(e){(0,l.default)("success","删除成功"),t.$element.modal("hide"),document.location.reload()}).fail(function(e){(0,l.default)("warning","删除失败~~")})}},{key:"_switchPage",value:function(){this._renderStep(this.step),this._renderContent(this.step),this._rendStepIframe(this.step),this._rendButton(this.step),2!=this.step||this.loaded||this._initIframe()}},{key:"_initIframe",value:function(){var e=this,t='<iframe class="'+this.iframe_name+'" id="'+this.iframe_name+'" name="'+this.iframe_name+'" scrolling="no" src="'+this.contentUrl+'"></iframe>';this.$task_manage_content.html(t).show(),this.$frame=$("#"+this.iframe_name).iFrameResize();var a=function(){e.loaded=!0;var t={};e.iframe_jQuery=e.$frame[0].contentWindow.$,e.$iframe_body=e.$frame.contents().find("body").addClass("task-iframe-body"),e._rendButton(2),e.$iframe_body.find("#step2-form").data("validator",t),e.$iframe_body.find("#step3-form").data("validator",t)};this.$frame.load((0,d.default)(a,this.$task_manage_content))}},{key:"_inItStep1form",value:function(){var e=$("#step1-form"),t=e.validate({rules:{mediaType:{required:!0}},messages:{mediaType:"请选择%display%"}});e.data("validator",t)}},{key:"_validator",value:function(e){var t=null;if(1===e)t=$("#step1-form").data("validator");else if(this.loaded){var a=this.$iframe_body.find("#step"+e+"-form");t=this.iframe_jQuery.data(a[0],"validator")}return!(t&&!t.form())}},{key:"_rendButton",value:function(e){if(1===e)this._renderPrev(!1),this._rendSubmit(!1),this._renderNext(!0);else if(2===e){if(this._renderPrev(!0),"edit"===this.mode&&this._renderPrev(!1),!this.loaded)return this._rendSubmit(!1),void this._renderNext(!1);this._rendSubmit(!0),this._renderNext(!0)}else 3===e&&(this._renderNext(!1),this._renderPrev(!0))}},{key:"_rendStepIframe",value:function(e){this.loaded&&this.$iframe_body&&(2===e?this.$iframe_body.find(".js-step2-view").addClass("active"):this.$iframe_body.find(".js-step2-view").removeClass("active"),3===e?this.$iframe_body.find(".js-step3-view").addClass("active"):this.$iframe_body.find(".js-step3-view").removeClass("active"))}},{key:"_renderStep",value:function(e){$("#task-create-step").find("li:eq("+(e-1)+")").addClass("doing").prev().addClass("done").removeClass("doing"),$("#task-create-step").find("li:eq("+(e-1)+")").next().removeClass("doing").removeClass("done")}},{key:"_renderContent",value:function(e){1===e?this.$task_manage_type.removeClass("hidden"):this.$task_manage_type.addClass("hidden"),1!==e?this.$task_manage_content.removeClass("hidden"):this.$task_manage_content.addClass("hidden")}},{key:"_renderNext",value:function(e){e?$("#course-tasks-next").removeClass("hidden").removeAttr("disabled"):$("#course-tasks-next").addClass("hidden")}},{key:"_renderPrev",value:function(e){e?$("#course-tasks-prev").removeClass("hidden"):$("#course-tasks-prev").addClass("hidden")}},{key:"_rendSubmit",value:function(e){e?$("#course-tasks-submit").removeClass("hidden"):$("#course-tasks-submit").addClass("hidden")}}]),e}();t.default=c},0:function(e,t,a){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}var i=a("92bf3ad15db28fd41545"),n=s(i);new n.default($("#modal"))},b4fbf03f4f16003fe503:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=arguments,s=function(e,t){var s=$('<div class="load-animation"></div>');s.prependTo(t).nextAll().hide(),t.append();var i=[],n=e.length;return function(t){return i.push(t),s.hide().nextAll().show(),i.length<n?a.callee:e.apply(null,i)}};t.default=s}});