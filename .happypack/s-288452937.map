{"version":3,"sources":["app/Resources/static-src/app/js/group/thread-opreate.js"],"names":["initThread","btn","$form","$","toolbar","replace","formValidator","validate","currentDom","ajax","rules","required","minlength","visible_character","submitError","data","responseText","parseJSON","error","message","Translator","trans","submitSuccess","console","log","window","location","href","url","reload","click","form","initThreadReplay","$forms","each","content","find","attr","ignore","submitHandler","$replyBtn","postId","fromUserIdVal","length","val","button","addClass","cache","async","type","dataType","success","removeClass","e"],"mappings":"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","file":"thread-opreate.js","sourceRoot":"/Users/kz/projects/edusoho","sourcesContent":["import { initEditor } from './editor';\nimport notify from 'common/notify';\nimport AttachmentActions from 'app/js/attachment/widget/attachment-actions';\n\nexport const initThread = () => {\n  let btn = '#post-thread-btn';\n  let $form = $(\"#post-thread-form\");\n  new AttachmentActions($form);\n  initEditor({\n    toolbar: 'Thread',\n    replace: 'post_content'\n  });\n  let formValidator = $form.validate({\n    currentDom: btn,\n    ajax: true,\n    rules: {\n      'content': {\n        required: true,\n        minlength: 2,\n        visible_character: true\n      }\n    },\n    submitError: function () {\n      data = data.responseText;\n      data = $.parseJSON(data);\n      if (data.error) {\n        notify('danger', data.error.message);\n      } else {\n        notify('danger', Translator.trans('发表回复失败，请重试'));\n      }\n    },\n    submitSuccess: function (data) {\n      console.log(data);\n      if (data == \"/login\") {\n        window.location.href = url;\n        return;\n      }\n      // @TODO优化不刷新页面\n      window.location.reload();\n    },\n  });\n  console.log(formValidator);\n  $(btn).click(() => {\n    formValidator.form();\n  })\n}\n\nexport const initThreadReplay = () => {\n  let $forms = $('.thread-post-reply-form');\n  $forms.each(function () {\n    let $form = $(this);\n    let content = $form.find('textarea').attr('name');\n    let formValidator = $form.validate({\n      ignore: '',\n      rules: {\n        [`${content}`]: {\n          required: true,\n          minlength: 2,\n          visible_character: true\n        }\n      },\n      submitHandler: function (form) {\n        // @TODO优化全局的submitHandler方法，提交统一方式；\n        var $replyBtn = $(form).find('.reply-btn');\n        var postId = $replyBtn.attr('postId');\n        var fromUserIdVal = \"\";\n        if ($('#fromUserId').length > 0) {\n          fromUserIdVal = $('#fromUserId').val();\n        } else {\n          if ($('#fromUserIdNosub').length > 0) {\n            fromUserIdVal = $('#fromUserIdNosub').val();\n          } else {\n            fromUserIdVal = \"\";\n          }\n        }\n        $replyBtn.button('submiting').addClass('disabled');\n        console.log($(form).attr('action'));\n        console.log(\"content=\" + $(form).find('textarea').val() + '&' + 'postId=' + postId + '&' + 'fromUserId=' + fromUserIdVal);\n        $.ajax({\n          url: $(form).attr('action'),\n          data: \"content=\" + $(form).find('textarea').val() + '&' + 'postId=' + postId + '&' + 'fromUserId=' + fromUserIdVal,\n          cache: false,\n          async: false,\n          type: \"POST\",\n          dataType: 'text',\n          success: function (url) {\n            if (url == \"/login\") {\n              window.location.href = url;\n              return;\n            }\n            // @TODO优化不刷新页面\n            window.location.reload();\n          },\n          error: function (data) {\n            data = $.parseJSON(data.responseText);\n            if (data.error) {\n              notify('danger',data.error.message);\n            } else {\n              notify('danger',Translator.trans('发表回复失败，请重试'));\n            }\n            $replyBtn.button('reset').removeClass('disabled');\n          }\n        });\n      }\n    });\n    $form.find('button').click((e) => {\n      formValidator.form()\n    })\n  })\n}"]}