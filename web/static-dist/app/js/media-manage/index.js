webpackJsonp(["app/js/media-manage/index"],{"16dca8fd088a3c871f3f":function(t,e,i){"use strict";function n(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}function s(t){return t&&t.__esModule?t:{default:t}}function a(t,e){var i=$("#editbox-lesson-list").width(),n=parseInt(e),s=t*i/n;return s+20}function o(t,e){return Math.round((t-20)*e/$("#editbox-lesson-list").width())}for(var r=i("609d911a24b2b709511a"),l=s(r),c=i("9181c6995ae8c5c94b7a"),u=n(c),d=$(".js-editbox"),h=$("#editbox-lesson-list"),f=6,p=d.data("mediaLength"),m=p/f,v=0;v<=f;v++){var g=$('[data-role="scale-default"]').clone().css("left",a(m*v,p)).removeClass("hidden").removeAttr("data-role");g.find('[data-role="scale-time"]').text(u.sec2Time(Math.round(m*v))),$('[data-role="scale-default"]').before(g)}l.default.on("timechange",function(t){$(".scale-white").css("left",a(t.currentTime,p))}),$(".scale-white").on("mousedown",function(t){var e=!1;$(document).on("mousemove.playertime",function(t){window.getSelection?window.getSelection().removeAllRanges():document.selection.empty();var e=t.pageX>h.width()+20?h.width()+20:t.pageX&&t.pageX<=20?20:t.pageX;$(".scale-white").css("left",e);var i=o(e,p);l.default.sendToChild({id:"viewerIframe"},"setCurrentTime",{time:i})}).on("mouseup.playertime",function(t){$(document).off("mousemove.playertime"),$(document).off("mousedown.playertime"),e=!0})})},0:function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}var s=i("4e9151fb4a048110077b"),a=n(s);new a.default},"4e9151fb4a048110077b":function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var a=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}();i("b26ed6014df6ee9a0332"),i("16dca8fd088a3c871f3f");var o=i("90c40b9c35e074e923b0"),r=n(o),l=i("609d911a24b2b709511a"),c=n(l),u=i("b334fd7e4c5a19234db2"),d=n(u),h=i(!function(){var t=new Error('Cannot find module "subtitle"');throw t.code="MODULE_NOT_FOUND",t}()),f=n(h),p=$(".text-track-overview"),m=$("#uploader"),v=function(){function t(){s(this,t),this.select=null,this.init()}return a(t,[{key:"init",value:function(){this.initTextDisplay(),this.initSelect(),this.initUploader()}},{key:"initTextDisplay",value:function(){var t=$(".manage-edit-body").height(),e=$(".nav-tabs-edit").height(),i=$(".text-track-title").height(),n=$("#track-select").height();p.height(t-e-i-n-140).show()}},{key:"initSelect",value:function(){var t=Object.create(r.default),e=$("#track-select"),i=e.data("subtitleList"),n=m.data("mediaId"),s=this;t.init({id:"#track-select",optionsLimit:4}),t.on("valuechange",function(t){return t?void $.ajax({url:t.url,type:"GET",notSetHeader:!0}).done(s.showSubtitleContent):void p.html(Translator.trans("subtitle.no_subtitle_hint"))}),t.on("deleteoption",function(t){var e="/media/"+n+"/subtitle/"+t.id+"/delete";$.post(e,function(t){t&&((0,d.default)("success",Translator.trans("subtitle.delete_success_hint")),m.show())})}),t.on("optionlimit",function(){m.hide()}),t.resetOptions(i),this.select=t}},{key:"initUploader",value:function(){var t=this.select,e=m.data("mediaGlobalId"),i=m.data("mediaId"),n=m.data("subtitleCreateUrl"),s=new UploaderSDK({initUrl:m.data("initUrl"),finishUrl:m.data("finishUrl"),id:"uploader",ui:"simple",multi:!0,accept:{extensions:["srt"],mimeTypes:["text/srt"]},type:"sub",process:{videoNo:e}});s.on("error",function(t){"Q_TYPE_DENIED"===t.error&&(0,d.default)("danger",Translator.trans("subtitle.upload_srt_hint"))}),s.on("file.finish",function(e){$.post(n,{name:e.name,subtitleId:e.id,mediaId:i}).success(function(e){e&&(t.addOption(e),(0,d.default)("success",Translator.trans("subtitle.upload_success_hint")),setTimeout(function(){var e="/media/"+i+"/subtitles";$.get(e).done(function(e){e.subtitles&&t.resetOptions(e.subtitles)})},5e3))}).error(function(t){(0,d.default)("danger",Translator.trans(t.responseJSON.error.message))})})}},{key:"showSubtitleContent",value:function(t){var e=new f.default;try{e.parse(t)}catch(t){return(0,d.default)("danger",Translator.trans("subtitle.parse_error_hint")),void p.html(Translator.trans("subtitle.parse_error_hint"))}var i=e.getSubtitles({duration:!0,timeFormat:"ms"}),n="";i.map(function(t){n+="<p>"+t.text+"</p>"}),p.html(n);var s=p.find("p");c.default.on("timechange",function(t){setTimeout(function(){var e=i.find(function(e,i){if(e.start/1e3>t.currentTime)return e});s.removeClass("active"),e&&e.index>1&&i[e.index-2].end>1e3*parseFloat(t.currentTime)&&s.eq(e.index-2).addClass("active")},0)})}}]),t}();e.default=v},"609d911a24b2b709511a":function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var s=i("06597b47670159844043"),a=n(s),o=new a.default({name:"parent",project:"PlayerProject",children:[document.getElementById("viewerIframe")],type:"parent"});e.default=o},"90c40b9c35e074e923b0":function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(t){var e={waiting:Translator.trans("subtitle.status.waiting"),doing:Translator.trans("subtitle.status.doing"),success:Translator.trans("subtitle.status.success"),error:Translator.trans("subtitle.status.error"),none:Translator.trans("subtitle.status.waiting")};return e[t]},n={init:function(t){this.$el=$(t.id),this.options=[],this.optionsLimit=t.optionsLimit||!1,this.eventManager={},this.initParent(),this.initEvent()},initParent:function(){var t=$(document.createDocumentFragment());t.append(this.templete()),this.$el.append(t),this.$parentDom=$(".track-select-parent"),this.$list=$(".track-selcet-list"),this.$dataShow=this.$parentDom.find(".data-show"),this.$open=this.$parentDom.find(".track-selcet-open-arrow"),this.$close=this.$parentDom.find(".track-selcet-close-arrow"),this.$showBox=this.$parentDom.find(".track-select-show")},initEvent:function(){var t=this;this.$parentDom.delegate(".track-selcet-open-arrow","click",this.handleOpen.bind(this)).delegate(".track-selcet-close-arrow","click",this.handleClose.bind(this)).delegate(".delete","click",this.handleDelete.bind(this)).delegate(".select-item","click",function(){$(this).siblings().removeClass("active"),$(this).addClass("active");var e=$(this).find(".value").html(),i=$(this).find(".value").attr("url");t.setValue({name:e,url:i}),t.handleClose()}),this.$showBox.on("click",this.toggle.bind(this)),this.on("valuechange",function(){this.$dataShow.html(this.getValue().name),this.$dataShow.attr("title",this.getValue().name)}),this.on("listchange",function(){this.optionsLimit&&this.options.length>=this.optionsLimit&&this.trigger("optionlimit"),this.$list.html(this.getOptionsStr()),this.setValue(this.getDefaultOption())}),this.on("optionempty",this.handleOptionEmpty.bind(this))},templete:function(){return'<div class="track-select-parent">\n              <div class="track-select-show">\n                <div class="data-show" title="'+this.getDefaultOption().name+'"></div>\n                <span class="track-selcet-open-arrow">\n                  <i class="es-icon es-icon-keyboardarrowdown"></i>\n                </span>\n                <span class="track-selcet-close-arrow" style="display:none;">\n                  <i class="es-icon es-icon-keyboardarrowup"></i>\n                </span>\n              </div>\n              <ul class="track-selcet-list" style="display:none;">\n                '+this.getOptionsStr()+"\n              </ul>\n            </div>"},getDefaultOption:function(){return this.options.length?this.options[0]:(this.open?this.handleClose():"",!1)},getOptionsStr:function(){this.options.length||this.trigger("optionempty");var t="";return this.options.map(function(e,n){t+='<li class="select-item">\n                        <div class="value" title="'+e.name+'" url="'+e.url+'">\n                          '+e.name+'\n                        </div>\n                        <span class="convertStatus convert-'+e.convertStatus+'">'+i(e.convertStatus)+'</span>\n                        <i class="es-icon es-icon-close01 delete" data-index="'+n+'"></i>\n                      </li>'}),t},setValue:function(t){return t?(this.value=t,void this.trigger("valuechange",this.value)):(this.$dataShow.html(Translator.trans("subtitle.no_subtitle_hint")),void this.trigger("valuechange",!1))},getValue:function(){return this.value||{name:Translator.trans("subtitle.no_subtitle_hint")}},toggle:function(){this.open?this.handleClose():this.handleOpen()},handleOpen:function(){this.options.length&&(this.open=!0,this.$open.hide(),this.$close.show(),this.$showBox.addClass("active"),this.$list.slideDown(200))},handleClose:function(){this.open=!1,this.$close.hide(),this.$open.show(),this.$showBox.removeClass("active"),this.$list.slideUp(200)},handleDelete:function(t){var e=t.target;$(e).parent().remove(),this.trigger("deleteoption",this.options[$(e).data("index")]),this.options.splice($(e).data("index"),1),this.trigger("listchange",this.options),t.stopPropagation()},handleOptionEmpty:function(){this.value="",this.trigger("valuechange",!1)},on:function(t,e){this.eventManager[t]?this.eventManager[t].push(e.bind(this)):this.eventManager[t]=[e.bind(this)]},trigger:function(t,e){this.eventManager[t]&&this.eventManager[t].map(function(t){t(e)})},resetOptions:function(t){this.options=t,this.trigger("listchange",this.options)},addOption:function(t){t.convertStatus||(t.convertStatus="waiting"),this.options.push(t),this.trigger("listchange")}};e.default=n},b26ed6014df6ee9a0332:function(t,e){"use strict";var i=$("#lesson-dashboard"),n=i.data("media-player-url"),s="<iframe src='"+n+"' name='viewerIframe' id='viewerIframe' width='100%'allowfullscreen webkitallowfullscreen height='100%' style='border:0px'></iframe>";$("#lesson-video-content").html(s)}});