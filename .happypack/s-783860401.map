{"version":3,"sources":["app/Resources/static-src/app/js/activity-manage/exercise/index.js"],"names":["Exercise","$form","$element","_setValidateRule","_init","_initEvent","_inItStep2form","$step2_form","$","validator","validate","rules","title","required","maxlength","trim","itemCount","positiveInteger","min","max","range","difficulty","remote","url","data","type","dataType","async","val","courseId","length","lessonId","JSON","stringify","types","each","push","messages","$step3_form","onkeyup","finishCondition","addMethod","value","element","optional","test","format","click","change","checkQuestionNum","post","text","attr","i","n","questionNum","closest","find"],"mappings":"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","file":"index.js","sourceRoot":"/Users/kz/projects/edusoho","sourcesContent":["import SelectLinkage from 'app/js/question-manage/widget/select-linkage.js';\n\nclass Exercise {\n\tconstructor($form) {\n\t\tthis.$element = $form;\n\t\tthis._setValidateRule();\n    this._init();\n    this._initEvent();\n  }\n\n  _init() {\n    this._inItStep2form();\n  }\n\n  _initEvent() {\n  }\n\n  _inItStep2form() {\n    let $step2_form = $(\"#step2-form\");\n    let validator = $step2_form.validate({\n        rules: {\n          title: {\n            required:true,\n            maxlength: 50,\n            trim: true,\n          },\n          itemCount: {\n            required: true,\n            positiveInteger:true,\n            min: 1,\n            max: 9999\n          },\n          range:{\n          \trequired:true,\n          },\n          difficulty:{\n          \trequired:true\n          },\n          'questionTypes[]':{\n            required:true,\n            remote: {    \n              url: $('[name=\"checkQuestion\"]').data('checkUrl'),   \n              type: \"post\",    \n              dataType: \"json\", \n              async: false,      \n              data: {    \n                itemCount: function() {    \n                  return $('[name=\"itemCount\"]').val();    \n                },\n                range: function() {\n                  let range = {}\n                  let courseId = $('[name=\"range[courseId]\"]').val();\n                  range.courseId = courseId;\n                  if ($('[name=\"range[lessonId]\"]').length > 0) {\n                    let lessonId = $('[name=\"range[lessonId]\"]').val();\n                    range.lessonId = lessonId;\n                  }\n                  \n                  return JSON.stringify(range);\n                },\n                difficulty: function() {\n                  return $('[name=\"difficulty\"]').val();\n                },\n                types: function () {\n                  let types = [];\n                  $('[name=\"questionTypes\\[\\]\"]:checked').each(function(){\n                    types.push($(this).val());\n                  });\n                  return types;\n                }\n              }    \n            }    \n          }\n        },\n        messages: {\n          required:\"请填写标题\",\n          range: \"题目来源\",\n          itemCount: {\n            required: '请填写题目个数',\n            positiveInteger: '请输入正整数',\n            min: '题目个数无效',\n            max: '题目个数过大'\n          },\n          difficulty: \"请选择难易程度\",\n          'questionTypes[]': {\n            required:\"请选择题型\",\n            remote:\"题目数量不足\"\n          },\n        }\n    });\n\n    /*if (validator.form()) {\n      $('input[namae=\"checkQuestion\"]').rules('add',{\n        required:true,\n        remote:{\n          url: $('input[namae=\"checkQuestion\"]').data('checkUrl'),     \n          type: 'post',               \n          dataType: 'json',           \n          data: $step2_form.serialize(),\n          success:function(response){\n            console.log(response);\n          }\n        }\n      })\n    }*/\n\n    $step2_form.data('validator',validator);\n  }\n\n  _inItStep3form() {\n    var $step3_form = $(\"#step3-form\");\n    var validator = $step3_form.validate({\n        onkeyup: false,\n        rules: {\n            finishCondition: {\n                required: true,\n            },\n        },\n        messages: {\n            finishCondition: \"请输完成条件\",\n        }\n    });\n    $step3_form.data('validator',validator);\n  }\n\n  _setValidateRule() {\n    $.validator.addMethod(\"positiveInteger\",function(value,element){  \n\t\t  return this.optional( element ) || /^[1-9]\\d*$/.test(value);\n\t\t}, $.validator.format(\"必须为正整数\"));\n\n  }\n}\n\nnew Exercise($('#step2-form'));\nnew SelectLinkage($('[name=\"range[courseId]\"]'),$('[name=\"range[lessonId]\"]'));\n\n$('.js-question-type').click(function(){\n  \n})\n\n$('[name=\"range[courseId]\"]').change(function(){\n  let url = $(this).data('checkNumUrl');\n  checkQuestionNum(url);\n})\n\n$('[name=\"range[lessonId]\"]').change(function(){\n  let url = $(this).data('checkNumUrl');\n  checkQuestionNum(url);\n})\n\n$('[name=\"difficulty\"]').change(function(){\n  let url = $(this).data('checkNumUrl');\n  checkQuestionNum(url);\n})\n\nfunction checkQuestionNum(url) {\n  let courseId = $('[name=\"range[courseId]\"]').val();\n  let lessonId = $('[name=\"range[lessonId]\"]').val();\n  let difficulty = $('[name=\"difficulty\"]').val();\n\n  $.post(url,{courseId:courseId, lessonId:lessonId, difficulty:difficulty},function(data){\n    $('[role=\"questionNum\"]').text(0);\n    $('input[type=\"checkbox\"]').attr({'disabled':true,'checked':false});\n\n    $.each(data,function(i,n){\n      $(\"[type='\"+i+\"']\").text(n.questionNum);\n      $(\"[type='\"+i+\"']\").closest('.js-question-type').find('input[type=\"checkbox\"]').attr('disabled',false);\n    });\n  })\n}\n"]}