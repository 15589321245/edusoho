{"version":3,"sources":["app/Resources/static-src/app/js/task/index.js"],"names":["TaskShow","element","mode","isMember","$","ui","init","initPlugin","initSidebar","initTaskPipe","initLearnBtn","tooltip","popover","html","trigger","on","post","data","modal","response","val","learned","eventEmitter","find","addListener","_receiveFinish","get","attr","learnedWeakPrompt","sidebar","reload","url","px","time","animate","right"],"mappings":"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","file":"index.js","sourceRoot":"/Users/kz/projects/edusoho","sourcesContent":["import TaskSidebar from \"./widget/sidebar\";\nimport TaskUi from \"./widget/task-ui\";\nimport TaskPipe from \"./widget/task-pipe\";\nimport Emitter from \"common/es-event-emitter\";\n\nclass TaskShow extends Emitter {\n  constructor({element, mode, isMember}) {\n    super();\n    this.element = $(element);\n    this.mode = mode;\n    this.isMember = isMember;\n    \n    this.ui = new TaskUi({\n      element: '.js-task-dashboard-page'\n    });\n\n    this.init();\n  }\n\n  init() {\n    this.initPlugin();\n    this.initSidebar();\n    if (this.mode != 'preview' && this.isMember) {\n      this.initTaskPipe();\n      this.initLearnBtn();\n    }\n  }\n\n  initPlugin() {\n    $('[data-toggle=\"tooltip\"]').tooltip();\n    $('[data-toggle=\"popover\"]').popover({\n      html: true,\n      trigger: 'hover'\n    });\n  }\n\n  initLearnBtn() {\n    this.element.on('click', '#learn-btn', event => {\n      $.post($('#learn-btn').data('url'), response => {\n        $('#modal').modal('show');\n        $('#modal').html(response);\n        $('input[name=\"task-result-status\"]', $('#js-hidden-data')).val('finish');\n        this.ui.learned();\n      });\n    });\n  }\n\n  initTaskPipe() {\n    this.eventEmitter = new TaskPipe(this.element.find('#task-content-iframe'));\n    this.eventEmitter.addListener('finish', response => {\n      this._receiveFinish(response);\n    });\n\n  }\n\n  _receiveFinish(response) {\n    // response.result.status == 'finish'\n    //     &&\n    if ( $('input[name=\"task-result-status\"]', $('#js-hidden-data')).val() != 'finish') {\n        // 盘点是任务式学习还是自由式学习\n        $.get($(\".js-learned-prompt\").data('url'), html => {\n        $(\".js-learned-prompt\").attr('data-content', html);\n        this.ui.learnedWeakPrompt();\n        this.ui.learned();\n        this.sidebar.reload();\n        $('input[name=\"task-result-status\"]', $('#js-hidden-data')).val('finish');\n      });\n    }\n  }\n\n  initSidebar() {\n    this.sidebar = new TaskSidebar({\n      element: this.element.find('#dashboard-sidebar'),\n      url: this.element.find('#js-hidden-data [name=\"plugins_url\"]').val()\n    });\n    this.sidebar\n        .on('popup', (px, time) => {\n          this.element.find('#dashboard-content').animate({\n            right: px\n          }, time);\n        })\n        .on('fold', (px, time) => {\n          this.element.find('#dashboard-content').animate({\n            right: px\n          }, time);\n        });\n  }\n}\n\nnew TaskShow({\n  element: $('body'),\n  mode: $('body').find('#js-hidden-data [name=\"mode\"]').val(),\n  isMember: $('body').find('#js-hidden-data [name=\"isMember\"]').val()\n});\n"]}