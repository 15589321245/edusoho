{"version":3,"sources":["webpack:///./app/Resources/static-src/app/js/task/plugin/question/form.js","webpack:///./app/Resources/static-src/app/js/task/plugin/question/index.js","webpack:///./app/Resources/static-src/app/js/task/plugin/question/question.js"],"names":["$element","$","editor","validator","initEvent","on","expand","save","event","collapse","preventDefault","form","$btn","currentTarget","attr","channel","post","serialize","done","html","Translator","trans","publish","removeAttr","fail","error","hasClass","addClass","CKEDITOR","replace","toolbar","filebrowserImageUploadUrl","find","data","validate","rules","messages","val","getData","removeClass","destroy","removeData","clear","each","QuestionPlugin","$list","$detail","question","onRedirectQuestion","subscribe","envelope","prepend","remove","onBackList","popover","$target","url","hide","show","$form","render","onSavePost","append","number","parseInt","text","response","Notify","danger","message","get","undelegate"],"mappings":"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","file":"app/js/task/plugin/question/index.js","sourcesContent":["import notify from \"common/notify\";\nimport postal from \"postal\";\n\nexport default class {\n  constructor() {\n    this.$element = $('#task-question-plugin-form');\n    this.editor = null;\n    this.validator = null;\n    this.initEvent();\n  }\n\n  initEvent() {\n    this.$element.on('focusin', '.expand-form-trigger', event => this.expand());\n    this.$element.on('click', '.btn-primary', event => this.save(event));\n    this.$element.on('click', '.collapse-form-btn', event => this.collapse());\n  }\n\n  save(event) {\n    event.preventDefault();\n\n    if (!this.validator || !this.validator.form()) {\n      return;\n    }\n    let $btn = $(event.currentTarget);\n    $btn.attr('disabled', 'disabled');\n\n    let channel = postal.channel('task.plugin.question');\n\n    $.post(this.$element.attr('action'), this.$element.serialize())\n        .done((html) => {\n          notify('success', Translator.trans('task.plugin_question_post_success_hint'));\n          channel.publish(\"form.save\", {\n            html: html\n          });\n          $btn.removeAttr('disabled');\n          this.collapse();\n        })\n        .fail((error) => {\n          notify('danger', error);\n        })\n    ;\n  }\n\n  expand() {\n    if (this.$element.hasClass('form-expanded')) {\n      return;\n    }\n\n    this.$element.addClass('form-expanded');\n\n    let editor = CKEDITOR.replace('question_content', {\n      toolbar: 'Simple',\n      filebrowserImageUploadUrl: this.$element.find('#question_content').data('imageUploadUrl')\n    });\n\n    this.editor = editor;\n\n    this.validator = this.$element.validate({\n      rules: {\n        'question[title]': 'required',\n        'question[content]': 'required'\n      },\n      messages: {\n        'question[title]': Translator.trans('task.plugin_question_add.title_required_error_hint'),\n        'question[content]': Translator.trans('task.plugin_question_add.content_required_error_hint')\n      }\n    });\n\n    editor.on( 'change', () => {\n      this.$element.find('[name=\"question[content]\"]').val(editor.getData());\n    });\n    editor.on('blur', () => {\n      this.$element.find('[name=\"question[content]\"]').val(editor.getData());\n    });\n\n    this.$element.find('.js-detail-form-group').removeClass('hide');\n  }\n\n  collapse() {\n    this.$element.removeClass('form-expanded');\n    this.editor && this.editor.destroy();\n    this.$element.removeData(\"validator\");\n    this.clear();\n    this.$element.find('.js-detail-form-group').addClass('hide');\n\n  }\n\n  clear() {\n    this.$element.find('input[type=text],textarea').each(function () {\n      $(this).val('');\n    });\n  }\n}\n\n\n// WEBPACK FOOTER //\n// ./app/Resources/static-src/app/js/task/plugin/question/form.js","import postal from \"postal\";\nimport QuestionForm from './form';\nimport Question from './question'\n\nclass QuestionPlugin {\n  constructor() {\n    this.$element = $('.question-pane');\n    this.$list = this.$element.find('.question-list-block');\n    this.$detail = this.$element.find('.question-detail-block');\n    this.form = new QuestionForm();\n    this.question = null;\n    this.initEvent();\n  }\n\n  initEvent() {\n\n    this.$element.on('click', '.js-redirect-question-detail', event => this.onRedirectQuestion(event));\n\n    const channel = postal.channel('task.plugin.question');\n\n    channel.subscribe('form.save', (data, envelope) => {\n      this.$element.find('[data-role=\"list\"]').prepend(data.html);\n      this.$element.find('.empty-item').remove();\n    });\n\n    channel.subscribe('back-to-list', () => this.onBackList())\n\n      $(\"[data-toggle='popover']\").popover();\n  }\n\n  onRedirectQuestion(event) {\n    const $target = $(event.currentTarget);\n    const url = $target.data('url');\n    this.question = new Question(url);\n    this.$list.hide();\n    this.$detail.show();\n  }\n\n  onBackList(){\n    this.question && this.question.destroy();\n    this.$list.show();\n    this.$detail.hide();\n  }\n}\n\nnew QuestionPlugin();\n\n\n// WEBPACK FOOTER //\n// ./app/Resources/static-src/app/js/task/plugin/question/index.js","import notify from \"common/notify\";\nimport postal from \"postal\";\n\nexport default class {\n  constructor(url) {\n    this.url = url;\n    this.$element = $('.question-detail-block');\n    this.$form = null;\n    this.validator = null;\n    this.channel = postal.channel('task.plugin.question');\n    this.render();\n  }\n\n  initEvent() {\n\n    this.$element.on('click', '.back-to-list', () => {\n      this.channel.publish('back-to-list');\n    });\n\n    this.$form.on('click', '.btn-primary', event => this.onSavePost(event))\n  }\n\n  onSavePost(event) {\n    event.preventDefault();\n\n    if (!this.validator || !this.validator.form()) {\n      return;\n    }\n\n    $.post(this.$form.attr('action'), this.$form.serialize())\n        .done((html) => {\n          this.$element.find('[data-role=post-list]').append(html);\n          const number = parseInt(this.$element.find('[data-role=post-number]').text());\n          this.$element.find('[data-role=post-number]').text(number + 1);\n          this.$form.find('textarea').val('');\n        })\n        .error(function (response) {\n          Notify.danger(response.error.message);\n        });\n  }\n\n  render() {\n    $.get(this.url)\n        .done(html => {\n          this.$element.html(html);\n\n          this.$form = this.$element.find('.post-form');\n          this.validator = this.$form.validate({\n            rules: {\n              'post[content]': 'required'\n            },\n            messages: {\n              'post[content]': Translator.trans('task.plugin_question_replay.content_required_error_hint')\n            }\n          });\n\n          this.initEvent();\n        })\n        .fail(error => {\n          notify('danger', 'error')\n        })\n  }\n\n  destroy() {\n    this.$element.html('');\n    this.$element.undelegate();\n  }\n}\n\n\n// WEBPACK FOOTER //\n// ./app/Resources/static-src/app/js/task/plugin/question/question.js"],"sourceRoot":""}