{% import "TopxiaWebBundle::macro.html.twig" as web_macro %}

 <div class="row course-list es-openCourse-list">
{% for course in courses if course %}
  {% set lessons = data('OpenCourseLessons',{courseId:course.id,count:1}) %}
{#   <div class="course-block clearfix">
    <div class="course-img">
      <a href="{{ path('open_course_show', {courseId:course.id}) }}" target="_blank" target="{{ course.title }}">
        {% if course.type == 'liveOpen' %}
        <span class="tags">
          <span class="tag-open-live"></span>
        </span>
        {% endif %}
        {{ lazy_img(filepath(course.middlePicture, 'course.png'), 'img-responsive', course.title) }}
      </a>
      {% if course.type == 'liveOpen' and lessons %}
        {% if lessons[0].startTime|date('Y-m-d') == "now"|date('Y-m-d') %}
          <div class="open-starttime">今日直播：{{ lessons[0].startTime|date('H:i')}}</div>
        {% else %}
          <div class="open-starttime">{{ lessons[0].startTime|date('Y-m-d H:i')}}</div>
        {% endif %}
      {% endif %}
    </div>

    <div class="open-course-content">
      <div class="title text-overflow">
        {% if course.type == 'liveOpen' and lessons %}
          {% if "now"|date("U") >= lessons[0].startTime and "now"|date("U") <= lessons[0].endTime %}
            <span class="label label-primary label-md">正在直播</span>
          {% elseif "now"|date("U") < lessons[0].startTime %}
            <span class="label label-warning label-md">即将直播</span>
          {% endif %}
        {% endif %}
        
        <a class="link-dark" href="{{ path('open_course_show', {courseId:course.id}) }}" target="_blank" title="{{ course.title }}">
          {{ course.title }}
        </a>
      </div>
      <div class="color-gray mbm hidden-xs">
        教师：
        {% for teacherId in course.teacherIds if teacherId %}
          {% set teacher = teachers[teacherId] %}
          <a class="mrs" href="{{ path('user_show', {id:teacher.id}) }}" target="_blank">{{ teacher.nickname }}</a>
        {% endfor %}
      </div>
      <div class="open-course-intro hidden-sm hidden-xs">
        {% if course.subtitle %}
          {{ course.subtitle|raw }}
        {% endif %}
      </div>
      <div class="metas clearfix">
        <span class="num"><i class="es-icon es-icon-whatshot"></i>{{ course.hitNum }}</span>
        <span class="comment"><i class="es-icon es-icon-textsms"></i>{{ course.postNum }}</span>
        <a class="btn btn-primary pull-right hidden-xs" href="{{ path('open_course_show', {courseId:course.id}) }}" target="_blank" title="{{ course.title }}">立即参加</a>
      </div>
    </div>
  </div> #}
  <div class="col-md-4 col-xs-6">
    <div class="course-item">
      <div class="course-img">
        <a href="{{ path('open_course_show', {courseId:course.id}) }}" target="_blank" target="{{ course.title }}">
        {% if course.type == 'liveOpen' %}
          <span class="tags">
            <span class="tag-open-live"></span>
          </span>
        {% endif %}
        {{ lazy_img(filepath(course.middlePicture, 'course.png'), 'img-responsive', course.title) }}
        </a>
       {% if course.type == 'liveOpen' and lessons %}
          <div class="mask">
            {% if lessons[0].startTime|date('Y-m-d') == "now"|date('Y-m-d') %}
            <i class="es-icon es-icon-videocam prs"></i>{{ lessons[0].startTime|date('H:i')}} 直播
            {% else %}
              <i class="es-icon es-icon-videocam prs"></i>{{ lessons[0].startTime|date('Y-m-d H:i')}} 直播
            {% endif %}
          </div>
       {% endif %}
      </div>
      <div class="course-info clearfix">
        <div class="title">
          <a class="link-dark" href="{{ path('open_course_show', {courseId:course.id}) }}" target="_blank" title="{{ course.title }}">
          {{ course.title }}
          </a>
        </div>
        <div class="metas pull-right">
          <span class="num"><i class="es-icon es-icon-people"></i>{{ course.studentNum }}</span>
          <span class="comment"><i class="es-icon es-icon-textsms"></i>{{ course.postNum }}</span>
        </div>
      </div>

    </div>
 </div>
{% else %}
  <div class="empty">{{'暂无公开课'|trans}}</div>
{% endfor %}
 </div>
{{ web_macro.ajaxCoursePaginator(paginator) }}