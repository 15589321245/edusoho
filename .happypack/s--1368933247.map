{"version":3,"sources":["app/Resources/static-src/app/js/course-manage/info/index.js"],"names":["renderMultiGroupComponent","elementId","name","datas","$","data","render","document","getElementById","length","get","done","liveCapacity","capacity","_initDatePicker","CKEDITOR","replace","allowedContent","toolbar","filebrowserImageUploadUrl","on","event","val","removeClass","addClass","jQuery","validator","addMethod","value","element","optional","maxCapacity","parseInt","message","Translator","trans","parent","siblings","find","html","$form","validate","onkeyup","currentDom","groups","date","rules","title","required","maxStudentNum","live_capacity","positive_integer","expiryDays","digits","max_year","expiryStartDate","before","expiryEndDate","after","messages","params","click","evt","form","publishAddMessage","submit","postal","publish","channel","topic","$id","$picker","datetimepicker","format","language","minView","autoclose","endDate","Date","now"],"mappings":";;AAAA;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AAEA,SAASA,yBAAT,CAAmCC,SAAnC,EAA8CC,IAA9C,EAAoD;AAClD,MAAIC,QAAQC,EAAE,MAAMH,SAAR,EAAmBI,IAAnB,CAAwB,YAAxB,CAAZ;AACA,qBAASC,MAAT,CAAgB,sDAAY,YAAYH,KAAxB,EAA+B,mBAAmBD,IAAlD,GAAhB,EACEK,SAASC,cAAT,CAAwBP,SAAxB,CADF;AAGD;;AAED,IAAIG,EAAE,sBAAF,EAA0BK,MAA1B,GAAmC,CAAvC,EAA0C;AACxCL,IAAEM,GAAF,CAAMN,EAAE,sBAAF,EAA0BC,IAA1B,CAA+B,iBAA/B,CAAN,EAAyDM,IAAzD,CAA8D,UAACC,YAAD,EAAkB;AAC9ER,MAAE,sBAAF,EAA0BC,IAA1B,CAA+B,cAA/B,EAA+CO,aAAaC,QAA5D;AACD,GAFD;AAGD;;AAEDb,0BAA0B,cAA1B,EAA0C,OAA1C;AACAA,0BAA0B,mBAA1B,EAA+C,WAA/C;;AAEAc,gBAAgB,kBAAhB;AACAA,gBAAgB,gBAAhB;;AAEA;;AAEAC,SAASC,OAAT,CAAiB,SAAjB,EAA4B;AAC1BC,kBAAgB,IADU;AAE1BC,WAAS,QAFiB;AAG1BC,6BAA2Bf,EAAE,UAAF,EAAcC,IAAd,CAAmB,gBAAnB;AAHD,CAA5B;;AAMAD,EAAE,0BAAF,EAA8BgB,EAA9B,CAAiC,QAAjC,EAA2C,UAAUC,KAAV,EAAiB;AAC1D,MAAIjB,EAAE,kCAAF,EAAsCkB,GAAtC,MAA+C,MAAnD,EAA2D;AACzDlB,MAAE,cAAF,EAAkBmB,WAAlB,CAA8B,QAA9B,EAAwCC,QAAxC,CAAiD,QAAjD;AACApB,MAAE,cAAF,EAAkBmB,WAAlB,CAA8B,QAA9B;AACD,GAHD,MAGO;AACLnB,MAAE,cAAF,EAAkBmB,WAAlB,CAA8B,QAA9B,EAAwCC,QAAxC,CAAiD,QAAjD;AACApB,MAAE,cAAF,EAAkBmB,WAAlB,CAA8B,QAA9B;AACD;AACF,CARD;;AAUAE,OAAOC,SAAP,CAAiBC,SAAjB,CAA2B,UAA3B,EAAuC,UAAUC,KAAV,EAAiBC,OAAjB,EAA0B;AAC/D,SAAO,KAAKC,QAAL,CAAcD,OAAd,KAA0BD,QAAQ,MAAzC;AACD,CAFD,EAEG,mBAFH;;AAIAH,OAAOC,SAAP,CAAiBC,SAAjB,CAA2B,eAA3B,EAA4C,UAAUC,KAAV,EAAiBC,OAAjB,EAA0B;AACpE,MAAME,cAAcC,SAAS5B,EAAEyB,OAAF,EAAWxB,IAAX,CAAgB,cAAhB,CAAT,CAApB;AACA,MAAIuB,QAAQG,WAAZ,EAAyB;AACvB,QAAME,UAAUC,WAAWC,KAAX,CAAiB,+DAAjB,EAAkF,EAAEtB,UAAUkB,WAAZ,EAAlF,CAAhB;AACA3B,MAAEyB,OAAF,EAAWO,MAAX,GAAoBC,QAApB,CAA6B,iBAA7B,EAAgDC,IAAhD,CAAqD,GAArD,EAA0DC,IAA1D,CAA+DN,OAA/D;AACD,GAHD,MAGO;AACL7B,MAAEyB,OAAF,EAAWO,MAAX,GAAoBC,QAApB,CAA6B,iBAA7B,EAAgDC,IAAhD,CAAqD,GAArD,EAA0DC,IAA1D,CAA+D,EAA/D;AACD;;AAED,SAAO,IAAP;AACD,CAVD;;AAYA,IAAIC,QAAQpC,EAAE,mBAAF,CAAZ;AACA,IAAIsB,YAAYc,MAAMC,QAAN,CAAe;AAC7BC,WAAS,KADoB;AAE7BC,cAAY,gBAFiB;AAG7BC,UAAQ;AACNC,UAAM;AADA,GAHqB;AAM7BC,SAAO;AACLC,WAAO;AACLC,gBAAU;AADL,KADF;AAILC,mBAAe;AACbD,gBAAU,IADG;AAEbE,qBAAe,IAFF;AAGbC,wBAAkB;AAHL,KAJV;AASLC,gBAAY;AACVJ,gBAAU,uBADA;AAEVK,cAAQ,IAFE;AAGVC,gBAAU;AAHA,KATP;AAcLC,qBAAiB;AACfP,gBAAU,uBADK;AAEfH,YAAM,IAFS;AAGfW,cAAQ;AAHO,KAdZ;AAmBLC,mBAAe;AACbT,gBAAU,uBADG;AAEbH,YAAM,IAFO;AAGba,aAAO;AAHM;AAnBV,GANsB;AA+B7BC,YAAU;AACRZ,WAAOb,WAAWC,KAAX,CAAiB,aAAjB,CADC;AAERc,mBAAe;AACbD,gBAAUd,WAAWC,KAAX,CAAiB,SAAjB;AADG,KAFP;AAKRiB,gBAAY;AACVJ,gBAAUd,WAAWC,KAAX,CAAiB,UAAjB;AADA,KALJ;AAQRoB,qBAAiB;AACfP,gBAAUd,WAAWC,KAAX,CAAiB,SAAjB,CADK;AAEfqB,cAAQtB,WAAWC,KAAX,CAAiB,aAAjB;AAFO,KART;AAYRsB,mBAAe;AACbT,gBAAUd,WAAWC,KAAX,CAAiB,SAAjB,CADG;AAEbuB,aAAOxB,WAAWC,KAAX,CAAiB,aAAjB;AAFM;AAZP;AA/BmB,CAAf,CAAhB;;AAkDA/B,EAAEsB,SAAF,CAAYC,SAAZ,CACE,QADF,EAEE,UAAUC,KAAV,EAAiBC,OAAjB,EAA0B+B,MAA1B,EAAkC;AAChC,MAAIxD,EAAE,kCAAF,EAAsCkB,GAAtC,OAAgD,MAApD,EAA4D;AAC1D,WAAO,IAAP;AACD;AACD,SAAO,CAACM,KAAD,IAAUxB,EAAEwD,MAAF,EAAUtC,GAAV,KAAkBM,KAAnC;AACD,CAPH,EAQEM,WAAWC,KAAX,CAAiB,aAAjB,CARF;;AAWA/B,EAAEsB,SAAF,CAAYC,SAAZ,CACE,OADF,EAEE,UAAUC,KAAV,EAAiBC,OAAjB,EAA0B+B,MAA1B,EAAkC;AAChC,MAAIxD,EAAE,kCAAF,EAAsCkB,GAAtC,OAAgD,MAApD,EAA4D;AAC1D,WAAO,IAAP;AACD;AACD,SAAO,CAACM,KAAD,IAAUxB,EAAEwD,MAAF,EAAUtC,GAAV,KAAkBM,KAAnC;AACD,CAPH,EAQEM,WAAWC,KAAX,CAAiB,aAAjB,CARF;;AAWA/B,EAAE,gBAAF,EAAoByD,KAApB,CAA0B,UAAUC,GAAV,EAAe;AACvC,MAAIpC,UAAUqC,IAAV,EAAJ,EAAsB;AACpB;AACAC;AACAxB,UAAMyB,MAAN;AACD;AACF,CAND;;AAQA,SAASD,iBAAT,GAA6B;AAC3BE,SAAOC,OAAP,CAAe;AACbC,aAAS,sBADI;AAEbC,WAAO;AAFM,GAAf;AAID;;AAED,SAASvD,eAAT,CAAyBwD,GAAzB,EAA8B;AAC5B,MAAIC,UAAUnE,EAAEkE,GAAF,CAAd;AACAC,UAAQC,cAAR,CAAuB;AACrBC,YAAQ,YADa;AAErBC,cAAU,IAFW;AAGrBC,aAAS,CAHY,EAGT;AACZC,eAAW,IAJU;AAKrBC,aAAS,IAAIC,IAAJ,CAASA,KAAKC,GAAL,KAAa,QAAQ,GAAR,GAAc,GAAd,GAAoB,IAA1C;AALY,GAAvB;AAOAR,UAAQC,cAAR,CAAuB,cAAvB,EAAuC,IAAIM,IAAJ,EAAvC;AACD","file":"index.js","sourceRoot":"/Users/kz/projects/edusoho","sourcesContent":["import { TabChange } from '../help';\nimport ReactDOM from 'react-dom';\nimport React from 'react';\nimport MultiInput from 'app/common/component/multi-input';\nimport 'postal';\n\nfunction renderMultiGroupComponent(elementId, name) {\n  let datas = $('#' + elementId).data('init-value');\n  ReactDOM.render(<MultiInput dataSource={datas} outputDataElement={name} />,\n    document.getElementById(elementId)\n  );\n}\n\nif ($('#maxStudentNum-field').length > 0) {\n  $.get($('#maxStudentNum-field').data('liveCapacityUrl')).done((liveCapacity) => {\n    $('#maxStudentNum-field').data('liveCapacity', liveCapacity.capacity);\n  })\n}\n\nrenderMultiGroupComponent('course-goals', 'goals');\nrenderMultiGroupComponent('intended-students', 'audiences');\n\n_initDatePicker('#expiryStartDate');\n_initDatePicker('#expiryEndDate');\n\nTabChange();\n\nCKEDITOR.replace('summary', {\n  allowedContent: true,\n  toolbar: 'Detail',\n  filebrowserImageUploadUrl: $('#summary').data('imageUploadUrl')\n});\n\n$('input[name=\"expiryMode\"]').on('change', function (event) {\n  if ($('input[name=\"expiryMode\"]:checked').val() == 'date') {\n    $('#expiry-days').removeClass('hidden').addClass('hidden');\n    $('#expiry-date').removeClass('hidden');\n  } else {\n    $('#expiry-date').removeClass('hidden').addClass('hidden');\n    $('#expiry-days').removeClass('hidden');\n  }\n});\n\njQuery.validator.addMethod(\"max_year\", function (value, element) {\n  return this.optional(element) || value < 100000;\n}, \"有效期最大值不能超过99,999天\");\n\njQuery.validator.addMethod(\"live_capacity\", function (value, element) {\n  const maxCapacity = parseInt($(element).data('liveCapacity'));\n  if (value > maxCapacity) {\n    const message = Translator.trans('网校可支持最多%capacity%人同时参加直播，您可以设置一个更大的数值，但届时有可能会导致满额后其他学员无法进入直播。', { capacity: maxCapacity });\n    $(element).parent().siblings('.js-course-rule').find('p').html(message);\n  } else {\n    $(element).parent().siblings('.js-course-rule').find('p').html('');\n  }\n\n  return true;\n});\n\nlet $form = $('#course-info-form');\nlet validator = $form.validate({\n  onkeyup: false,\n  currentDom: '#course-submit',\n  groups: {\n    date: 'expiryStartDate expiryEndDate'\n  },\n  rules: {\n    title: {\n      required: true\n    },\n    maxStudentNum: {\n      required: true,\n      live_capacity: true,\n      positive_integer: true\n    },\n    expiryDays: {\n      required: '#expiryByDays:checked',\n      digits: true,\n      max_year: true\n    },\n    expiryStartDate: {\n      required: '#expiryByDate:checked',\n      date: true,\n      before: '#expiryEndDate'\n    },\n    expiryEndDate: {\n      required: '#expiryByDate:checked',\n      date: true,\n      after: '#expiryStartDate'\n    }\n  },\n  messages: {\n    title: Translator.trans('请输入教学计划课程标题'),\n    maxStudentNum: {\n      required: Translator.trans('请输入课程人数')\n    },\n    expiryDays: {\n      required: Translator.trans('请输入学习有效期'),\n    },\n    expiryStartDate: {\n      required: Translator.trans('请输入开始日期'),\n      before: Translator.trans('开始日期应早于结束日期')\n    },\n    expiryEndDate: {\n      required: Translator.trans('请输入结束日期'),\n      after: Translator.trans('结束日期应晚于开始日期')\n    }\n  }\n});\n\n$.validator.addMethod(\n  \"before\",\n  function (value, element, params) {\n    if ($('input[name=\"expiryMode\"]:checked').val() !== 'date') {\n      return true;\n    }\n    return !value || $(params).val() > value;\n  },\n  Translator.trans('开始日期应早于结束日期')\n);\n\n$.validator.addMethod(\n  \"after\",\n  function (value, element, params) {\n    if ($('input[name=\"expiryMode\"]:checked').val() !== 'date') {\n      return true;\n    }\n    return !value || $(params).val() < value;\n  },\n  Translator.trans('结束日期应晚于开始日期')\n);\n\n$('#course-submit').click(function (evt) {\n  if (validator.form()) {\n    //发消息\n    publishAddMessage();\n    $form.submit();\n  }\n});\n\nfunction publishAddMessage() {\n  postal.publish({\n    channel: \"courseInfoMultiInput\",\n    topic: \"addMultiInput\",\n  });\n}\n\nfunction _initDatePicker($id) {\n  let $picker = $($id);\n  $picker.datetimepicker({\n    format: 'yyyy-mm-dd',\n    language: \"zh\",\n    minView: 2, //month\n    autoclose: true,\n    endDate: new Date(Date.now() + 86400 * 365 * 100 * 1000)\n  });\n  $picker.datetimepicker('setStartDate', new Date());\n}"]}