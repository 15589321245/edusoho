{"version":3,"sources":["node_modules/.0.5.3@postal.federation/lib/postal.federation.min.js"],"names":["define","module","exports","e","n","require","amd","postalFedx","_","postal","i","t","o","id","loaded","call","m","c","p","x","signalReady","apply","send","a","onFederatedMsg","r","__esModule","s","u","d","packingSlips","l","getPackingSlip","f","state","g","disconnect","h","NO_OP","configure","I","k","handlers","v","y","b","matchesFilter","S","addFilter","w","removeFilter","M","fedx","FederationClient","clients","_clients","transports","_transports","filters","canSendRemote","sendMessage","_ready","each","_outboundQueue","push","arguments","_getTransports","reduce","_signalQueue","length","addWireTap","channel","topic","subscribe","configuration","SYSTEM_CHANNEL","callback","shift","_inboundQueue","instanceId","createUUID","substr","Math","floor","random","join","publish","data","oldId","newId","Object","prototype","hasOwnProperty","Array","slice","defineProperty","value","ping","type","timeStamp","Date","ticket","pong","pingData","message","envelope","bundle","filterMode","Error","_config","defaults","transport","target","doNotNotify","enabled","filterDirection","packingSlip","source","setInstanceId","handshakeComplete","sendPong","sendBundle","pings","contains","remoteId","localId","without","transportName","lastSender","extend","isArray","direction","include","any","resolver","compare","out","configurable","writable","defineProperties","TypeError","options","sendPing","originId","clone","knownIds","concat","onMessage","shouldProcess","create","window"],"mappings":"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","file":"postal.federation.min.js","sourceRoot":"/Users/kz/projects/edusoho","sourcesContent":["/*** IMPORTS FROM imports-loader ***/\nvar define = false;\nvar module = false;\nvar exports = false;\n(function() {\n\n/*!\n *  * postal.federation - A base plugin for federating instances of postal.js across various boundaries.\n *  * Author: Jim Cowart (http://ifandelse.com)\n *  * Version: v0.5.3\n *  * Url: http://github.com/postaljs/postal.federation\n *  * License(s): (MIT OR GPL-2.0)\n */\n(function(e,n){\"object\"==typeof exports&&\"object\"==typeof module?module.exports=n(require(\"lodash\"),require(\"postal\")):\"function\"==typeof define&&define.amd?define([\"lodash\",\"postal\"],n):\"object\"==typeof exports?exports.postalFedx=n(require(\"lodash\"),require(\"postal\")):e.postalFedx=n(e._,e.postal)})(this,function(e,n){return function(e){function n(i){if(t[i])return t[i].exports;var o=t[i]={exports:{},id:i,loaded:!1};return e[i].call(o.exports,o,o.exports,n),o.loaded=!0,o.exports}var t={};return n.m=e,n.c=t,n.p=\"\",n(0)}([function(e,n,t){function i(e){x.signalReady.apply(this,e)}function o(e){x.send.apply(this,e)}function a(e){x.onFederatedMsg.call(this,e)}var r=function(e){return e&&e.__esModule?e[\"default\"]:e},c=r(t(1)),s=r(t(2));t(3);var u=t(4),d=u.packingSlips,l=u.getPackingSlip,p=t(5),f=p.state,g=p.disconnect,h=p.NO_OP,_=p.configure,I=t(6),k=I.handlers,v=I.onFederatedMsg,y=t(7),b=r(y),m=y.matchesFilter,S=y.addFilter,w=y.removeFilter,M=r(t(8)),x=s.fedx={FederationClient:M,packingSlips:d,handlers:k,clients:f._clients,transports:f._transports,filters:b,addFilter:S,removeFilter:w,canSendRemote:function(e,n){return m(e,n,\"out\")},configure:_,getPackingSlip:l,onFederatedMsg:v,sendMessage:function(e){return f._ready?void c.each(this.transports,function(n){n.sendMessage(e)}):void f._outboundQueue.push(arguments)},disconnect:g,_getTransports:function(){return c.reduce(this.transports,function(e,n,t){return e[t]=!0,e},{})},signalReady:function(e,n,t){if(!f._ready)return void f._signalQueue.push(arguments);var i=this._getTransports();switch(arguments.length){case 1:\"function\"==typeof e?t=e:\"string\"==typeof e&&(i={},i[e]=this.transports[e],t=h);break;case 2:\"string\"==typeof e?(i={},i[e]=this.transports[e]):i=e,t=n||h;break;case 3:i={},i[e]=[n]}c.each(i,function(e,n){e=\"boolean\"==typeof e?[]:e,this.transports[n].signalReady(e,t)},this)}};e.exports=x,s.addWireTap(function(e,n){x.canSendRemote(n.channel,n.topic)&&x.sendMessage(n)}),s.subscribe({channel:s.configuration.SYSTEM_CHANNEL,topic:\"instanceId.changed\",callback:function(){for(f._ready=!0;f._signalQueue.length;)i(f._signalQueue.shift());for(;f._outboundQueue.length;)o(f._outboundQueue.shift());for(;f._inboundQueue.length;)a(f._inboundQueue.shift())}}),void 0!==s.instanceId()&&(f._ready=!0)},function(n,t){n.exports=e},function(e,t){e.exports=n},function(e,n,t){var i=function(e){return e&&e.__esModule?e[\"default\"]:e},o=i(t(2));o.createUUID||(o.createUUID=function(){for(var e=[],n=\"0123456789abcdef\",t=0;36>t;t++)e[t]=n.substr(Math.floor(16*Math.random()),1);return e[14]=\"4\",e[19]=n.substr(3&e[19]|8,1),e[8]=e[13]=e[18]=e[23]=\"-\",e.join(\"\")}),o.instanceId||(o.instanceId=function(){var e=void 0,n=void 0;return function(t){return t&&(n=e,e=t,o.publish({channel:o.configuration.SYSTEM_CHANNEL,topic:\"instanceId.changed\",data:{oldId:n,newId:e}})),e}}())},function(e,n,t){function i(e){return Object.prototype.hasOwnProperty.call(r,e)?r[e].apply(this,Array.prototype.slice.call(arguments,1)):void 0}var o=function(e){return e&&e.__esModule?e[\"default\"]:e};n.getPackingSlip=i,Object.defineProperty(n,\"__esModule\",{value:!0});var a=o(t(2)),r={ping:function(){return{type:\"federation.ping\",instanceId:a.instanceId(),timeStamp:new Date,ticket:a.createUUID()}},pong:function(e){return{type:\"federation.pong\",instanceId:a.instanceId(),timeStamp:new Date,pingData:{instanceId:e.instanceId,timeStamp:e.timeStamp,ticket:e.ticket}}},message:function(e){return{type:\"federation.message\",instanceId:a.instanceId(),timeStamp:new Date,envelope:e}},disconnect:function(){return{type:\"federation.disconnect\",instanceId:a.instanceId(),timeStamp:new Date}},bundle:function(e){return{type:\"federation.bundle\",instanceId:a.instanceId(),timeStamp:new Date,packingSlips:e}}};n.packingSlips=r},function(e,n,t){function i(e){if(e&&e.filterMode&&\"blacklist\"!==e.filterMode&&\"whitelist\"!==e.filterMode)throw new Error(\"postal.fedx filterMode must be 'blacklist' or 'whitelist'.\");return e&&(u._config=r.defaults(e,c)),u._config}function o(e){e=e||{};var n=u._transports;e.transport&&(n={},n[e.transport]=u._transports[e.transport]),r.each(n,function(n){n.disconnect({target:e.target,instanceId:e.instanceId,doNotNotify:!!e.doNotNotify})})}var a=function(e){return e&&e.__esModule?e[\"default\"]:e};n.configure=i,n.disconnect=o,Object.defineProperty(n,\"__esModule\",{value:!0});var r=a(t(1)),c={enabled:!0,filterMode:\"whitelist\",filterDirection:\"both\"},s=function(){};n.NO_OP=s;var u={_clients:[],_transports:{},_ready:!1,_inboundQueue:[],_outboundQueue:[],_signalQueue:[],_config:c};n.state=u},function(e,n,t){function i(e){if(!c._ready)return void c._inboundQueue.push(e);if(!Object.prototype.hasOwnProperty.call(p,e.packingSlip.type))throw new Error(\"postal.federation does not have a message handler for '\"+e.packingSlip.type+\"'.\");p[e.packingSlip.type](e)}var o=function(e){return e&&e.__esModule?e[\"default\"]:e};n.onFederatedMsg=i,Object.defineProperty(n,\"__esModule\",{value:!0});var a=t(4).getPackingSlip,r=t(5),c=r.state,s=r.disconnect,u=t(7).matchesFilter,d=o(t(2)),l=o(t(1)),p={\"federation.ping\":function(e){e.source.setInstanceId(e.packingSlip.instanceId),e.source.handshakeComplete?e.source.sendPong(e.packingSlip):e.source.sendBundle([a(\"pong\",e.packingSlip),a(\"ping\")])},\"federation.pong\":function(e){e.source.handshakeComplete=!0,e.source.setInstanceId(e.packingSlip.instanceId),e.source.pings[e.packingSlip.pingData.ticket]&&(e.source.pings[e.packingSlip.pingData.ticket].callback({ticket:e.packingSlip.pingData.ticket,instanceId:e.packingSlip.instanceId,source:e.source}),e.source.pings[e.packingSlip.pingData.ticket]=void 0),l.contains(c._clients,e.packingSlip.instanceId)||c._clients.push(e.packingSlip.instanceId),d.publish({channel:\"postal.federation\",topic:\"client.federated\",data:{remoteId:e.source.instanceId,localId:d.instanceId(),transport:e.transport}})},\"federation.disconnect\":function(e){c._clients=l.without(c._clients,e.source.instanceId),s({transport:e.source.transportName,instanceId:e.source.instanceId,doNotNotify:!0})},\"federation.message\":function(e){var n=e.packingSlip.envelope;u(n.channel,n.topic,\"in\")&&(n.lastSender=e.packingSlip.instanceId,d.publish(n))},\"federation.bundle\":function(e){l.each(e.packingSlip.packingSlips,function(n){i(l.extend({},e,{packingSlip:n}))})}};n.handlers=p},function(e,n,t){function i(e){e=c.isArray(e)?e:[e],c.each(e,function(e){e.direction=e.direction||s._config.filterDirection,c.each(\"both\"===e.direction?[\"in\",\"out\"]:[e.direction],function(n){d[n][e.channel]?c.include(d[n][e.channel],e.topic)||d[n][e.channel].push(e.topic):d[n][e.channel]=[e.topic]})})}function o(e){e=c.isArray(e)?e:[e],c.each(e,function(e){e.direction=e.direction||s._config.filterDirection,c.each(\"both\"===e.direction?[\"in\",\"out\"]:[e.direction],function(n){d[n][e.channel]&&c.include(d[n][e.channel],e.topic)&&(d[n][e.channel]=c.without(d[n][e.channel],e.topic))})})}function a(e,n,t){var i=Object.prototype.hasOwnProperty.call(d[t],e),o=i&&c.any(d[t][e],function(e){return u.configuration.resolver.compare(e,n)}),a=\"blacklist\"===s._config.filterMode;return s._config.enabled&&(a&&(!i||i&&!o)||!a&&i&&o)}var r=function(e){return e&&e.__esModule?e[\"default\"]:e};n.addFilter=i,n.removeFilter=o,n.matchesFilter=a,Object.defineProperty(n,\"__esModule\",{value:!0});var c=r(t(1)),s=t(5).state,u=r(t(2)),d={\"in\":{},out:{}};n[\"default\"]=d},function(e,n,t){var i=function(e){return e&&e.__esModule?e[\"default\"]:e},o=function(){function e(e,n){for(var t in n){var i=n[t];i.configurable=!0,i.value&&(i.writable=!0)}Object.defineProperties(e,n)}return function(n,t,i){return t&&e(n.prototype,t),i&&e(n,i),n}}(),a=function(e,n){if(!(e instanceof n))throw new TypeError(\"Cannot call a class as a function\")},r=t(4).getPackingSlip,c=t(6).onFederatedMsg,s=t(5),u=s.state,d=s.NO_OP,l=i(t(2)),p=i(t(1)),f=function(){function e(n,t,i){a(this,e),this.target=n,this.options=t||{},this.pings={},this.instanceId=i,this.handshakeComplete=!1}return o(e,{sendPing:{value:function(e){var n=r(\"ping\");this.pings[n.ticket]={ticket:n.ticket,callback:e||d},this.send(n)}},sendPong:{value:function(e){this.send(r(\"pong\",e))}},sendBundle:{value:function(e){this.send(r(\"bundle\",e))}},sendMessage:{value:function(e){if(this.handshakeComplete){e.originId=e.originId||l.instanceId();var n=p.clone(e);!this.instanceId||this.instanceId===n.lastSender||n.knownIds&&n.knownIds.length&&(!n.knownIds||p.include(n.knownIds,this.instanceId))||(n.knownIds=(n.knownIds||[]).concat(p.without(u._clients,this.instanceId)),this.send(r(\"message\",n)))}}},disconnect:{value:function(){this.send(r(\"disconnect\"))}},onMessage:{value:function(e){this.shouldProcess()&&c({transport:this.transportName,packingSlip:e,source:this})}},shouldProcess:{value:function(){return!0}},send:{value:function(){throw new Error(\"An object deriving from FederationClient must provide an implementation for 'send'.\")}},setInstanceId:{value:function(e){this.instanceId=e}}},{extend:{value:function(n,t){function i(){e.apply(this,arguments)}return i.prototype=Object.create(e.prototype),p.extend(i.prototype,n),p.extend(i,t),i}}}),e}();e.exports=f}])});\n//# sourceMappingURL=postal.federation.min.js.map\n}.call(window));"]}