{% do script(['app/js/courseset/show/notes/index.js', 'app/js/course/widgets/choice-course/index.js']) %}

{% set nav = 'note' %}

{% block detail_content %}
  <select class="form-control js-choice-course">
    {% if member %}
      {% set route = 'my_course_show' %}
    {% else %}
      {% set route = 'course_show' %}
    {% endif %}
    {% for selectCourse in courses %}
      <option value="{{ path(route, {id: course.id, selectedCourse: selectCourse.id, tab: 'notes'}) }}#notes" {% if selectCourse.id == selectedCourseId %}selected{% endif %}>{{ selectCourse.title }}</option>
    {% endfor %}
    <option value="{{ path(route, {id: course.id, tab: 'notes'}) }}#notes" {% if 0 == selectedCourseId %}selected{% endif %}>{{ '全部教学计划'|trans }}</option>
  </select>

  <div class="note-list" id="note-list">
    {% for note in notes %}
      {% set author = users[note.userId] %}
      {% set task = tasks[note.taskId]|default(null) %}
      <div class="media note-item">
        <div class="media-left">
          <a class=" js-user-card" href="{{ path('user_show', {'id': author.id }) }}"
             data-card-url="{{ path('user_card_show', {'userId': author.id}) }}" data-user-id="{{ author.id }}">
            <img class="avatar-sm" src="{{ filepath(author.smallAvatar, 'avatar.png') }}">
          </a>
        </div>
        <div class="media-body">
          <div class="content">
            {{ note.content|raw }}
          </div>
          <a href="javascript:;" class="more more-show">[展开全文]</a>
          <div class="metas clearfix">
            <a class="link-dark name" href="{{ path('user_show', {'id': author.id }) }}">{{ author.nickname }}</a>
            · <span>{{ note.createdTime|smart_time }}</span>
            {% if task %}
              · {% if member %}
                  <a href="{{ path('course_task_show', {'courseId': course.id, 'id': note.taskId}) }}" class="period" target="_blank">
                    {{ task.title }}
                  </a>
                {% else %}
                  <a href="javascript:;" class="period">
                    {{ task.title }}
                  </a>
                {% endif %}
            {% else %}
              · 该任务已被删除
            {% endif %}
            <span class="metas-sns">
              <span class="icon-favour">
                <a href="javascript:;" class="js-like {% if note.id in likeNoteIds %}color-primary{% endif %}"
                   data-like-url="{{ path('note_like', {id: note.id}) }}"
                   data-cancel-like-url="{{ path('note_cancel_like', {id: note.id}) }}">
                  <i class="es-icon es-icon-thumbup"></i>
                  <span class="js-like-num">{{ note.likeNum }}</span>
                </a>
              </span>
            </span>
          </div>
        </div>
      </div>
    {% else %}
      <div class="empty">{{'暂无笔记'|trans}}</div>
    {% endfor %}
  </div>

{% endblock %}