{"version":3,"sources":["node_modules/.2.3.0@es-messenger/index.js"],"names":["module","exports","prefix","supportPostMessage","window","Target","target","name","errMsg","arguments","length","Error","prototype","send","msg","postMessage","targetFunc","navigator","Messenger","messengerName","projectName","targets","listenFunc","initListen","addTarget","targetObj","self","generalCallback","data","msgPairs","split","e","pairs","i","document","addEventListener","attachEvent","listen","callback","len","cbIsExist","push","clear","hasOwnProperty"],"mappings":"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","file":"index.js","sourceRoot":"/Users/kz/projects/edusoho","sourcesContent":["/**\n *     __  ___\n *    /  |/  /___   _____ _____ ___   ____   ____ _ ___   _____\n *   / /|_/ // _ \\ / ___// ___// _ \\ / __ \\ / __ `// _ \\ / ___/\n *  / /  / //  __/(__  )(__  )/  __// / / // /_/ //  __// /\n * /_/  /_/ \\___//____//____/ \\___//_/ /_/ \\__, / \\___//_/\n *                                        /____/\n *\n * @description MessengerJS, a common cross-document communicate solution.\n * @author biqing kwok\n * @version 2.2.4\n * @license release under MIT license\n */\n\nmodule.exports = (function () {\n\n    // 消息前缀, 建议使用自己的项目名, 避免多项目之间的冲突\n    // !注意 消息前缀应使用字符串类型\n    var prefix = \"[PROJECT_NAME]\",\n        supportPostMessage = 'postMessage' in window;\n\n    // Target 类, 消息对象\n    function Target(target, name, prefix) {\n        var errMsg = '';\n        if (arguments.length < 2) {\n            errMsg = 'target error - target and name are both required';\n        } else if (typeof target != 'object') {\n            errMsg = 'target error - target itself must be window object';\n        } else if (typeof name != 'string') {\n            errMsg = 'target error - target name must be string type';\n        }\n        if (errMsg) {\n            throw new Error(errMsg);\n        }\n        this.target = target;\n        this.name = name;\n        this.prefix = prefix;\n    }\n\n    // 往 target 发送消息, 出于安全考虑, 发送消息会带上前缀\n    if (supportPostMessage) {\n        // IE8+ 以及现代浏览器支持\n        Target.prototype.send = function (msg) {\n            this.target.postMessage(this.prefix + '|' + this.name + '__Messenger__' + msg, '*');\n        };\n    } else {\n        // 兼容IE 6/7\n        Target.prototype.send = function (msg) {\n            var targetFunc = window.navigator[this.prefix + this.name];\n            if (typeof targetFunc == 'function') {\n                targetFunc(this.prefix + msg, window);\n            } else {\n                throw new Error(\"target callback function is not defined\");\n            }\n        };\n    }\n\n    // 信使类\n    // 创建Messenger实例时指定, 必须指定Messenger的名字, (可选)指定项目名, 以避免Mashup类应用中的冲突\n    // !注意: 父子页面中projectName必须保持一致, 否则无法匹配\n    function Messenger(messengerName, projectName) {\n        this.targets = {};\n        this.name = messengerName;\n        this.listenFunc = [];\n        this.prefix = projectName || prefix;\n        this.initListen();\n    }\n\n    // 添加一个消息对象\n    Messenger.prototype.addTarget = function (target, name) {\n        var targetObj = new Target(target, name, this.prefix);\n        this.targets[name] = targetObj;\n    };\n\n    // 初始化消息监听\n    Messenger.prototype.initListen = function () {\n        var self = this;\n        var generalCallback = function (msg) {\n            if (typeof msg == 'object' && msg.data) {\n                msg = msg.data;\n            }\n\n            try {\n                var msgPairs = msg.split('__Messenger__');\n            } catch (e) {\n                return true;\n            }\n\n            var msg = msgPairs[1];\n            var pairs = msgPairs[0].split('|');\n            var prefix = pairs[0];\n            var name = pairs[1];\n\n            for (var i = 0; i < self.listenFunc.length; i++) {\n                if (prefix + name === self.prefix + self.name) {\n                    self.listenFunc[i](msg);\n                }\n            }\n        };\n\n        if (supportPostMessage) {\n            if ('addEventListener' in document) {\n                window.addEventListener('message', generalCallback, false);\n            } else if ('attachEvent' in document) {\n                window.attachEvent('onmessage', generalCallback);\n            }\n        } else {\n            // 兼容IE 6/7\n            window.navigator[this.prefix + this.name] = generalCallback;\n        }\n    };\n\n    // 监听消息\n    Messenger.prototype.listen = function (callback) {\n        var i = 0;\n        var len = this.listenFunc.length;\n        var cbIsExist = false;\n        for (; i < len; i++) {\n            if (this.listenFunc[i] == callback) {\n                cbIsExist = true;\n                break;\n            }\n        }\n        if (!cbIsExist) {\n            this.listenFunc.push(callback);\n        }\n    };\n    // 注销监听\n    Messenger.prototype.clear = function () {\n        this.listenFunc = [];\n    };\n    // 广播消息\n    Messenger.prototype.send = function (msg) {\n        var targets = this.targets,\n            target;\n        for (target in targets) {\n            if (targets.hasOwnProperty(target)) {\n                targets[target].send(msg);\n            }\n        }\n    };\n\n    return Messenger;\n})();\n"]}