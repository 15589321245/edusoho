{% extends 'courseset-manage/layout.html.twig' %}
{% block title %}{{'计划设置'|trans}} - {{ course.title }} - {{ parent() }}{% endblock %}
{% set side_nav = 'info' %}
{% do script(['libs/es-ckeditor/ckeditor.js','libs/jquery-validation.js','libs/bootstrap-datetimepicker.js','app/js/course-manage/info/index.js']) %}

{% block main %}
  <div class="panel panel-default">
    {% if courseSet.type != 'live' %}
      <div class="panel-heading">
        {{ course.title }}<span class="mh5">／</span>{{'计划设置'|trans}}
        {% if course.status != 'published' %}
          <button class="btn btn-success btn-sm pull-right js-publish-course" 
            data-url="{{ path('course_set_manage_course_publish', {courseSetId: courseSet.id, courseId: course.id}) }}">
            {{ '发布计划'|trans }}
          </button>
        {% endif %}
      </div>
    {% endif %}
    <div class="panel-body">
      <form class="form-horizontal" role="form" id="course-info-form" action="{{path('course_set_manage_course_info', {courseSetId: courseSet.id, courseId: course.id})}}" method="post">
        <div class="form-group">
          <div class="col-sm-2 control-label">
          <label for="title" class="control-label-required">{{'计划名称'|trans}}</label>
          </div>
          <div class="col-sm-8">
            <input type="hidden" name="_csrf_token" value="{{ csrf_token('site') }}">
            <input type="hidden" name="courseSetId" value="{{courseSet.id}}">
            <input type="hidden" name="id" value="{{course.id|default(0)}}">
            <input class="form-control" type="text" id="title" name="title" value="{{course.title|default('')}}">
          </div>
        </div>
        <div class="form-group">
          <label for="" class="col-sm-2 control-label">{{'学习完成规则'|trans}}</label>
          <div class="col-sm-8 radios"> 
            {{ radios('enableFinish', { '1': '必须满足任务完成的条件才算学完'|trans, '0': '学员可以自己点击“学过了”按钮以示学完'|trans }, course.enableFinish|default('1')) }}
          </div>
        </div>
        <div class="form-group">
          <label for="" class="col-sm-2 control-label">{{'学习模式'|trans}}</label>
          <div class="col-sm-8 radios"> 
            {% if course.learnMode|default('freeMode') == 'freeMode' %}
            <label>
              <input type="radio" id="learnFreeMode" name="learnMode" value="freeMode" checked data-role="tab" data-tab-content="#learnFreeModeHelp" >{{'自由模式'|trans}}
            </label>
            {% endif %}
            {% if course.learnMode|default('freeMode') == 'lockMode' %}
            <label>
              <input type="radio" name="learnMode" value="lockMode" checked data-role="tab" data-tab-content="#learnLockModeHelp">
              {{'解锁式学习'|trans}}
            </label>
            {% endif %}
            {% if course.learnMode|default('freeMode') == 'lockMode' %} <p class="help-block" id="learnFreeModeHelp" data-role="tab-content">{{'根据计划预定的顺序学习'|trans}}</p>{% endif %}
            {% if course.learnMode|default('freeMode') == 'freeMode' %}<p class="help-block" id="learnLockModeHelp" data-role="tab-content" >{{'学习过程自由安排'|trans}}</p>{% endif %}
          </div>
        </div>
        <div class="form-group">
        <label class="col-sm-2 control-label">{{'学习有效期模式'|trans}}</label>
        <div class="col-sm-8 radios">
            {{ radios('expiryMode', { 'days': '随到随学'|trans, 'date': '指定日期学习'|trans }, course.expiryMode|default('days'), course.status|default('draft') == 'published'? 'disabled': '') }}
            <div class="mbm mtm {% if course.expiryMode|default('days') == 'date' %}hidden{% endif %}" id="expiry-days">
              {{'学习有效期'|trans}}<input class="form-control mhs" type="text" id="expiryDays" name="expiryDays" style="display:inline-block;width:150px" value="{{course.expiryDays|default('0')}}" {% if course.status|default('draft') == 'published' %}disabled{% endif %}>{{'天'|trans}}
              <span class="color-gray mll">{{'设置为0天则无限制'|trans}}</span>
            </div>
            <div class="mbm mtm {% if course.expiryMode|default('days') == 'days' %}hidden{% endif %}" id="expiry-date">
              {{'开始日期'|trans}}<input class="form-control mls mrl" id="expiryStartDate" type="text" name="expiryStartDate" value="{{course.expiryStartDate|default('now'|date('Y-m-d'))}}" style="display:inline-block;width:150px" 
              {% if course.status|default('draft') == 'published' %}disabled{% endif %}>
            {{'结束日期'|trans}}<input class="form-control mls" type="text" id="expiryEndDate" name="expiryEndDate" value="{{course.expiryEndDate|default('')}}" style="display:inline-block;width:150px"
              {% if course.status|default('draft') == 'published' %}disabled{% endif %}>
            </div>
            <p class="help-block mtm mbm">{{'过期后将无法观看内容，系统默认会在到期前10天提醒学员。'|trans}}</p>
            <div class="color-warning">{{'课程首次发布后“学习有效期方式”将不能再修改'|trans}}</div>
        </div>
        </div>
        <div class="form-group">
          <div class="col-md-2 control-label">
            <label>{{'计划简介'|trans}}</label>
          </div>
          <div class="col-md-8 controls">
            <textarea class="form-control invisible" name="summary" rows="10" id="summary" data-image-upload-url="{{ path('editor_upload', {token:upload_token('course')}) }}">{{ field_value(course, 'summary') }}</textarea>
          </div>
        </div>
        <div class="form-group dynamic-collection" id="course-goals-form-group">
          <div class="col-md-2 control-label">
            <label>{{'课程目标'|trans}}</label>
          </div>
          <div class="col-md-8 controls">
            <div id="course-goals" data-field-name="goals" data-init-value="{{course.goals|default([])|json_encode_utf8()}}"></div>
          </div>
        </div>
        <div class="form-group" id="course-audiences-form-group">
          <div class="col-md-2 control-label">
            <label>{{'适应人群'|trans}}</label>
          </div>
          <div class="col-md-8 controls">
            <div id="intended-students" data-field-name="audiences" data-init-value="{{course.audiences|default([])|json_encode_utf8()}}"></div>
          </div>
        </div>
        <div class="form-group">
          <div class="col-sm-offset-2 col-sm-8">
            <button id="course-submit" type="button" class="btn btn-primary" data-loading-text="{{ '正在保存...'|trans }}">{{ '保存'|trans }}</button>
            <div id="test"></div>
          </div>
        </div>
      </form>
    </div>
  </div>
{% endblock %}