{% extends 'layout.html.twig' %}

{% block title %}{{ '任务学习'|trans }} - {{ parent() }}{% endblock %}

{#{% set script_controller = 'taskbundle/controller/task/show' %}#}
{% set bodyClass = "" %}
{% do script(['libs/perfect-scrollbar.js','libs/es-ckeditor/ckeditor.js','app/js/task/index.js']) %}

{% block body %}
  {% set preview = app.request.query.get('preview') %}
  <div id="js-hidden-data">
    <input type="hidden" name="current-timestamp" value="{{ date().timestamp }}">
    <input type="hidden" name="report-url" value="{{ path('course_task_report', {courseId: task.courseId, id: task.id}) }}">
    <input type="hidden" name="course-id" value="{{ task.courseId }}">
    <input type="hidden" name="task-id" value="{{ task.id }}">
    <input type="hidden" name="task-result-status" value="{{ taskResult.status }}">
    <input type="hidden" name="mode" value="{% if preview %}preview{% else %}learn{% endif %}">
    <input type="hidden" name="isMember" value="{{ isMember ? true : false }}">
    <input type="hidden" name="plugins_url" value="{{ path('course_task_show_plugins', {courseId: task.courseId, taskId: task.id}) }}">
  </div>

  <div class="task-dashboard-page js-task-dashboard-page">
    <div class="dashboard-content" id="dashboard-content">
      <div class="dashboard-header">
        <a class="back-link" href="{{ path('my_course_show',{id:course.id}) }}">
          <i class="es-icon es-icon-chevronleft"></i>
        </a>
        任务：{{ task.title }}
      </div>
      <div class="dashboard-body">
        <iframe id="task-content-iframe" class="task-content-iframe"
                data-event-url="{{ path('course_task_trigger', {courseId: task.courseId, id: task.id}) }}"
                src="{{ path('course_task_activity_show',{courseId:task.courseId, id:task.id }) }}"
                style="width:100%;height:100%;border:0px">
        </iframe>
      </div>

      <div class="dashboard-footer ">
        <div class="state-opration js-state-opration" data-learnmode="{{course.learnMode|default('freeMode')}}">
          <a class="btn btn-gray text-sm js-learn-prompt {% if taskResult.status != 'finish' %}open{% endif %}"
            href="javascript:;" 
            data-toggle="popover"
            data-trigger="hover" 
            data-placement="top"
            data-content='{{ render(controller('AppBundle:Task:finishCondition', {task: task})) }}'>
            <i class="es-icon es-icon-help mrs text-md"></i>任务完成条件
          </a>

          <span
              class="btn text-sm js-learned-prompt color-primary {% if taskResult.status == 'finish' %}open{% endif %}"
              href="javascript:;" 
              data-toggle="popover" 
              data-trigger="hover"
              data-placement="top"
              data-content='{% include "task/task-finished-prompt.html.twig" %}'
              data-url="{{ path('course_task_finished_prompt', {courseId: course.id, id: task.id}) }}">
              <i class="es-icon es-icon-iccheckcircleblack24px mrs text-md"></i>任务完成
          </span>
        </div>

        {% if course.enableFinish and isMember %}
          <a type="button" href="javascript:;"
            {% if taskResult.status != 'finish' %}
              class="btn btn-transparent btn-learn js-btn-learn"
              id='learn-btn'
              data-url='{{ path("course_task_finish",{courseId: task.courseId, id: task.id}) }}'
            {% else %}
              class="btn btn-transparent btn-learn js-btn-learn active"
            {% endif %}>
              <i class="es-icon es-icon--check-circle done"></i>
              <i class="es-icon es-icon-undone-check doing"></i>
            学过了
          </a>
        {% endif %}

      </div>
    </div>
    <div class="dashboard-sidebar" id="dashboard-sidebar">

    </div>
  </div>

  <div id="login-modal" class="modal" data-url="{{ path('login_ajax') }}"></div>
  <div id="modal" class="modal"></div>
  <div id="attachment-modal" class="modal"></div>
{% endblock %}
