{"version":3,"sources":["app/Resources/static-src/app/js/task/plugin/question/form.js"],"names":["$element","$","editor","validator","initEvent","on","expand","save","event","collapse","preventDefault","form","$btn","currentTarget","attr","channel","post","serialize","done","html","publish","removeAttr","fail","error","hasClass","addClass","CKEDITOR","replace","toolbar","filebrowserImageUploadUrl","find","data","validate","rules","messages","val","getData","removeClass","destroy","removeData","clear","each"],"mappings":"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","file":"form.js","sourceRoot":"/Users/kz/projects/edusoho","sourcesContent":["import notify from \"common/notify\";\nimport postal from \"postal\";\n\nexport default class {\n  constructor() {\n    this.$element = $('#task-question-plugin-form');\n    this.editor = null;\n    this.validator = null;\n    this.initEvent();\n  }\n\n  initEvent() {\n    this.$element.on('focusin', '.expand-form-trigger', event => this.expand());\n    this.$element.on('click', '.btn-primary', event => this.save(event));\n    this.$element.on('click', '.collapse-form-btn', event => this.collapse());\n  }\n\n  save(event) {\n    event.preventDefault();\n\n    if (!this.validator || !this.validator.form()) {\n      return;\n    }\n    let $btn = $(event.currentTarget);\n    $btn.attr('disabled', 'disabled');\n\n    let channel = postal.channel('task.plugin.question');\n\n    $.post(this.$element.attr('action'), this.$element.serialize())\n        .done((html) => {\n          notify('success', '提问成功');\n          channel.publish(\"form.save\", {\n            html: html\n          });\n          $btn.removeAttr('disabled');\n          this.collapse();\n        })\n        .fail((error) => {\n          notify('danger', error);\n        })\n    ;\n  }\n\n  expand() {\n    if (this.$element.hasClass('form-expanded')) {\n      return;\n    }\n\n    this.$element.addClass('form-expanded');\n\n    let editor = CKEDITOR.replace('question_content', {\n      toolbar: 'Simple',\n      filebrowserImageUploadUrl: this.$element.find('#question_content').data('imageUploadUrl')\n    });\n\n    this.editor = editor;\n\n    this.validator = this.$element.validate({\n      rules: {\n        'question[title]': 'required',\n        'question[content]': 'required'\n      },\n      messages: {\n        'question[title]': \"请输入问题标题\",\n        'question[content]': \"请输入提问内容\"\n      }\n    });\n\n    editor.on( 'change', () => {\n      this.$element.find('[name=\"question[content]\"]').val(editor.getData());\n    });\n    editor.on('blur', () => {\n      this.$element.find('[name=\"question[content]\"]').val(editor.getData());\n    });\n\n    this.$element.find('.js-detail-form-group').removeClass('hide');\n  }\n\n  collapse() {\n    this.$element.removeClass('form-expanded');\n    this.editor && this.editor.destroy();\n    this.$element.removeData(\"validator\");\n    this.clear();\n    this.$element.find('.js-detail-form-group').addClass('hide');\n  }\n\n  clear() {\n    this.$element.find('input[type=text],textarea').each(function () {\n      $(this).val('');\n    });\n  }\n}"]}