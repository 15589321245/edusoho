{% extends 'TopxiaAdminBundle::layout.html.twig' %}

{% set script_controller = 'announcement/index' %}
{% block title %}{{ getTitle('admin_announcement')}}{% endblock %}
{% set side_menus = permissions('admin_operation') %}
{% set nav = 'operation' %}
{% set menu = 'announcement' %}
{% block content %}
    <div class="col-md-2">
    {% block sidebar %}
        {% include 'TopxiaAdminBundle::side.html.twig' with {menus : side_menus , nav : menu} %}
    {% endblock %}
    </div>

    <div class="col-md-10">
        <h4>{{ admin_macro.title(side_menus,menu) }}</h4>
        
        <div class="clearfix mbs">
            {% set btn_menus = permissions("admin_announcement","button") %}
            {% include 'TopxiaAdminBundle::button.html.twig' with {menus : btn_menus} %}
        </div>

        <table id="announcement-table" class="table table-striped">
          <thead>
            <tr>
              <th width="28%">公告信息</th>
              <th>发布时间</th>
              <th>结束时间</th>
              <th>状态</th>
              <th>发布人</th>
              <th>操作</th>
            </tr>
          </thead>
          <tbody>
          {% if announcements %}
            {% for announcement in announcements %}
            <tr>
              <td><a href="{{announcement.url}}" target="_content">{{announcement.title}}</td>
              <td>{{announcement.startTime|date('Y-m-d H:i:s')}}</td>
              <td>{{announcement.endTime|date('Y-m-d H:i:s')}}</td>
              <td>
                {% if now < announcement.startTime %}
                  即将开始
                {% elseif now > announcement.endTime  %}
                  已结束
                {% else %}
                  显示中
                {% endif %}
              </td>
              <td>{{users[announcement.userId].nickname}}</td>
              <td>  
                <div class="btn-group">

                <button type="button" class="btn btn-default btn-sm dropdown-toggle" data-toggle="dropdown">
                  编辑
                  <span class="caret"></span>
                </button>

                <ul class="dropdown-menu">
                   <li><a href="javascript::" data-url="{{path('admin_announcement_delete',{id:announcement.id})}}" class="delete-btn"><span class="glyphicon glyphicon-trash"></span> 删除</a></li>
                   
                </ul>
              </div>
            </td>
            </tr>
            {% endfor %}
          {% endif %}
          </tbody>
        </table>

        {% if not announcements %}
        <div class="empty">暂无公告</div>
        {% endif %}

        {{ web_macro.paginator(paginator) }}
    </div>
{% endblock %}