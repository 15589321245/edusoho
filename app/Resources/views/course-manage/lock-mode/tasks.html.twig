{% extends 'course-manage/layout.html.twig' %}
{% block title %}{{'计划任务'|trans}} - {{ course.title }} - {{ parent() }}{% endblock %}
{% do script(['libs/jquery-sortable.js','app/js/course-manage/index.js']) %}
{% set side_nav = 'tasks' %}

{% block main %}
  <div class="panel panel-default">
    {% if courseSet.type != 'live' %}
      <div class="panel-heading">
        {{ course.title }}<span class="mh5">／</span>{{'计划任务'|trans}}
        {% if course.status != 'published' %}
          <button class="btn btn-success btn-sm pull-right js-publish-course"
            data-url="{{ path('course_set_manage_course_publish', {courseSetId: courseSet.id, courseId: course.id}) }}">
            {{ '发布计划'|trans }}
          </button>
        {% endif %}
      </div>
    {% endif %}
    <div class="panel-body">
      <div class="task-list-header clearfix">
        任务总数：<span class="color-warning space">{{ taskNum }}</span>  {% if taskPerDay|default(false) %}日均约需完成：<span class="color-warning">{{ taskPerDay }}</span> 个任务{% endif %}
        <div class="pull-right">
          <button class="btn btn-info btn-sm" data-toggle="modal" data-target="#modal" data-backdrop="static" data-keyboard="false" data-url="{{ path('course_manage_task_create', {courseId:course.id}) }}">
            <i class="es-icon es-icon-anonymous-iconfont"></i>
            学习任务
          </button>
          <button class="btn btn-info btn-sm" data-toggle="modal" data-target="#modal" data-backdrop="static" data-keyboard="false" data-url="{{ path('course_manage_task_batch_create', {courseId:course.id,token:uploader_token('courseTask', app.user.id, 'private')}) }}">
            <i class="es-icon es-icon-anonymous-iconfont"></i>
            批量添加
          </button>
          <div class="btn-group">
            <button type="button" class="btn btn-sm btn-success dropdown-toggle" data-toggle="dropdown">
              <i class="es-icon es-icon-anonymous-iconfont"></i>
              {{ setting('default.chapter_name')|default('章'|trans) }}/{{ setting('default.part_name')|default('节'|trans) }}
              <span class="caret"></span>
            </button>
            <ul class="dropdown-menu" role="menu">
              <li>
                <a href="#" id="chapter-create-btn" data-toggle="modal" data-target="#modal" data-backdrop="static"
                  data-keyboard="false" data-url="{{ path('course_manage_chapter_create', {id:course.id}) }}">
                  <i class="es-icon es-icon-anonymous-iconfont"></i>
                  {{ '添加%chapter_name%'|trans({'%chapter_name%': setting('default.chapter_name')|default('章'|trans)}) }}
                </a>
              </li>
              <li>
                <a href="#" id="chapter-create-btn" data-toggle="modal" data-target="#modal" data-backdrop="static"
                  data-keyboard="false" data-url="{{ path('course_manage_chapter_create', {id:course.id, type:'unit'}) }}">
                  <i class="es-icon es-icon-anonymous-iconfont"></i>
                  {{ '添加%part_name%'|trans({'%part_name%': setting('default.part_name')|default('节')}) }}
                </a>
              </li>
            </ul>
          </div>
        </div>
      </div>
      <ul id="sortable-list" class="task-manage-list sortable-list"
          data-sort-url='{{ path("course_manage_items_sort",{courseId: course.id}) }}'>
        {% for key, item in items %}
          {% if item.itemType == 'task' %}
            {% include 'task-manage/list-item-lock-mode.html.twig' with {task:item} %}
          {% elseif item.itemType == 'chapter' %}
            {% include 'course-manage/chapter/list-item-lock-mode.html.twig' with {chapter:item, course:course} %}
          {% endif %}
        {% endfor %}
      </ul>
    </div>
  </div>
{% endblock %}
