webpackJsonp(["app/js/activity-manage/video/index"],{0:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_fileChoose=__webpack_require__("eca7a2561fa47d3f75f6"),_fileChoose2=_interopRequireDefault(_fileChoose),_dialog=__webpack_require__("b00a2728f54f5fed6ab0"),_dialog2=_interopRequireDefault(_dialog),Video=function(){function Video(){_classCallCheck(this,Video),this.showChooseContent(),this.initStep2form(),this.isInitStep3from(),this.autoValidatorLength(),this.initfileChooser()}return _createClass(Video,[{key:"showChooseContent",value:function(){$("#iframe-content").on("click",".js-choose-trigger",function(event){_fileChoose2["default"].openUI(),$('[name="ext[mediaSource]"]').val(null)})}},{key:"initStep2form",value:function(){var $step2_form=$("#step2-form"),validator=$step2_form.data("validator");$step2_form.validate({groups:{date:"minute second"},rules:{title:{required:!0,maxlength:50,trim:!0},minute:"required unsigned_integer",second:"required second_range","ext[mediaSource]":"required","ext[finishDetail]":"unsigned_integer"},messages:{minute:{required:"请输入时长"},second:{required:"请输入时长",second_range:"秒数只能在0-59之间"},"ext[mediaSource]":"请上传或选择%display%"}}),$step2_form.data("validator",validator)}},{key:"initStep3from",value:function(){var $step3_forom=$("#step3-form"),validator=$step3_forom.data("validator");$step3_forom.validate({rules:{"ext[finishDetail]":{required:!0,positive_integer:!0,max:300,min:1}},messages:{"ext[finishDetail]":{required:"请输入时长"}}}),$step3_forom.data("validator",validator)}},{key:"autoValidatorLength",value:function(){$(".js-length").blur(function(){var validator=$("#step2-form").data("validator");if(validator&&validator.form()){var minute=0|parseInt($("#minute").val()),second=0|parseInt($("#second").val());$("#length").val(60*minute+second)}})}},{key:"isInitStep3from",value:function(){var _this=this;"time"===$("#finish-condition").children("option:selected").val()&&($(".viewLength").removeClass("hidden"),this.initStep3from()),$("#finish-condition").on("change",function(event){"time"==event.target.value?($(".viewLength").removeClass("hidden"),_this.initStep3from()):($(".viewLength").addClass("hidden"),$('input[name="ext[finishDetail]"]').rules("remove"))})}},{key:"initfileChooser",value:function(){var fileChooser=new _fileChoose2["default"],subtitleDialog=new _dialog2["default"](".js-subtitle-list"),onSelectFile=function(file){if(_fileChoose2["default"].closeUI(),file.length&&file.length>0){var minute=parseInt(file.length/60),second=Math.round(file.length%60);$("#minute").val(minute),$("#second").val(second),$("#length").val(60*minute+second)}$('[name="ext[mediaSource]"]').val(file.source),"self"==file.source?($("#ext_mediaId").val(file.id),$("#ext_mediaUri").val("")):($("#ext_mediaUri").val(file.uri),$("#ext_mediaId").val(0)),subtitleDialog.render(file)};fileChooser.on("select",onSelectFile)}}]),Video}();new Video},b00a2728f54f5fed6ab0:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_notify=__webpack_require__("b334fd7e4c5a19234db2"),_notify2=_interopRequireDefault(_notify),SubtitleDialog=function(){function SubtitleDialog(element){_classCallCheck(this,SubtitleDialog),this.upload_id="subtitle-uploader",this.inited=!1,this.element=$(element),this.element.length>0&&(this.init(),this.inited=!0);var $container=this.element.closest("#video-subtitle-form-group");$container.find("#ext_mediaId_for_subtitle").val()>0&&this.render({id:$container.find("#ext_mediaId_for_subtitle").val()})}return _createClass(SubtitleDialog,[{key:"init",value:function(){var self=this;this.element.on("click",".js-subtitle-delete",function(){var $elem=$(this);$.post($elem.data("subtitleDeleteUrl"),function(data){data&&((0,_notify2["default"])("success","删除字幕成功"),$elem.parent().remove(),$("#"+self.upload_id).show())})})}},{key:"render",value:function(media){if(this.inited&&media&&"id"in media&&media.id>0){this.media=media,this.element.html("加载字幕...");var self=this;$.get(this.element.data("dialogUrl"),{mediaId:this.media.id},function(html){self.element.html(html),self.initUploader()})}}},{key:"initUploader",value:function(){var self=this,$elem=$("#"+this.upload_id),mediaId=$(".js-subtitle-dialog").data("mediaId"),globalId=$elem.data("mediaGlobalId");this.uploader&&this._destroyUploader();var uploader=new UploaderSDK({initUrl:$elem.data("initUrl"),finishUrl:$elem.data("finishUrl"),id:this.upload_id,ui:"simple",multi:!0,accept:{extensions:["srt"],mimeTypes:["text/srt"]},type:"sub",process:{videoNo:globalId}});uploader.on("error",function(err){"Q_TYPE_DENIED"===err.error&&(0,_notify2["default"])("danger","请上传srt格式的文件！")}),uploader.on("file.finish",function(file){$.post($elem.data("subtitleCreateUrl"),{name:file.name,subtitleId:file.id,mediaId:mediaId}).success(function(data){var convertStatus={waiting:"等待转码",doing:"正在转码",success:"转码成功",error:"转码失败",none:"等待转码"};$(".js-media-subtitle-list").append('<li class="pvs"><span class="subtitle-name prl">'+data.name+'</span><span class="subtitle-transcode-status '+data.convertStatus+'">'+convertStatus[data.convertStatus]+'</span><a href="javascript:;" class="btn-link pll color-primary js-subtitle-delete" data-subtitle-delete-url="/media/'+mediaId+"/subtitle/"+data.id+'/delete">删除</a></li>'),$(".js-media-subtitle-list li").length>3&&$("#"+self.upload_id).hide(),(0,_notify2["default"])("success","字幕上传成功！")}).error(function(data){(0,_notify2["default"])("danger",data.responseJSON.error.message)})}),this.uploader=uploader}},{key:"show",value:function(){var parent=this.element.parent(".form-group");parent.length>0&&parent.removeClass("hide")}},{key:"hide",value:function(){var parent=this.element.parent(".form-group");parent.length>0&&parent.addClass("hide")}},{key:"_destroyUploader",value:function(){if(this.uploader){this.uploader.__events=null;try{this.uploader.destroy()}catch(e){}this.uploader=null}}},{key:"destroy",value:function(){this.inited&&this._destroyUploader()}}]),SubtitleDialog}();exports["default"]=SubtitleDialog}});