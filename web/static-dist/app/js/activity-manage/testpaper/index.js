webpackJsonp(["app/js/activity-manage/testpaper/index"],[function(module,exports,__webpack_require__){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_unit=__webpack_require__("3c398f87808202f19beb"),Testpaper=function(){function Testpaper($element){_classCallCheck(this,Testpaper),this.$element=$element,this.$step2_form=this.$element.find("#step2-form"),this.$step3_form=this.$element.find("#step3-form"),this.$parentiframe=$(window.parent.document).find("#task-create-content-iframe"),this.scoreSlider=null,this._init()}return _createClass(Testpaper,[{key:"_init",value:function(){(0,_unit.dateFormat)(),this.setValidateRule(),this.initEvent(),this.initStepForm2()}},{key:"initEvent",value:function(){var _this=this;this.$element.find("#testpaper-media").on("change",function(event){return _this.changeTestpaper(event)}),this.$element.find("input[name=doTimes]").on("change",function(event){return _this.showRedoInterval(event)}),this.$element.find('input[name="testMode"]').on("change",function(event){return _this.startTimeCheck(event)}),this.$element.find('input[name="length"]').on("blur",function(event){return _this.changeEndTime(event)}),this.$element.find("#condition-select").on("change",function(event){return _this.changeCondition(event)}),this.initSelectTestpaper(this.$element.find("#testpaper-media").find("option:selected"),$('[name="finishScore"]').val())}},{key:"setValidateRule",value:function(){$.validator.addMethod("arithmeticFloat",function(value,element){return this.optional(element)||/^[0-9]+(\.[0-9]?)?$/.test(value)},$.validator.format("必须为正数，保留一位小数")),$.validator.addMethod("positiveInteger",function(value,element){return this.optional(element)||/^[1-9]\d*$/.test(value)},$.validator.format("必须为正整数"))}},{key:"initStepForm2",value:function(){var validator=this.$step2_form.validate({onkeyup:!1,rules:{title:{required:!0,trim:!0,maxlength:50},mediaId:{required:!0,digits:!0},limitedTime:{required:!0,digits:!0},startTime:{required:function(){return 1==$('[name="doTimes"]:checked').val()&&"realTime"==$('[name="testMode"]:checked').val()},DateAndTime:function(){return 1==$('[name="doTimes"]:checked').val()&&"realTime"==$('[name="testMode"]:checked').val()}},redoInterval:{required:function(){return 0==$('[name="doTimes"]:checked').val()},arithmeticFloat:!0,max:1e9}},messages:{mediaId:{required:"请选择%display%"},redoInterval:{max:"最大值不能超过1000000000"}}});this.$step2_form.data("validator",validator)}},{key:"initSelectTestpaper",value:function($option){var passScore=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",mediaId=$option.val();if(""!=mediaId){this.getItemsTable($option.closest("select").data("getTestpaperItems"),mediaId);var score=$option.data("score");""==passScore&&(passScore=Math.ceil(.6*score)),$("#score-single-input").val(passScore),$(".js-score-total").text(score),this.initScoreSlider(parseInt(passScore),parseInt(score))}else $("#questionItemShowDiv").hide()}},{key:"changeTestpaper",value:function(event){var $target=$(event.currentTarget),$option=$target.find("option:selected");this.initSelectTestpaper($option)}},{key:"showRedoInterval",value:function(event){var $this=$(event.currentTarget);1==$this.val()?($("#lesson-redo-interval-field").closest(".form-group").hide(),$(".starttime-check-div").show(),this.dateTimePicker()):($("#lesson-redo-interval-field").closest(".form-group").show(),$(".starttime-check-div").hide())}},{key:"startTimeCheck",value:function(event){var $this=$(event.currentTarget);"realTime"==$this.val()?($(".starttime-input").removeClass("hidden"),this.dateTimePicker()):$(".starttime-input").addClass("hidden")}},{key:"changeEndTime",value:function(event){$('input[name="startTime"]:visible').val()}},{key:"changeCondition",value:function(event){var $this=$(event.currentTarget),value=$this.find("option:selected").val();"score"!=value?$(".js-score-form-group").addClass("hidden"):$(".js-score-form-group").removeClass("hidden")}},{key:"initScoreSlider",value:function(passScore,score){var scoreSlider=document.getElementById("score-slider"),option={start:passScore,connect:[!0,!1],tooltips:[!0],step:1,range:{min:0,max:score}};this.scoreSlider?this.scoreSlider.updateOptions(option):(this.scoreSlider=noUiSlider.create(scoreSlider,option),scoreSlider.noUiSlider.on("update",function(values,handle){$(".noUi-tooltip").text((values[handle]/score*100).toFixed(0)+"%"),$(".js-score-tooltip").css("left",(values[handle]/score*100).toFixed(0)+"%"),$(".js-passScore").text(parseInt(values[handle])),$('input[name="finishScore"]').val(parseInt(values[handle]))}));var html='<div class="score-tooltip js-score-tooltip"><div class="tooltip top" role="tooltip" style="">\n      <div class="tooltip-arrow"></div>\n      <div class="tooltip-inner ">\n      达标分数：<span class="js-passScore">'+passScore+"</span>分\n      </div>\n      </div></div>";$(".noUi-handle").append(html),$(".noUi-tooltip").text((passScore/score*100).toFixed(0)+"%"),$(".js-score-tooltip").css("left",(passScore/score*100).toFixed(0)+"%")}},{key:"getItemsTable",value:function(url,testpaperId){$.post(url,{testpaperId:testpaperId},function(html){$("#questionItemShowTable").html(html),$("#questionItemShowDiv").show()})}},{key:"dateTimePicker",value:function(){var _this2=this,data=new Date,$starttime=$('input[name="startTime"]');!$starttime.is(":visible")||""!=$starttime.val()&&"0"!=$starttime.val()||$starttime.val(data.Format("yyyy-MM-dd hh:mm")),$starttime.datetimepicker({autoclose:!0,format:"yyyy-mm-dd hh:ii",language:"zh",minView:"hour",endDate:new Date(Date.now()+31536e7)}).on("show",function(event){_this2.$parentiframe.height($("body").height()+240)}).on("hide",function(event){_this2.$step2_form.data("validator").form(),_this2.$parentiframe.height($("body").height())}).on("changeDate",function(event){event.date.valueOf()}),$starttime.datetimepicker("setStartDate",data)}}]),Testpaper}();new Testpaper($("#iframe-content"))}]);