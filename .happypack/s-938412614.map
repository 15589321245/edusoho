{"version":3,"sources":["app/Resources/static-src/common/card.js"],"names":["Card","$","on","_this","userId","data","loadingHtml","Translator","trans","timer","setTimeout","length","ajax","type","url","dataType","beforeSend","success","html","bindCardEvent","callback","clone","popover","clearTimeout","find","append","trigger","placement","content","template","container","animation","selector","$btn","button","post","hide","siblings","show"],"mappings":"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","file":"card.js","sourceRoot":"/Users/kz/projects/edusoho","sourcesContent":["import { isMobileDevice } from 'common/utils';\n\nconst Card = () => {\n  if (!isMobileDevice()) {\n    $(\".js-user-card\").on(\"mouseenter\", function () {\n      let _this = $(this);\n      let userId = _this.data('userId');\n      let loadingHtml =\n        '<div class=\"card-body\">' +\n        '<div class=\"card-loader\">' +\n        '<div class=\"loader-inner\">' +\n        '<span></span>' +\n        '<span></span>' +\n        '<span></span>' +\n        '</div>' + Translator.trans('名片加载中') +\n        '</div>' +\n        '</div>';\n      let timer = setTimeout(function () {\n        if ($('#user-card-' + userId).length === 0 || !_this.data('popover')) {\n          $.ajax({\n            type: \"GET\",\n            url: _this.data('cardUrl'),\n            dataType: \"html\",\n            beforeSend: beforeSend(_this, loadingHtml),\n            success(html) {\n              bindCardEvent('.js-card-content');\n              callback(html, _this);\n            }\n          });\n        } else {\n          let html = $('#user-card-' + userId).clone();\n          callback(html, _this);\n        }\n      }, 300);\n      _this.data('timerId', timer);\n    }).on(\"mouseleave\", function () {\n      let _this = $(this);\n      setTimeout(function () {\n        if (!$(\".popover:hover\").length) {\n          _this.popover(\"hide\");\n        }\n      }, 100);\n      clearTimeout(_this.data('timerId'));\n    });\n  }\n};\n\nfunction callback(html, _this) {\n  if ($('#user-card-' + _this.data('userId')).length === 0) {\n    if ($('body').find('#user-card-store').length > 0) {\n      $('#user-card-store').append(html);\n    } else {\n      $('body').append('<div id=\"user-card-store\" class=\"hidden\"></div>');\n      $('#user-card-store').append(html);\n    }\n  }\n  if (!_this.data('popover')) {\n    _this.popover('destroy');\n    _this.popover({\n      trigger: 'manual',\n      placement: 'auto top',\n      html: 'true',\n      content() {\n        return html;\n      },\n      template: '<div class=\"popover es-card\"><div class=\"arrow\"></div><div class=\"popover-content\"></div></div>',\n      container: 'body',\n      animation: true\n    });\n  }\n  _this.popover(\"show\");\n  _this.data('popover', true);\n  $(\".popover\").on(\"mouseleave\", function () {\n    $(_this).popover('hide');\n  });\n}\n\nfunction bindCardEvent(selector) {\n  $('body').on('click', '.js-card-content .follow-btn', function () {\n    let $btn = $(this).button('loading');\n    $.post($btn.data('url'), function () {\n      $btn.button('reset').hide();\n      $btn.siblings('.unfollow-btn').show();\n    });\n  });\n\n  $('body').on('click', '.js-card-content .unfollow-btn', function () {\n    let $btn = $(this).button('loading');\n    $.post($btn.data('url'), function () {\n      $btn.button('reset').hide();\n      $btn.siblings('.follow-btn').show();\n    });\n  });\n}\n\nfunction beforeSend(_this, loadingHtml) {\n  _this.popover({\n    trigger: 'manual',\n    placement: 'auto top',\n    html: 'true',\n    content() {\n      return loadingHtml;\n    },\n    template: '<div class=\"popover es-card\"><div class=\"arrow\"></div><div class=\"popover-content\"></div></div>',\n    container: 'body',\n    animation: true\n  });\n}\n\nexport default Card();\n"]}