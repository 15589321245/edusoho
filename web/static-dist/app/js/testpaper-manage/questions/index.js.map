{"version":3,"sources":["webpack:///./app/Resources/static-src/app/common/component/question-operate/index.js","webpack:///./app/Resources/static-src/app/common/component/question-subjective/index.js","webpack:///./app/Resources/static-src/app/js/testpaper-manage/questions/index.js","webpack:///./app/Resources/static-src/app/js/testpaper-manage/questions/manage.js"],"names":["QuestionOperate","$form","$modal","initEvent","on","deleteQuestion","event","replaceQuestion","previewQuestion","batchDelete","initSortList","find","sortable","containerPath","containerSelector","itemSelector","placeholder","exclude","onDrop","item","container","_super","hasClass","$tbody","parents","each","$tr","$","data","detach","insertAfter","refreshSeqs","$target","currentTarget","excludeIds","push","val","modal","get","join","type","html","stopPropagation","id","closest","remove","length","$redmine","text","Translator","trans","show","setTimeout","slideUp","self","index","questionId","preventDefault","window","open","seq","questionSubjectiveRemask","$element","hasSubjective","$subjectiveRemask","console","log","removeClass","$testpaperItemsManager","QuestionManage","$button","$typeNav","currentType","children","questions","_initEvent","_showPickerModal","_changeNav","_confirmSave","_submitSave","addClass","prop","isOk","_validateScore","passedScoreErrorMsg","siblings","trim","stats","_calTestpaperStats","passedScore","total","score","statsItem","tr","name","count","toFixed","test","focus","missScore","itemType","parseFloat","question","button","post","attr","result","goto","location","href"],"mappings":"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","file":"app/js/testpaper-manage/questions/index.js","sourcesContent":["import notify from 'common/notify';\nimport { questionSubjectiveRemask } from '../question-subjective'\n\nexport default class QuestionOperate {\n  constructor($form, $modal) {\n    this.$form = $form;\n    this.$modal = $modal;\n    this.initEvent();\n  }\n\n  initEvent() { \n    this.$form.on('click','[data-role=\"item-delete-btn\"]',event=>this.deleteQuestion(event));\n    this.$form.on('click','[data-role=\"replace-item\"]',event=>this.replaceQuestion(event));\n    this.$form.on('click','[data-role=\"preview-btn\"]',event=>this.previewQuestion(event));\n    this.$form.on('click','[data-role=\"batch-delete-btn\"]',event=>this.batchDelete(event));\n    this.initSortList();\n  }\n\n  initSortList() {\n    this.$form.find('tbody').sortable({\n      containerPath: '> tr',\n      containerSelector:'tbody',\n      itemSelector: 'tr.is-question',\n      placeholder: '<tr class=\"placeholder\"/>',\n      exclude: '.notMoveHandle',\n      onDrop: (item, container, _super) => {\n        _super(item, container);\n        if (item.hasClass('have-sub-questions')) {\n            let $tbody = item.parents('tbody');\n            $tbody.find('tr.is-question').each(function() {\n                let $tr = $(this);\n                $tbody.find('[data-parent-id=' + $tr.data('id') + ']').detach().insertAfter($tr);\n            });\n        }\n        this.refreshSeqs();\n      }\n    });\n  }\n\n  replaceQuestion(event) {\n    let $target = $(event.currentTarget);\n    let excludeIds = [];\n    let $tbody = this.$form.find(\"tbody:visible\");\n\n    $tbody.find('[name=\"questionIds[]\"]').each(function(){\n      excludeIds.push($(this).val());\n    })\n\n    this.$modal.data('manager', this).modal();\n    $.get($target.data('url'), {excludeIds: excludeIds.join(','), type: $tbody.data('type')}, html => {\n      this.$modal.html(html);\n    });\n  }\n\n  deleteQuestion(event) {\n    event.stopPropagation();\n    let $target = $(event.currentTarget);\n    let id = $target.closest('tr').data('id');\n    let $tbody =  $target.closest('tbody');\n    $tbody.find('[data-parent-id=\"'+id+'\"]').remove();\n    $target.closest('tr').remove();\n    questionSubjectiveRemask(this.$form);\n    this.refreshSeqs();\n  }\n\n  batchDelete(event) {\n    if (this.$form.find('[data-role=\"batch-item\"]:checked').length == 0) {\n      let $redmine = this.$form.find('.js-help-redmine');\n      if($redmine) {\n        $redmine.text(Translator.trans('activity.testpaper_manage.question_required_error_hint')).show();;\n        setTimeout(function() {\n          $redmine.slideUp();\n        }, 3000);\n      }else {\n       notify('danger', Translator.trans('activity.testpaper_manage.question_required_error_hint'));\n      }\n    }\n    let self = this;\n\n    this.$form.find('[data-role=\"batch-item\"]:checked').each(function(index,item){\n      let questionId = $(this).val();\n\n      if ($(this).closest('tr').data('type') == 'material') {\n        self.$form.find('[data-parent-id=\"'+questionId+'\"]').remove();\n      }\n      $(this).closest('tr').remove();\n      \n    })\n    questionSubjectiveRemask(this.$form);\n  }\n\n  previewQuestion(event) {\n    event.preventDefault();\n    window.open($(event.currentTarget).data('url'), '_blank', \"directories=0,height=580,width=820,scrollbars=1,toolbar=0,status=0,menubar=0,location=0\");\n  }\n\n  refreshSeqs() {\n    let seq = 1;\n    this.$form.find(\"tbody tr\").each(function(){\n      let $tr = $(this);\n                  \n      if (!$tr.hasClass('have-sub-questions')) { \n        $tr.find('td.seq').html(seq);\n        seq ++;\n      }\n    });  \n\n    this.$form.find('[name=\"questionLength\"]').val((seq - 1) > 0 ? (seq - 1 ) : null );       \n  }\n}\n\n\n// WEBPACK FOOTER //\n// ./app/Resources/static-src/app/common/component/question-operate/index.js","export let questionSubjectiveRemask = ($element) => {\n  let hasSubjective = false;\n   let html = '';\n  let $subjectiveRemask = $(\".js-subjective-remask\");\n\n  $element.find('tbody tr').each(function() {\n    let type = $(this).data('type');\n    console.log(type);\n    if (type == 'essay') {\n      hasSubjective = true;\n    }\n  });\n  console.log(hasSubjective);\n  if(hasSubjective || $element.find('tbody tr').length == 0) {\n    $subjectiveRemask.html('');\n    return;\n  }\n\n  console.log($subjectiveRemask);\n\n  if($subjectiveRemask.data('type') == 'homework') {\n    html = Translator.trans('activity.homework_manage.objective_question_hint');\n  }\n  else {\n    html = Translator.trans('activity.homework_manage.pass_objective_question_hint');\n  }\n  $subjectiveRemask.html(html).removeClass('hidden');\n}\n\n\n// WEBPACK FOOTER //\n// ./app/Resources/static-src/app/common/component/question-subjective/index.js","import Emitter from 'common/es-event-emitter';\nimport 'jquery-sortable';\nimport BatchSelect from '../../../common/widget/batch-select';\nimport QuestionOperate from '../../../common/component/question-operate';\nimport QuestionManage from './manage';\n\nlet $testpaperItemsManager = $('#testpaper-items-manager');\nnew QuestionOperate($testpaperItemsManager,$(\"#modal\"));\nnew QuestionManage($testpaperItemsManager);\nnew BatchSelect($testpaperItemsManager);\n\n\n\n\n\n// WEBPACK FOOTER //\n// ./app/Resources/static-src/app/js/testpaper-manage/questions/index.js","import notify from 'common/notify';\nexport default class QuestionManage{\n  constructor($element) {\n    this.$element = $element;\n    this.$button = this.$element.find('[data-role=\"pick-item\"]');\n    this.$typeNav = this.$element.find('#testpaper-question-nav');\n    this.$modal = $('#testpaper-confirm-modal');\n    this.currentType = this.$typeNav.find('.active').children().data('type');\n    this.questions = [];\n    this._initEvent();\n  }\n\n  _initEvent() {\n    this.$button.on('click',event => this._showPickerModal(event));\n    this.$typeNav.on('click','li', event => this._changeNav(event));\n    this.$element.on('click','.js-request-save',event => this._confirmSave(event));\n    this.$modal.on('click','.js-confirm-submit',event => this._submitSave(event));\n  }\n\n  _showPickerModal(event) {\n    let excludeIds = [];\n    $('[data-type=\"'+this.currentType+'\"]').find('[name=\"questionIds[]\"]').each(function(){\n        excludeIds.push($(this).val());\n    });\n\n    let $modal = $(\"#modal\").modal();\n    $modal.data('manager', this);\n    $.get(this.$button.data('url'), {excludeIds: excludeIds.join(','), type: this.currentType}, function(html) {\n        $modal.html(html);\n    });\n  }\n\n  _changeNav(event) {\n    let $target = $(event.currentTarget);\n    let type = $target.children().data('type');\n    this.currentType = type;\n\n    this.$typeNav.find('li').removeClass('active');\n    $target.addClass('active');\n\n    this.$element.find('[data-role=\"question-body\"]').addClass('hide');\n    this.$element.find('#testpaper-items-'+type).removeClass('hide');\n    this.$element.find('[data-role=\"batch-select\"]').prop('checked',false);\n    this.$element.find('[data-role=\"batch-item\"]').prop('checked',false);\n  }\n  _confirmSave(event) {\n    let isOk = this._validateScore();\n\n    if (!isOk) {\n        return ;\n    }\n\n    if( $('[name=\"passedScore\"]').length > 0){\n        let passedScoreErrorMsg = $('.passedScoreDiv').siblings('.help-block').html();\n        if ($.trim(passedScoreErrorMsg) != ''){\n            return ;\n        }\n    }\n\n    let stats = this._calTestpaperStats();\n\n    if($('[name=\"passedScore\"]').length > 0){\n      let passedScore = $('input[name=\"passedScore\"]').val();\n      if( passedScore > stats.total.score){\n        notify('danger', Translator.trans('activity.testpaper_manage.setting_pass_score_error_hint', {'passedScore':passedScore, 'totalScore':stats.total.score}));\n        return;\n      }\n    }\n    \n    let html='';\n    $.each(stats, function(index, statsItem){\n        let tr = \"<tr>\";\n            tr += \"<td>\" + statsItem.name + \"</td>\";\n            tr += \"<td>\" + statsItem.count + \"</td>\";\n            tr += \"<td>\" + statsItem.score.toFixed(1) + \"</td>\";\n            tr += \"</tr>\";\n        html += tr;\n    });\n\n    this.$modal.find('.detail-tbody').html(html);\n\n    this.$modal.modal('show');\n  }\n\n  _validateScore() {\n    let isOk = true;\n\n    if (this.$element.find('[name=\"scores[]\"]').length == 0) {\n        notify('danger',Translator.trans('activity.testpaper_manage.question_required_error_hint'));\n        isOk = false;\n    }\n\n    this.$element.find('input[type=\"text\"][name=\"scores[]\"]').each(function() {\n        var score = $(this).val();\n\n        if (score == '0') {\n            notify('danger','activity.testpaper_manage.question_score_empty_hint');\n            isOk = false;\n        }\n\n        if (!/^(([1-9]{1}\\d{0,2})|([0]{1}))(\\.(\\d){1})?$/.test(score)) {\n            notify('danger', Translator.trans('activity.testpaper_manage.question_score_error_hint'));\n            $(this).focus();\n            isOk = false;\n        }\n    });\n\n    return isOk;\n  }\n\n  _calTestpaperStats() {\n    let stats = {};\n    let self = this;\n\n    this.$typeNav.find('li').each(function() {\n        let type = $(this).find('a').data('type'),\n            name = $(this).find('a').data('name');\n            \n\n        stats[type] = {name:name, count:0, score:0, missScore:0};\n\n        self.$element.find('#testpaper-items-'+type).find('[name=\"scores[]\"]').each(function() {\n            let itemType = $(this).closest('tr').data('type');\n            let score = itemType == 'material' ? 0 : parseFloat($(this).val());\n            let question = {};\n\n            if (itemType != 'material') {\n              stats[type]['count'] ++;\n            }\n            \n            stats[type]['score'] += score;\n            stats[type]['missScore'] = parseFloat($(this).data('miss-score'));\n\n            let questionId = $(this).closest('tr').data('id');\n\n            question['id'] = questionId;\n            question['score'] = score;\n            question['missScore'] = parseFloat($(this).data('miss-score'));\n            question['type'] = type;\n            \n            self.questions.push(question);\n        });\n    });\n\n    let total = {name:Translator.trans('activity.testpaper_manage.question_total_score'), count:0, score:0};\n    $.each(stats, function(index, statsItem) {\n        total.count += statsItem.count;\n        total.score += statsItem.score;\n    });\n\n    stats.total = total;\n\n    return stats;\n  }\n\n  _submitSave(event) {\n    let passedScore = 0;\n    let $target = $(event.currentTarget);\n    if ($('input[name=\"passedScore\"]:visible').length > 0) {\n        passedScore = $('input[name=\"passedScore\"]').val();\n    }\n\n    $target.button('loading').addClass('disabled');\n    \n    $.post(this.$element.attr('action'),{questions:this.questions,passedScore:passedScore},function(result){\n      if (result.goto) {\n        window.location.href = result.goto;\n      }\n    })\n  }\n}\n\n\n// WEBPACK FOOTER //\n// ./app/Resources/static-src/app/js/testpaper-manage/questions/manage.js"],"sourceRoot":""}