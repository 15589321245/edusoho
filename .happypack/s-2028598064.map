{"version":3,"sources":["node_modules/.1.2.7@core-js/modules/es6.promise.js"],"names":["$","require","LIBRARY","global","ctx","classof","$export","isObject","anObject","aFunction","strictNew","forOf","setProto","set","same","SPECIES","speciesConstructor","asap","PROMISE","process","isNode","P","empty","Wrapper","testResolve","sub","test","promise","constructor","exec","resolve","USE_NATIVE","works","P2","x","self","prototype","create","value","then","thenableThenGotten","setDesc","get","e","sameConstructor","a","b","getConstructor","C","S","undefined","isThenable","it","PromiseCapability","reject","$$resolve","$$reject","TypeError","perform","error","notify","record","isReject","n","chain","c","v","ok","s","i","run","reaction","handler","fail","result","h","call","length","setTimeout","p","console","isUnhandled","emit","onunhandledrejection","reason","_d","$reject","d","r","slice","$resolve","wrapper","Promise","executor","err","onFulfilled","onRejected","push","G","W","F","capability","iter","all","iterable","values","abrupt","remaining","results","Array","each","index","alreadyCalled","race"],"mappings":"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","file":"es6.promise.js","sourceRoot":"/Users/kz/projects/edusoho","sourcesContent":["'use strict';\nvar $          = require('./$')\n  , LIBRARY    = require('./$.library')\n  , global     = require('./$.global')\n  , ctx        = require('./$.ctx')\n  , classof    = require('./$.classof')\n  , $export    = require('./$.export')\n  , isObject   = require('./$.is-object')\n  , anObject   = require('./$.an-object')\n  , aFunction  = require('./$.a-function')\n  , strictNew  = require('./$.strict-new')\n  , forOf      = require('./$.for-of')\n  , setProto   = require('./$.set-proto').set\n  , same       = require('./$.same-value')\n  , SPECIES    = require('./$.wks')('species')\n  , speciesConstructor = require('./$.species-constructor')\n  , asap       = require('./$.microtask')\n  , PROMISE    = 'Promise'\n  , process    = global.process\n  , isNode     = classof(process) == 'process'\n  , P          = global[PROMISE]\n  , empty      = function(){ /* empty */ }\n  , Wrapper;\n\nvar testResolve = function(sub){\n  var test = new P(empty), promise;\n  if(sub)test.constructor = function(exec){\n    exec(empty, empty);\n  };\n  (promise = P.resolve(test))['catch'](empty);\n  return promise === test;\n};\n\nvar USE_NATIVE = function(){\n  var works = false;\n  function P2(x){\n    var self = new P(x);\n    setProto(self, P2.prototype);\n    return self;\n  }\n  try {\n    works = P && P.resolve && testResolve();\n    setProto(P2, P);\n    P2.prototype = $.create(P.prototype, {constructor: {value: P2}});\n    // actual Firefox has broken subclass support, test that\n    if(!(P2.resolve(5).then(function(){}) instanceof P2)){\n      works = false;\n    }\n    // actual V8 bug, https://code.google.com/p/v8/issues/detail?id=4162\n    if(works && require('./$.descriptors')){\n      var thenableThenGotten = false;\n      P.resolve($.setDesc({}, 'then', {\n        get: function(){ thenableThenGotten = true; }\n      }));\n      works = thenableThenGotten;\n    }\n  } catch(e){ works = false; }\n  return works;\n}();\n\n// helpers\nvar sameConstructor = function(a, b){\n  // library wrapper special case\n  if(LIBRARY && a === P && b === Wrapper)return true;\n  return same(a, b);\n};\nvar getConstructor = function(C){\n  var S = anObject(C)[SPECIES];\n  return S != undefined ? S : C;\n};\nvar isThenable = function(it){\n  var then;\n  return isObject(it) && typeof (then = it.then) == 'function' ? then : false;\n};\nvar PromiseCapability = function(C){\n  var resolve, reject;\n  this.promise = new C(function($$resolve, $$reject){\n    if(resolve !== undefined || reject !== undefined)throw TypeError('Bad Promise constructor');\n    resolve = $$resolve;\n    reject  = $$reject;\n  });\n  this.resolve = aFunction(resolve),\n  this.reject  = aFunction(reject)\n};\nvar perform = function(exec){\n  try {\n    exec();\n  } catch(e){\n    return {error: e};\n  }\n};\nvar notify = function(record, isReject){\n  if(record.n)return;\n  record.n = true;\n  var chain = record.c;\n  asap(function(){\n    var value = record.v\n      , ok    = record.s == 1\n      , i     = 0;\n    var run = function(reaction){\n      var handler = ok ? reaction.ok : reaction.fail\n        , resolve = reaction.resolve\n        , reject  = reaction.reject\n        , result, then;\n      try {\n        if(handler){\n          if(!ok)record.h = true;\n          result = handler === true ? value : handler(value);\n          if(result === reaction.promise){\n            reject(TypeError('Promise-chain cycle'));\n          } else if(then = isThenable(result)){\n            then.call(result, resolve, reject);\n          } else resolve(result);\n        } else reject(value);\n      } catch(e){\n        reject(e);\n      }\n    };\n    while(chain.length > i)run(chain[i++]); // variable length - can't use forEach\n    chain.length = 0;\n    record.n = false;\n    if(isReject)setTimeout(function(){\n      var promise = record.p\n        , handler, console;\n      if(isUnhandled(promise)){\n        if(isNode){\n          process.emit('unhandledRejection', value, promise);\n        } else if(handler = global.onunhandledrejection){\n          handler({promise: promise, reason: value});\n        } else if((console = global.console) && console.error){\n          console.error('Unhandled promise rejection', value);\n        }\n      } record.a = undefined;\n    }, 1);\n  });\n};\nvar isUnhandled = function(promise){\n  var record = promise._d\n    , chain  = record.a || record.c\n    , i      = 0\n    , reaction;\n  if(record.h)return false;\n  while(chain.length > i){\n    reaction = chain[i++];\n    if(reaction.fail || !isUnhandled(reaction.promise))return false;\n  } return true;\n};\nvar $reject = function(value){\n  var record = this;\n  if(record.d)return;\n  record.d = true;\n  record = record.r || record; // unwrap\n  record.v = value;\n  record.s = 2;\n  record.a = record.c.slice();\n  notify(record, true);\n};\nvar $resolve = function(value){\n  var record = this\n    , then;\n  if(record.d)return;\n  record.d = true;\n  record = record.r || record; // unwrap\n  try {\n    if(record.p === value)throw TypeError(\"Promise can't be resolved itself\");\n    if(then = isThenable(value)){\n      asap(function(){\n        var wrapper = {r: record, d: false}; // wrap\n        try {\n          then.call(value, ctx($resolve, wrapper, 1), ctx($reject, wrapper, 1));\n        } catch(e){\n          $reject.call(wrapper, e);\n        }\n      });\n    } else {\n      record.v = value;\n      record.s = 1;\n      notify(record, false);\n    }\n  } catch(e){\n    $reject.call({r: record, d: false}, e); // wrap\n  }\n};\n\n// constructor polyfill\nif(!USE_NATIVE){\n  // 25.4.3.1 Promise(executor)\n  P = function Promise(executor){\n    aFunction(executor);\n    var record = this._d = {\n      p: strictNew(this, P, PROMISE),         // <- promise\n      c: [],                                  // <- awaiting reactions\n      a: undefined,                           // <- checked in isUnhandled reactions\n      s: 0,                                   // <- state\n      d: false,                               // <- done\n      v: undefined,                           // <- value\n      h: false,                               // <- handled rejection\n      n: false                                // <- notify\n    };\n    try {\n      executor(ctx($resolve, record, 1), ctx($reject, record, 1));\n    } catch(err){\n      $reject.call(record, err);\n    }\n  };\n  require('./$.redefine-all')(P.prototype, {\n    // 25.4.5.3 Promise.prototype.then(onFulfilled, onRejected)\n    then: function then(onFulfilled, onRejected){\n      var reaction = new PromiseCapability(speciesConstructor(this, P))\n        , promise  = reaction.promise\n        , record   = this._d;\n      reaction.ok   = typeof onFulfilled == 'function' ? onFulfilled : true;\n      reaction.fail = typeof onRejected == 'function' && onRejected;\n      record.c.push(reaction);\n      if(record.a)record.a.push(reaction);\n      if(record.s)notify(record, false);\n      return promise;\n    },\n    // 25.4.5.1 Promise.prototype.catch(onRejected)\n    'catch': function(onRejected){\n      return this.then(undefined, onRejected);\n    }\n  });\n}\n\n$export($export.G + $export.W + $export.F * !USE_NATIVE, {Promise: P});\nrequire('./$.set-to-string-tag')(P, PROMISE);\nrequire('./$.set-species')(PROMISE);\nWrapper = require('./$.core')[PROMISE];\n\n// statics\n$export($export.S + $export.F * !USE_NATIVE, PROMISE, {\n  // 25.4.4.5 Promise.reject(r)\n  reject: function reject(r){\n    var capability = new PromiseCapability(this)\n      , $$reject   = capability.reject;\n    $$reject(r);\n    return capability.promise;\n  }\n});\n$export($export.S + $export.F * (!USE_NATIVE || testResolve(true)), PROMISE, {\n  // 25.4.4.6 Promise.resolve(x)\n  resolve: function resolve(x){\n    // instanceof instead of internal slot check because we should fix it without replacement native Promise core\n    if(x instanceof P && sameConstructor(x.constructor, this))return x;\n    var capability = new PromiseCapability(this)\n      , $$resolve  = capability.resolve;\n    $$resolve(x);\n    return capability.promise;\n  }\n});\n$export($export.S + $export.F * !(USE_NATIVE && require('./$.iter-detect')(function(iter){\n  P.all(iter)['catch'](function(){});\n})), PROMISE, {\n  // 25.4.4.1 Promise.all(iterable)\n  all: function all(iterable){\n    var C          = getConstructor(this)\n      , capability = new PromiseCapability(C)\n      , resolve    = capability.resolve\n      , reject     = capability.reject\n      , values     = [];\n    var abrupt = perform(function(){\n      forOf(iterable, false, values.push, values);\n      var remaining = values.length\n        , results   = Array(remaining);\n      if(remaining)$.each.call(values, function(promise, index){\n        var alreadyCalled = false;\n        C.resolve(promise).then(function(value){\n          if(alreadyCalled)return;\n          alreadyCalled = true;\n          results[index] = value;\n          --remaining || resolve(results);\n        }, reject);\n      });\n      else resolve(results);\n    });\n    if(abrupt)reject(abrupt.error);\n    return capability.promise;\n  },\n  // 25.4.4.4 Promise.race(iterable)\n  race: function race(iterable){\n    var C          = getConstructor(this)\n      , capability = new PromiseCapability(C)\n      , reject     = capability.reject;\n    var abrupt = perform(function(){\n      forOf(iterable, false, function(promise){\n        C.resolve(promise).then(capability.resolve, reject);\n      });\n    });\n    if(abrupt)reject(abrupt.error);\n    return capability.promise;\n  }\n});"]}