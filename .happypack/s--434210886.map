{"version":3,"sources":["app/Resources/static-src/app/common/doc-player.js"],"names":["console","log","window","parent","$","DocPlayer","element","swfUrl","pdfUrl","watermarkOptions","canCopy","swfPlayerWidth","swfPlayerHeight","swfPlayerUrl","init","isSupportHtml5","isIE9","initPDFJSViewer","initSwfViewer","docPlayer","onmessage","e","undefined","isPageFullScreen","data","docContent","document","removeAttribute","addClss","style","width","body","offsetWidth","position","left","top","zIndex","navigator","appVersion","indexOf","support","leadingWhitespace","attr","src","$iframe","initscren","append","addWatermark","html","Translator","trans","flashVars","doc_url","decodeURI","value","params","bgcolor","allowFullScreen","wmode","allowNetworking","allowscriptaccess","autoPlay","attributes","id","embedSWF","WaterMark"],"mappings":"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","file":"doc-player.js","sourceRoot":"/Users/kz/projects/edusoho","sourcesContent":["import swfobject from 'es-swfobject';\nimport 'app/common/watermark';\n\n        console.log(window.parent);\n\n        console.log($(window.parent));\n\n\nclass DocPlayer {\n  constructor({ element, swfUrl, pdfUrl, watermarkOptions, canCopy }) {\n    this.element = $(element);\n    this.swfUrl = swfUrl || '';\n    this.pdfUrl = pdfUrl || '';\n    this.swfPlayerWidth = '100%';\n    this.swfPlayerHeight = '100%';\n    this.swfPlayerUrl = '';\n    this.watermarkOptions = watermarkOptions || '';\n    this.canCopy = canCopy || false;\n    this.init();\n\n    console.log(watermarkOptions);\n  }\n\n  init() {\n    if (this.isSupportHtml5() && !this.isIE9()) {\n      this.initPDFJSViewer();\n    } else {\n      this.initSwfViewer();\n    }\n\n\n    console.log();\n  }\n\n  initscren(docPlayer) {\n     window.onmessage=function(e){  \n        if(e == null || e == undefined ){\n            return;\n        }\n        var isPageFullScreen = e.data;\n        if(typeof(isPageFullScreen) != \"boolean\"){\n            return ;\n        }\n\n        var docContent =  $('#task-content-iframe', window.parent.document);\n        if (isPageFullScreen) {\n          docContent.removeAttribute(\"style\");\n        }else{\n          docContent.addClss('screen-full');\n          docContent.style.width = window.document.body.offsetWidth+\"px\";\n          docContent.style.position = \"fixed\";\n          docContent.style.left = \"0\";\n          docContent.style.top = \"0\";\n          docContent.style.zIndex = \"9999\";\n        }\n    };\n  }\n\n  isIE9() {\n    return navigator.appVersion.indexOf(\"MSIE 9.\") != -1;\n  }\n\n  isSupportHtml5() {\n    return $.support.leadingWhitespace;\n  }\n\n  initPDFJSViewer() {\n    $(\"html\").attr('dir', 'ltr');\n\n    let src = 'http://opencdn.edusoho.net/pdf.js/v3/viewer.html#' + this.pdfUrl;\n\n    if (!this.canCopy) {\n      src += '#false';\n    }\n\n    // let iframe = document.createElement('iframe');\n    // iframe.style.height = '100%';\n    // iframe.allowfullscreen = true;\n    // iframe.style.width = '100%';\n    // iframe.id = 'doc-pdf-player';\n    // iframe.src = src;\n    // this.element.get(0).appendChild(iframe);\n\n    let $iframe = `<iframe id=\"doc-pdf-player\" class=\"task-content-iframe\" \n   \n     src=\"${src}\" style=\"width:100%;height:100%;border:0px\" \n     allowfullscreen=\"\" webkitallowfullscreen=\"\">\n      </iframe>`;\n\n      this.initscren('doc-pdf-player');\n   \n     this.element.append($iframe);\n\n    this.addWatermark();\n  }\n\n  initSwfViewer() {\n    $.html(`<div id=\"website\"><p align=\"center\" class=\"style1\">${Translator.trans('您还没有安装flash播放器 请点击')}<a href=\"http://www.adobe.com/go/getflashplayer\">${Translator.trans('这里')}</a>${Translator.trans('安装')}</p></div>`);\n\n    let flashVars = {\n      doc_url: decodeURI(this.swfUrl.value)\n    };\n\n    let params = {\n      bgcolor: '#efefef',\n      allowFullScreen: true,\n      wmode: 'window',\n      allowNetworking: 'all',\n      allowscriptaccess: 'always',\n      autoPlay: false\n    };\n\n    let attributes = {\n      id: 'website'\n    };\n\n    swfobject.embedSWF(\n      this.swfPlayerUrl,\n      'website',\n      this.swfPlayerWidth,\n      this.swfPlayerHeight,\n      \"9.0.45\",\n      null,\n      flashVars,\n      params,\n      attributes\n    );\n\n    this.addWatermark();\n  }\n\n  addWatermark() {\n    this.watermarkOptions && this.element.WaterMark(this.watermarkOptions);\n  }\n}\n\n\nexport default DocPlayer;\n"]}