{% extends 'admin/layout.html.twig' %}

{% set script_controller='topxiaadminbundle/controller/bill/cash/index' %}

{% set menu = 'admin_bill' %}

{% block main %}
    {% include 'admin/bill/form-filter.html.twig' %}
    <p class="text-muted">
      <span class="mrl">{{ 'finance.balance'|trans }}：<strong class="inflow-num">{{ math_format(account.cash_amount, 0.01) }}</strong>{{ 'site.currency.CNY'|trans }}</span>
      <span class="mrl">{{ '收入'|trans }}：<strong class="inflow-num">{{ amountInflow }}</strong>{{ 'site.currency.CNY'|trans }}</span>
      <span class="mrl">{{ 'finance.expense'|trans }}：<strong class="outflow-num">{{ amountOutflow }}</strong>{{ 'site.currency.CNY'|trans }}</span>
    </p>

    <div class="table-responsive">
      <table class="table table-striped">
          {% include 'admin/bill/table-header.html.twig' %}
         {% if cashes %}
          {% for cash in cashes %}
          {% set user = users[cash['buyer_id']]|default() %}
            <tr class="text-sm">
              <td><span >{{ cash.sn }}</span></td>
              <td><span>{{ cash.title }}</span><br>
                  {% if cash.order_sn %}
                    <span class="text-muted">{{ 'order.id'|trans }}：{{ cash.order_sn }}</span></td>
                  {% else %}
                      <span class="text-muted">{{ 'order.id'|trans }}：--</span></td>
                  {% endif %}
              <td>
                  {% if user %}
                    <span><a href="{{ path('user_show', {id: user.id}) }}">
                    {{ user.nickname }}</a></span>
                  {% else %}
                      --
                  {% endif %}
              </td>
              <td><span>{{ cash.created_time|date('Y-m-d H:i:s') }}</span></td>
              <td class="text-right prl {% if cash.type =="inflow" %}text-success{% else %}warning-state{% endif %}">
                {{ cash.amount }}
              </td>
              <td>
                <span>
                  {% if cash.type == "inflow" %}
                    {{ dict_text('payment', cash.platform) }}
                  {% else %}
                    {{ 'order.payment_pattern.school'|trans }}
                  {% endif %}
                </span>
              </td>
              <td>{{ cash.trade_sn }}</td>
            </tr>
          {% endfor %}
        {% else %}
            <th colspan="10"><div class="empty">{{ 'site.datagrid.empty'|trans }}</div></th>
        {% endif %}
      </table>
    </div>
    {{ admin_macro.paginator(paginator) }}
{% endblock %}