{"version":3,"sources":["webpack:///./app/Resources/static-src/app/js/activity-manage/editor.js","webpack:///./app/Resources/static-src/app/js/activity-manage/text/index.js","webpack:///./app/Resources/static-src/app/js/activity-manage/text/text.js"],"names":["initEditor","$item","validator","editor","CKEDITOR","replace","toolbar","filebrowserImageUploadUrl","$","data","filebrowserFlashUploadUrl","allowedContent","height","on","console","log","val","getData","form","Text","props","_init","_inItStep2form","_inItStep3form","_lanuchAutoSave","event","$btn","currentTarget","content","setData","remove","$step2_form","validate","rules","title","required","maxlength","trim","course_title","$content","_contentCache","$title","parent","document","_originTitle","text","setInterval","_saveDraft","needSave","post","done","date","Date","now","Translator","trans","getHours","getMinutes","getSeconds","createdTime","$step3_form","finishDetail","positive_integer","max","messages"],"mappings":"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","file":"app/js/activity-manage/text/index.js","sourcesContent":["export const initEditor = ($item, validator) => {\n  \n  var editor = CKEDITOR.replace('text-content-field', {\n    toolbar: 'Task',\n    filebrowserImageUploadUrl: $('#text-content-field').data('imageUploadUrl'),\n    filebrowserFlashUploadUrl: $('#text-content-field').data('flashUploadUrl'),\n    allowedContent: true,\n    height: 280,\n  });\n  \n  editor.on('change', () => {\n    console.log('change');\n    $item.val(editor.getData());\n    if (validator) {\n      validator.form();\n    }\n  });\n\n  //fix ie11 中文输入\n  editor.on('blur', () => {\n     console.log('blur');\n    $item.val(editor.getData());\n    if (validator) {\n      validator.form();\n    }\n  });\n\n  return editor;\n};\n\n\n// WEBPACK FOOTER //\n// ./app/Resources/static-src/app/js/activity-manage/editor.js","import Text from './text';\n\nnew Text();\n\n\n\n// WEBPACK FOOTER //\n// ./app/Resources/static-src/app/js/activity-manage/text/index.js","import { initEditor } from \"../editor\";\nimport \"store\";\nexport default class Text {\n  constructor(props) {\n    this._init();\n  }\n\n  _init() {\n    this._inItStep2form();\n    this._inItStep3form();\n    this._lanuchAutoSave();\n\n    $('.js-continue-edit').on('click', (event) => {\n      const $btn = $(event.currentTarget);\n      const content = $btn.data('content');\n      this.editor.setData(content);\n      $btn.remove();\n    });\n  }\n\n  _inItStep2form() {\n    const $step2_form = $('#step2-form');\n    let validator = $step2_form.data('validator');\n    validator = $step2_form.validate({\n      rules: {\n        title: {\n          required: true,\n          maxlength: 50,\n          trim: true,\n          course_title: true,\n        },\n        content: {\n          required: true,\n          trim: true,\n        },\n      },\n    });\n    const $content = $('[name=\"content\"]');\n    this.editor = initEditor($content, validator);\n    this._contentCache = $content.val();\n  }\n\n  _lanuchAutoSave() {\n    const $title = $('#modal .modal-title', parent.document);\n    this._originTitle = $title.text();\n    setInterval(() => {\n      this._saveDraft();\n    }, 5000);\n  }\n\n  _saveDraft() {\n    const content = this.editor.getData();\n    const needSave = content !== this._contentCache;\n    if (!needSave) {\n      return;\n    }\n    const $content = $('[name=\"content\"]');\n    $.post($content.data('saveDraftUrl'), { content: content })\n      .done(() => {\n        const date = new Date(); //日期对象\n        const $title = $('#modal .modal-title', parent.document);\n        const now = Translator.trans('site.date_format_his', {'hours': date.getHours(), 'minutes': date.getMinutes(), 'seconds': date.getSeconds()});\n        $title.text(this._originTitle + Translator.trans('activity.text_manage.save_draft_hint', { createdTime: now }));\n        this._contentCache = content;\n      });\n  }\n\n  _inItStep3form() {\n    const $step3_form = $('#step3-form');\n    let validator = $step3_form.data('validator');\n    validator = $step3_form.validate({\n      rules: {\n        finishDetail: {\n          required: true,\n          positive_integer: true,\n          max: 300,\n        },\n      },\n      messages: {\n        finishDetail: {\n          required: Translator.trans('activity.text_manage.finish_detail_required_error_hint'),\n        },\n      },\n    });\n  }\n}\n\n\n// WEBPACK FOOTER //\n// ./app/Resources/static-src/app/js/activity-manage/text/text.js"],"sourceRoot":""}