{"version":3,"sources":["webpack:///./app/Resources/static-src/app/js/activity/video/index.js","webpack:///./app/Resources/static-src/app/js/activity/video/video-play.js","webpack:///./app/Resources/static-src/app/js/activity/video/video-recorder.js"],"names":["recorder","videoplay","play","VideoPlay","player","intervalId","emitter","$","length","_playerSwf","_playVideo","record","setInterval","addVideoPlayerCounter","swf_dom","embedSWF","data","wmode","allowFullScreen","messenger","name","project","children","type","on","msg","playing","_onFinishLearnTask","watching","currentTime","emit","then","clearInterval","catch","error","console","VideoRecorder","container","interval","playerCounter","activityId","store","get","set","watchTime","log","url","post","response","status","window","location","reload"],"mappings":"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","file":"app/js/activity/video/index.js","sourcesContent":["import VideoRecorder from './video-recorder';\nimport VideoPlay from './video-play';\n\nlet recorder = new VideoRecorder('#video-content');\nlet videoplay = new VideoPlay(recorder);\nvideoplay.play();\n\n\n\n// WEBPACK FOOTER //\n// ./app/Resources/static-src/app/js/activity/video/index.js","import swfobject from 'es-swfobject';\nimport EsMessenger from 'app/common/messenger';\nimport ActivityEmitter from 'app/js/activity/activity-emitter';\n\nexport default class VideoPlay {\n  constructor(recorder) {\n    this.player = {};\n    this.intervalId = null;\n    this.recorder = recorder;\n    this.emitter = new ActivityEmitter();\n  }\n\n  play() {\n    if ($('#swf-player').length) {\n      this._playerSwf();\n    } else {\n      this._playVideo();\n    }\n    this.record();\n  }\n\n  record() {\n    this.intervalId = setInterval(() => {\n      this.recorder.addVideoPlayerCounter(this.emitter, this.player);\n    }, 1000);\n  }\n\n  getPlay() {\n    return this.player;\n  }\n\n  _playerSwf() {\n    const swf_dom = 'swf-player';\n    swfobject.embedSWF($('#' + swf_dom).data('url'),\n      swf_dom, '100%', '100%', \"9.0.0\", null, null, {\n        wmode: 'opaque',\n        allowFullScreen: 'true'\n      });\n  }\n\n  _playVideo() {\n    var messenger = new EsMessenger({\n      name: 'partner',\n      project: 'PlayerProject',\n      children: [],\n      type: 'parent'\n    });\n\n    messenger.on(\"ended\", (msg) => {\n      this.player.playing = false;\n      this._onFinishLearnTask(msg);\n    });\n\n    messenger.on(\"playing\", (msg) => {\n      this.player.playing = true;\n    });\n\n    messenger.on(\"paused\", (msg) => {\n      this.player.playing = false;\n      this.recorder.watching(this.emitter);\n    });\n\n    messenger.on(\"timechange\", (msg) => {\n      this.player.currentTime = msg.currentTime;\n    });\n  }\n\n  _onFinishLearnTask(msg) {\n    this.emitter.emit('finish', { data: msg }).then(() => {\n      clearInterval(this.intervalId);\n    }).catch((error) => {\n      console.error(error);\n    });\n  }\n\n}\n\n\n// WEBPACK FOOTER //\n// ./app/Resources/static-src/app/js/activity/video/video-play.js","import 'store';\n\nexport default class VideoRecorder {\n\tconstructor(container) {\n\t\tthis.container = container;\n\t\tthis.interval = 120;\n\t\tthis.playerCounter = 0;\n\t\tthis.activityId = $(this.container).data('id');\n\t}\n\n\taddVideoPlayerCounter(emitter, player) {\n\t\tlet playerCounter = store.get(\"activity_id_\" + this.activityId + \"_playing_counter\");\n\t\tif (!playerCounter) {\n\t\t\tthis.playerCounter = 0;\n\t\t}\n\t\tif (!(player && player.playing)) {\n\t\t\treturn false;\n\t\t}\n\t\tif (playerCounter >= this.interval) {\n\t\t\tthis.watching(emitter);\n\t\t} else if (player.playing) {\n\t\t\tthis.playerCounter++;\n\t\t}\n\t\tstore.set(\"activity_id_\" + this.activityId + \"_playing_counter\", this.playerCounter);\n\t}\n\n\twatching(emitter) {\n\t\tlet watchTime = store.get(\"activity_id_\" + this.activityId + \"_playing_counter\");\n\t\tconsole.log(watchTime);\n\t\temitter.emit('watching', {watchTime: watchTime}).then(() => {\n\t\t\tlet url = $(\"#video-content\").data('watchUrl');\n\t\t\t$.post(url, function (response) {\n\t\t\t\tif (response && response.status == 'error') {\n\t\t\t\t\twindow.location.reload();\n\t\t\t\t}\n\t\t\t})\n\t\t}).catch((error) => {\n\t\t\tconsole.error(error);\n\t\t});\n\t\tthis.playerCounter = 0;\n\t}\n}\n\n\n\n\n// WEBPACK FOOTER //\n// ./app/Resources/static-src/app/js/activity/video/video-recorder.js"],"sourceRoot":""}